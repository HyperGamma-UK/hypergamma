var Il=Object.defineProperty;var Ml=(t,e,i)=>e in t?Il(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Z=(t,e,i)=>(Ml(t,typeof e!="symbol"?e+"":e,i),i),Gr=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)};var Se=(t,e,i)=>(Gr(t,e,"read from private field"),i?i.call(t):e.get(t)),qe=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},it=(t,e,i,r)=>(Gr(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i);var Ui=(t,e,i)=>(Gr(t,e,"access private method"),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Qi=window,Ls=Qi.ShadowRoot&&(Qi.ShadyCSS===void 0||Qi.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Is=Symbol(),In=new WeakMap;let mo=class{constructor(e,i,r){if(this._$cssResult$=!0,r!==Is)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=i}get styleSheet(){let e=this.o;const i=this.t;if(Ls&&e===void 0){const r=i!==void 0&&i.length===1;r&&(e=In.get(i)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&In.set(i,e))}return e}toString(){return this.cssText}};const Dl=t=>new mo(typeof t=="string"?t:t+"",void 0,Is),fi=(t,...e)=>{const i=t.length===1?t[0]:e.reduce((r,s,n)=>r+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[n+1],t[0]);return new mo(i,t,Is)},Rl=(t,e)=>{Ls?t.adoptedStyleSheets=e.map(i=>i instanceof CSSStyleSheet?i:i.styleSheet):e.forEach(i=>{const r=document.createElement("style"),s=Qi.litNonce;s!==void 0&&r.setAttribute("nonce",s),r.textContent=i.cssText,t.appendChild(r)})},Mn=Ls?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let i="";for(const r of e.cssRules)i+=r.cssText;return Dl(i)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Wr;const cr=window,Dn=cr.trustedTypes,Fl=Dn?Dn.emptyScript:"",Rn=cr.reactiveElementPolyfillSupport,ms={toAttribute(t,e){switch(e){case Boolean:t=t?Fl:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=t!==null;break;case Number:i=t===null?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch{i=null}}return i}},vo=(t,e)=>e!==t&&(e==e||t==t),Yr={attribute:!0,type:String,converter:ms,reflect:!1,hasChanged:vo};let Xt=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var i;this.finalize(),((i=this.h)!==null&&i!==void 0?i:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach((i,r)=>{const s=this._$Ep(r,i);s!==void 0&&(this._$Ev.set(s,r),e.push(s))}),e}static createProperty(e,i=Yr){if(i.state&&(i.attribute=!1),this.finalize(),this.elementProperties.set(e,i),!i.noAccessor&&!this.prototype.hasOwnProperty(e)){const r=typeof e=="symbol"?Symbol():"__"+e,s=this.getPropertyDescriptor(e,r,i);s!==void 0&&Object.defineProperty(this.prototype,e,s)}}static getPropertyDescriptor(e,i,r){return{get(){return this[i]},set(s){const n=this[e];this[i]=s,this.requestUpdate(e,n,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Yr}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),e.h!==void 0&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const i=this.properties,r=[...Object.getOwnPropertyNames(i),...Object.getOwnPropertySymbols(i)];for(const s of r)this.createProperty(s,i[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const i=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const s of r)i.unshift(Mn(s))}else e!==void 0&&i.push(Mn(e));return i}static _$Ep(e,i){const r=i.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise(i=>this.enableUpdating=i),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach(i=>i(this))}addController(e){var i,r;((i=this._$ES)!==null&&i!==void 0?i:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((r=e.hostConnected)===null||r===void 0||r.call(e))}removeController(e){var i;(i=this._$ES)===null||i===void 0||i.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((e,i)=>{this.hasOwnProperty(i)&&(this._$Ei.set(i,this[i]),delete this[i])})}createRenderRoot(){var e;const i=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return Rl(i,this.constructor.elementStyles),i}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach(i=>{var r;return(r=i.hostConnected)===null||r===void 0?void 0:r.call(i)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach(i=>{var r;return(r=i.hostDisconnected)===null||r===void 0?void 0:r.call(i)})}attributeChangedCallback(e,i,r){this._$AK(e,r)}_$EO(e,i,r=Yr){var s;const n=this.constructor._$Ep(e,r);if(n!==void 0&&r.reflect===!0){const a=(((s=r.converter)===null||s===void 0?void 0:s.toAttribute)!==void 0?r.converter:ms).toAttribute(i,r.type);this._$El=e,a==null?this.removeAttribute(n):this.setAttribute(n,a),this._$El=null}}_$AK(e,i){var r;const s=this.constructor,n=s._$Ev.get(e);if(n!==void 0&&this._$El!==n){const a=s.getPropertyOptions(n),l=typeof a.converter=="function"?{fromAttribute:a.converter}:((r=a.converter)===null||r===void 0?void 0:r.fromAttribute)!==void 0?a.converter:ms;this._$El=n,this[n]=l.fromAttribute(i,a.type),this._$El=null}}requestUpdate(e,i,r){let s=!0;e!==void 0&&(((r=r||this.constructor.getPropertyOptions(e)).hasChanged||vo)(this[e],i)?(this._$AL.has(e)||this._$AL.set(e,i),r.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,r))):s=!1),!this.isUpdatePending&&s&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(i){Promise.reject(i)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((s,n)=>this[n]=s),this._$Ei=void 0);let i=!1;const r=this._$AL;try{i=this.shouldUpdate(r),i?(this.willUpdate(r),(e=this._$ES)===null||e===void 0||e.forEach(s=>{var n;return(n=s.hostUpdate)===null||n===void 0?void 0:n.call(s)}),this.update(r)):this._$Ek()}catch(s){throw i=!1,this._$Ek(),s}i&&this._$AE(r)}willUpdate(e){}_$AE(e){var i;(i=this._$ES)===null||i===void 0||i.forEach(r=>{var s;return(s=r.hostUpdated)===null||s===void 0?void 0:s.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach((i,r)=>this._$EO(r,this[r],i)),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};Xt.finalized=!0,Xt.elementProperties=new Map,Xt.elementStyles=[],Xt.shadowRootOptions={mode:"open"},Rn==null||Rn({ReactiveElement:Xt}),((Wr=cr.reactiveElementVersions)!==null&&Wr!==void 0?Wr:cr.reactiveElementVersions=[]).push("1.6.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Xr;const hr=window,ai=hr.trustedTypes,Fn=ai?ai.createPolicy("lit-html",{createHTML:t=>t}):void 0,vs="$lit$",_t=`lit$${(Math.random()+"").slice(9)}$`,wo="?"+_t,Ul=`<${wo}>`,li=document,Ei=()=>li.createComment(""),Ni=t=>t===null||typeof t!="object"&&typeof t!="function",So=Array.isArray,Jl=t=>So(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",Kr=`[ 	
\f\r]`,yi=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Un=/-->/g,Jn=/>/g,Bt=RegExp(`>|${Kr}(?:([^\\s"'>=/]+)(${Kr}*=${Kr}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),$n=/'/g,zn=/"/g,ko=/^(?:script|style|textarea|title)$/i,$l=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),be=$l(1),Mt=Symbol.for("lit-noChange"),Ae=Symbol.for("lit-nothing"),qn=new WeakMap,ii=li.createTreeWalker(li,129,null,!1),zl=(t,e)=>{const i=t.length-1,r=[];let s,n=e===2?"<svg>":"",a=yi;for(let c=0;c<i;c++){const f=t[c];let u,h,p=-1,y=0;for(;y<f.length&&(a.lastIndex=y,h=a.exec(f),h!==null);)y=a.lastIndex,a===yi?h[1]==="!--"?a=Un:h[1]!==void 0?a=Jn:h[2]!==void 0?(ko.test(h[2])&&(s=RegExp("</"+h[2],"g")),a=Bt):h[3]!==void 0&&(a=Bt):a===Bt?h[0]===">"?(a=s??yi,p=-1):h[1]===void 0?p=-2:(p=a.lastIndex-h[2].length,u=h[1],a=h[3]===void 0?Bt:h[3]==='"'?zn:$n):a===zn||a===$n?a=Bt:a===Un||a===Jn?a=yi:(a=Bt,s=void 0);const _=a===Bt&&t[c+1].startsWith("/>")?" ":"";n+=a===yi?f+Ul:p>=0?(r.push(u),f.slice(0,p)+vs+f.slice(p)+_t+_):f+_t+(p===-2?(r.push(void 0),c):_)}const l=n+(t[i]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[Fn!==void 0?Fn.createHTML(l):l,r]};class Bi{constructor({strings:e,_$litType$:i},r){let s;this.parts=[];let n=0,a=0;const l=e.length-1,c=this.parts,[f,u]=zl(e,i);if(this.el=Bi.createElement(f,r),ii.currentNode=this.el.content,i===2){const h=this.el.content,p=h.firstChild;p.remove(),h.append(...p.childNodes)}for(;(s=ii.nextNode())!==null&&c.length<l;){if(s.nodeType===1){if(s.hasAttributes()){const h=[];for(const p of s.getAttributeNames())if(p.endsWith(vs)||p.startsWith(_t)){const y=u[a++];if(h.push(p),y!==void 0){const _=s.getAttribute(y.toLowerCase()+vs).split(_t),m=/([.?@])?(.*)/.exec(y);c.push({type:1,index:n,name:m[2],strings:_,ctor:m[1]==="."?Vl:m[1]==="?"?Gl:m[1]==="@"?Wl:br})}else c.push({type:6,index:n})}for(const p of h)s.removeAttribute(p)}if(ko.test(s.tagName)){const h=s.textContent.split(_t),p=h.length-1;if(p>0){s.textContent=ai?ai.emptyScript:"";for(let y=0;y<p;y++)s.append(h[y],Ei()),ii.nextNode(),c.push({type:2,index:++n});s.append(h[p],Ei())}}}else if(s.nodeType===8)if(s.data===wo)c.push({type:2,index:n});else{let h=-1;for(;(h=s.data.indexOf(_t,h+1))!==-1;)c.push({type:7,index:n}),h+=_t.length-1}n++}}static createElement(e,i){const r=li.createElement("template");return r.innerHTML=e,r}}function ci(t,e,i=t,r){var s,n,a,l;if(e===Mt)return e;let c=r!==void 0?(s=i._$Co)===null||s===void 0?void 0:s[r]:i._$Cl;const f=Ni(e)?void 0:e._$litDirective$;return(c==null?void 0:c.constructor)!==f&&((n=c==null?void 0:c._$AO)===null||n===void 0||n.call(c,!1),f===void 0?c=void 0:(c=new f(t),c._$AT(t,i,r)),r!==void 0?((a=(l=i)._$Co)!==null&&a!==void 0?a:l._$Co=[])[r]=c:i._$Cl=c),c!==void 0&&(e=ci(t,c._$AS(t,e.values),c,r)),e}let ql=class{constructor(e,i){this.u=[],this._$AN=void 0,this._$AD=e,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(e){var i;const{el:{content:r},parts:s}=this._$AD,n=((i=e==null?void 0:e.creationScope)!==null&&i!==void 0?i:li).importNode(r,!0);ii.currentNode=n;let a=ii.nextNode(),l=0,c=0,f=s[0];for(;f!==void 0;){if(l===f.index){let u;f.type===2?u=new Ms(a,a.nextSibling,this,e):f.type===1?u=new f.ctor(a,f.name,f.strings,this,e):f.type===6&&(u=new Yl(a,this,e)),this.u.push(u),f=s[++c]}l!==(f==null?void 0:f.index)&&(a=ii.nextNode(),l++)}return n}p(e){let i=0;for(const r of this.u)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,i),i+=r.strings.length-2):r._$AI(e[i])),i++}},Ms=class Ao{constructor(e,i,r,s){var n;this.type=2,this._$AH=Ae,this._$AN=void 0,this._$AA=e,this._$AB=i,this._$AM=r,this.options=s,this._$Cm=(n=s==null?void 0:s.isConnected)===null||n===void 0||n}get _$AU(){var e,i;return(i=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&i!==void 0?i:this._$Cm}get parentNode(){let e=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=i.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,i=this){e=ci(this,e,i),Ni(e)?e===Ae||e==null||e===""?(this._$AH!==Ae&&this._$AR(),this._$AH=Ae):e!==this._$AH&&e!==Mt&&this.g(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):Jl(e)?this.k(e):this.g(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}g(e){this._$AH!==Ae&&Ni(this._$AH)?this._$AA.nextSibling.data=e:this.T(li.createTextNode(e)),this._$AH=e}$(e){var i;const{values:r,_$litType$:s}=e,n=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=Bi.createElement(s.h,this.options)),s);if(((i=this._$AH)===null||i===void 0?void 0:i._$AD)===n)this._$AH.p(r);else{const a=new ql(n,this),l=a.v(this.options);a.p(r),this.T(l),this._$AH=a}}_$AC(e){let i=qn.get(e.strings);return i===void 0&&qn.set(e.strings,i=new Bi(e)),i}k(e){So(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let r,s=0;for(const n of e)s===i.length?i.push(r=new Ao(this.S(Ei()),this.S(Ei()),this,this.options)):r=i[s],r._$AI(n),s++;s<i.length&&(this._$AR(r&&r._$AB.nextSibling,s),i.length=s)}_$AR(e=this._$AA.nextSibling,i){var r;for((r=this._$AP)===null||r===void 0||r.call(this,!1,!0,i);e&&e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var i;this._$AM===void 0&&(this._$Cm=e,(i=this._$AP)===null||i===void 0||i.call(this,e))}},br=class{constructor(e,i,r,s,n){this.type=1,this._$AH=Ae,this._$AN=void 0,this.element=e,this.name=i,this._$AM=s,this.options=n,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=Ae}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,i=this,r,s){const n=this.strings;let a=!1;if(n===void 0)e=ci(this,e,i,0),a=!Ni(e)||e!==this._$AH&&e!==Mt,a&&(this._$AH=e);else{const l=e;let c,f;for(e=n[0],c=0;c<n.length-1;c++)f=ci(this,l[r+c],i,c),f===Mt&&(f=this._$AH[c]),a||(a=!Ni(f)||f!==this._$AH[c]),f===Ae?e=Ae:e!==Ae&&(e+=(f??"")+n[c+1]),this._$AH[c]=f}a&&!s&&this.j(e)}j(e){e===Ae?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}};class Vl extends br{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ae?void 0:e}}const Hl=ai?ai.emptyScript:"";class Gl extends br{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Ae?this.element.setAttribute(this.name,Hl):this.element.removeAttribute(this.name)}}let Wl=class extends br{constructor(e,i,r,s,n){super(e,i,r,s,n),this.type=5}_$AI(e,i=this){var r;if((e=(r=ci(this,e,i,0))!==null&&r!==void 0?r:Ae)===Mt)return;const s=this._$AH,n=e===Ae&&s!==Ae||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,a=e!==Ae&&(s===Ae||n);n&&this.element.removeEventListener(this.name,this,s),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var i,r;typeof this._$AH=="function"?this._$AH.call((r=(i=this.options)===null||i===void 0?void 0:i.host)!==null&&r!==void 0?r:this.element,e):this._$AH.handleEvent(e)}},Yl=class{constructor(e,i,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=i,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){ci(this,e)}};const Vn=hr.litHtmlPolyfillSupport;Vn==null||Vn(Bi,Ms),((Xr=hr.litHtmlVersions)!==null&&Xr!==void 0?Xr:hr.litHtmlVersions=[]).push("2.7.0");const Xl=(t,e,i)=>{var r,s;const n=(r=i==null?void 0:i.renderBefore)!==null&&r!==void 0?r:e;let a=n._$litPart$;if(a===void 0){const l=(s=i==null?void 0:i.renderBefore)!==null&&s!==void 0?s:null;n._$litPart$=a=new Ms(e.insertBefore(Ei(),l),l,void 0,i??{})}return a._$AI(t),a};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Zr,Qr;class lt extends Xt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,i;const r=super.createRenderRoot();return(e=(i=this.renderOptions).renderBefore)!==null&&e!==void 0||(i.renderBefore=r.firstChild),r}update(e){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Xl(i,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return Mt}}lt.finalized=!0,lt._$litElement$=!0,(Zr=globalThis.litElementHydrateSupport)===null||Zr===void 0||Zr.call(globalThis,{LitElement:lt});const Hn=globalThis.litElementPolyfillSupport;Hn==null||Hn({LitElement:lt});((Qr=globalThis.litElementVersions)!==null&&Qr!==void 0?Qr:globalThis.litElementVersions=[]).push("3.3.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Kl={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Zl=t=>(...e)=>({_$litDirective$:t,values:e});let Ql=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,i,r){this._$Ct=e,this._$AM=i,this._$Ci=r}_$AS(e,i){return this.update(e,i)}update(e,i){return this.render(...i)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ec=Zl(class extends Ql{constructor(t){var e;if(super(t),t.type!==Kl.ATTRIBUTE||t.name!=="style"||((e=t.strings)===null||e===void 0?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,i)=>{const r=t[i];return r==null?e:e+`${i=i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`},"")}update(t,[e]){const{style:i}=t.element;if(this.vt===void 0){this.vt=new Set;for(const r in e)this.vt.add(r);return this.render(e)}this.vt.forEach(r=>{e[r]==null&&(this.vt.delete(r),r.includes("-")?i.removeProperty(r):i[r]="")});for(const r in e){const s=e[r];s!=null&&(this.vt.add(r),r.includes("-")?i.setProperty(r,s):i[r]=s)}return Mt}});class tc extends lt{constructor({primary:e,label:i,backgroundColor:r=null,size:s,onClick:n}={}){super(),this.label=i,this.primary=e,this.backgroundColor=r,this.size=s,this.onClick=n}static get styles(){return fi`
    :host {
      display: inline-block;
    }

    .storybook-button {
      font-family: 'Nunito Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-weight: 700;
      border: 0;
      border-radius: 5px;
      cursor: pointer;
      display: inline-block;
      line-height: 1;
    }
    .storybook-button--primary {
      color: white;
      background-color: hsl(190, 60%, 36%);
    }
    .storybook-button--secondary {
      color: #333;
      background-color: transparent;
      box-shadow: rgba(0, 0, 0, 0.15) 0px 0px 0px 1px inset;
    }
    .storybook-button--small {
      font-size: 12px;
      padding: 10px 16px;
    }
    .storybook-button--medium {
      font-size: 14px;
      padding: 11px 20px;
    }
    .storybook-button--large {
      font-size: 16px;
      padding: 12px 24px;
    }
`}static get properties(){return{primary:{type:Boolean},backgroundColor:{type:String},size:{type:String},onClick:{type:Function},label:{type:String}}}render(){const e=this.primary?"storybook-button--primary":"storybook-button--secondary";return be`
      <button
        type="button"
        class=${["storybook-button",`storybook-button--${this.size||"medium"}`,e].join(" ")}
        style=${ec({backgroundColor:this.backgroundColor})}
        @click=${this.onClick}
      >
        <slot>${this.label??""}</slot>
      </button>
    `}}customElements.get("hypergamma-button")||customElements.define("hypergamma-button",tc);let Dt={},ws={};const ic={},Ss=Symbol("infoSubscribeSymbol"),rc=(t,e)=>{const i=Math.random().toString(36).substring(2,15);typeof t=="function"?(e=t,t=[Ss]):t=[t];let r=Dt;return t.forEach(s=>{r[s]||(r[s]={}),r=r[s]}),r[i]=e,ws[i]={target:t,callback:e},i},sc=t=>{const{target:e}=ws[t];let i=Dt;e.forEach(s=>{i[s]||(i[s]={}),i=i[s]}),delete i[t],delete ws[t];let r=Dt;e.forEach(s=>{Object.keys(r[s]).length===0&&delete r[s]})},nc=5;let xo=(t,e=[])=>{if(!(e.length>nc))for(let i in t){const r=[...e,i].join(".");typeof t[i]=="object"&&xo(t[i],[...e,i]),Dt[r]&&Object.values(Dt[r]).forEach(s=>s(t[i]))}};const Ji=t=>{t&&(Object.assign(ic,t),xo(t),Dt[Ss]&&Object.values(Dt[Ss]).forEach(e=>e(t)))};var ri;class We extends lt{constructor(i={}){super();Z(this,"info",{globalState:{}});Z(this,"subscriptions",{});qe(this,ri,[]);Z(this,"subscribe",(i,r)=>{const s=rc(i,r);Se(this,ri).push(s)});Z(this,"query",i=>this.shadowRoot.querySelector(i));Z(this,"onSet",()=>{});Z(this,"set",i=>{i&&(Object.assign(this.info,i),this.onSet(),this.requestUpdate())});Z(this,"onTransition",()=>{});Object.assign(this.info,i)}static get styles(){return fi`
      section {
        width: 100%;
        height: 100%;
      }
    `}disconnectedCallback(){super.connectedCallback(),Se(this,ri).forEach(i=>sc(i)),it(this,ri,[])}render(){return be`
    <section><slot></slot></section>
    `}}ri=new WeakMap;customElements.get("hypergamma-page")||customElements.define("hypergamma-page",We);class Oo extends We{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",i=>{e.innerHTML=JSON.stringify(i)})}render(){return be`
    <h1>Home</h1>
    <p id="readout">No device connected</p>
    `}}customElements.get("hypergamma-home-page")||customElements.define("hypergamma-home-page",Oo);class Eo extends We{constructor(...e){super(...e)}render(){return be`
      <h1>Hyper+</h1>
      <div>
        <hypergamma-button @click=${()=>this.onTransition("plus/focus")}>Focus</hypergamma-button>
        <hypergamma-button @click=${()=>this.onTransition("plus/training")}>Training</hypergamma-button>
        <hypergamma-button @click=${()=>this.onTransition("plus/performance")}>Peformance</hypergamma-button>
        <hypergamma-button @click=${()=>this.onTransition("plus/meditation")}>Meditation</hypergamma-button>
    `}}customElements.get("hypergamma-hyperplus-page")||customElements.define("hypergamma-hyperplus-page",Eo);var oc=Object.create,Ds=Object.defineProperty,ac=Object.getOwnPropertyDescriptor,Rs=Object.getOwnPropertyNames,lc=Object.getPrototypeOf,cc=Object.prototype.hasOwnProperty,Ht=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof require<"u"?require:e)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')}),_r=(t,e)=>function(){return t&&(e=(0,t[Rs(t)[0]])(t=0)),e},hc=(t,e)=>function(){return e||(0,t[Rs(t)[0]])((e={exports:{}}).exports,e),e.exports},fc=(t,e)=>{for(var i in e)Ds(t,i,{get:e[i],enumerable:!0})},uc=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Rs(e))!cc.call(t,s)&&s!==i&&Ds(t,s,{get:()=>e[s],enumerable:!(r=ac(e,s))||r.enumerable});return t},dc=(t,e,i)=>(i=t!=null?oc(lc(t)):{},uc(e||!t||!t.__esModule?Ds(i,"default",{value:t,enumerable:!0}):i,t)),Gn,Wn,es,Gt,$i,Yn,Xn,Kn,mt,No,Bo,Fs=_r({"src/ble/node_modules/@capacitor/core/dist/index.js"(){Gn=t=>{const e=new Map;e.set("web",{name:"web"});const i=t.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},r=(n,a)=>{i.platforms.set(n,a)},s=n=>{i.platforms.has(n)&&(i.currentPlatform=i.platforms.get(n))};return i.addPlatform=r,i.setPlatform=s,i},Wn=t=>t.CapacitorPlatforms=Gn(t),es=Wn(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),es.addPlatform,es.setPlatform,function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"}(Gt||(Gt={})),$i=class extends Error{constructor(t,e,i){super(t),this.message=t,this.code=e,this.data=i}},Yn=t=>{var e,i;return t!=null&&t.androidBridge?"android":!((i=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||i===void 0)&&i.bridge?"ios":"web"},Xn=t=>{var e,i,r,s,n;const a=t.CapacitorCustomPlatform||null,l=t.Capacitor||{},c=l.Plugins=l.Plugins||{},f=t.CapacitorPlatforms,u=()=>a!==null?a.name:Yn(t),h=((e=f==null?void 0:f.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||u,p=()=>h()!=="web",y=((i=f==null?void 0:f.currentPlatform)===null||i===void 0?void 0:i.isNativePlatform)||p,_=V=>{const G=H.get(V);return!!(G!=null&&G.platforms.has(h())||O(V))},m=((r=f==null?void 0:f.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||_,A=V=>{var G;return(G=l.PluginHeaders)===null||G===void 0?void 0:G.find(ye=>ye.name===V)},O=((s=f==null?void 0:f.currentPlatform)===null||s===void 0?void 0:s.getPluginHeader)||A,E=V=>t.console.error(V),L=(V,G,ye)=>Promise.reject(`${ye} does not have an implementation of "${G}".`),H=new Map,K=(V,G={})=>{const ye=H.get(V);if(ye)return console.warn(`Capacitor plugin "${V}" already registered. Cannot register plugins twice.`),ye.proxy;const pe=h(),ee=O(V);let $;const ae=async()=>(!$&&pe in G?$=typeof G[pe]=="function"?$=await G[pe]():$=G[pe]:a!==null&&!$&&"web"in G&&($=typeof G.web=="function"?$=await G.web():$=G.web),$),Ye=(ge,ie)=>{var Pe,Te;if(ee){const Fe=ee==null?void 0:ee.methods.find(Oe=>ie===Oe.name);if(Fe)return Fe.rtype==="promise"?Oe=>l.nativePromise(V,ie.toString(),Oe):(Oe,Le)=>l.nativeCallback(V,ie.toString(),Oe,Le);if(ge)return(Pe=ge[ie])===null||Pe===void 0?void 0:Pe.bind(ge)}else{if(ge)return(Te=ge[ie])===null||Te===void 0?void 0:Te.bind(ge);throw new $i(`"${V}" plugin is not implemented on ${pe}`,Gt.Unimplemented)}},Xe=ge=>{let ie;const Pe=(...Te)=>{const Fe=ae().then(Oe=>{const Le=Ye(Oe,ge);if(Le){const Qe=Le(...Te);return ie=Qe==null?void 0:Qe.remove,Qe}else throw new $i(`"${V}.${ge}()" is not implemented on ${pe}`,Gt.Unimplemented)});return ge==="addListener"&&(Fe.remove=async()=>ie()),Fe};return Pe.toString=()=>`${ge.toString()}() { [capacitor code] }`,Object.defineProperty(Pe,"name",{value:ge,writable:!1,configurable:!1}),Pe},C=Xe("addListener"),Ce=Xe("removeListener"),Je=(ge,ie)=>{const Pe=C({eventName:ge},ie),Te=async()=>{const Oe=await Pe;Ce({eventName:ge,callbackId:Oe},ie)},Fe=new Promise(Oe=>Pe.then(()=>Oe({remove:Te})));return Fe.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Te()},Fe},Ke=new Proxy({},{get(ge,ie){switch(ie){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return ee?Je:C;case"removeListener":return Ce;default:return Xe(ie)}}});return c[V]=Ke,H.set(V,{name:V,proxy:Ke,platforms:new Set([...Object.keys(G),...ee?[pe]:[]])}),Ke},le=((n=f==null?void 0:f.currentPlatform)===null||n===void 0?void 0:n.registerPlugin)||K;return l.convertFileSrc||(l.convertFileSrc=V=>V),l.getPlatform=h,l.handleError=E,l.isNativePlatform=y,l.isPluginAvailable=m,l.pluginMethodNoop=L,l.registerPlugin=le,l.Exception=$i,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},Kn=t=>t.Capacitor=Xn(t),mt=Kn(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),No=mt.registerPlugin,mt.Plugins,Bo=class{constructor(t){this.listeners={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e);const r=this.windowListeners[t];r&&!r.registered&&this.addWindowListener(r);const s=async()=>this.removeListener(t,e),n=Promise.resolve({remove:s});return Object.defineProperty(n,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await s()}}),n}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,e){const i=this.listeners[t];i&&i.forEach(r=>r(e))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,e){this.windowListeners[e]={registered:!1,windowEventName:t,pluginEventName:e,handler:i=>{this.notifyListeners(e,i)}}}unimplemented(t="not implemented"){return new mt.Exception(t,Gt.Unimplemented)}unavailable(t="not available"){return new mt.Exception(t,Gt.Unavailable)}async removeListener(t,e){const i=this.listeners[t];if(!i)return;const r=i.indexOf(e);this.listeners[t].splice(r,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}}}});function pc(t){return new DataView(Uint8Array.from(t).buffer)}function gc(t){return Array.from(new Uint8Array(t.buffer))}function yc(t){return`0000${t.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}function er(t){const e=t.trim().split(" ").filter(i=>i!=="").map(i=>parseInt(i,16));return pc(e)}function ts(t){return gc(t).map(e=>{let i=e.toString(16);return i.length==1&&(i="0"+i),i}).join(" ")}function bc(t){if(typeof t=="string")return t;if(typeof t=="number")return yc(t);throw new Error("Invalid UUID")}function Zn(t){const e={};if(t)return t.forEach((i,r)=>{e[r.toString()]=i}),e}var Us=_r({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js"(){}});async function _c(t,e,i){let r;return Promise.race([t,new Promise((s,n)=>{r=setTimeout(()=>n(i),e)})]).finally(()=>clearTimeout(r))}var mc=_r({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/timeout.js"(){}}),To={};fc(To,{BluetoothLeWeb:()=>jo});var jo,vc=_r({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/web.js"(){Fs(),Us(),mc(),jo=class extends Bo{constructor(){super(...arguments),this.deviceMap=new Map,this.discoveredDevices=new Map,this.scan=null,this.DEFAULT_CONNECTION_TIMEOUT=1e4,this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this),this.onDisconnectedCallback=this.onDisconnected.bind(this),this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}async initialize(){if(typeof navigator>"u"||!navigator.bluetooth)throw this.unavailable("Web Bluetooth API not available in this browser.");if(!await navigator.bluetooth.getAvailability())throw this.unavailable("No Bluetooth radio available.")}async isEnabled(){return{value:!0}}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(t){const e=this.getFilters(t),i=await navigator.bluetooth.requestDevice({filters:e.length?e:void 0,optionalServices:t==null?void 0:t.optionalServices,acceptAllDevices:e.length===0});return this.deviceMap.set(i.id,i),this.getBleDevice(i)}async requestLEScan(t){this.requestBleDeviceOptions=t;const e=this.getFilters(t);await this.stopLEScan(),this.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),this.scan=await navigator.bluetooth.requestLEScan({filters:e.length?e:void 0,acceptAllAdvertisements:e.length===0,keepRepeatedDevices:t==null?void 0:t.allowDuplicates})}onAdvertisementReceived(t){var e,i;const r=t.device.id;if(this.deviceMap.set(r,t.device),!this.discoveredDevices.has(r)||!((e=this.requestBleDeviceOptions)===null||e===void 0)&&e.allowDuplicates){this.discoveredDevices.set(r,!0);const n=this.getBleDevice(t.device),a={device:n,localName:n.name,rssi:t.rssi,txPower:t.txPower,manufacturerData:Zn(t.manufacturerData),serviceData:Zn(t.serviceData),uuids:(i=t.uuids)===null||i===void 0?void 0:i.map(bc)};this.notifyListeners("onScanResult",a)}}async stopLEScan(){var t;!((t=this.scan)===null||t===void 0)&&t.active&&this.scan.stop(),this.scan=null}async getDevices(t){return{devices:(await navigator.bluetooth.getDevices()).map(r=>(this.deviceMap.set(r.id,r),this.getBleDevice(r)))}}async getConnectedDevices(t){return{devices:(await navigator.bluetooth.getDevices()).filter(r=>{var s;return(s=r.gatt)===null||s===void 0?void 0:s.connected}).map(r=>(this.deviceMap.set(r.id,r),this.getBleDevice(r)))}}async connect(t){var e,i;const r=this.getDeviceFromMap(t.deviceId);r.removeEventListener("gattserverdisconnected",this.onDisconnectedCallback),r.addEventListener("gattserverdisconnected",this.onDisconnectedCallback);const s=Symbol();if(r.gatt===void 0)throw new Error("No gatt server available.");try{const n=(e=t.timeout)!==null&&e!==void 0?e:this.DEFAULT_CONNECTION_TIMEOUT;await _c(r.gatt.connect(),n,s)}catch(n){throw await((i=r.gatt)===null||i===void 0?void 0:i.disconnect()),n===s?new Error("Connection timeout"):n}}onDisconnected(t){const i=`disconnected|${t.target.id}`;this.notifyListeners(i,null)}async createBond(t){throw this.unavailable("createBond is not available on web.")}async isBonded(t){throw this.unavailable("isBonded is not available on web.")}async disconnect(t){var e;(e=this.getDeviceFromMap(t.deviceId).gatt)===null||e===void 0||e.disconnect()}async getServices(t){var e,i;const r=(i=await((e=this.getDeviceFromMap(t.deviceId).gatt)===null||e===void 0?void 0:e.getPrimaryServices()))!==null&&i!==void 0?i:[],s=[];for(const n of r){const a=await n.getCharacteristics(),l=[];for(const c of a)l.push({uuid:c.uuid,properties:this.getProperties(c),descriptors:await this.getDescriptors(c)});s.push({uuid:n.uuid,characteristics:l})}return{services:s}}async getDescriptors(t){try{return(await t.getDescriptors()).map(i=>({uuid:i.uuid}))}catch{return[]}}getProperties(t){return{broadcast:t.properties.broadcast,read:t.properties.read,writeWithoutResponse:t.properties.writeWithoutResponse,write:t.properties.write,notify:t.properties.notify,indicate:t.properties.indicate,authenticatedSignedWrites:t.properties.authenticatedSignedWrites,reliableWrite:t.properties.reliableWrite,writableAuxiliaries:t.properties.writableAuxiliaries}}async getCharacteristic(t){var e;const i=await((e=this.getDeviceFromMap(t.deviceId).gatt)===null||e===void 0?void 0:e.getPrimaryService(t==null?void 0:t.service));return i==null?void 0:i.getCharacteristic(t==null?void 0:t.characteristic)}async getDescriptor(t){const e=await this.getCharacteristic(t);return e==null?void 0:e.getDescriptor(t==null?void 0:t.descriptor)}async discoverServices(t){throw this.unavailable("discoverServices is not available on web.")}async readRssi(t){throw this.unavailable("readRssi is not available on web.")}async read(t){const e=await this.getCharacteristic(t);return{value:await(e==null?void 0:e.readValue())}}async write(t){const e=await this.getCharacteristic(t);let i;typeof t.value=="string"?i=er(t.value):i=t.value,await(e==null?void 0:e.writeValueWithResponse(i))}async writeWithoutResponse(t){const e=await this.getCharacteristic(t);let i;typeof t.value=="string"?i=er(t.value):i=t.value,await(e==null?void 0:e.writeValueWithoutResponse(i))}async readDescriptor(t){const e=await this.getDescriptor(t);return{value:await(e==null?void 0:e.readValue())}}async writeDescriptor(t){const e=await this.getDescriptor(t);let i;typeof t.value=="string"?i=er(t.value):i=t.value,await(e==null?void 0:e.writeValue(i))}async startNotifications(t){const e=await this.getCharacteristic(t);e==null||e.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),e==null||e.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),await(e==null?void 0:e.startNotifications())}onCharacteristicValueChanged(t){var e,i;const r=t.target,s=`notification|${(e=r.service)===null||e===void 0?void 0:e.device.id}|${(i=r.service)===null||i===void 0?void 0:i.uuid}|${r.uuid}`;this.notifyListeners(s,{value:r.value})}async stopNotifications(t){const e=await this.getCharacteristic(t);await(e==null?void 0:e.stopNotifications())}getFilters(t){var e;const i=[];for(const r of(e=t==null?void 0:t.services)!==null&&e!==void 0?e:[])i.push({services:[r],name:t==null?void 0:t.name,namePrefix:t==null?void 0:t.namePrefix});return(t!=null&&t.name||t!=null&&t.namePrefix)&&i.length===0&&i.push({name:t.name,namePrefix:t.namePrefix}),console.log(i),i}getDeviceFromMap(t){const e=this.deviceMap.get(t);if(e===void 0)throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return e}getBleDevice(t){var e;return{deviceId:t.id,name:(e=t.name)!==null&&e!==void 0?e:void 0}}}}}),wc=hc({"src/ble/node_modules/throat/index.js"(t,e){function i(c){var f=new l,u=c|0;function h(A,O,E){return u|0?(u=(u|0)-1,new Promise(function(L){L(A.apply(O,E))}).then(y,_)):new Promise(function(L){f.push(new n(L,A,O,E))}).then(p)}function p(A){try{return Promise.resolve(A.fn.apply(A.self,A.args)).then(y,_)}catch(O){_(O)}}function y(A){return m(),A}function _(A){throw m(),A}function m(){var A=f.shift();A?A.resolve(A):u=(u|0)+1}return h}function r(c,f){const u=i(c|0);return function(){for(var h=new Array(arguments.length),p=0;p<arguments.length;p++)h[p]=arguments[p];return u(f,this,h)}}function s(c){const f=i(c|0);return function(u){if(typeof u!="function")throw new TypeError("Expected throat fn to be a function but got "+typeof u);for(var h=new Array(arguments.length-1),p=1;p<arguments.length;p++)h[p-1]=arguments[p];return f(u,this,h)}}e.exports=function(f,u){if(typeof f=="function"){var h=u;u=f,f=h}if(typeof f!="number")throw new TypeError("Expected throat size to be a number but got "+typeof f);if(u!==void 0&&typeof u!="function")throw new TypeError("Expected throat fn to be a function but got "+typeof u);return typeof u=="function"?r(f|0,u):s(f|0)},e.exports.default=e.exports;function n(c,f,u,h){this.resolve=c,this.fn=f,this.self=u||null,this.args=h}var a=64;function l(){this._s1=[],this._s2=[],this._shiftBlock=this._pushBlock=new Array(a),this._pushIndex=0,this._shiftIndex=0}l.prototype.push=function(c){this._pushIndex===a&&(this._pushIndex=0,this._s1[this._s1.length]=this._pushBlock=new Array(a)),this._pushBlock[this._pushIndex++]=c},l.prototype.shift=function(){if(this._shiftIndex===a){this._shiftIndex=0;var c=this._s2;if(c.length===0){var f=this._s1;if(f.length===0)return;this._s1=c,c=this._s2=f.reverse()}this._shiftBlock=c.pop()}if(!(this._pushBlock===this._shiftBlock&&this._pushIndex===this._shiftIndex)){var u=this._shiftBlock[this._shiftIndex];return this._shiftBlock[this._shiftIndex++]=null,u}}}}),Sc=Object.create,Co=Object.defineProperty,kc=Object.getOwnPropertyDescriptor,Po=Object.getOwnPropertyNames,Ac=Object.getPrototypeOf,xc=Object.prototype.hasOwnProperty,Oc=(t=>typeof Ht<"u"?Ht:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof Ht<"u"?Ht:e)[i]}):t)(function(t){if(typeof Ht<"u")return Ht.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')}),Ec=(t,e)=>function(){return e||(0,t[Po(t)[0]])((e={exports:{}}).exports,e),e.exports},Nc=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Po(e))!xc.call(t,s)&&s!==i&&Co(t,s,{get:()=>e[s],enumerable:!(r=kc(e,s))||r.enumerable});return t},Bc=(t,e,i)=>(i=t!=null?Sc(Ac(t)):{},Nc(e||!t||!t.__esModule?Co(i,"default",{value:t,enumerable:!0}):i,t)),Tc=Ec({"node_modules/web-worker/cjs/browser.js"(t,e){e.exports=Worker}}),jc=class{constructor(t){this.pushToState={},this.data={},this.triggers={},this.setState=e=>{Object.assign(this.data,e);let i=Object.getOwnPropertyNames(e);for(const r of i)this.triggerEvent(r,this.data[r]);return this.data},this.setValue=(e,i)=>{this.data[e]=i,this.triggerEvent(e,i)},this.triggerEvent=(e,i)=>{if(this.triggers[e]){let r=s=>s.onchange(i);this.triggers[e].forEach(r)}},this.subscribeEvent=(e,i,r,s)=>{if(e){r&&s&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>r[s],set:a=>{r[s]=a},enumerable:!0,configurable:!0}),this.triggers[e]||(this.triggers[e]=[]);let n=this.triggers[e].length;return this.triggers[e].push({sub:n,onchange:i}),this.triggers[e].length-1}else return},this.unsubscribeEvent=(e,i)=>{let r=this.triggers[e];if(r)if(!i)delete this.triggers[e],delete this.data[e];else{let s,n=r.find((a,l)=>{if(a.sub===s)return s=l,!0});return n&&r.splice(s,1),Object.keys(r).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(n),!0}},this.subscribeEventOnce=(e,i)=>{let r,s=n=>{i(n),this.unsubscribeEvent(e,r)};r=this.subscribeEvent(e,s)},this.getEvent=(e,i)=>{for(const r in this.triggers[e])if(this.triggers[e][r].sub===i)return this.triggers[e][r]},this.getSnapshot=()=>{for(const e in this.data)this.data[e]},typeof t=="object"&&(this.data=t)}},Lo=new jc,ce=class{constructor(t,e,i){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:Lo},this.__setProperties=(r,s,n)=>{if((()=>{let l=r;typeof r=="function"?As(r)?r=new r:r={__operator:r,__node:{forward:!0,tag:r.name}}:typeof r=="string"&&n!=null&&n.get(r)&&(r=n.get(r)),r.__node.initial||(r.__node.initial=l)})(),typeof r=="object"){let l=()=>{var m;(m=r.__node)!=null&&m.state&&(this.__node.state=r.__node.state)},c=()=>{r.__props&&(typeof r.__props=="function"&&(r.__props=new r.__props),typeof r.__props=="object"&&this.__proxyObject(r.__props))},f=()=>{var m;r.__node.tag||((m=r.__operator)!=null&&m.name?r.__node.tag=r.__operator.name:r.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},u=()=>{typeof r.__node=="string"?n!=null&&n.get(r.__node.tag)?r=n.get(r.__node.tag):r.__node={}:r.__node||(r.__node={}),n&&(r.__node.graph=n),r instanceof Lt&&(r.__node.source=r)},h=()=>{if(!r.__parent&&s&&(r.__parent=s),s!=null&&s.__node&&!(s instanceof Lt||r instanceof Lt)&&(r.__node.tag=s.__node.tag+"."+r.__node.tag),s instanceof Lt&&r instanceof Lt&&(r.__node.loaders&&Object.assign(s.__node.loaders?s.__node.loaders:{},r.__node.loaders),s.__node.mapGraphs)){r.__node.nodes.forEach(A=>{s.set(r.__node.tag+"."+A.__node.tag,A)});let m=()=>{r.__node.nodes.forEach(A=>{s.__node.nodes.delete(r.__node.tag+"."+A.__node.tag)})};this.__addOndisconnected(m)}},p=()=>{if(typeof r.default=="function"&&!r.__operator&&(r.__operator=r.default),r.__operator){if(typeof r.__operator=="string"&&n){let m=n.get(r.__operator);m&&(r.__operator=m.__operator),!r.__node.tag&&r.__operator.name&&(r.__node.tag=r.__operator.name)}typeof r.__operator=="function"&&(r.__operator=this.__setOperator(r.__operator)),r.default&&(r.default=r.__operator)}},y=()=>{r.__node=Object.assign(this.__node,r.__node);let m=Object.getOwnPropertyNames(r);for(const A of m)this[A]=r[A]},_=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(m=>m.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(m=>m.bind(this))))};l(),f(),c(),u(),h(),y(),_(),p()}},this.__subscribe=(r,s,n,a,l)=>{var u,h,p;const c=(y,_=(A,O)=>A,m=r)=>{let A=this.__node.state.subscribeEvent(y,m,this,s),O=this.__node.state.getEvent(y,A);return O.source=this.__node.tag,s&&(O.key=s),O.target=_(r),a&&(O.bound=a),A},f=y=>{if(!this.__node.graph.get(y)&&y.includes(".")){let m=this.__node.graph.get(y.substring(0,y.lastIndexOf("."))),A=y.substring(y.lastIndexOf(".")+1);m&&typeof m[A]=="function"&&(y=(...O)=>m[A](...O))}};if(s){if((!this.__node.localState||!this.__node.localState[s])&&this.__addLocalState(this,s),typeof r=="string"){if(l){if((u=this.__node.graph)!=null&&u.get(l)){let m=(h=this.__node.graph)==null?void 0:h.get(l);if(typeof m[r]=="function"){let A=m[r];r=(...O)=>{A(...O)}}else{let A=r;r=E=>{m[A]=E}}}}else if(typeof this[r]=="function"){let m=this[r];r=(...A)=>{m(...A)}}else(p=this.__node.graph)!=null&&p.get(r)&&f(r);if(typeof r!="function")return}let y,_=n?this.__node.unique+"."+s+"input":this.__node.unique+"."+s;return typeof r=="function"?y=c(_):r!=null&&r.__node&&(y=c(_,(m,A)=>A||m.__node.unique,(...m)=>{r.__operator&&r.__operator(...m)})),y}else{if(typeof r=="string"&&(this.__node.graph.get(r)&&(r=this.__node.graph.get(r)),typeof r!="object"))return;let y,_=n?this.__node.unique+"input":this.__node.unique;return typeof r=="function"?y=c(_):r!=null&&r.__node&&(y=c(_,(m,A)=>A||m.__node.unique,(...m)=>{r.__operator&&r.__operator(...m)})),y}},this.__unsubscribe=(r,s,n)=>s?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+s+"input":this.__node.unique+"."+s,r):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,r),this.__setOperator=r=>{r=r.bind(this),this.__args&&this.__node.graph&&(r=Js(r,this.__args,this.__node.graph));let s=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[s]&&this.__node.state.setValue(s,n);let a=r(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof(a==null?void 0:a.then)=="function"?a.then(l=>{l!==void 0&&this.__node.state.setValue(this.__node.unique,l)}).catch(console.error):a!==void 0&&this.__node.state.setValue(this.__node.unique,a)),a},this.__parent instanceof ce&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),a=()=>{var l;(l=this.__parent)==null||l.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(a),this.__subscribedToParent=!0}return this.__operator},this.__addLocalState=(r,s)=>{if(!r)return;this.__node.localState||(this.__node.localState={});const n=this.__node.localState,a=(l,c)=>{var h;let f=this.__node.unique+"."+c,u=`${f}input`;if(typeof l[c]=="function"&&c!=="__operator"){let p=l[c].bind(this);l[c]=(...y)=>{this.__node.state.triggers[u]&&this.__node.state.setValue(u,y);let _=p(...y);return this.__node.state.triggers[f]&&(typeof(_==null?void 0:_.then)=="function"?_.then(m=>{this.__node.state.triggerEvent(f,m)}).catch(console.error):this.__node.state.triggerEvent(f,_)),_}}else{let p,y;(h=this.__props)!=null&&h[c]?(p=()=>this.__props[c],y=m=>{this.__props[c]=m,this.__node.state.triggers[f]&&this.__node.state.triggerEvent(f,m)}):(n[c]=l[c],p=()=>n[c],y=m=>{n[c]=m,this.__node.state.triggers[f]&&this.__node.state.triggerEvent(f,m)});const _={get:p,set:y,enumerable:!0,configurable:!0};if(Object.defineProperty(l,c,_),typeof this.__node.initial=="object"){let m=Object.getOwnPropertyDescriptor(this.__node.initial,c);(m===void 0||m!=null&&m.configurable)&&Object.defineProperty(this.__node.initial,c,_)}}};if(s)a(r,s);else for(let l in r)a(r,l)},this.__proxyObject=r=>{const s=Cc(r);for(const n of s)if(typeof r[n]=="function")this[n]=(...a)=>r[n](...a);else{const a={get:()=>r[n],set:l=>{r[n]=l},enumerable:!0,configurable:!0};if(Object.defineProperty(this,n,a),typeof this.__node.initial=="object"){let l=Object.getOwnPropertyDescriptor(this.__node.initial,n);(l===void 0||l!=null&&l.configurable)&&Object.defineProperty(this.__node.initial,n,a)}}},this.__setProperties(t,e,i)}__addOnconnected(t){t=t.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(t):typeof this.__onconnected=="function"?this.__onconnected=[t,this.__onconnected]:this.__onconnected=t}__addOndisconnected(t){t=t.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(t):typeof this.__ondisconnected=="function"?this.__ondisconnected=[t,this.__ondisconnected]:this.__ondisconnected=t}__callConnected(t=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let e=i=>{i(this)};this.__onconnected.forEach(e)}}__callDisconnected(t=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let e=i=>{i(this)};this.__ondisconnected.forEach(e)}}},Lt=class{constructor(t){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:Lo,roots:{}},this.init=e=>{if(e){let i=Object.assign({},e);delete i.roots,ks(this.__node,i),e.roots&&this.load(e.roots)}},this.load=e=>{function i(n,a,l=!0,c=!0){var f,u;if(c&&(n?Object.assign(n,a):n=Object.assign({},a),i(n,a,!0,!1)),a.__children&&!l)((f=a.__children)==null?void 0:f.constructor.name)==="Object"?((u=n.__children)==null?void 0:u.constructor.name)==="Object"?i(n.__children,a.__children,!0,!1):n.__children=i({},a.__children,!0,!1):n.__children=a.__children;else if(l)for(const h in a)n[h]=Object.assign({},a[h]),a[h].__children&&i({},a[h].__children,!1,!1);return n}this.__node.roots=i(this.__node.roots?this.__node.roots:{},e);let r=Object.assign({},e);r.__node&&delete r.__node;let s=this.recursiveSet(r,this,void 0,e);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let n=new ce(e,this,this);this.set(n.__node.tag,n),this.runLoaders(n,this,e,e.__node.tag),n.__listeners&&(s[n.__node.tag]=n.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(s),r},this.setLoaders=(e,i)=>(i?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders),this.runLoaders=(e,i,r,s)=>{for(const n in this.__node.loaders)typeof this.__node.loaders[n]=="object"?(this.__node.loaders[n].init&&this.__node.loaders[n](e,i,this,this.__node.roots,r,s),this.__node.loaders[n].connected&&e.__addOnconnected(this.__node.loaders[n].connect),this.__node.loaders[n].disconnected&&e.__addOndisconnected(this.__node.loaders[n].disconnect)):typeof this.__node.loaders[n]=="function"&&this.__node.loaders[n](e,i,this,this.__node.roots,r,s)},this.add=(e,i)=>{var n,a;let r={};typeof i=="string"&&(i=this.get(i));let s;if(typeof e=="function"?As(e)?e.prototype instanceof ce?(e=e.prototype.constructor(e,i,this),s=!0):e=new e:e={__operator:e}:typeof e=="string"&&(e=this.__node.roots[e]),!!e){if(!s){let l=Object.getOwnPropertyNames(e),c={};for(const f of l)c[f]=e[f];e=c}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&(!((n=e==null?void 0:e.__node)!=null&&n.tag)||!this.get(e.__node.tag))){let l;if(s?l=e:l=new ce(e,i,this),this.set(l.__node.tag,l),this.runLoaders(l,i,e,l.__node.tag),this.__node.roots[l.__node.tag]=e,l.__children&&(l.__children=Object.assign({},l.__children),this.recursiveSet(l.__children,l,r,l.__children)),l.__listeners){r[l.__node.tag]=Object.assign({},l.__listeners);for(const c in l.__listeners){let f=l.__listeners[c];l[c]&&(delete r[l.__node.tag][c],r[l.__node.tag][l.__node.tag+"."+c]=f),typeof f=="string"&&((a=l.__children)!=null&&a[f]?r[l.__node.tag][c]=l.__node.tag+"."+f:i instanceof ce&&(i.__node.tag===f||i.__node.tag.includes(".")&&i.__node.tag.split(".").pop()===f)&&(r[l.__node.tag][c]=i.__node.tag))}}return this.setListeners(r),l.__callConnected(),l}}},this.recursiveSet=(e,i,r={},s)=>{var a;let n=Object.getOwnPropertyNames(s);for(const l of n){if(l.includes("__"))continue;let c=s[l];if(Array.isArray(c))continue;let f;if(typeof c=="function"?As(c)?(c=new c,c instanceof ce&&(c=c.prototype.constructor(c,i,this),f=!0)):c={__operator:c}:typeof c=="string"?this.__node.nodes.get(c)?c=this.__node.nodes.get(c):c=this.__node.roots[c]:typeof c=="boolean"&&(this.__node.nodes.get(l)?c=this.__node.nodes.get(l):c=this.__node.roots[l]),typeof c=="object"){if(!f&&!(c instanceof ce)){let p=Object.getOwnPropertyNames(c),y={};for(const _ of p)y[_]=c[_];c=y}if(c.__node||(c.__node={}),c.__node.tag||(c.__node.tag=l),c.__node.initial||(c.__node.initial=e[l]),this.get(c.__node.tag)&&!(!(i instanceof Lt)&&(i!=null&&i.__node))||i!=null&&i.__node&&this.get(i.__node.tag+"."+c.__node.tag))continue;let u,h=!1;if(f||c instanceof ce?u=c:(u=new ce(c,i,this),h=!0),!h&&c instanceof ce&&!f&&i instanceof ce){let p=this.subscribe(i.__node.tag,u.__node.tag),y=_=>{this.unsubscribe(i.__node.tag,p)};u.__addOndisconnected(y)}else{if(this.set(u.__node.tag,u),this.runLoaders(u,i,e[l],l),e[l]=u,this.__node.roots[u.__node.tag]=c,u.__children&&(u.__children=Object.assign({},u.__children),this.recursiveSet(u.__children,u,r,u.__children)),u.__listeners){r[u.__node.tag]=Object.assign({},u.__listeners);for(const p in u.__listeners){let y=u.__listeners[p],_=p;u[p]&&(delete r[u.__node.tag][p],_=u.__node.tag+"."+p,r[u.__node.tag][_]=y),typeof y=="string"&&((a=u.__children)!=null&&a[y]?r[u.__node.tag][_]=u.__node.tag+"."+y:i instanceof ce&&(i.__node.tag===y||i.__node.tag.includes(".")&&i.__node.tag.split(".").pop()===y)&&(r[u.__node.tag][_]=i.__node.tag))}}u.__callConnected()}}}return r},this.remove=(e,i=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof ce){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],i&&this.clearListeners(e),e.__callDisconnected();const r=s=>{for(const n in s)this.unsubscribe(s[n]),this.delete(s[n].__node.tag),delete this.__node.roots[s[n].__node.tag],this.delete(n),delete this.__node.roots[n],s[n].__node.tag=s[n].__node.tag.substring(s[n].__node.tag.lastIndexOf(".")+1),i&&this.clearListeners(s[n]),console.log(n,s[n].__listeners),s[n].__callDisconnected(),s[n].__children&&r(s[n].__children)};e.__children&&r(e.__children)}return e!=null&&e.__node.tag&&(e!=null&&e.__parent)&&(e==null||delete e.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e},this.run=(e,...i)=>{if(typeof e=="string"){let r=this.get(e);if(!r&&e.includes(".")){if(r=this.get(e.substring(0,e.lastIndexOf("."))),typeof(r==null?void 0:r[e.substring(e.lastIndexOf(".")+1)])=="function")return r[e.substring(e.lastIndexOf(".")+1)](...i)}else if(r!=null&&r.__operator)return r.__operator(...i)}if(e!=null&&e.__operator)return e==null?void 0:e.__operator(...i)},this.setListeners=e=>{var i,r,s,n;for(const a in e){let l=this.get(a);if(typeof e[a]=="object")for(const c in e[a]){let f=this.get(c),u;if(typeof e[a][c]!="object")e[a][c]={__callback:e[a][c]};else if(!e[a][c].__callback)for(const h in e[a][c]){typeof e[a][c][h]!="object"&&(e[a][c][h]={__callback:e[a][c][h]},(e[a][c][h].__callback===!0||typeof e[a][c][h].__callback>"u")&&(e[a][c][h].__callback=l.__operator));let p=this.get(h);if(p)if(p)u=this.subscribe(p,e[a][c][h].__callback,e[a][c].__args,void 0,e[a][c].inputState,a,c),typeof l.__listeners[c][h]!="object"&&(l.__listeners[c][h]={__callback:e[a][c][h].__callback,inputState:(r=e[a][c][h])==null?void 0:r.inputState}),l.__listeners[c][h].sub=u;else{let y=c.substring(0,c.lastIndexOf("."));p=this.get(y),f&&(u=this.subscribe(p,e[a][c][h].__callback,e[a][c][h].__args,c.substring(c.lastIndexOf(".")+1),e[a][c][h].inputState,a,c),typeof l.__listeners[c][h]!="object"&&(l.__listeners[c][h]={__callback:e[a][c][h].__callback,inputState:(i=e[a][c][h])==null?void 0:i.inputState}),l.__listeners[c][h].sub=u)}}if("__callback"in e[a][c])if((e[a][c].__callback===!0||typeof e[a][c].__callback>"u")&&(e[a][c].__callback=l.__operator),typeof e[a][c].__callback=="function"&&(e[a][c].__callback=e[a][c].__callback.bind(l)),typeof l.__listeners!="object"&&(l.__listeners={}),f)u=this.subscribe(f,e[a][c].__callback,e[a][c].__args,void 0,e[a][c].inputState,a,c),typeof l.__listeners[c]!="object"&&(l.__listeners[c]={__callback:e[a][c].__callback,inputState:(n=e[a][c])==null?void 0:n.inputState}),l.__listeners[c].sub=u;else{let h=c.substring(0,c.lastIndexOf("."));f=this.get(h),f&&(u=this.subscribe(f,e[a][c].__callback,e[a][c].__args,c.substring(c.lastIndexOf(".")+1),e[a][c].inputState,a,c),typeof l.__listeners[c]!="object"&&(l.__listeners[c]={__callback:e[a][c].__callback,inputState:(s=e[a][c])==null?void 0:s.inputState}),l.__listeners[c].sub=u)}}}},this.clearListeners=(e,i)=>{var r,s,n,a,l,c,f;if(typeof e=="string"&&(e=this.get(e)),e!=null&&e.__listeners)for(const u in e.__listeners){if(i&&u!==i||typeof((r=e.__listeners[u])==null?void 0:r.sub)!="number")continue;let h=this.get(u);if(h)if(typeof!((l=e.__listeners[u])!=null&&l.__callback)=="number")for(const p in e.__listeners[u])(c=e.__listeners[u][p])!=null&&c.sub&&(this.unsubscribe(h,e.__listeners[u][p].sub,void 0,e.__listeners[u][p].inputState),e.__listeners[u][p].sub=void 0);else typeof((f=e.__listeners[u])==null?void 0:f.sub)=="number"&&(this.unsubscribe(h,e.__listeners[u].sub,void 0,e.__listeners[u].inputState),e.__listeners[u].sub=void 0);else if(h=this.get(u.substring(0,u.lastIndexOf("."))),h)if(typeof e.__listeners[u]=="object"&&!((s=e.__listeners[u])!=null&&s.__callback))for(const p in e.__listeners[u])typeof((n=e.__listeners[u][p])==null?void 0:n.sub)=="number"&&(this.unsubscribe(h,e.__listeners[u][p].sub,u.substring(u.lastIndexOf(".")+1),e.__listeners[u][p].inputState),e.__listeners[u][p].sub=void 0);else typeof((a=e.__listeners[u])==null?void 0:a.sub)=="number"&&(this.unsubscribe(h,e.__listeners[u].sub,u.substring(u.lastIndexOf(".")+1),e.__listeners[u].inputState),e.__listeners[u].sub=void 0)}},this.get=e=>this.__node.nodes.get(e),this.set=(e,i)=>this.__node.nodes.set(e,i),this.delete=e=>this.__node.nodes.delete(e),this.getProps=(e,i)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof ce){let r;if(i)r=Object.assign({},this.__node.roots[e.__node.tag]);else{r=Object.assign({},e);for(const s in r)s.includes("__")&&delete r[s]}}},this.subscribe=(e,i,r,s,n,a,l)=>{let c=e;typeof e=="string"&&(c=this.get(e),!c&&e.includes(".")&&(c=this.get(e.substring(0,e.lastIndexOf("."))),s=e.substring(e.lastIndexOf(".")+1)));let f;if(a instanceof ce&&(a=a.__node.tag),typeof i=="string"){let u=i,h=p=>{var y;if((y=this.get(p))!=null&&y.__operator){let _=this.get(p);p=function(...m){return _.__operator(...m)}}else if(p.includes(".")){let _=this.get(p.substring(0,p.lastIndexOf("."))),m=p.substring(p.lastIndexOf(".")+1);typeof _[m]=="function"?_[m]instanceof ce?p=_[m]:p=function(...A){return _[m](...A)}:p=function(A){return _[m]=A,_[m]}}return p};if(a){let p=this.get(a);typeof(p==null?void 0:p[i])=="function"?i=function(...y){return p[u](...y)}:p[u]?p[u]instanceof ce?i=p[u]:i=function(y){return p[u]=y,p[u]}:i=h(i)}else i=h(i)}if((typeof i=="function"||i instanceof ce)&&r&&(i instanceof ce&&i.__operator&&(i=function(u){return i.__operator(u)}),i=Js(i,r,this)),c instanceof ce){f=c.__subscribe(i,s,n,a,l);let u=()=>{c.__unsubscribe(f,s,n)};c.__addOndisconnected(u)}else if(typeof e=="string")if(this.get(e))if(i instanceof ce&&i.__operator){f=this.get(e).__subscribe(i.__operator,s,n,a,l);let u=()=>{this.get(e).__unsubscribe(f)};i.__addOndisconnected(u)}else(typeof i=="function"||typeof i=="string")&&(f=this.get(e).__subscribe(i,s,n,a,l),this.__node.state.getEvent(this.get(e).__node.unique,f).source=e);else typeof i=="string"&&(i=this.__node.nodes.get(i).__operator),typeof i=="function"&&(f=this.__node.state.subscribeEvent(e,i));return f},this.unsubscribe=(e,i,r,s)=>{var n;return e instanceof ce?e.__unsubscribe(i,r,s):(n=this.get(e))==null?void 0:n.__unsubscribe(i,r,s)},this.setState=e=>{this.__node.state.setState(e)},this.init(t)}};function ks(t,e){var i,r;for(const s in e)((i=e[s])==null?void 0:i.constructor.name)==="Object"&&!Array.isArray(e[s])?((r=t[s])==null?void 0:r.constructor.name)==="Object"&&!Array.isArray(t[s])?ks(t[s],e[s]):t[s]=ks({},e[s]):t[s]=e[s];return t}function Cc(t){var e=[],i=t;do{var r=Object.getOwnPropertyNames(i);let s=function(n){e.indexOf(n)===-1&&e.push(n)};r.forEach(s)}while(i=Object.getPrototypeOf(i));return e}function As(t){return Pc(t)==="class"}function Pc(t){var i;return typeof t=="function"?t.prototype?(i=Object.getOwnPropertyDescriptor(t,"prototype"))!=null&&i.writable?"function":"class":t.constructor.name==="AsyncFunction"?"async":"arrow":""}var Js=(t,e,i)=>{let r=[],s=l=>{var c,f;if((c=i.get(l))!=null&&c.__operator){let u=i.get(l);return(...h)=>{u.__operator(...h)}}else if(l.includes(".")){let u=l.split("."),h=u.pop(),p=u.join("."),y=i.get(p);return typeof((f=i.get(p))==null?void 0:f[h])=="function"?(..._)=>y[h](..._):()=>y[h]}else if(i.get(l)){let u=i.get(l);return()=>u}else{let u=l;return()=>u}},n=(l,c)=>{if(l==="__output")r[c]=f=>f;else if(typeof l=="string")r[c]=s(l);else if(typeof l=="function"){let f=l;r[c]=(...u)=>f(...u)}else if(typeof l=="object"&&l.__input){let f=function(u){let h=u.__input;if(typeof u.__input=="string"&&(h=s(u.__input)),u.__args&&(h=Js(h,u.__args,i)),u.__output){let p=u.__output;if(typeof u.__output=="string"?p=s(p):typeof l.__output=="object"&&(p=f(p)),typeof p=="function"){let y=h;h=(..._)=>p(y(..._))}}return h};r[c]=f(l)}else{let f=l;r[c]=()=>f}};e.forEach(n),typeof t=="string"&&(t=s(t));let a=t;return t=function(...l){let c=f=>f(...l);return a(...r.map(c))},t},Lc=(t,e,i)=>{t.__node.backward&&e instanceof ce&&i.setListeners({[e.__node.tag]:{[t.__node.tag]:e}})},Ic=(t,e,i)=>{if(t.__operator&&!t.__node.looperSet){if(typeof t.__node.delay=="number"){let r=t.__operator;t.__setOperator((...s)=>new Promise((n,a)=>{setTimeout(async()=>{n(await r(...s))},t.__node.delay)}))}else if(t.__node.frame===!0){let r=t.__operator;t.__setOperator((...s)=>new Promise((n,a)=>{requestAnimationFrame(async()=>{n(await r(...s))})}))}if(typeof t.__node.repeat=="number"||typeof t.__node.recursive=="number"){let r=t.__operator;t.__setOperator(async(...s)=>{let n=t.__node.repeat?t.__node.repeat:t.__node.recursive,a,l=async(c,...f)=>{for(;c>0;){if(t.__node.delay||t.__node.frame){r(...f).then(async u=>{t.__node.recursive?await l(c,u):await l(c,...f)});break}else a=await r(...s);c--}};return await l(n,...s),a})}if(t.__node.loop&&typeof t.__node.loop=="number"){t.__node.looperSet=!0;let r=t.__operator;t.__setOperator((...n)=>{"looping"in t.__node||(t.__node.looping=!0),t.__node.looping&&(r(...n),setTimeout(()=>{t.__operator(...n)},t.__node.loop))}),t.__node.looping&&t.__operator();let s=n=>{n.__node.looping&&(n.__node.looping=!1)};t.__addOndisconnected(s)}}},Mc=(t,e,i)=>{if(t.__node.animate===!0||t.__animation){let r=t.__operator;t.__setOperator((...n)=>{"animating"in t.__node||(t.__node.animating=!0),t.__node.animating&&(typeof t.__animation=="function"?t.__animation(...n):r(...n),requestAnimationFrame(()=>{t.__operator(...n)}))}),(t.__node.animating||(!("animating"in t.__node)||t.__node.animating)&&t.__animation)&&setTimeout(()=>{requestAnimationFrame(t.__operator)},10);let s=n=>{n.__node.animating&&(n.__node.animating=!1)};t.__addOndisconnected(s)}},Dc=(t,e,i)=>{if(typeof t.__branch=="object"&&t.__operator&&!t.__branchApplied){let r=t.__operator;t.__branchApplied=!0,t.__operator=(...s)=>{let n=r(...s);for(const a in t.__branch){let l=()=>{typeof t.__branch[a].then=="function"?t.__branch[a].then(n):t.__branch[a].then instanceof ce&&t.__branch[a].then.__operator?t.__branch[a].then.__operator(n):n=t.__branch[a].then};typeof t.__branch[a].if=="function"?t.__branch[a].if(n)==!0&&l():t.__branch[a].if===n&&l()}return n}}if(t.__listeners){for(const r in t.__listeners)if(typeof t.__listeners[r]=="object"&&t.__listeners[r].branch&&!t.__listeners[r].branchApplied){let s=t.__listeners[r].callback;t.__listeners[r].branchApplied=!0,t.__listeners.callback=n=>{let a=()=>{typeof t.__listeners[r].branch.then=="function"?n=t.__listeners[r].branch.then(n):t.__listeners[r].branch.then instanceof ce&&t.__listeners[r].branch.then.__operator?n=t.__listeners[r].branch.then.__operator(n):n=t.__listeners[r].branch.then};return typeof t.__listeners[r].branch.if=="function"?t.__listeners[r].branch.if(n)&&a():t.__listeners[r].branch.if===n&&a(),s(n)}}}},Rc=(t,e,i)=>{if(t.__listeners)for(const r in t.__listeners)typeof t.__listeners[r]=="object"&&t.__listeners[r].oncreate&&t.__listeners[r].callback(t.__listeners[r].oncreate)},Fc=(t,e,i)=>{if(t.__listeners)for(const r in t.__listeners)typeof t.__listeners[r]=="object"&&typeof t.__listeners[r].binding=="object"&&(t.__listeners.callback=t.__listeners.callback.bind(t.__listeners[r].binding))},Uc=(t,e,i)=>{if(t.__listeners){for(const r in t.__listeners)if(typeof t.__listeners[r]=="object"&&typeof t.__listeners[r].transform=="function"&&!t.__listeners[r].transformApplied){let s=t.__listeners[r].callback;t.__listeners[r].transformApplied=!0,t.__listeners.callback=n=>(n=t.__listeners[r].transform(n),s(n))}}},Jc=(t,e,i)=>{var r;t.post&&!t.__operator?t.__setOperator(t.post):!t.__operator&&typeof t.get=="function"&&t.__setOperator(t.get),!t.get&&t.__operator&&(t.get=t.__operator),t.aliases&&t.aliases.forEach(s=>{i.set(s,t);let n=a=>{i.__node.nodes.delete(s)};t.__addOndisconnected(n)}),typeof((r=i.__node.roots)==null?void 0:r[t.__node.tag])=="object"&&t.get&&(i.__node.roots[t.__node.tag].get=t.get)},Qn={backprop:Lc,loop:Ic,animate:Mc,branching:Dc,triggerListenerOncreate:Rc,bindListener:Fc,transformListenerResult:Uc,substitute__operator:Jc},xs=t=>{let e={};for(const i in t)typeof t[i]=="object"?e[i]=xs(t[i]):typeof t[i]=="function"?e[i]=t[i].toString():e[i]=t[i];return e};function Kt(t=""){let e=a=>a.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),r=(a=>{let l=a.indexOf("=>")+1;return l<=0&&(l=a.indexOf("){")),l<=0&&(l=a.indexOf(") {")),a.slice(0,a.indexOf("{",l)+1)})(t),s=e(t),n;if(r.includes("function")){let a=r.split("(")[1].split(")")[0];n=new Function(a,s)}else if(r.substring(0,6)===s.substring(0,6)){let a=r.split("(")[1].split(")")[0];n=new Function(a,s.substring(s.indexOf("{")+1,s.length-1))}else try{n=(0,eval)(t)}catch{}return n}var $c=function(){const t=new Map,e=[],i=["this"];function r(){t.clear(),e.length=0,i.length=1}function s(a,l){var c=e.length-1,f=e[c];if(typeof f=="object")if(f[a]===l||c===0)i.push(a),e.push(l.pushed);else for(;c-->=0;){if(f=e[c],typeof f=="object"&&f[a]===l){c+=2,e.length=c,i.length=c,--c,e[c]=l,i[c]=a;break}c--}}function n(a,l){if(l!=null&&typeof l=="object"){a&&s(a,l);let c=t.get(l);if(c)return"[Circular Reference]"+c;t.set(l,i.join("."))}return l}return function(l,c){try{return e.push(l),JSON.stringify(l,n,c)}finally{r()}}}();JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=$c);var zc=function(){const t=new Map,e=[],i=["this"];function r(){t.clear(),e.length=0,i.length=1}function s(a,l){var c=e.length-1;if(e[c]){var f=e[c];if(typeof f=="object")if(f[a]===l||c===0)i.push(a),e.push(l.pushed);else for(;c-->=0;){if(f=e[c],typeof f=="object"&&f[a]===l){c+=2,e.length=c,i.length=c,--c,e[c]=l,i[c]=a;break}c++}}}function n(a,l){let c;if(l!=null)if(typeof l=="object"){let f=l.constructor.name;a&&f==="Object"&&s(a,l);let u=t.get(l);if(u)return"[Circular Reference]"+u;if(t.set(l,i.join(".")),f==="Array")l.length>20?c=l.slice(l.length-20):c=l;else if(f.includes("Set"))c=Array.from(l);else if(f!=="Object"&&f!=="Number"&&f!=="String"&&f!=="Boolean")c="instanceof_"+f;else if(f==="Object"){let h={};for(const p in l)if(l[p]==null)h[p]=l[p];else if(Array.isArray(l[p]))l[p].length>20?h[p]=l[p].slice(l[p].length-20):h[p]=l[p];else if(l[p].constructor.name==="Object"){h[p]={};for(const y in l[p])if(Array.isArray(l[p][y]))l[p][y].length>20?h[p][y]=l[p][y].slice(l[p][y].length-20):h[p][y]=l[p][y];else if(l[p][y]!=null){let _=l[p][y].constructor.name;_.includes("Set")?h[p][y]=Array.from(l[p][y]):_!=="Number"&&_!=="String"&&_!=="Boolean"?h[p][y]="instanceof_"+_:h[p][y]=l[p][y]}else h[p][y]=l[p][y]}else{let y=l[p].constructor.name;y.includes("Set")?h[p]=Array.from(l[p]):y!=="Number"&&y!=="String"&&y!=="Boolean"?h[p]="instanceof_"+y:h[p]=l[p]}c=h}else c=l}else c=l;return c}return function(l,c){e.push(l);let f=JSON.stringify(l,n,c);return r(),f}}();JSON.stringifyFast===void 0&&(JSON.stringifyFast=zc);function eo(t){if(typeof t.__methods=="object")for(const e in t.__methods){let i=t.__methods[e],r=typeof i=="function"?i:Kt(i);e==="__operator"?t.__setOperator(r):t[e]=r.bind(t)}}var Io=class extends Lt{constructor(t){super({...t,loaders:t!=null&&t.loaders?Object.assign({...Qn},t.loaders):{...Qn}}),this.name=`service${Math.floor(Math.random()*1e15)}`,this.addServices=e=>{var i,r,s,n;for(const a in e)if(typeof e[a]=="function"&&(e[a]=new e[a]),(r=(i=e[a])==null?void 0:i.__node)!=null&&r.loaders&&Object.assign(this.__node.loaders,e[a].__node.loaders),(n=(s=e[a])==null?void 0:s.__node)!=null&&n.nodes){e[a].__node.nodes.forEach((f,u)=>{this.get(u)?this.set(a+"."+u,f):this.set(u,f)}),this.__node.nodes.forEach((f,u)=>{e[a].__node.nodes.get(u)||e[a].__node.nodes.set(u,f)});let l=this.set;this.set=(f,u)=>(e[a].set(f,u),l(f,u));let c=this.delete;this.delete=f=>(e[a].delete(f),c(f))}else typeof e[a]=="object"&&this.load(e[a])},this.handleMethod=(e,i,r)=>{let s=i.toLowerCase(),n=this.__node.nodes.get(e);if(n||(n=this.__node.roots[e]),n!=null&&n[s])if(typeof n[s]!="function"){if(r){Array.isArray(r)&&r.length===1?n[s]=r[0]:n[s]=r;return}return n[s]}else return Array.isArray(r)?n[s](...r):n[s](r);else return this.handleServiceMessage({route:e,args:r,method:i})},this.transmit=(...e)=>typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.__node.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e,this.receive=(...e)=>{if(e[0]&&typeof e[0]=="string"){let i=e[0].substring(0,8);(i.includes("{")||i.includes("["))&&(i.includes("\\")&&(e[0]=e[0].replace(/\\/g,"")),e[0][0]==='"'&&(e[0]=e[0].substring(1,e[0].length-1)),e[0]=JSON.parse(e[0]))}return typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.__node.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e},this.pipe=(e,i,r,s,n)=>{if(e instanceof ce)return n?this.subscribe(e,a=>{let l=n(a);l!==void 0?this.transmit({route:i,args:l,method:s}):this.transmit({route:i,args:a,method:s},r)}):this.subscribe(e,a=>{this.transmit({route:i,args:a,method:s},r)});if(typeof e=="string")return this.subscribe(e,a=>{this.transmit({route:i,args:a,method:s},r)})},this.pipeOnce=(e,i,r,s,n)=>{if(e instanceof ce)return n?e.__node.state.subscribeEventOnce(e.__node.unique,a=>{let l=n(a);l!==void 0?this.transmit({route:i,args:l,method:s}):this.transmit({route:i,args:a,method:s},r)}):this.__node.state.subscribeEventOnce(e.__node.unique,a=>{this.transmit({route:i,args:a,method:s},r)});if(typeof e=="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(e).__node.unique,a=>{this.transmit({route:i,args:a,method:s},r)})},this.terminate=(...e)=>{},this.isTypedArray=qc,this.recursivelyAssign=fr,this.spliceTypedArray=Vc,this.ping=()=>(console.log("pinged!"),"pong"),this.echo=(...e)=>(this.transmit(...e),e),t!=null&&t.services&&this.addServices(t.services),this.load(this)}handleServiceMessage(t){let e;return typeof t=="object"&&(t.route?e=t.route:t.node&&(e=t.node)),e?Array.isArray(t.args)?this.run(e,...t.args):this.run(e,t.args):t}handleGraphNodeCall(t,e){if(!t)return e;if(e!=null&&e.args)this.handleServiceMessage(e);else return Array.isArray(e)?this.run(t,...e):this.run(t,e)}};function qc(t){return ArrayBuffer.isView(t)&&Object.prototype.toString.call(t)!=="[object DataView]"}var fr=(t,e)=>{for(const i in e)e[i].constructor.name==="Object"&&!Array.isArray(e[i])?e[i].constructor.name==="Object"&&!Array.isArray(t[i])?fr(t[i],e[i]):t[i]=fr({},e[i]):t[i]=e[i];return t};function Vc(t,e,i){let r=t.subarray(0,e),s;i&&(s=t.subarray(i+1));let n;return(r.length>0||(s==null?void 0:s.length)>0)&&(n=new t.constructor(r.length+s.length)),n&&(r.length>0&&n.set(r),s&&s.length>0&&n.set(s,r.length)),n}var zi={},Hc={transferNode:(t,e,i)=>{let r;if(typeof t=="object"){t.__node||(t.__node={}),i&&(t.__node.tag=i);for(const s in t)typeof t[s]=="function"&&(t.__methods||(t.__methods={}),t.__methods[s]=t[s].toString());r=xs(t)}else typeof t=="function"?r=t.toString():typeof t=="string"&&(r=t);if(r){if(e.run)return e.run("setNode",[r]);if(e.postMessage)return e.postMessage({route:"setNode",args:r},void 0),new Promise(s=>s(i));if(e.send)return e.send(JSON.stringify({route:"setNode",args:r})),new Promise(s=>s(i))}},setNode:function(t){if(typeof t=="object"&&t.__methods&&(this.__node.graph.__node.loaders.methodstrings||(this.__node.graph.__node.loaders.methodstrings=eo)),typeof t=="string"){let e=Kt(t);typeof e=="function"?t={__operator:e,__node:{tag:e.name}}:(e=JSON.parse(t),typeof e=="object"&&(t=e))}if(typeof t=="object"||typeof t=="function"){let e=Object.assign({},t),i=this.__node.graph.add(t);return zi[i.__node.tag]=e,i.__node.tag}else return!1},proxyRemoteNode:function(t,e){return new Promise((i,r)=>{e.run("getNodeProperties",t).then(s=>{let n={};if(typeof s=="object")for(const a in s)s[a]==="function"?n[a]=(...l)=>new Promise(c=>{e.run(t,l,a).then(c)}):Object.defineProperty(n,a,{get:()=>new Promise(l=>{e.run(t,void 0,a).then(l)}),set:l=>{e.post(t,l,a)},configurable:!0,enumerable:!0});i(n)})})},makeNodeTransferrable:function(t,e){t.__node||(t.__node={}),e&&(t.__node.tag=e);for(const r in t)typeof t[r]=="function"&&(t.__methods||(t.__methods={}),t.__methods[r]=t[r].toString());return xs(t)},setTemplate:function(t,e){var i;if(typeof t=="object"&&t.__methods&&(this.__node.graph.__node.loaders.methodstrings||(this.__node.graph.__node.loaders.methodstrings=eo)),typeof t=="string"){let r=Kt(t);typeof r=="function"?(e||(e=r.name),t={__operator:r,__node:{tag:e}}):(r=JSON.parse(t),typeof r=="object"&&(t=r,!e&&((i=r.__node)!=null&&i.tag)&&(e=r.__node.tag)))}return e||(e=`node${Math.floor(Math.random()*1e15)}`),typeof t=="object"||typeof t=="function"?(zi[e]=t,e):!1},loadFromTemplate:function(t,e,i){if(zi[t]){let r=fr({},zi[t]);return e&&(r.__node||(r.__node={}),r.__node.tag=e),i&&Object.assign(r,i),this.__node.graph.add(r).__node.tag}},setMethod:function(t,e,i){if(typeof e=="string"){let r=Kt(e);typeof r=="function"&&(e=r)}return!i&&typeof e=="function"&&(i=e.name),this.__node.graph.get(t)?this.__node.graph.get(t)[i]=e:this.__node.graph.add({__node:{tag:i,[i]:e}}),!0},assignNode:function(t,e){this.__node.graph.get(t)&&typeof e=="object"&&Object.assign(this.__node.graph.get(t),e)},getNodeProperties:function(t){let e=this.__node.graph.get(t);if(e){let i=Object.getOwnPropertyNames(e),r={};for(const s in i)r[s]=typeof e[s];return r}},transferClass:(t,e,i)=>{if(typeof t=="object"){let r=t.toString(),s={route:"receiveClass",args:[r,i]};return e.run?e.run("receiveClass",[r,i]):e.postMessage?(e.postMessage({route:"receiveClass",args:[r,i]},void 0),new Promise(n=>n(name))):e.send?(e.send(JSON.stringify({route:"receiveClass",args:[r,i]})),new Promise(n=>n(name))):s}return!1},receiveClass:function(t,e){if(typeof t=="string"&&t.indexOf("class")===0){let i=(0,eval)("("+t+")"),r=e;return r||(r=i.name),this.__node.graph[r]=i,!0}return!1},transferFunction:(t,e,i)=>{i||(i=t.name);let r=t.toString(),s={route:"receiveClass",args:[r,i]};return e.run?e.run("setFunction",[r,i]):e.postMessage?(e.postMessage({route:"setFunction",args:[r,i]},void 0),new Promise(n=>n(name))):e.send?(e.send(JSON.stringify({route:"setFunction",args:[r,i]})),new Promise(n=>n(name))):s},setGlobal:(t,e)=>(globalThis[t]=e,!0),assignGlobalObject:(t,e)=>globalThis[t]?(typeof e=="object"&&Object.assign(globalThis[t],e),!0):!1,setValue:function(t,e){return this.__node.graph[t]=e,!0},assignObject:function(t,e){return this.__node.graph[t]?(typeof e=="object"&&Object.assign(this.__node.graph[t],e),!0):!1},setGlobalFunction:(t,e)=>(typeof t=="string"&&(t=Kt(t)),typeof t=="function"?(e||(e=t.name),globalThis[e]=t,!0):!1),setGraphFunction:function(t,e){return typeof t=="string"&&(t=Kt(t)),typeof t=="function"?(e||(e=t.name),this.__node.graph[e]=t,!0):!1}},v={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};v.cipher.aes=function(t){this.s[0][0][0]||this.O();var e,i,r,s,n=this.s[0][4],a=this.s[1];e=t.length;var l=1;if(e!==4&&e!==6&&e!==8)throw new v.exception.invalid("invalid aes key size");for(this.b=[r=t.slice(0),s=[]],t=e;t<4*e+28;t++)i=r[t-1],(t%e===0||e===8&&t%e===4)&&(i=n[i>>>24]<<24^n[i>>16&255]<<16^n[i>>8&255]<<8^n[i&255],t%e===0&&(i=i<<8^i>>>24^l<<24,l=l<<1^283*(l>>7))),r[t]=r[t-e]^i;for(e=0;t;e++,t--)i=r[e&3?t:t-4],s[e]=4>=t||4>e?i:a[0][n[i>>>24]]^a[1][n[i>>16&255]]^a[2][n[i>>8&255]]^a[3][n[i&255]]};v.cipher.aes.prototype={encrypt:function(t){return to(this,t,0)},decrypt:function(t){return to(this,t,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var t=this.s[0],e=this.s[1],i=t[4],r=e[4],s,n,a,l=[],c=[],f,u,h,p;for(s=0;256>s;s++)c[(l[s]=s<<1^283*(s>>7))^s]=s;for(n=a=0;!i[n];n^=f||1,a=c[a]||1)for(h=a^a<<1^a<<2^a<<3^a<<4,h=h>>8^h&255^99,i[n]=h,r[h]=n,u=l[s=l[f=l[n]]],p=16843009*u^65537*s^257*f^16843008*n,u=257*l[h]^16843008*h,s=0;4>s;s++)t[s][n]=u=u<<24^u>>>8,e[s][h]=p=p<<24^p>>>8;for(s=0;5>s;s++)t[s]=t[s].slice(0),e[s]=e[s].slice(0)}};function to(t,e,i){if(e.length!==4)throw new v.exception.invalid("invalid aes block size");var r=t.b[i],s=e[0]^r[0],n=e[i?3:1]^r[1],a=e[2]^r[2];e=e[i?1:3]^r[3];var l,c,f,u=r.length/4-2,h,p=4,y=[0,0,0,0];l=t.s[i],t=l[0];var _=l[1],m=l[2],A=l[3],O=l[4];for(h=0;h<u;h++)l=t[s>>>24]^_[n>>16&255]^m[a>>8&255]^A[e&255]^r[p],c=t[n>>>24]^_[a>>16&255]^m[e>>8&255]^A[s&255]^r[p+1],f=t[a>>>24]^_[e>>16&255]^m[s>>8&255]^A[n&255]^r[p+2],e=t[e>>>24]^_[s>>16&255]^m[n>>8&255]^A[a&255]^r[p+3],p+=4,s=l,n=c,a=f;for(h=0;4>h;h++)y[i?3&-h:h]=O[s>>>24]<<24^O[n>>16&255]<<16^O[a>>8&255]<<8^O[e&255]^r[p++],l=s,s=n,n=a,a=e,e=l;return y}v.bitArray={bitSlice:function(t,e,i){return t=v.bitArray.$(t.slice(e/32),32-(e&31)).slice(1),i===void 0?t:v.bitArray.clamp(t,i-e)},extract:function(t,e,i){var r=Math.floor(-e-i&31);return((e+i-1^e)&-32?t[e/32|0]<<32-r^t[e/32+1|0]>>>r:t[e/32|0]>>>r)&(1<<i)-1},concat:function(t,e){if(t.length===0||e.length===0)return t.concat(e);var i=t[t.length-1],r=v.bitArray.getPartial(i);return r===32?t.concat(e):v.bitArray.$(e,r,i|0,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return e===0?0:32*(e-1)+v.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var i=t.length;return e=e&31,0<i&&e&&(t[i-1]=v.bitArray.partial(e,t[i-1]&2147483648>>e-1,1)),t},partial:function(t,e,i){return t===32?e:(i?e|0:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(v.bitArray.bitLength(t)!==v.bitArray.bitLength(e))return!1;var i=0,r;for(r=0;r<t.length;r++)i|=t[r]^e[r];return i===0},$:function(t,e,i,r){var s;for(s=0,r===void 0&&(r=[]);32<=e;e-=32)r.push(i),i=0;if(e===0)return r.concat(t);for(s=0;s<t.length;s++)r.push(i|t[s]>>>e),i=t[s]<<32-e;return s=t.length?t[t.length-1]:0,t=v.bitArray.getPartial(s),r.push(v.bitArray.partial(e+t&31,32<e+t?i:r.pop(),1)),r},i:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,i;for(e=0;e<t.length;++e)i=t[e],t[e]=i>>>24|i>>>8&65280|(i&65280)<<8|i<<24;return t}};v.codec.utf8String={fromBits:function(t){var e="",i=v.bitArray.bitLength(t),r,s;for(r=0;r<i/8;r++)!(r&3)&&(s=t[r/4]),e+=String.fromCharCode(s>>>8>>>8>>>8),s<<=8;return decodeURIComponent(escape(e))},toBits:function(t){t=unescape(encodeURIComponent(t));var e=[],i,r=0;for(i=0;i<t.length;i++)r=r<<8|t.charCodeAt(i),(i&3)===3&&(e.push(r),r=0);return i&3&&e.push(v.bitArray.partial(8*(i&3),r)),e}};v.codec.hex={fromBits:function(t){var e="",i;for(i=0;i<t.length;i++)e+=((t[i]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,v.bitArray.bitLength(t)/4)},toBits:function(t){var e,i=[],r;for(t=t.replace(/\s|0x/g,""),r=t.length,t=t+"00000000",e=0;e<t.length;e+=8)i.push(parseInt(t.substr(e,8),16)^0);return v.bitArray.clamp(i,4*r)}};v.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(t,e,i){var r=v.codec.base32.BASE,s=v.codec.base32.REMAINING,n="",a=0,l=v.codec.base32.B,c=0,f=v.bitArray.bitLength(t);for(i&&(l=v.codec.base32.X),i=0;n.length*r<f;)n+=l.charAt((c^t[i]>>>a)>>>s),a<r?(c=t[i]<<r-a,a+=s,i++):(c<<=r,a-=r);for(;n.length&7&&!e;)n+="=";return n},toBits:function(t,e){t=t.replace(/\s|=/g,"").toUpperCase();var i=v.codec.base32.BITS,r=v.codec.base32.BASE,s=v.codec.base32.REMAINING,n=[],a,l=0,c=v.codec.base32.B,f=0,u,h="base32";for(e&&(c=v.codec.base32.X,h="base32hex"),a=0;a<t.length;a++){if(u=c.indexOf(t.charAt(a)),0>u){if(!e)try{return v.codec.base32hex.toBits(t)}catch{}throw new v.exception.invalid("this isn't "+h+"!")}l>s?(l-=s,n.push(f^u>>>l),f=u<<i-l):(l+=r,f^=u<<i-l)}return l&56&&n.push(v.bitArray.partial(l&56,f,1)),n}};v.codec.base32hex={fromBits:function(t,e){return v.codec.base32.fromBits(t,e,1)},toBits:function(t){return v.codec.base32.toBits(t,1)}};v.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,i){var r="",s=0,n=v.codec.base64.B,a=0,l=v.bitArray.bitLength(t);for(i&&(n=n.substr(0,62)+"-_"),i=0;6*r.length<l;)r+=n.charAt((a^t[i]>>>s)>>>26),6>s?(a=t[i]<<6-s,s+=26,i++):(a<<=6,s-=6);for(;r.length&3&&!e;)r+="=";return r},toBits:function(t,e){t=t.replace(/\s|=/g,"");var i=[],r,s=0,n=v.codec.base64.B,a=0,l;for(e&&(n=n.substr(0,62)+"-_"),r=0;r<t.length;r++){if(l=n.indexOf(t.charAt(r)),0>l)throw new v.exception.invalid("this isn't base64!");26<s?(s-=26,i.push(a^l>>>s),a=l<<32-s):(s+=6,a^=l<<32-s)}return s&56&&i.push(v.bitArray.partial(s&56,a,1)),i}};v.codec.base64url={fromBits:function(t){return v.codec.base64.fromBits(t,1,1)},toBits:function(t){return v.codec.base64.toBits(t,1)}};v.hash.sha256=function(t){this.b[0]||this.O(),t?(this.F=t.F.slice(0),this.A=t.A.slice(0),this.l=t.l):this.reset()};v.hash.sha256.hash=function(t){return new v.hash.sha256().update(t).finalize()};v.hash.sha256.prototype={blockSize:512,reset:function(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update:function(t){typeof t=="string"&&(t=v.codec.utf8String.toBits(t));var e,i=this.A=v.bitArray.concat(this.A,t);if(e=this.l,t=this.l=e+v.bitArray.bitLength(t),9007199254740991<t)throw new v.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var r=new Uint32Array(i),s=0;for(e=512+e-(512+e&511);e<=t;e+=512)is(this,r.subarray(16*s,16*(s+1))),s+=1;i.splice(0,16*s)}else for(e=512+e-(512+e&511);e<=t;e+=512)is(this,i.splice(0,16));return this},finalize:function(){var t,i=this.A,e=this.F,i=v.bitArray.concat(i,[v.bitArray.partial(1,1)]);for(t=i.length+2;t&15;t++)i.push(0);for(i.push(Math.floor(this.l/4294967296)),i.push(this.l|0);i.length;)is(this,i.splice(0,16));return this.reset(),e},Y:[],b:[],O:function(){function t(n){return 4294967296*(n-Math.floor(n))|0}for(var e=0,i=2,r,s;64>e;i++){for(s=!0,r=2;r*r<=i;r++)if(i%r===0){s=!1;break}s&&(8>e&&(this.Y[e]=t(Math.pow(i,.5))),this.b[e]=t(Math.pow(i,1/3)),e++)}}};function is(t,e){var i,r,s,n=t.F,a=t.b,l=n[0],c=n[1],f=n[2],u=n[3],h=n[4],p=n[5],y=n[6],_=n[7];for(i=0;64>i;i++)16>i?r=e[i]:(r=e[i+1&15],s=e[i+14&15],r=e[i&15]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(s>>>17^s>>>19^s>>>10^s<<15^s<<13)+e[i&15]+e[i+9&15]|0),r=r+_+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(y^h&(p^y))+a[i],_=y,y=p,p=h,h=u+r|0,u=f,f=c,c=l,l=r+(c&f^u&(c^f))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;n[0]=n[0]+l|0,n[1]=n[1]+c|0,n[2]=n[2]+f|0,n[3]=n[3]+u|0,n[4]=n[4]+h|0,n[5]=n[5]+p|0,n[6]=n[6]+y|0,n[7]=n[7]+_|0}v.mode.ccm={name:"ccm",G:[],listenProgress:function(t){v.mode.ccm.G.push(t)},unListenProgress:function(t){t=v.mode.ccm.G.indexOf(t),-1<t&&v.mode.ccm.G.splice(t,1)},fa:function(t){var e=v.mode.ccm.G.slice(),i;for(i=0;i<e.length;i+=1)e[i](t)},encrypt:function(t,e,i,r,s){var n,a=e.slice(0),l=v.bitArray,c=l.bitLength(i)/8,f=l.bitLength(a)/8;if(s=s||64,r=r||[],7>c)throw new v.exception.invalid("ccm: iv must be at least 7 bytes");for(n=2;4>n&&f>>>8*n;n++);return n<15-c&&(n=15-c),i=l.clamp(i,8*(15-n)),e=v.mode.ccm.V(t,e,i,r,s,n),a=v.mode.ccm.C(t,a,i,e,s,n),l.concat(a.data,a.tag)},decrypt:function(t,e,i,r,s){s=s||64,r=r||[];var n=v.bitArray,a=n.bitLength(i)/8,f=n.bitLength(e),l=n.clamp(e,f-s),c=n.bitSlice(e,f-s),f=(f-s)/8;if(7>a)throw new v.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;4>e&&f>>>8*e;e++);if(e<15-a&&(e=15-a),i=n.clamp(i,8*(15-e)),l=v.mode.ccm.C(t,l,i,c,s,e),t=v.mode.ccm.V(t,l.data,i,r,s,e),!n.equal(l.tag,t))throw new v.exception.corrupt("ccm: tag doesn't match");return l.data},na:function(t,e,i,r,s,n){var a=[],l=v.bitArray,c=l.i;if(r=[l.partial(8,(e.length?64:0)|r-2<<2|n-1)],r=l.concat(r,i),r[3]|=s,r=t.encrypt(r),e.length)for(i=l.bitLength(e)/8,65279>=i?a=[l.partial(16,i)]:4294967295>=i&&(a=l.concat([l.partial(16,65534)],[i])),a=l.concat(a,e),e=0;e<a.length;e+=4)r=t.encrypt(c(r,a.slice(e,e+4).concat([0,0,0])));return r},V:function(t,e,i,r,s,n){var a=v.bitArray,l=a.i;if(s/=8,s%2||4>s||16<s)throw new v.exception.invalid("ccm: invalid tag length");if(4294967295<r.length||4294967295<e.length)throw new v.exception.bug("ccm: can't deal with 4GiB or more data");for(i=v.mode.ccm.na(t,r,i,s,a.bitLength(e)/8,n),r=0;r<e.length;r+=4)i=t.encrypt(l(i,e.slice(r,r+4).concat([0,0,0])));return a.clamp(i,8*s)},C:function(t,e,i,r,s,n){var a,l=v.bitArray;a=l.i;var c=e.length,f=l.bitLength(e),u=c/50,h=u;if(i=l.concat([l.partial(8,n-1)],i).concat([0,0,0]).slice(0,4),r=l.bitSlice(a(r,t.encrypt(i)),0,s),!c)return{tag:r,data:[]};for(a=0;a<c;a+=4)a>u&&(v.mode.ccm.fa(a/c),u+=h),i[3]++,s=t.encrypt(i),e[a]^=s[0],e[a+1]^=s[1],e[a+2]^=s[2],e[a+3]^=s[3];return{tag:r,data:l.clamp(e,f)}}};v.mode.ocb2={name:"ocb2",encrypt:function(t,e,i,r,s,n){if(v.bitArray.bitLength(i)!==128)throw new v.exception.invalid("ocb iv must be 128 bits");var a,l=v.mode.ocb2.S,c=v.bitArray,f=c.i,u=[0,0,0,0];i=l(t.encrypt(i));var h,p=[];for(r=r||[],s=s||64,a=0;a+4<e.length;a+=4)h=e.slice(a,a+4),u=f(u,h),p=p.concat(f(i,t.encrypt(f(i,h)))),i=l(i);return h=e.slice(a),e=c.bitLength(h),a=t.encrypt(f(i,[0,0,0,e])),h=c.clamp(f(h.concat([0,0,0]),a),e),u=f(u,f(h.concat([0,0,0]),a)),u=t.encrypt(f(u,f(i,l(i)))),r.length&&(u=f(u,n?r:v.mode.ocb2.pmac(t,r))),p.concat(c.concat(h,c.clamp(u,s)))},decrypt:function(t,e,i,r,s,n){if(v.bitArray.bitLength(i)!==128)throw new v.exception.invalid("ocb iv must be 128 bits");s=s||64;var a=v.mode.ocb2.S,l=v.bitArray,c=l.i,f=[0,0,0,0],u=a(t.encrypt(i)),h,p,y=v.bitArray.bitLength(e)-s,_=[];for(r=r||[],i=0;i+4<y/32;i+=4)h=c(u,t.decrypt(c(u,e.slice(i,i+4)))),f=c(f,h),_=_.concat(h),u=a(u);if(p=y-32*i,h=t.encrypt(c(u,[0,0,0,p])),h=c(h,l.clamp(e.slice(i),p).concat([0,0,0])),f=c(f,h),f=t.encrypt(c(f,c(u,a(u)))),r.length&&(f=c(f,n?r:v.mode.ocb2.pmac(t,r))),!l.equal(l.clamp(f,s),l.bitSlice(e,y)))throw new v.exception.corrupt("ocb: tag doesn't match");return _.concat(l.clamp(h,p))},pmac:function(t,e){var i,r=v.mode.ocb2.S,s=v.bitArray,n=s.i,a=[0,0,0,0],l=t.encrypt([0,0,0,0]),l=n(l,r(r(l)));for(i=0;i+4<e.length;i+=4)l=r(l),a=n(a,t.encrypt(n(l,e.slice(i,i+4))));return i=e.slice(i),128>s.bitLength(i)&&(l=n(l,r(l)),i=s.concat(i,[-2147483648,0,0,0])),a=n(a,i),t.encrypt(n(r(n(l,r(l))),a))},S:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}};v.mode.gcm={name:"gcm",encrypt:function(t,e,i,r,s){var n=e.slice(0);return e=v.bitArray,r=r||[],t=v.mode.gcm.C(!0,t,n,r,i,s||128),e.concat(t.data,t.tag)},decrypt:function(t,e,i,r,s){var n=e.slice(0),a=v.bitArray,l=a.bitLength(n);if(s=s||128,r=r||[],s<=l?(e=a.bitSlice(n,l-s),n=a.bitSlice(n,0,l-s)):(e=n,n=[]),t=v.mode.gcm.C(!1,t,n,r,i,s),!a.equal(t.tag,e))throw new v.exception.corrupt("gcm: tag doesn't match");return t.data},ka:function(t,e){var i,r,s,n,a,l=v.bitArray.i;for(s=[0,0,0,0],n=e.slice(0),i=0;128>i;i++){for((r=(t[Math.floor(i/32)]&1<<31-i%32)!==0)&&(s=l(s,n)),a=(n[3]&1)!==0,r=3;0<r;r--)n[r]=n[r]>>>1|(n[r-1]&1)<<31;n[0]>>>=1,a&&(n[0]^=-520093696)}return s},j:function(t,e,i){var r,s=i.length;for(e=e.slice(0),r=0;r<s;r+=4)e[0]^=4294967295&i[r],e[1]^=4294967295&i[r+1],e[2]^=4294967295&i[r+2],e[3]^=4294967295&i[r+3],e=v.mode.gcm.ka(e,t);return e},C:function(t,e,i,r,s,n){var a,l,c,f,u,h,p,y,_=v.bitArray;for(h=i.length,p=_.bitLength(i),y=_.bitLength(r),l=_.bitLength(s),a=e.encrypt([0,0,0,0]),l===96?(s=s.slice(0),s=_.concat(s,[1])):(s=v.mode.gcm.j(a,[0,0,0,0],s),s=v.mode.gcm.j(a,s,[0,0,Math.floor(l/4294967296),l&4294967295])),l=v.mode.gcm.j(a,[0,0,0,0],r),u=s.slice(0),r=l.slice(0),t||(r=v.mode.gcm.j(a,l,i)),f=0;f<h;f+=4)u[3]++,c=e.encrypt(u),i[f]^=c[0],i[f+1]^=c[1],i[f+2]^=c[2],i[f+3]^=c[3];return i=_.clamp(i,p),t&&(r=v.mode.gcm.j(a,l,i)),t=[Math.floor(y/4294967296),y&4294967295,Math.floor(p/4294967296),p&4294967295],r=v.mode.gcm.j(a,r,t),c=e.encrypt(s),r[0]^=c[0],r[1]^=c[1],r[2]^=c[2],r[3]^=c[3],{tag:_.bitSlice(r,0,n),data:i}}};v.misc.hmac=function(t,e){this.W=e=e||v.hash.sha256;var i=[[],[]],r,s=e.prototype.blockSize/32;for(this.w=[new e,new e],t.length>s&&(t=e.hash(t)),r=0;r<s;r++)i[0][r]=t[r]^909522486,i[1][r]=t[r]^1549556828;this.w[0].update(i[0]),this.w[1].update(i[1]),this.R=new e(this.w[0])};v.misc.hmac.prototype.encrypt=v.misc.hmac.prototype.mac=function(t){if(this.aa)throw new v.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)};v.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1};v.misc.hmac.prototype.update=function(t){this.aa=!0,this.R.update(t)};v.misc.hmac.prototype.digest=function(){var t=this.R.finalize(),t=new this.W(this.w[1]).update(t).finalize();return this.reset(),t};v.misc.pbkdf2=function(t,e,i,r,s){if(i=i||1e4,0>r||0>i)throw new v.exception.invalid("invalid params to pbkdf2");typeof t=="string"&&(t=v.codec.utf8String.toBits(t)),typeof e=="string"&&(e=v.codec.utf8String.toBits(e)),s=s||v.misc.hmac,t=new s(t);var n,a,l,c,f=[],u=v.bitArray;for(c=1;32*f.length<(r||1);c++){for(s=n=t.encrypt(u.concat(e,[c])),a=1;a<i;a++)for(n=t.encrypt(n),l=0;l<n.length;l++)s[l]^=n[l];f=f.concat(s)}return r&&(f=u.clamp(f,r)),f};v.prng=function(t){this.c=[new v.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=t,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80};v.prng.prototype={randomWords:function(t,e){var i=[],r;r=this.isReady(e);var s;if(r===this.u)throw new v.exception.notReady("generator isn't seeded");if(r&this.J){r=!(r&this.I),s=[];var n=0,a;for(this.Z=s[0]=new Date().valueOf()+this.da,a=0;16>a;a++)s.push(4294967296*Math.random()|0);for(a=0;a<this.c.length&&(s=s.concat(this.c[a].finalize()),n+=this.m[a],this.m[a]=0,r||!(this.P&1<<a));a++);for(this.P>=1<<this.c.length&&(this.c.push(new v.hash.sha256),this.m.push(0)),this.f-=n,n>this.o&&(this.o=n),this.P++,this.b=v.hash.sha256.hash(this.b.concat(s)),this.L=new v.cipher.aes(this.b),r=0;4>r&&(this.h[r]=this.h[r]+1|0,!this.h[r]);r++);}for(r=0;r<t;r+=4)(r+1)%this.ca===0&&ro(this),s=Os(this),i.push(s[0],s[1],s[2],s[3]);return ro(this),i.slice(0,t)},setDefaultParanoia:function(t,e){if(t===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new v.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=t},addEntropy:function(t,e,i){i=i||"user";var r,s,n=new Date().valueOf(),a=this.H[i],l=this.isReady(),c=0;switch(r=this.U[i],r===void 0&&(r=this.U[i]=this.ha++),a===void 0&&(a=this.H[i]=0),this.H[i]=(this.H[i]+1)%this.c.length,typeof t){case"number":e===void 0&&(e=1),this.c[a].update([r,this.N++,1,e,n,1,t|0]);break;case"object":if(i=Object.prototype.toString.call(t),i==="[object Uint32Array]"){for(s=[],i=0;i<t.length;i++)s.push(t[i]);t=s}else for(i!=="[object Array]"&&(c=1),i=0;i<t.length&&!c;i++)typeof t[i]!="number"&&(c=1);if(!c){if(e===void 0)for(i=e=0;i<t.length;i++)for(s=t[i];0<s;)e++,s=s>>>1;this.c[a].update([r,this.N++,2,e,n,t.length].concat(t))}break;case"string":e===void 0&&(e=t.length),this.c[a].update([r,this.N++,3,e,n,t.length]),this.c[a].update(t);break;default:c=1}if(c)throw new v.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[a]+=e,this.f+=e,l===this.u&&(this.isReady()!==this.u&&io("seeded",Math.max(this.o,this.f)),io("progress",this.getProgress()))},isReady:function(t){return t=this.T[t!==void 0?t:this.M],this.o&&this.o>=t?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=t?this.J|this.u:this.u},getProgress:function(t){return t=this.T[t||this.M],this.o>=t||this.f>t?1:this.f/t},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:_i(this,this.ma),mouseCollector:_i(this,this.oa),keyboardCollector:_i(this,this.la),accelerometerCollector:_i(this,this.ea),touchCollector:_i(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new v.exception.bug("can't attach event");this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(t,e){this.K[t][this.ga++]=e},removeEventListener:function(t,e){var i,r,s=this.K[t],n=[];for(r in s)s.hasOwnProperty(r)&&s[r]===e&&n.push(r);for(i=0;i<n.length;i++)r=n[i],delete s[r]},la:function(){bi(this,1)},oa:function(t){var e,i;try{e=t.x||t.clientX||t.offsetX||0,i=t.y||t.clientY||t.offsetY||0}catch{i=e=0}e!=0&&i!=0&&this.addEntropy([e,i],2,"mouse"),bi(this,0)},qa:function(t){t=t.touches[0]||t.changedTouches[0],this.addEntropy([t.pageX||t.clientX,t.pageY||t.clientY],1,"touch"),bi(this,0)},ma:function(){bi(this,2)},ea:function(t){if(t=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z,window.orientation){var e=window.orientation;typeof e=="number"&&this.addEntropy(e,1,"accelerometer")}t&&this.addEntropy(t,2,"accelerometer"),bi(this,0)}};function io(t,e){var i,r=v.random.K[t],s=[];for(i in r)r.hasOwnProperty(i)&&s.push(r[i]);for(i=0;i<s.length;i++)s[i](e)}function bi(t,e){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?t.addEntropy(window.performance.now(),e,"loadtime"):t.addEntropy(new Date().valueOf(),e,"loadtime")}function ro(t){t.b=Os(t).concat(Os(t)),t.L=new v.cipher.aes(t.b)}function Os(t){for(var e=0;4>e&&(t.h[e]=t.h[e]+1|0,!t.h[e]);e++);return t.L.encrypt(t.h)}function _i(t,e){return function(){e.apply(t,arguments)}}v.random=new v.prng(6);e:try{if(ss=typeof module<"u"&&module.exports){try{ns=Oc("crypto")}catch{ns=null}ss=rs=ns}if(ss&&rs.randomBytes)qi=rs.randomBytes(128),qi=new Uint32Array(new Uint8Array(qi).buffer),v.random.addEntropy(qi,1024,"crypto['randomBytes']");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(Vi=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(Vi);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(Vi);else break e;v.random.addEntropy(Vi,1024,"crypto['getRandomValues']")}}catch(t){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(t))}var qi,rs,Vi,ss,ns;v.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(t,e,i,r){i=i||{},r=r||{};var s=v.json,n=s.g({iv:v.random.randomWords(4,0)},s.defaults),a;if(s.g(n,i),i=n.adata,typeof n.salt=="string"&&(n.salt=v.codec.base64.toBits(n.salt)),typeof n.iv=="string"&&(n.iv=v.codec.base64.toBits(n.iv)),!v.mode[n.mode]||!v.cipher[n.cipher]||typeof t=="string"&&100>=n.iter||n.ts!==64&&n.ts!==96&&n.ts!==128||n.ks!==128&&n.ks!==192&&n.ks!==256||2>n.iv.length||4<n.iv.length)throw new v.exception.invalid("json encrypt: invalid parameters");return typeof t=="string"?(a=v.misc.cachedPbkdf2(t,n),t=a.key.slice(0,n.ks/32),n.salt=a.salt):v.ecc&&t instanceof v.ecc.elGamal.publicKey&&(a=t.kem(),n.kemtag=a.tag,t=a.key.slice(0,n.ks/32)),typeof e=="string"&&(e=v.codec.utf8String.toBits(e)),typeof i=="string"&&(n.adata=i=v.codec.utf8String.toBits(i)),a=new v.cipher[n.cipher](t),s.g(r,n),r.key=t,n.ct=n.mode==="ccm"&&v.arrayBuffer&&v.arrayBuffer.ccm&&e instanceof ArrayBuffer?v.arrayBuffer.ccm.encrypt(a,e,n.iv,i,n.ts):v.mode[n.mode].encrypt(a,e,n.iv,i,n.ts),n},encrypt:function(t,e,i,r){var s=v.json,n=s.ja.apply(s,arguments);return s.encode(n)},ia:function(t,e,i,r){i=i||{},r=r||{};var s=v.json;e=s.g(s.g(s.g({},s.defaults),e),i,!0);var n,a;if(n=e.adata,typeof e.salt=="string"&&(e.salt=v.codec.base64.toBits(e.salt)),typeof e.iv=="string"&&(e.iv=v.codec.base64.toBits(e.iv)),!v.mode[e.mode]||!v.cipher[e.cipher]||typeof t=="string"&&100>=e.iter||e.ts!==64&&e.ts!==96&&e.ts!==128||e.ks!==128&&e.ks!==192&&e.ks!==256||!e.iv||2>e.iv.length||4<e.iv.length)throw new v.exception.invalid("json decrypt: invalid parameters");return typeof t=="string"?(a=v.misc.cachedPbkdf2(t,e),t=a.key.slice(0,e.ks/32),e.salt=a.salt):v.ecc&&t instanceof v.ecc.elGamal.secretKey&&(t=t.unkem(v.codec.base64.toBits(e.kemtag)).slice(0,e.ks/32)),typeof n=="string"&&(n=v.codec.utf8String.toBits(n)),a=new v.cipher[e.cipher](t),n=e.mode==="ccm"&&v.arrayBuffer&&v.arrayBuffer.ccm&&e.ct instanceof ArrayBuffer?v.arrayBuffer.ccm.decrypt(a,e.ct,e.iv,e.tag,n,e.ts):v.mode[e.mode].decrypt(a,e.ct,e.iv,n,e.ts),s.g(r,e),r.key=t,i.raw===1?n:v.codec.utf8String.fromBits(n)},decrypt:function(t,e,i,r){var s=v.json;return s.ia(t,s.decode(e),i,r)},encode:function(t){var e,i="{",r="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new v.exception.invalid("json encode: invalid property name");switch(i+=r+'"'+e+'":',r=",",typeof t[e]){case"number":case"boolean":i+=t[e];break;case"string":i+='"'+escape(t[e])+'"';break;case"object":i+='"'+v.codec.base64.fromBits(t[e],0)+'"';break;default:throw new v.exception.bug("json encode: unsupported type")}}return i+"}"},decode:function(t){if(t=t.replace(/\s/g,""),!t.match(/^\{.*\}$/))throw new v.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var e={},i,r;for(i=0;i<t.length;i++){if(!(r=t[i].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new v.exception.invalid("json decode: this isn't json!");r[3]!=null?e[r[2]]=parseInt(r[3],10):r[4]!=null?e[r[2]]=r[2].match(/^(ct|adata|salt|iv)$/)?v.codec.base64.toBits(r[4]):unescape(r[4]):r[5]!=null&&(e[r[2]]=r[5]==="true")}return e},g:function(t,e,i){if(t===void 0&&(t={}),e===void 0)return t;for(var r in e)if(e.hasOwnProperty(r)){if(i&&t[r]!==void 0&&t[r]!==e[r])throw new v.exception.invalid("required parameter overridden");t[r]=e[r]}return t},sa:function(t,e){var i={},r;for(r in t)t.hasOwnProperty(r)&&t[r]!==e[r]&&(i[r]=t[r]);return i},ra:function(t,e){var i={},r;for(r=0;r<e.length;r++)t[e[r]]!==void 0&&(i[e[r]]=t[e[r]]);return i}};v.encrypt=v.json.encrypt;v.decrypt=v.json.decrypt;v.misc.pa={};v.misc.cachedPbkdf2=function(t,e){var i=v.misc.pa,r;return e=e||{},r=e.iter||1e3,i=i[t]=i[t]||{},r=i[r]=i[r]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):v.random.randomWords(2,0)},i=e.salt===void 0?r.firstSalt:e.salt,r[i]=r[i]||v.misc.pbkdf2(t,i,e.iter),{key:r[i].slice(0),salt:i.slice(0)}};var tr=class extends Io{constructor(t,e,i){super(t),this.name="http",this.fetchProxied=!1,this.listening={},this.GET=(r="http://localhost:8080/ping",s="",n)=>(s==="json"&&(n="application/json"),new Promise((a,l)=>{let c=tr.request({method:"GET",url:r,responseType:s,mimeType:n,onload:f=>{let u;c.responseType===""||c.responseType==="text"?u=c.responseText:u=c.response,r instanceof URL&&(r=r.toString()),this.setState({[r]:u}),a(u)},onabort:f=>{l(f)}})}).catch(console.error)),this.POST=(r,s="http://localhost:8080/echo",n="",a)=>(typeof r=="object"&&(n==="json"||n==="text"||!n)&&(r=JSON.stringify(r)),n==="json"&&(a="application/json"),new Promise((l,c)=>{let f=tr.request({method:"POST",url:s,data:r,responseType:n,mimeType:a,onload:u=>{let h;f.responseType===""||f.responseType==="text"?h=f.responseText:h=f.response,s instanceof URL&&(s=s.toString()),this.setState({[s]:h}),l(h)},onabort:u=>{c(u)}})}).catch(console.error)),this.transmit=(r,s)=>{var a;let n=r;return typeof n=="object"&&(r=JSON.stringify(n)),((a=n==null?void 0:n.method)==null?void 0:a.toLowerCase())=="get"||(r==null?void 0:r.toLowerCase())==="get"?this.GET(s):this.POST(r,s)},this.transponder=(r,s,n="",a)=>{typeof s=="object"&&(s=JSON.stringify(s));let l="GET";if(s&&(l="POST"),n!=="json")return new Promise((c,f)=>{let u=tr.request({method:l,url:r,data:s,responseType:n,onload:h=>{let p=u.response;if(typeof p=="string"){let y=p.substring(0,8);(y.includes("{")||y.includes("["))&&(y.includes("\\")&&(p=p.replace(/\\/g,"")),p[0]==='"'&&(p=p.substring(1,p.length-1)),p=JSON.parse(p))}return typeof(p==null?void 0:p.method)=="string"?c(this.handleMethod(p.route,p.method,p.args)):typeof(p==null?void 0:p.route)=="string"?c(this.handleServiceMessage(p)):typeof(p==null?void 0:p.node)=="string"||p.node instanceof ce?c(this.handleGraphNodeCall(p.node,p.args)):c(p)},onabort:h=>{f(h)}})}).catch(console.error)},this.listen=(r="0",s=async(n,a,l)=>{const c=await n.text(),f=this.receive(c);this.setState({[l.url]:f})})=>{this.listening[r]={};let n=`${r}${Math.floor(Math.random()*1e15)}`;return this.listening[r][n]=s,this.fetchProxied||(globalThis.fetch=new Proxy(globalThis.fetch,{apply(a,l,c){const f=a.apply(l,c);return f.then(u=>{if(u.ok){if(this.listening[0])for(const h in this.listeners){const p=u.clone();this.listening[0][h](p,c,u)}else for(const h in this.listening)if(u.url.includes(h)){for(const p in this.listening[r]){const y=u.clone();this.listening[r][p](y,c,u)}break}}}).catch(u=>{console.error(u)}),f}}),this.fetchProxied=!0),n},this.stopListening=(r,s)=>{if(!r&&r!==0)for(const n in this.listening)delete this.listening[n];else s?delete this.listening[s]:delete this.listening[r]},this.load(this),this.listen(e,i)}},Gc=tr;Gc.request=t=>{const e=new XMLHttpRequest;return t.responseType?e.responseType=t.responseType:t.responseType="json",t.mimeType&&e.overrideMimeType(t.mimeType),t.onload&&e.addEventListener("load",t.onload,!1),t.onprogress&&e.addEventListener("progress",t.onprogress,!1),t.onabort&&e.addEventListener("abort",t.onabort,!1),t.onloadend&&e.addEventListener("loadend",t.onloadend,!1),t.onerror&&e.addEventListener("error",t.onerror,!1),e.open(t.method,t.url,!0,t.user,t.pass),t.onerror||(e.onerror=function(){e.abort()}),e.send(t.data),e};var Tt=Bc(Tc()),Wc=class extends Io{constructor(t){super(),this.name="worker",this.workers={},this.threadRot=0,this.loadWorkerRoute=(e,i)=>{e.workerUrl&&(e.url=e.workerUrl),e.workerId&&(e.__node.tag=e.workerId),e.__node.tag||(e.__node.tag=i),e._id=e.__node.tag;let r;if(this.workers[e._id]?r=this.workers[e._id]:e.worker&&(r=e.worker),r||(r=this.addWorker(e)),e.worker=r,!e.worker.__ondisconnected){let s=n=>{var a;(a=n.worker)==null||a.terminate()};e.__addOndisconnected(s)}if(e.transferFunctions)for(const s in e.transferFunctions)this.transferFunction(r,e.transferFunctions[s],s);if(e.transferClasses)for(const s in e.transferClasses)this.transferClass(r,e.transferClasses[s],s);if(r)return e.__operator||(e.__operator=(...s)=>{var n,a;if(e.callback)if(!((n=this.__node.nodes.get(e.__node.tag))!=null&&n.__children))r.post(e.callback,s);else return r.run(e.callback,s);else if(!((a=this.__node.nodes.get(e.__node.tag))!=null&&a.__children))r.send(s);else return r.request(s)}),e.init&&r.run(e.init,e.initArgs,void 0,e.initTransfer),r},this.workerloader={workers:(e,i,r,s)=>{var a,l,c,f,u,h,p,y,_,m,A,O,E,L,H,K,le,V,G,ye,pe;let n=e;if(!e.parentRoute&&(i!=null&&i.callback)&&(i!=null&&i.worker)&&(e.parentRoute=i==null?void 0:i.callback),n!=null&&n.worker||n!=null&&n.workerId||n!=null&&n.workerUrl){let ee=this.loadWorkerRoute(n,n.__node.tag);ee&&(!n.parentRoute&&((a=n.__parent)!=null&&a.callback)&&(n.parentRoute=n.__parent.callback),n.__parent&&!n.portId&&(typeof n.__parent=="string"?n.__node.tag!==n.__parent&&ee._id!==n.__parent&&(n.portId=this.establishMessageChannel(ee,n.__parent)):n.__node.tag!==((c=(l=n.__parent)==null?void 0:l.__node)==null?void 0:c.tag)&&ee._id!==((f=n.__parent)==null?void 0:f.tag)&&(n.portId=this.establishMessageChannel(ee,n.__parent.worker))),n.parentRoute?(n.stopped||(typeof n.__parent=="string"&&n.__parent===ee._id?ee.run("subscribe",[n.parentRoute,void 0,void 0,n.callback]):n.__node.tag===((h=(u=n.__parent)==null?void 0:u.__node)==null?void 0:h.tag)||ee._id===((y=(p=n.__parent)==null?void 0:p.__node)==null?void 0:y.tag)?ee.run("subscribe",[n.parentRoute,void 0,void 0,n.callback]):ee.run("subscribeToWorker",[n.parentRoute,n.portId,void 0,n.callback,void 0,void 0,n.blocking]).then($=>{ee.workerSubs[n.parentRoute+n.portId].sub=$})),!(typeof n.__parent=="string"&&n.__parent===ee._id)&&!(n.__node.tag===((m=(_=n.__parent)==null?void 0:_.__node)==null?void 0:m.tag)||ee._id===((O=(A=n.__parent)==null?void 0:A.__node)==null?void 0:O.tag))&&(ee.workerSubs[n.parentRoute+n.portId]={sub:null,route:n.parentRoute,portId:n.portId,callback:n.callback,blocking:n.blocking})):n.__parent&&(typeof n.__parent=="string"?(n.stopped||(n.__parent===ee._id?ee.run("subscribe",[n.__parent,void 0,n.callback]):ee.run("subscribeToWorker",[n.__parent,n.portId,void 0,n.callback,void 0,void 0,n.blocking]).then($=>{ee.workerSubs[n.__parent+n.portId].sub=$})),typeof n.__parent=="string"&&n.__parent===ee._id||(ee.workerSubs[n.__parent+n.portId]={sub:null,route:ee._id,portId:n.portId,callback:n.callback,blocking:n.blocking})):(L=(E=n.__parent)==null?void 0:E.__node)!=null&&L.tag&&((H=n.__parent)!=null&&H.worker)&&(n.stopped||(n.__node.tag===n.__parent.__node.tag||ee._id===n.__parent.__node.tag?ee.run("subscribe",[n.__parent.__node.tag,void 0,void 0,n.callback]):ee.run("subscribeToWorker",[n.__parent.__node.tag,n.portId,void 0,n.callback,void 0,void 0,n.blocking]).then($=>{ee.workerSubs[n.__parent.__node.tag+n.portId].sub=$})),n.__node.tag===((le=(K=n.__parent)==null?void 0:K.__node)==null?void 0:le.tag)||ee._id===((G=(V=n.__parent)==null?void 0:V.__node)==null?void 0:G.tag)||(ee.workerSubs[n.__parent.__node.tag+n.portId]={sub:null,route:n.__parent.__node.tag,portId:n.portId,callback:n.callback,blocking:n.blocking}))))}else n.__parent&&n.parentRoute&&(typeof n.__parent=="string"&&((ye=s[n.__parent])!=null&&ye.worker)?s[n.__parent].worker.subscribe(n.parentRoute,n.__operator,void 0,void 0,void 0,n.blocking):(pe=n.__parent)!=null&&pe.worker&&n.__parent.worker.subscribe(n.parentRoute,n.__operator,void 0,void 0,void 0,n.blocking));return n}},this.addDefaultMessageListener=()=>{globalThis.onmessage=e=>{let i=this.receive(e.data);this.__node.keepState&&this.setState({[this.name]:i})}},this.postMessage=(e,i,r)=>{this.workers[i]?this.workers[i].send(e,r):globalThis.postMessage(e,i,r)},this.addWorker=e=>{let i;if(e._id||(e._id=`worker${Math.floor(Math.random()*1e15)}`),e.url?i=new Tt.default(e.url):e.port?i=e.port:this.workers[e._id]&&(this.workers[e._id].port?i=this.workers[e._id].port:i=this.workers[e._id].worker),!i)return;let r=(y,_)=>this.transmit(y,i,_),s=(y,_,m,A)=>{let O={route:y,args:_};return m&&(O.method=m),this.transmit(O,i,A)},n=(y,_,m,A)=>new Promise((O,E)=>{let L=Math.random(),H={route:"runRequest",args:[{route:y,args:_},e._id,L]};m&&(H.args[0].method=m);let K=le=>{typeof le.data=="object"&&le.data.callbackId===L&&(i.removeEventListener("message",K),O(le.data.args))};i.addEventListener("message",K),this.transmit(H,i,A)}),a=(y,_,m)=>new Promise((A,O)=>{let E=Math.random(),L={route:"runRequest",args:[y,e._id,E]};_&&(L.method=_);let H=K=>{typeof K.data=="object"&&K.data.callbackId===E&&(i.removeEventListener("message",H),A(K.data.args))};i.addEventListener("message",H),this.transmit(L,i,m)}),l={},c=(y,_,m,A,O,E)=>this.subscribeToWorker(y,e._id,_,m,A,O,E),f=(y,_)=>n("unsubscribe",[y,_]),u=async(y,_,m,A)=>{if(y)await n("subscribeToWorker",[y,_,void 0,m,A]).then(O=>{O&&(l[y+_]={sub:O,route:y,portId:_,callback:m,blocking:A})});else for(const O in l)typeof l[O].sub!="number"&&await n("subscribeToWorker",[l[O].route,l[O].portId,void 0,l[O].callback,void 0,l[O].blocking]).then(E=>{l[O].sub=E}),console.log(JSON.stringify(l));return!0},h=async(y,_)=>{if(y&&_&&l[y+_])await n("unsubscribe",[y,l[y+_].sub]),l[y+_].sub=!1;else for(const m in l)typeof l[m].sub=="number"&&await n("unpipeWorkers",[l[m].route,l[m].portId,l[m].sub]).then(console.log),l[m].sub=!1;return!0},p=()=>{for(const y in l)typeof l[y].sub=="number"&&n("unpipeWorkers",[l[y].route,l[y].portId,l[y].sub]),l[y].sub=!1;return this.terminate(e._id)};return e.onmessage||(e.onmessage=y=>{this.receive(y.data),this.setState({[e._id]:y.data})}),e.onerror||(e.onerror=y=>{console.error(y.data)}),i.onmessage=e.onmessage,i.onerror=e.onerror,this.workers[e._id]={worker:i,send:r,post:s,run:n,request:a,subscribe:c,unsubscribe:f,terminate:p,start:u,stop:h,postMessage:i.postMessage,workerSubs:l,graph:this,...e},this.workers[e._id]},this.open=this.addWorker,this.toObjectURL=e=>{let i=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(i)},this.transmit=(e,i,r)=>{if(r||(r=this.getTransferable(e)),i instanceof Tt.default||i instanceof MessagePort)i.postMessage(e,r);else if(typeof i=="string")this.workers[i]&&(this.workers[i].port?this.workers[i].port.postMessage(e,r):this.workers[i].worker&&this.workers[i].worker.postMessage(e,r));else{let s=Object.keys(this.workers);this.workers[s[this.threadRot]].worker.postMessage(e,r),this.threadRot++,this.threadRot===s.length&&(this.threadRot=0)}return e},this.terminate=e=>{let i;if(typeof e=="string"){let r=this.workers[e];r&&(delete this.workers[e],e=r.worker,r.onclose&&(i=r.onclose))}else typeof e=="object"&&e!=null&&e._id&&(e=e.worker,delete this.workers[e==null?void 0:e._id]);return e instanceof Tt.default?(e.terminate(),i&&i(e),!0):e instanceof MessagePort?(e.close(),i&&i(e),!0):!1},this.establishMessageChannel=(e,i)=>{let r;if(typeof e=="string"?(r=e,this.workers[e]&&(this.workers[e].port?e=this.workers[e].port:i=this.workers[e].worker)):e!=null&&e.worker&&(e=e.worker),typeof i=="string"?this.workers[i]&&(this.workers[i].port?i=this.workers[i].port:i=this.workers[i].worker):i!=null&&i.worker&&(i=i.worker),e instanceof Tt.default||e instanceof MessagePort){let s=new MessageChannel,n=`port${Math.floor(Math.random()*1e15)}`;return e.postMessage({route:"addWorker",args:{port:s.port1,_id:n}},[s.port1]),i instanceof Tt.default||i instanceof MessagePort?i.postMessage({route:"addWorker",args:{port:s.port2,_id:n}},[s.port2]):r&&this.workers[r]&&(s.port2.onmessage=this.workers[r].onmessage,this.workers[r].port=s.port2),n}return!1},this.request=(e,i,r,s)=>{let n=this.workers[i].worker;return new Promise((a,l)=>{let c=Math.random(),f={route:"runRequest",args:[e,c]};s&&(f.method=s);let u=h=>{typeof h.data=="object"&&h.data.callbackId===c&&(n.removeEventListener("message",u),a(h.data.args))};n.addEventListener("message",u),this.transmit(f,n,r)})},this.runRequest=(e,i,r)=>{let s=this.receive(e);return typeof i=="string"&&this.workers[i]&&(this.workers[i].port?i=this.workers[i].port:i=this.workers[i].worker),s instanceof Promise?s.then(n=>{i instanceof Tt.default||i instanceof MessagePort?i.postMessage({args:n,callbackId:r}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:n,callbackId:r})}):i instanceof Tt.default||i instanceof MessagePort?i.postMessage({args:s,callbackId:r}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:s,callbackId:r}),s},this.subscribeWorker=(e,i,r,s,n,a)=>{let l;if(a){let c=!1;l=f=>{c||(c=!0,f instanceof Promise?f.then(u=>{i!=null&&i.run&&i.run("triggerSubscription",[e,i._id,u]).then(h=>{c=!1})}):i!=null&&i.run&&i.run("triggerSubscription",[e,i._id,f]).then(u=>{c=!1}))}}else l=c=>{c instanceof Promise?c.then(f=>{i!=null&&i.postMessage?i.postMessage({args:f,callbackId:e}):globalThis.postMessage&&globalThis.postMessage({args:f,callbackId:e})}):i!=null&&i.postMessage?i.postMessage({args:c,callbackId:e}):globalThis.postMessage&&globalThis.postMessage({args:c,callbackId:e})};return!a&&(i!=null&&i.port)?i=i.port:!a&&(i!=null&&i.worker)?i=i.worker:typeof i=="string"&&this.workers[i]&&(a?i=this.workers[i]:this.workers[i].port?i=this.workers[i].port:i=this.workers[i].worker),this.subscribe(e,l,r,s,n)},this.subscribeToWorker=(e,i,r,s,n,a,l)=>{if(typeof i=="string"&&this.workers[i])return this.__node.state.subscribeEvent(i,c=>{(c==null?void 0:c.callbackId)===e&&(r?typeof r=="string"?this.run(r,c.args):r(c.args):this.setState({[i]:c.args}))}),this.workers[i].run("subscribeWorker",[e,i,s,n,a,l])},this.triggerSubscription=async(e,i,r)=>{if(this.__node.state.triggers[i])for(let s=0;s<this.__node.state.triggers[i].length;s++)await this.__node.state.triggers[i][s].onchange({args:r,callbackId:e});return!0},this.pipeWorkers=(e,i,r,s,n,a,l,c,f)=>(typeof e=="string"&&(e=this.workers[e]),typeof i=="string"&&(i=this.workers[i]),n||(n=this.establishMessageChannel(e.worker,i.worker)),i.run("subscribeToWorker",[r,n,s,a,l,c,f])),this.unpipeWorkers=(e,i,r)=>{if(typeof i=="string"&&(i=this.workers[i]),typeof i=="object")return i.run("unsubscribe",[e,r])},this.connections={workers:this.workers},t!=null&&t.services&&this.addServices(t.services),this.load(this),this.setLoaders(this.workerloader),t&&this.init(t),typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope&&this.addDefaultMessageListener()}getTransferable(t){var i,r,s,n,a,l,c,f,u,h;let e;if(typeof t=="object")if(t.args)if(((r=(i=t.args)==null?void 0:i.constructor)==null?void 0:r.name)==="Object")for(const p in t.args)ArrayBuffer.isView(t.args[p])?e?e.push(t.args[p].buffer):e=[t.args[p].buffer]:((n=(s=t.args[p])==null?void 0:s.constructor)==null?void 0:n.name)==="ArrayBuffer"&&(e?e.push(t.args[p]):e=[t.args[p]]);else Array.isArray(t.args)&&t.args.length<11?t.args.forEach(p=>{var y;ArrayBuffer.isView(p)?e=[p.buffer]:((y=p==null?void 0:p.constructor)==null?void 0:y.name)==="ArrayBuffer"&&(e=[p])}):ArrayBuffer.isView(t.args)?e=[t.args.buffer]:((l=(a=t.args)==null?void 0:a.constructor)==null?void 0:l.name)==="ArrayBuffer"&&(e=[t]);else if(((c=t==null?void 0:t.constructor)==null?void 0:c.name)==="Object")for(const p in t)ArrayBuffer.isView(t[p])?e?e.push(t[p].buffer):e=[t[p].buffer]:((u=(f=t[p])==null?void 0:f.constructor)==null?void 0:u.name)==="ArrayBuffer"&&(e?e.push(t[p]):e=[t[p]]);else Array.isArray(t)&&t.length<11?t.forEach(p=>{var y;ArrayBuffer.isView(p)?e=[p.buffer]:((y=p.constructor)==null?void 0:y.name)==="ArrayBuffer"&&(e=[p])}):ArrayBuffer.isView(t)?e=[t.buffer]:((h=t.constructor)==null?void 0:h.name)==="ArrayBuffer"&&(e=[t]);return e}},rt=$s(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","timeStamp"]),Yc=$s(["deltaX","deltaY"]),Xc=$s(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function so(t,e){const i={type:t.type};i.isTrusted=t.isTrusted,i.bubbles=t.bubbles,i.cancelBubble=t.cancelBubble,i.cancelable=t.cancelable,i.composed=t.composed,i.defaultPrevent=t.defaultPrevented,i.eventPhase=t.eventPhase,i.returnValue=t.returnValue,i.currentTarget=t.currentTarget.id?t.currentTarget.id:t.currentTarget.constructor.name,i.target=i.currentTarget,i.srcElement=i.currentTarget,e(i)}function Kc(t,e){t.preventDefault(),Yc(t,e)}function Zc(t){t.preventDefault()}function Qc(t,e,i){for(const r of e)i[r]=t[r]}function $s(t){return function(i,r){const s={type:i.type};Qc(i,t,s),r(s)}}function os(t,e){const i=[],r={type:t.type,touches:i};for(let s=0;s<t.touches.length;++s){const n=t.touches[s];i.push({pageX:n.pageX,pageY:n.pageY})}e(r)}var as=1,Mo={};for(;as<222;)Mo[as]=!0,as++;function no(t,e){let{keyCode:i}=t;Mo[i]&&(t.preventDefault&&(i<110||i>123)&&t.preventDefault(),Xc(t,e))}var mi={contextmenu:Zc,mousedown:rt,mousemove:rt,mouseup:rt,pointerdown:rt,pointermove:rt,pointerup:rt,pointerlockchange:rt,webkitpointerlockchange:rt,focus:so,blur:so,pointerout:rt,touchstart:os,touchmove:os,touchend:os,wheel:Kc,keydown:no,keyup:no};function zs(t,e,i){i||(i="proxy"+Math.floor(Math.random()*1e15));const r=a=>{e?e.postMessage({route:"handleProxyEvent",args:[a,i]}):Do(a,i)};let s=Object.entries(mi);for(const[a,l]of s)t.addEventListener(a,function(c){l(c,r)});mi.keydown&&globalThis.addEventListener("keydown",function(a){mi.keydown(a,r)}),mi.keyup&&globalThis.addEventListener("keyup",function(a){mi.keyup(a,r)});const n=()=>{const a=t.getBoundingClientRect();r({type:"resize",left:a.left,top:a.top,width:t.clientWidth,height:t.clientHeight})};return n(),globalThis.addEventListener("resize",n),i}var eh=class{addEventListener(e,i){this.__listeners===void 0&&(this.__listeners={});const r=this.__listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this.__listeners===void 0)return!1;const r=this.__listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this.__listeners===void 0)return;const s=this.__listeners[e];if(s!==void 0){const n=s.indexOf(i);n!==-1&&s.splice(n,1)}}dispatchEvent(e,i){if(this.__listeners===void 0)return;const s=this.__listeners[e.type];if(s!==void 0){i?e.target=i:e.target=this;const n=s.slice(0);for(let a=0,l=n.length;a<l;a++)n[a].call(this,e)}}};function oo(){}var th=class extends eh{constructor(){super(),this.__listeners={},this.style={},this.setPointerCapture=()=>{},this.releasePointerCapture=()=>{},this.getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}),this.handleEvent=e=>{e.type==="resize"&&(this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),e.preventDefault=oo,e.stopPropagation=oo,this.dispatchEvent(e,this.proxied)},this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}},ur=class{constructor(){this.targets={},this.makeProxy=(e,i=void 0)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let r;this.targets[e]?r=this.targets[e]:(r=new th,this.targets[e]=r),typeof i=="object"&&(i.proxy=r,r.proxied=i,typeof WorkerGlobalScope<"u"&&(i.style=r.style),r.width&&(i.style.width=r.width+"px",i.clientWidth=r.width),r.height&&(i.style.height=r.height+"px",i.clientHeight=r.height),i.setPointerCapture=r.setPointerCapture.bind(r),i.releasePointerCapture=r.releasePointerCapture.bind(r),i.getBoundingClientRect=r.getBoundingClientRect.bind(r),i.addEventListener=r.addEventListener.bind(r),i.removeEventListener=r.removeEventListener.bind(r),i.handleEvent=r.handleEvent.bind(r),i.dispatchEvent=r.dispatchEvent.bind(r),i.focus=r.focus.bind(r),i.blur=r.blur.bind(r))},this.getProxy=e=>this.targets[e],this.handleEvent=(e,i)=>{if(this.targets[i]||this.makeProxy(i),this.targets[i])return this.targets[i].handleEvent(e),!0},globalThis.document||(globalThis.document={elementFromPoint:(...e)=>this.targets[Object.keys(this.targets)[0]].proxied})}};function ih(t,e){var i;return(i=this==null?void 0:this.__node)!=null&&i.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new ur),this.__node.graph.ProxyManager.makeProxy(t,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new ur),globalThis.ProxyManager.makeProxy(t,e)),t}function Do(t,e){var i;if((i=this==null?void 0:this.__node)!=null&&i.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new ur),this.__node.graph.ProxyManager.handleEvent(t,e))return t}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new ur),globalThis.ProxyManager.handleEvent(t,e))return t}var qs={initProxyElement:zs,makeProxy:ih,handleProxyEvent:Do};function rh(t){if(t.worker){let e=t.worker,i=t.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete t.worker,delete t.route,Ro(e,t,i)}else return zs(t.canvas,void 0,t._id),Fo(t)}function Ro(t,e,i){var l;if(console.log(e),!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let r=e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let s={route:i||"setupCanvas",args:{...e,canvas:r}};(l=this==null?void 0:this.__node)!=null&&l.graph?this.__node.graph.run("initProxyElement",e.canvas,t,e._id):zs(e.canvas,t,e._id),e.draw&&(typeof e.draw=="function"?s.args.draw=e.draw.toString():s.args.draw=e.draw),e.update&&(typeof e.update=="function"?s.args.update=e.update.toString():s.args.update=e.update),e.init&&(typeof e.init=="function"?s.args.init=e.init.toString():s.args.init=e.init),e.clear&&(typeof e.clear=="function"?s.args.clear=e.clear.toString():s.args.clear=e.clear);let n=[r];return e.transfer&&(n.push(...e.transfer),delete e.transfer),t.postMessage(s,n),{_id:e._id,width:e.width,height:e.height,worker:t,draw:(c,f)=>{t.postMessage({route:"drawFrame",args:[c,e._id]},f)},update:(c,f)=>{t.postMessage({route:"updateCanvas",args:[c,e._id]},f)},clear:()=>{t.postMessage({route:"clearCanvas",args:e._id})},init:()=>{t.postMessage({route:"initCanvas",args:e._id})},stop:()=>{t.postMessage({route:"stopAnim",args:e._id})},start:()=>{t.postMessage({route:"startAnim",args:e._id})},set:(c,f)=>{t.postMessage({route:"setDraw",args:[c,e._id]},f)},terminate:()=>{t.terminate()}}}function ir(t,e){var r,s,n,a,l,c,f,u;let i;if((r=this==null?void 0:this.__node)!=null&&r.graph?e?i=(s=this.__node.graph.CANVASES)==null?void 0:s[t._id]:t._id?i=(n=this.__node.graph.CANVASES)==null?void 0:n[t._id]:i=(a=this.__node.graph.CANVASES)==null?void 0:a[Object.keys(this.__node.graph.CANVASES)[0]]:e?i=(l=globalThis.CANVASES)==null?void 0:l[t._id]:t._id?i=(c=globalThis.CANVASES)==null?void 0:c[t._id]:i=(f=globalThis.CANVASES)==null?void 0:f[Object.keys(globalThis.CANVASES)[0]],i)return t.canvas&&(i.canvas=t.canvas,(u=this==null?void 0:this.__node)!=null&&u.graph?this.__node.graph.run("makeProxy",i._id,i.canvas):qs.makeProxy(i._id,i.canvas)),typeof t.context=="string"?i.context=i.canvas.getContext(t.context):t.context&&(i.context=t.context),t.width&&(i.canvas.width=t.width),t.height&&(i.canvas.height=t.height),typeof t.draw=="string"&&(t.draw=ot(t.draw)),typeof t.draw=="function"&&(i.draw=t.draw.bind(t)),typeof t.update=="string"&&(t.update=ot(t.update)),typeof t.update=="function"&&(i.update=t.update.bind(t)),typeof t.init=="string"&&(t.init=ot(t.init)),typeof t.init=="function"&&(i.init=t.init.bind(t)),typeof t.clear=="string"&&(t.clear=ot(t.clear)),typeof t.clear=="function"&&(i.clear=t.clear.bind(t)),t._id}function Fo(t){var i,r,s,n,a,l,c;(i=this==null?void 0:this.__node)!=null&&i.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=t;if(t._id?e._id=t._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof t.context=="string"?e.context=t.canvas.getContext(t.context):e.context=t.context,"animating"in t?e.animating=t.animating:e.animating=!0,(s=(r=this==null?void 0:this.__node)==null?void 0:r.graph)!=null&&s.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if((n=globalThis.CANVASES)!=null&&n[e._id])ir(e);else if((a=this==null?void 0:this.__node)!=null&&a.graph&&(e.graph=this.__node.graph,e.__node||(e.__node={}),e.__node.tag||(e.__node.tag=e._id),e=this.__node.graph.add(e),e.__addOndisconnected=()=>{e.stop(),delete this.__node.graph.CANVASES[e._id]}),(l=this==null?void 0:this.__node)!=null&&l.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,(c=this==null?void 0:this.__node)!=null&&c.graph?this.__node.graph.run("makeProxy",e._id,e.canvas):qs.makeProxy(e._id,e.canvas),t.width&&(e.canvas.width=t.width),t.height&&(e.canvas.height=t.height),typeof e.draw=="string"?e.draw=ot(e.draw):typeof e.draw=="function"&&(e.draw=e.draw.bind(e)),typeof e.update=="string"?e.update=ot(e.update):typeof e.update=="function"&&(e.update=e.update.bind(e)),typeof e.init=="string"?e.init=ot(e.init):typeof e.init=="function"&&(e.init=e.init.bind(e)),typeof e.clear=="string"?e.clear=ot(e.clear):typeof e.clear=="function"&&(e.clear=e.clear.bind(e)),typeof e.init=="function"&&e.init(e,e.canvas,e.context),e.stop=()=>{rr(e._id)},e.start=f=>{Es(e._id,f)},e.set=f=>{ir(f,e._id)},typeof e.draw=="function"&&e.animating){let f=(u,h,p)=>{u.animating&&(u.draw(u,h,p),requestAnimationFrame(()=>{f(u,h,p)}))};f(e,e.canvas,e.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?e._id:{_id:t._id,width:t.width,height:t.height,draw:u=>{Uo(u,t._id)},update:u=>{zo(u,t._id)},clear:()=>{Jo(t._id)},init:()=>{$o(t._id)},stop:()=>{rr(t._id)},start:()=>{Es(t._id)},set:u=>{ir(u,t._id)},terminate:()=>{var u,h;(u=this.__node)!=null&&u.graph?this.__node.graph.remove(t._id):(rr(t._id),(h=this==null?void 0:this.__node)!=null&&h.graph?delete this.__node.graph.CANVASES[e._id]:delete globalThis.CANVASES[e._id])}}}function Uo(t,e){let i=St.call(this,e);if(i&&(t&&Object.assign(i,t),i.draw))return i.draw(i,i.canvas,i.context),e}function Jo(t){let e=St.call(this,t);if(e!=null&&e.clear)return e.clear(e,e.canvas,e.context),t}function $o(t){let e=St.call(this,t);if(e!=null&&e.init)return e.init(e,e.canvas,e.context),t}function zo(t,e){let i=St.call(this,e);if(i!=null&&i.update)return i.update(i,i.canvas,i.context,t),e}function sh(t,e){let i=St.call(this,e);if(i)return Object.assign(i,t),t.width&&(i.canvas.width=t.width),t.height&&(i.canvas.height=t.height),e}function Es(t,e){let i=St.call(this,t);if(i.animating=!0,i&&e)return typeof e=="string"&&(e=ot(e)),typeof e=="function"&&(i.draw=e),t;if(typeof(i==null?void 0:i.draw)=="function"){let r=(s,n,a)=>{s.animating&&(s.draw(s,n,a),requestAnimationFrame(()=>{r(s,n,a)}))};return typeof i.clear=="function"&&i.clear(i,i.canvas,i.context),typeof i.init=="function"&&i.init(i,i.canvas,i.context),r(i,i.canvas,i.context),t}}function rr(t){let e=St.call(this,t);if(e)return e.animating=!1,typeof e.clear=="function"&&requestAnimationFrame(e.clear(e,e.canvas,e.context)),t}function St(t){var i,r,s,n,a;let e;return(i=this==null?void 0:this.__node)!=null&&i.graph?t?e=(s=this.__node.graph.CANVASES)==null?void 0:s[t]:e=(r=this.__node.graph.CANVASES)==null?void 0:r[Object.keys(this.__node.graph.CANVASES)[0]]:t?e=(a=globalThis.CANVASES)==null?void 0:a[t]:e=(n=globalThis.CANVASES)==null?void 0:n[Object.keys(globalThis.CANVASES)[0]],e}var nh={...qs,Renderer:rh,transferCanvas:Ro,setupCanvas:Fo,setDraw:ir,drawFrame:Uo,clearCanvas:Jo,initCanvas:$o,updateCanvas:zo,setProps:sh,startAnim:Es,stopAnim:rr,getCanvas:St};function ot(t=""){let e=a=>a.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),r=(a=>{let l=a.indexOf("=>")+1;return l<=0&&(l=a.indexOf("){")),l<=0&&(l=a.indexOf(") {")),a.slice(0,a.indexOf("{",l)+1)})(t),s=e(t),n;if(r.includes("function")){let a=r.split("(")[1].split(")")[0];n=new Function(a,s)}else if(r.substring(0,6)===s.substring(0,6)){let a=r.split("(")[1].split(")")[0];n=new Function(a,s.substring(s.indexOf("{")+1,s.length-1))}else try{n=(0,eval)(r+s+"}")}catch{}return n}var oh=URL.createObjectURL(new Blob(['(()=>{var __require=(x=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof require!=="undefined"?require:a)[b]}):x)(function(x){if(typeof require!=="undefined")return require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x+\'" is not supported\')});var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __require2=(x=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x)(function(x){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x+\'" is not supported\')});var __commonJS=(cb,mod)=>function __require22(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var require_browser=__commonJS({"node_modules/web-worker/cjs/browser.js"(exports,module2){module2.exports=Worker}});var EventHandler=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.setState=updateObj=>{Object.assign(this.data,updateObj);let props=Object.getOwnPropertyNames(updateObj);for(const prop of props){this.triggerEvent(prop,this.data[prop])}return this.data};this.setValue=(key,value)=>{this.data[key]=value;this.triggerEvent(key,value)};this.triggerEvent=(key,value)=>{if(this.triggers[key]){let fn=obj=>obj.onchange(value);this.triggers[key].forEach(fn)}};this.subscribeEvent=(key,onchange,refObject,refKey)=>{if(key){if(refObject&&refKey&&!this.triggers[key]){Object.defineProperty(this.data,key,{get:()=>{return refObject[refKey]},set:value=>{refObject[refKey]=value},enumerable:true,configurable:true})}if(!this.triggers[key]){this.triggers[key]=[]}let l=this.triggers[key].length;this.triggers[key].push({sub:l,onchange});return this.triggers[key].length-1}else return void 0};this.unsubscribeEvent=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(!sub){delete this.triggers[key];delete this.data[key]}else{let sub2=void 0;let obj=triggers.find((o,i2)=>{if(o.sub===sub2){sub2=i2;return true}});if(obj)triggers.splice(sub2,1);if(Object.keys(triggers).length===0){delete this.triggers[key];delete this.data[key]}if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeEventOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeEvent(key,sub)};sub=this.subscribeEvent(key,changed)};this.getEvent=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};this.getSnapshot=()=>{const snapshot={};for(const key in this.data){snapshot[key]=this.data[key]}};if(typeof data==="object")this.data=data}};var state=new EventHandler;var GraphNode=class{constructor(properties,parent,graph){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state};this.__setProperties=(properties2,parent2,graph2)=>{let enforceProperties=()=>{let orig=properties2;if(typeof properties2==="function"){if(isNativeClass(properties2)){properties2=new properties2}else properties2={__operator:properties2,__node:{forward:true,tag:properties2.name}}}else if(typeof properties2==="string"){if(graph2?.get(properties2)){properties2=graph2.get(properties2)}}if(!properties2.__node.initial)properties2.__node.initial=orig};enforceProperties();if(typeof properties2==="object"){let assignState=()=>{if(properties2.__node?.state)this.__node.state=properties2.__node.state};let setProps2=()=>{if(properties2.__props){if(typeof properties2.__props==="function")properties2.__props=new properties2.__props;if(typeof properties2.__props==="object"){this.__proxyObject(properties2.__props)}}};let setTag=()=>{if(!properties2.__node.tag){if(properties2.__operator?.name)properties2.__node.tag=properties2.__operator.name;else properties2.__node.tag=`node${Math.floor(Math.random()*1e15)}`}};let setNode=()=>{if(typeof properties2.__node==="string"){if(graph2?.get(properties2.__node.tag)){properties2=graph2.get(properties2.__node.tag)}else properties2.__node={}}else if(!properties2.__node)properties2.__node={};if(graph2){properties2.__node.graph=graph2}if(properties2 instanceof Graph)properties2.__node.source=properties2};let setParent=()=>{if(!properties2.__parent&&parent2)properties2.__parent=parent2;if(parent2?.__node&&!(parent2 instanceof Graph||properties2 instanceof Graph))properties2.__node.tag=parent2.__node.tag+"."+properties2.__node.tag;if(parent2 instanceof Graph&&properties2 instanceof Graph){if(properties2.__node.loaders)Object.assign(parent2.__node.loaders?parent2.__node.loaders:{},properties2.__node.loaders);if(parent2.__node.mapGraphs){properties2.__node.nodes.forEach(n=>{parent2.set(properties2.__node.tag+"."+n.__node.tag,n)});let ondelete=()=>{properties2.__node.nodes.forEach(n=>{parent2.__node.nodes.delete(properties2.__node.tag+"."+n.__node.tag)})};this.__addOndisconnected(ondelete)}}};let setOp=()=>{if(typeof properties2.default==="function"&&!properties2.__operator){properties2.__operator=properties2.default}if(properties2.__operator){if(typeof properties2.__operator==="string"){if(graph2){let n=graph2.get(properties2.__operator);if(n)properties2.__operator=n.__operator;if(!properties2.__node.tag&&properties2.__operator.name)properties2.__node.tag=properties2.__operator.name}}if(typeof properties2.__operator==="function")properties2.__operator=this.__setOperator(properties2.__operator);if(properties2.default)properties2.default=properties2.__operator}};let assignProps=()=>{properties2.__node=Object.assign(this.__node,properties2.__node);let keys2=Object.getOwnPropertyNames(properties2);for(const key of keys2){this[key]=properties2[key]}};let bindCallbacks=()=>{if(this.__onconnected){if(typeof this.__onconnected==="function"){this.__onconnected=this.__onconnected.bind(this)}else if(Array.isArray(this.__onconnected)){this.__onconnected=this.__onconnected.map(f=>{return f.bind(this)})}if(typeof this.__ondisconnected==="function"){this.__ondisconnected=this.__ondisconnected.bind(this)}else if(Array.isArray(this.__ondisconnected)){this.__ondisconnected=this.__ondisconnected.map(f=>{return f.bind(this)})}}};assignState();setTag();setProps2();setNode();setParent();assignProps();bindCallbacks();setOp()}};this.__subscribe=(callback,key,subInput,bound,target)=>{const subscribeToFunction=(k,setTarget=(callback2,target2)=>callback2,triggerCallback=callback)=>{let sub=this.__node.state.subscribeEvent(k,triggerCallback,this,key);let trigger=this.__node.state.getEvent(k,sub);trigger.source=this.__node.tag;if(key)trigger.key=key;trigger.target=setTarget(callback);if(bound)trigger.bound=bound;return sub};const subscribeToGraph=callback2=>{let fn=this.__node.graph.get(callback2);if(!fn&&callback2.includes(".")){let n=this.__node.graph.get(callback2.substring(0,callback2.lastIndexOf(".")));let key2=callback2.substring(callback2.lastIndexOf(".")+1);if(n&&typeof n[key2]==="function")callback2=(...args)=>{return n[key2](...args)}}};if(key){if(!this.__node.localState||!this.__node.localState[key]){this.__addLocalState(this,key)}if(typeof callback==="string"){if(target){if(this.__node.graph?.get(target)){let n=this.__node.graph?.get(target);if(typeof n[callback]==="function"){let fn=n[callback];callback=(...inp)=>{fn(...inp)}}else{let k2=callback;let setter=inp=>{n[k2]=inp};callback=setter}}}else if(typeof this[callback]==="function"){let fn=this[callback];callback=(...inp)=>{fn(...inp)}}else if(this.__node.graph?.get(callback))subscribeToGraph(callback);if(typeof callback!=="function")return void 0}let sub;let k=subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key;if(typeof callback==="function")sub=subscribeToFunction(k);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}else{if(typeof callback==="string"){if(this.__node.graph.get(callback))callback=this.__node.graph.get(callback);if(typeof callback!=="object")return void 0}let sub;let k=subInput?this.__node.unique+"input":this.__node.unique;if(typeof callback==="function")sub=subscribeToFunction(k);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}};this.__unsubscribe=(sub,key,unsubInput)=>{if(key)return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key,sub);else return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"input":this.__node.unique,sub)};this.__setOperator=fn=>{fn=fn.bind(this);if(this.__args&&this.__node.graph){fn=wrapArgs(fn,this.__args,this.__node.graph)}let inpstr=`${this.__node.unique}input`;this.__operator=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[this.__node.unique]){if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result)}return result};if(this.__parent instanceof GraphNode&&!this.__subscribedToParent){if(this.__parent.__operator){let sub=this.__parent.__subscribe(this);let ondelete=()=>{this.__parent?.__unsubscribe(sub);delete this.__subscribedToParent};this.__addOndisconnected(ondelete);this.__subscribedToParent=true}}return this.__operator};this.__addLocalState=(props,key)=>{if(!props)return;if(!this.__node.localState){this.__node.localState={}}const localState=this.__node.localState;const initState=(props2,k)=>{let str2=this.__node.unique+"."+k;let inpstr=`${str2}input`;if(typeof props2[k]==="function"&&k!=="__operator"){let fn=props2[k].bind(this);props2[k]=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[str2]){if(typeof result?.then==="function"){result.then(res=>{this.__node.state.triggerEvent(str2,res)}).catch(console.error)}else this.__node.state.triggerEvent(str2,result)}return result}}else{let get,set;if(this.__props?.[k]){get=()=>{return this.__props[k]};set=v=>{this.__props[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}else{localState[k]=props2[k];get=()=>{return localState[k]};set=v=>{localState[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}const descriptor={get,set,enumerable:true,configurable:true};Object.defineProperty(props2,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}};if(key)initState(props,key);else{for(let k in props){initState(props,k)}}};this.__proxyObject=obj=>{const allProps=getAllProperties(obj);for(const k of allProps){if(typeof obj[k]==="function"){this[k]=(...args)=>{return obj[k](...args)}}else{const descriptor={get:()=>{return obj[k]},set:value=>{obj[k]=value},enumerable:true,configurable:true};Object.defineProperty(this,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}}};this.__setProperties(properties,parent,graph)}__addOnconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__onconnected)){this.__onconnected.push(callback)}else if(typeof this.__onconnected==="function"){this.__onconnected=[callback,this.__onconnected]}else this.__onconnected=callback}__addOndisconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.push(callback)}else if(typeof this.__ondisconnected==="function"){this.__ondisconnected=[callback,this.__ondisconnected]}else this.__ondisconnected=callback}__callConnected(node=this){if(typeof this.__onconnected==="function"){this.__onconnected(this)}else if(Array.isArray(this.__onconnected)){let fn=o=>{o(this)};this.__onconnected.forEach(fn)}}__callDisconnected(node=this){if(typeof this.__ondisconnected==="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let fn=o=>{o(this)};this.__ondisconnected.forEach(fn)}}};var Graph=class{constructor(options){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state,roots:{}};this.init=options2=>{if(options2){let cpy=Object.assign({},options2);delete cpy.roots;recursivelyAssign(this.__node,cpy);if(options2.roots)this.load(options2.roots)}};this.load=roots=>{function recursivelyAssignChildren(target,obj,inChildren=true,top=true){if(top){if(target)Object.assign(target,obj);else target=Object.assign({},obj);recursivelyAssignChildren(target,obj,true,false)}if(obj.__children&&!inChildren){if(obj.__children?.constructor.name==="Object"){if(target.__children?.constructor.name==="Object")recursivelyAssignChildren(target.__children,obj.__children,true,false);else target.__children=recursivelyAssignChildren({},obj.__children,true,false)}else{target.__children=obj.__children}}else if(inChildren){for(const key in obj){target[key]=Object.assign({},obj[key]);if(obj[key].__children){recursivelyAssignChildren({},obj[key].__children,false,false)}}}return target}this.__node.roots=recursivelyAssignChildren(this.__node.roots?this.__node.roots:{},roots);let cpy=Object.assign({},roots);if(cpy.__node)delete cpy.__node;let listeners=this.recursiveSet(cpy,this,void 0,roots);if(roots.__node){if(!roots.__node.tag)roots.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(roots.__node.tag)){let node=new GraphNode(roots,this,this);this.set(node.__node.tag,node);this.runLoaders(node,this,roots,roots.__node.tag);if(node.__listeners){listeners[node.__node.tag]=node.__listeners}}}else if(roots.__listeners){this.setListeners(roots.__listeners)}this.setListeners(listeners);return cpy};this.setLoaders=(loaders2,replace)=>{if(replace)this.__node.loaders=loaders2;else Object.assign(this.__node.loaders,loaders2);return this.__node.loaders};this.runLoaders=(node,parent,properties,key)=>{for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders[l]==="function")this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key)}};this.add=(properties,parent)=>{let listeners={};if(typeof parent==="string")parent=this.get(parent);let instanced;if(typeof properties==="function"){if(isNativeClass(properties)){if(properties.prototype instanceof GraphNode){properties=properties.prototype.constructor(properties,parent,this);instanced=true}else properties=new properties}else properties={__operator:properties}}else if(typeof properties==="string"){properties=this.__node.roots[properties]}if(!properties)return;if(!instanced){let keys2=Object.getOwnPropertyNames(properties);let cpy={};for(const key of keys2){cpy[key]=properties[key]}properties=cpy}if(!properties.__node)properties.__node={};properties.__node.initial=properties;if(typeof properties==="object"&&(!properties?.__node?.tag||!this.get(properties.__node.tag))){let node;if(instanced)node=properties;else node=new GraphNode(properties,parent,this);this.set(node.__node.tag,node);this.runLoaders(node,parent,properties,node.__node.tag);this.__node.roots[node.__node.tag]=properties;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key in node.__listeners){let listener=node.__listeners[key];if(node[key]){delete listeners[node.__node.tag][key];listeners[node.__node.tag][node.__node.tag+"."+key]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][key]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][key]=parent.__node.tag}}}}this.setListeners(listeners);node.__callConnected();return node}return};this.recursiveSet=(t2,parent,listeners={},origin)=>{let keys2=Object.getOwnPropertyNames(origin);for(const key of keys2){if(key.includes("__"))continue;let p=origin[key];if(Array.isArray(p))continue;let instanced;if(typeof p==="function"){if(isNativeClass(p)){p=new p;if(p instanceof GraphNode){p=p.prototype.constructor(p,parent,this);instanced=true}}else p={__operator:p}}else if(typeof p==="string"){if(this.__node.nodes.get(p))p=this.__node.nodes.get(p);else p=this.__node.roots[p]}else if(typeof p==="boolean"){if(this.__node.nodes.get(key))p=this.__node.nodes.get(key);else p=this.__node.roots[key]}if(typeof p==="object"){if(!instanced&&!(p instanceof GraphNode)){let keys3=Object.getOwnPropertyNames(p);let cpy={};for(const key2 of keys3){cpy[key2]=p[key2]}p=cpy}if(!p.__node)p.__node={};if(!p.__node.tag)p.__node.tag=key;if(!p.__node.initial)p.__node.initial=t2[key];if(this.get(p.__node.tag)&&!(!(parent instanceof Graph)&&parent?.__node)||parent?.__node&&this.get(parent.__node.tag+"."+p.__node.tag))continue;let node;let newnode=false;if(instanced||p instanceof GraphNode){node=p}else{node=new GraphNode(p,parent,this);newnode=true}if(!newnode&&p instanceof GraphNode&&!instanced&&parent instanceof GraphNode){let sub=this.subscribe(parent.__node.tag,node.__node.tag);let ondelete=node2=>{this.unsubscribe(parent.__node.tag,sub)};node.__addOndisconnected(ondelete)}else{this.set(node.__node.tag,node);this.runLoaders(node,parent,t2[key],key);t2[key]=node;this.__node.roots[node.__node.tag]=p;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key2 in node.__listeners){let listener=node.__listeners[key2];let k=key2;if(node[key2]){delete listeners[node.__node.tag][key2];k=node.__node.tag+"."+key2;listeners[node.__node.tag][k]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][k]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][k]=parent.__node.tag}}}}node.__callConnected()}}}return listeners};this.remove=(node,clearListeners=true)=>{this.unsubscribe(node);if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){this.delete(node.__node.tag);delete this.__node.roots[node.__node.tag];if(clearListeners){this.clearListeners(node)}node.__callDisconnected();const recursiveRemove=t2=>{for(const key in t2){this.unsubscribe(t2[key]);this.delete(t2[key].__node.tag);delete this.__node.roots[t2[key].__node.tag];this.delete(key);delete this.__node.roots[key];t2[key].__node.tag=t2[key].__node.tag.substring(t2[key].__node.tag.lastIndexOf(".")+1);if(clearListeners){this.clearListeners(t2[key])}console.log(key,t2[key].__listeners);t2[key].__callDisconnected();if(t2[key].__children){recursiveRemove(t2[key].__children)}}};if(node.__children){recursiveRemove(node.__children)}}if(node?.__node.tag&&node?.__parent){delete node?.__parent;node.__node.tag=node.__node.tag.substring(node.__node.tag.indexOf(".")+1)}return node};this.run=(node,...args)=>{if(typeof node==="string"){let nd=this.get(node);if(!nd&&node.includes(".")){nd=this.get(node.substring(0,node.lastIndexOf(".")));if(typeof nd?.[node.substring(node.lastIndexOf(".")+1)]==="function")return nd[node.substring(node.lastIndexOf(".")+1)](...args)}else if(nd?.__operator)return nd.__operator(...args)}if(node?.__operator){return node?.__operator(...args)}};this.setListeners=listeners=>{for(const key in listeners){let node=this.get(key);if(typeof listeners[key]==="object"){for(const k in listeners[key]){let n=this.get(k);let sub;if(typeof listeners[key][k]!=="object")listeners[key][k]={__callback:listeners[key][k]};else if(!listeners[key][k].__callback){for(const kk in listeners[key][k]){if(typeof listeners[key][k][kk]!=="object"){listeners[key][k][kk]={__callback:listeners[key][k][kk]};if(listeners[key][k][kk].__callback===true||typeof listeners[key][k][kk].__callback==="undefined")listeners[key][k][kk].__callback=node.__operator}let nn=this.get(kk);if(nn){if(!nn){let tag=k.substring(0,k.lastIndexOf("."));nn=this.get(tag);if(n){sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k][kk].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k][kk].inputState,key,k);if(typeof node.__listeners[k][kk]!=="object")node.__listeners[k][kk]={__callback:listeners[key][k][kk].__callback,inputState:listeners[key][k][kk]?.inputState};node.__listeners[k][kk].sub=sub}}else{sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k);if(typeof node.__listeners[k][kk]!=="object")node.__listeners[k][kk]={__callback:listeners[key][k][kk].__callback,inputState:listeners[key][k][kk]?.inputState};node.__listeners[k][kk].sub=sub}}}}if("__callback"in listeners[key][k]){if(listeners[key][k].__callback===true||typeof listeners[key][k].__callback==="undefined")listeners[key][k].__callback=node.__operator;if(typeof listeners[key][k].__callback==="function")listeners[key][k].__callback=listeners[key][k].__callback.bind(node);if(typeof node.__listeners!=="object")node.__listeners={};if(!n){let tag=k.substring(0,k.lastIndexOf("."));n=this.get(tag);if(n){sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k].inputState,key,k);if(typeof node.__listeners[k]!=="object")node.__listeners[k]={__callback:listeners[key][k].__callback,inputState:listeners[key][k]?.inputState};node.__listeners[k].sub=sub}}else{sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k);if(typeof node.__listeners[k]!=="object")node.__listeners[k]={__callback:listeners[key][k].__callback,inputState:listeners[key][k]?.inputState};node.__listeners[k].sub=sub}}}}}};this.clearListeners=(node,listener)=>{if(typeof node==="string")node=this.get(node);if(node?.__listeners){for(const key in node.__listeners){if(listener&&key!==listener)continue;if(typeof node.__listeners[key]?.sub!=="number")continue;let n=this.get(key);if(!n){n=this.get(key.substring(0,key.lastIndexOf(".")));if(n){if(typeof node.__listeners[key]==="object"&&!node.__listeners[key]?.__callback){for(const k in node.__listeners[key]){if(typeof node.__listeners[key][k]?.sub==="number"){this.unsubscribe(n,node.__listeners[key][k].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}else{if(typeof!node.__listeners[key]?.__callback==="number"){for(const k in node.__listeners[key]){if(node.__listeners[key][k]?.sub){this.unsubscribe(n,node.__listeners[key][k].sub,void 0,node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,void 0,node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}}};this.get=tag=>{return this.__node.nodes.get(tag)};this.set=(tag,node)=>{return this.__node.nodes.set(tag,node)};this.delete=tag=>{return this.__node.nodes.delete(tag)};this.getProps=(node,getInitial)=>{if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){let cpy;if(getInitial)cpy=Object.assign({},this.__node.roots[node.__node.tag]);else{cpy=Object.assign({},node);for(const key in cpy){if(key.includes("__"))delete cpy[key]}}}};this.subscribe=(nodeEvent,onEvent,args,key,subInput,target,bound)=>{let nd=nodeEvent;if(typeof nodeEvent==="string"){nd=this.get(nodeEvent);if(!nd&&nodeEvent.includes(".")){nd=this.get(nodeEvent.substring(0,nodeEvent.lastIndexOf(".")));key=nodeEvent.substring(nodeEvent.lastIndexOf(".")+1)}}let sub;if(target instanceof GraphNode)target=target.__node.tag;if(typeof onEvent==="string"){let key2=onEvent;let setOnEventFromString=onEvent2=>{if(this.get(onEvent2)?.__operator){let node=this.get(onEvent2);onEvent2=function(...inp){return node.__operator(...inp)}}else if(onEvent2.includes(".")){let n=this.get(onEvent2.substring(0,onEvent2.lastIndexOf(".")));let key3=onEvent2.substring(onEvent2.lastIndexOf(".")+1);if(typeof n[key3]==="function"){if(n[key3]instanceof GraphNode)onEvent2=n[key3];else onEvent2=function(...inp){return n[key3](...inp)}}else{onEvent2=function(inp){n[key3]=inp;return n[key3]}}}return onEvent2};if(target){let node=this.get(target);if(typeof node?.[onEvent]==="function"){onEvent=function(...inp){return node[key2](...inp)}}else if(node[key2]){if(node[key2]instanceof GraphNode)onEvent=node[key2];else onEvent=function(inp){node[key2]=inp;return node[key2]}}else{onEvent=setOnEventFromString(onEvent)}}else{onEvent=setOnEventFromString(onEvent)}}if((typeof onEvent==="function"||onEvent instanceof GraphNode)&&args){if(onEvent instanceof GraphNode&&onEvent.__operator)onEvent=function(inp){return onEvent.__operator(inp)};onEvent=wrapArgs(onEvent,args,this)}if(nd instanceof GraphNode){sub=nd.__subscribe(onEvent,key,subInput,target,bound);let ondelete=()=>{nd.__unsubscribe(sub,key,subInput)};nd.__addOndisconnected(ondelete)}else if(typeof nodeEvent==="string"){if(this.get(nodeEvent)){if(onEvent instanceof GraphNode&&onEvent.__operator){sub=this.get(nodeEvent).__subscribe(onEvent.__operator,key,subInput,target,bound);let ondelete=()=>{this.get(nodeEvent).__unsubscribe(sub)};onEvent.__addOndisconnected(ondelete)}else if(typeof onEvent==="function"||typeof onEvent==="string"){sub=this.get(nodeEvent).__subscribe(onEvent,key,subInput,target,bound);this.__node.state.getEvent(this.get(nodeEvent).__node.unique,sub).source=nodeEvent}}else{if(typeof onEvent==="string")onEvent=this.__node.nodes.get(onEvent).__operator;if(typeof onEvent==="function")sub=this.__node.state.subscribeEvent(nodeEvent,onEvent)}}return sub};this.unsubscribe=(node,sub,key,subInput)=>{if(node instanceof GraphNode){return node.__unsubscribe(sub,key,subInput)}else return this.get(node)?.__unsubscribe(sub,key,subInput)};this.setState=update=>{this.__node.state.setState(update)};this.init(options)}};function recursivelyAssign(target,obj){for(const key in obj){if(obj[key]?.constructor.name==="Object"&&!Array.isArray(obj[key])){if(target[key]?.constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign(target[key],obj[key]);else target[key]=recursivelyAssign({},obj[key])}else{target[key]=obj[key]}}return target}function getAllProperties(obj){var allProps=[],curr=obj;do{var props=Object.getOwnPropertyNames(curr);let fn=function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)};props.forEach(fn)}while(curr=Object.getPrototypeOf(curr));return allProps}function isNativeClass(thing){return isFunction(thing)==="class"}function isFunction(x){const res=typeof x==="function"?x.prototype?Object.getOwnPropertyDescriptor(x,"prototype")?.writable?"function":"class":x.constructor.name==="AsyncFunction"?"async":"arrow":"";return res}var wrapArgs=(callback,argOrder,graph)=>{let args=[];let getCallbackFromString=a=>{if(graph.get(a)?.__operator){let node=graph.get(a);return(...inp)=>{node.__operator(...inp)}}else if(a.includes(".")){let split=a.split(".");let popped=split.pop();let joined=split.join(".");let node=graph.get(joined);if(typeof graph.get(joined)?.[popped]==="function"){return(...inp)=>{return node[popped](...inp)}}else return()=>{return node[popped]}}else if(graph.get(a)){let node=graph.get(a);return()=>{return node}}else{let arg=a;return()=>{return arg}}};let forArg=(a,i2)=>{if(a==="__output"){args[i2]=inp=>{return inp}}else if(typeof a==="string"){args[i2]=getCallbackFromString(a)}else if(typeof a==="function"){let fn2=a;args[i2]=(...inp)=>{return fn2(...inp)}}else if(typeof a==="object"&&a.__input){let recursivelyCreateCallback=function(c){let input=c.__input;if(typeof c.__input==="string"){input=getCallbackFromString(c.__input)}if(c.__args){input=wrapArgs(input,c.__args,graph)}if(c.__output){let output=c.__output;if(typeof c.__output==="string"){output=getCallbackFromString(output)}else if(typeof a.__output==="object"){output=recursivelyCreateCallback(output)}if(typeof output==="function"){let fn2=input;input=(...inp)=>{return output(fn2(...inp))}}}return input};args[i2]=recursivelyCreateCallback(a)}else{let arg=a;args[i2]=()=>{return arg}}};argOrder.forEach(forArg);if(typeof callback==="string")callback=getCallbackFromString(callback);let fn=callback;callback=function(...inp){let mapArg=arg=>{return arg(...inp)};return fn(...args.map(mapArg))};return callback};var backprop=(node,parent,graph)=>{if(node.__node.backward&&parent instanceof GraphNode){graph.setListeners({[parent.__node.tag]:{[node.__node.tag]:parent}})}};var loop=(node,parent,graph)=>{if(node.__operator&&!node.__node.looperSet){if(typeof node.__node.delay==="number"){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{setTimeout(async()=>{res(await fn(...args))},node.__node.delay)})})}else if(node.__node.frame===true){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{requestAnimationFrame(async()=>{res(await fn(...args))})})})}if(typeof node.__node.repeat==="number"||typeof node.__node.recursive==="number"){let fn=node.__operator;node.__setOperator(async(...args)=>{let i2=node.__node.repeat?node.__node.repeat:node.__node.recursive;let result;let repeater=async(tick,...inp)=>{while(tick>0){if(node.__node.delay||node.__node.frame){fn(...inp).then(async res=>{if(node.__node.recursive){await repeater(tick,res)}else await repeater(tick,...inp)});break}else result=await fn(...args);tick--}};await repeater(i2,...args);return result})}if(node.__node.loop&&typeof node.__node.loop==="number"){node.__node.looperSet=true;let fn=node.__operator;node.__setOperator((...args)=>{if(!("looping"in node.__node))node.__node.looping=true;if(node.__node.looping){fn(...args);setTimeout(()=>{node.__operator(...args)},node.__node.loop)}});if(node.__node.looping)node.__operator();let ondelete=node2=>{if(node2.__node.looping)node2.__node.looping=false};node.__addOndisconnected(ondelete)}}};var animate=(node,parent,graph)=>{if(node.__node.animate===true||node.__animation){let fn=node.__operator;node.__setOperator((...args)=>{if(!("animating"in node.__node))node.__node.animating=true;if(node.__node.animating){if(typeof node.__animation==="function")node.__animation(...args);else fn(...args);requestAnimationFrame(()=>{node.__operator(...args)})}});if(node.__node.animating||(!("animating"in node.__node)||node.__node.animating)&&node.__animation)setTimeout(()=>{requestAnimationFrame(node.__operator)},10);let ondelete=node2=>{if(node2.__node.animating)node2.__node.animating=false};node.__addOndisconnected(ondelete)}};var branching=(node,parent,graph)=>{if(typeof node.__branch==="object"&&node.__operator&&!node.__branchApplied){let fn=node.__operator;node.__branchApplied=true;node.__operator=(...args)=>{let result=fn(...args);for(const key in node.__branch){let triggered=()=>{if(typeof node.__branch[key].then==="function"){node.__branch[key].then(result)}else if(node.__branch[key].then instanceof GraphNode&&node.__branch[key].then.__operator){node.__branch[key].then.__operator(result)}else result=node.__branch[key].then};if(typeof node.__branch[key].if==="function"){if(node.__branch[key].if(result)==true){triggered()}}else if(node.__branch[key].if===result){triggered()}}return result}}if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].branch&&!node.__listeners[key].branchApplied){let fn=node.__listeners[key].callback;node.__listeners[key].branchApplied=true;node.__listeners.callback=ret=>{let triggered=()=>{if(typeof node.__listeners[key].branch.then==="function"){ret=node.__listeners[key].branch.then(ret)}else if(node.__listeners[key].branch.then instanceof GraphNode&&node.__listeners[key].branch.then.__operator){ret=node.__listeners[key].branch.then.__operator(ret)}else ret=node.__listeners[key].branch.then};if(typeof node.__listeners[key].branch.if==="function"){if(node.__listeners[key].branch.if(ret)){triggered()}}else if(node.__listeners[key].branch.if===ret){triggered()}return fn(ret)}}}}}};var triggerListenerOncreate=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].oncreate){node.__listeners[key].callback(node.__listeners[key].oncreate)}}}}};var bindListener=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].binding==="object"){node.__listeners.callback=node.__listeners.callback.bind(node.__listeners[key].binding)}}}}};var transformListenerResult=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].transform==="function"&&!node.__listeners[key].transformApplied){let fn=node.__listeners[key].callback;node.__listeners[key].transformApplied=true;node.__listeners.callback=ret=>{ret=node.__listeners[key].transform(ret);return fn(ret)}}}}}};var substitute__operator=(node,parent,graph)=>{if(node.post&&!node.__operator){node.__setOperator(node.post)}else if(!node.__operator&&typeof node.get=="function"){node.__setOperator(node.get)}if(!node.get&&node.__operator){node.get=node.__operator}if(node.aliases){node.aliases.forEach(a=>{graph.set(a,node);let ondelete=node2=>{graph.__node.nodes.delete(a)};node.__addOndisconnected(ondelete)})}if(typeof graph.__node.roots?.[node.__node.tag]==="object"&&node.get)graph.__node.roots[node.__node.tag].get=node.get};var loaders={backprop,loop,animate,branching,triggerListenerOncreate,bindListener,transformListenerResult,substitute__operator};var recursivelyStringifyFunctions=obj=>{let cpy={};for(const key in obj){if(typeof obj[key]==="object"){cpy[key]=recursivelyStringifyFunctions(obj[key])}else if(typeof obj[key]==="function"){cpy[key]=obj[key].toString()}else cpy[key]=obj[key]}return cpy};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs22(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast22(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}function methodstrings(node){if(typeof node.__methods==="object"){for(const key in node.__methods){let fstr=node.__methods[key];let fn=typeof fstr==="function"?fstr:parseFunctionFromText(fstr);if(key==="__operator"){node.__setOperator(fn)}else{node[key]=fn.bind(node)}}}}var Service=class extends Graph{constructor(options){super({...options,loaders:options?.loaders?Object.assign({...loaders},options.loaders):{...loaders}});this.name=`service${Math.floor(Math.random()*1e15)}`;this.addServices=services=>{for(const s in services){if(typeof services[s]==="function")services[s]=new services[s];if(services[s]?.__node?.loaders)Object.assign(this.__node.loaders,services[s].__node.loaders);if(services[s]?.__node?.nodes){services[s].__node.nodes.forEach((n,tag)=>{if(!this.get(tag)){this.set(tag,n)}else this.set(s+"."+tag,n)});this.__node.nodes.forEach((n,k)=>{if(!services[s].__node.nodes.get(k))services[s].__node.nodes.set(k,n)});let set=this.set;this.set=(tag,node)=>{services[s].set(tag,node);return set(tag,node)};let del=this.delete;this.delete=tag=>{services[s].delete(tag);return del(tag)}}else if(typeof services[s]==="object"){this.load(services[s])}}};this.handleMethod=(route,method,args)=>{let m=method.toLowerCase();let src=this.__node.nodes.get(route);if(!src){src=this.__node.roots[route]}if(src?.[m]){if(typeof src[m]!=="function"){if(args){if(Array.isArray(args)&&args.length===1)src[m]=args[0];else src[m]=args;return}return src[m]}else{if(Array.isArray(args))return src[m](...args);else return src[m](args)}}else return this.handleServiceMessage({route,args,method})};this.transmit=(...args)=>{if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.receive=(...args)=>{if(args[0]){if(typeof args[0]==="string"){let substr=args[0].substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))args[0]=args[0].replace(/\\\\/g,"");if(args[0][0]===\'"\'){args[0]=args[0].substring(1,args[0].length-1)};args[0]=JSON.parse(args[0])}}}if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.pipe=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return this.subscribe(source,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.pipeOnce=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return source.__node.state.subscribeEventOnce(source.__node.unique,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.__node.state.subscribeEventOnce(source.__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(source).__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.terminate=(...args)=>{};this.isTypedArray=isTypedArray;this.recursivelyAssign=recursivelyAssign2;this.spliceTypedArray=spliceTypedArray;this.ping=()=>{console.log("pinged!");return"pong"};this.echo=(...args)=>{this.transmit(...args);return args};if(options?.services)this.addServices(options.services);this.load(this)}handleServiceMessage(message){let call;if(typeof message==="object"){if(message.route)call=message.route;else if(message.node)call=message.node}if(call){if(Array.isArray(message.args))return this.run(call,...message.args);else return this.run(call,message.args)}else return message}handleGraphNodeCall(route,args){if(!route)return args;if(args?.args){this.handleServiceMessage(args)}else if(Array.isArray(args))return this.run(route,...args);else return this.run(route,args)}};function isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}var recursivelyAssign2=(target,obj)=>{for(const key in obj){if(obj[key].constructor.name==="Object"&&!Array.isArray(obj[key])){if(obj[key].constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign2(target[key],obj[key]);else target[key]=recursivelyAssign2({},obj[key])}else target[key]=obj[key]}return target};function spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let ta;if(s.length>0||e?.length>0)ta=new arr.constructor(s.length+e.length);if(ta){if(s.length>0)ta.set(s);if(e&&e.length>0)ta.set(e,s.length)}return ta}var nodeTemplates={};var remoteGraphRoutes={transferNode:(properties,connection,name2)=>{let str2;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str2=recursivelyStringifyFunctions(properties)}else if(typeof properties==="function")str2=properties.toString();else if(typeof properties==="string")str2=properties;if(str2){if(connection.run)return connection.run("setNode",[str2]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str2},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str2}));return new Promise(r=>r(name2))}}},setNode:function(properties){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function")properties={__operator:f,__node:{tag:f.name}};else{f=JSON.parse(properties);if(typeof f==="object")properties=f}}if(typeof properties==="object"||typeof properties==="function"){let template=Object.assign({},properties);let node=this.__node.graph.add(properties);nodeTemplates[node.__node.tag]=template;return node.__node.tag}else return false},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]==="function"){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str2=recursivelyStringifyFunctions(properties);return str2},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function"){if(!name2)name2=f.name;properties={__operator:f,__node:{tag:name2}}}else{f=JSON.parse(properties);if(typeof f==="object"){properties=f;if(!name2&&f.__node?.tag)name2=f.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates[templateName]){let cpy=recursivelyAssign2({},nodeTemplates[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(route,fn,methodKey){if(typeof fn==="string"){let f=parseFunctionFromText(fn);if(typeof f==="function")fn=f}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(route)){this.__node.graph.get(route)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key in properties){result[key]=typeof node[key]}return result}return void 0},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str2=classObj.toString();let message={route:"receiveClass",args:[str2,className]};if(connection.run)return connection.run("receiveClass",[str2,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str2,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str2,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str2=fn.toString();let message={route:"receiveClass",args:[str2,fnName]};if(connection.run)return connection.run("setFunction",[str2,fnName]);else if(connection.postMessage){connection.postMessage({route:"setFunction",args:[str2,fnName]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"setFunction",args:[str2,fnName]}));return new Promise(r=>r(name))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl.exception.invalid("invalid aes key size");this.b=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};sjcl.cipher.aes.prototype={encrypt:function(a){return t(this,a,0)},decrypt:function(a){return t(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d=b[4],e,f,g,h=[],k=[],l,n,m,p;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d[m]=f,n=h[e=h[l=h[f]]],p=16843009*n^65537*e^257*l^16843008*f,n=257*h[m]^16843008*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p=p<<24^p>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function t(a,b,c){if(4!==b.length)throw new sjcl.exception.invalid("invalid aes block size");var d=a.b[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,k,l,n=d.length/4-2,m,p=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v=h[2],w=h[3],x=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v[g>>8&255]^w[b&255]^d[p],k=a[f>>>24]^q[g>>16&255]^v[b>>8&255]^w[e&255]^d[p+1],l=a[g>>>24]^q[b>>16&255]^v[e>>8&255]^w[f&255]^d[p+2],b=a[b>>>24]^q[e>>16&255]^v[f>>8&255]^w[g&255]^d[p+3],p+=4,e=h,f=k,g=l;for(m=0;4>m;m++)r[c?3&-m:m]=x[e>>>24]<<24^x[f>>16&255]<<16^x[g>>8&255]<<8^x[b&255]^d[p++],h=e,e=f,f=g,g=b,b=h;return r}sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray.$(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},$:function(a,b,c,d){var e;e=0;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(c&65280)<<8|c<<24;return a}};sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\\s|0x/g,"");d=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};sjcl.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f="",g=0,h=sjcl.codec.base32.B,k=0,l=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32.X);for(c=0;f.length*d<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d?(k=a[c]<<d-g,g+=e,c++):(k<<=d,g-=d);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\\s|=/g,"").toUpperCase();var c=sjcl.codec.base32.BITS,d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f=[],g,h=0,k=sjcl.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p){}throw new sjcl.exception.invalid("this isn\'t "+m+"!")}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d,l^=n<<c-h)}h&56&&f.push(sjcl.bitArray.partial(h&56,l,1));return f}};sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};sjcl.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.B,g=0,h=sjcl.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\\s|=/g,"");var c=[],d,e=0,f=sjcl.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d=0;d<a.length;d++){h=f.indexOf(a.charAt(d));if(0>h)throw new sjcl.exception.invalid("this isn\'t base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl.bitArray.partial(e&56,g,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl.hash.sha256.hash=function(a){return new sjcl.hash.sha256().update(a).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.A=sjcl.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl.bitArray.bitLength(a);if(9007199254740991<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=512+b-(512+b&511);b<=a;b+=512)u(this,d.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&511);b<=a;b+=512)u(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/4294967296));for(b.push(this.l|0);b.length;)u(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a2){return 4294967296*(a2-Math.floor(a2))|0}for(var b=0,c=2,d,e;64>b;c++){e=true;for(d=2;d*d<=c;d++)if(0===c%d){e=false;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};function u(a,b){var c,d,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d=b[c]:(d=b[c+1&15],e=b[c+14&15],d=b[c&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d=d+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p^r))+g[c],q=r,r=p,p=m,m=n+d|0,n=l,l=k,k=h,h=d+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p|0;f[6]=f[6]+r|0;f[7]=f[7]+q|0}sjcl.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm.G.indexOf(a);-1<a&&sjcl.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.V(a,b,c,d,e,f);g=sjcl.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl.mode.ccm.C(a,k,c,l,e,b);a=sjcl.mode.ccm.V(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn\'t match");return k.data},na:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,k=h.i;d=[h.partial(8,(b.length?64:0)|d-2<<2|f-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d=a.encrypt(k(d,g.slice(b,b+4).concat([0,0,0])));return d},V:function(a,b,c,d,e,f){var g=sjcl.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");if(4294967295<d.length||4294967295<b.length)throw new sjcl.exception.bug("ccm: can\'t deal with 4GiB or more data");c=sjcl.mode.ccm.na(a,d,c,e,g.bitLength(b)/8,f);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl.mode.ccm.fa(g/k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,l)}}};sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.S,k=sjcl.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p=p.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));d.length&&(n=l(n,f?d:sjcl.mode.ocb2.pmac(a,d)));return p.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.S,h=sjcl.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p,r=sjcl.bitArray.bitLength(b)-e,q=[];d=d||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p=r-32*c;m=a.encrypt(k(n,[0,0,0,p]));m=k(m,h.clamp(b.slice(c),p).concat([0,0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d.length&&(l=k(l,f?d:sjcl.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl.exception.corrupt("ocb: tag doesn\'t match");return q.concat(h.clamp(m,p))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.S,e=sjcl.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d(f(h,d(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;d=d||[];a=sjcl.mode.gcm.C(true,a,f,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl.mode.gcm.C(false,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn\'t match");return a.data},ka:function(a,b){var c,d,e,f,g,h=sjcl.bitArray.i;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d=3;0<d;d--)f[d]=f[d]>>>1|(f[d-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=sjcl.mode.gcm.ka(b,a);return b},C:function(a,b,c,d,e,f){var g,h,k,l,n,m,p,r,q=sjcl.bitArray;m=c.length;p=q.bitLength(c);r=q.bitLength(d);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl.mode.gcm.j(g,[0,0,0,0],e),e=sjcl.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=sjcl.mode.gcm.j(g,[0,0,0,0],d);n=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p);a&&(d=sjcl.mode.gcm.j(g,h,c));a=[Math.floor(r/4294967296),r&4294967295,Math.floor(p/4294967296),p&4294967295];d=sjcl.mode.gcm.j(g,d,a);k=b.encrypt(e);d[0]^=k[0];d[1]^=k[1];d[2]^=k[2];d[3]^=k[3];return{tag:q.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.W=b=b||sjcl.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=false};sjcl.misc.hmac.prototype.update=function(a){this.aa=true;this.R.update(a)};sjcl.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=new this.W(this.w[1]).update(a).finalize();this.reset();return a};sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1e4;if(0>d||0>c)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl.bitArray;for(k=1;32*l.length<(d||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d&&(l=n.clamp(l,d));return l};sjcl.prng=function(a){this.c=[new sjcl.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=false;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=65536;this.T=[0,48,64,96,128,192,256,384,512,768,1024];this.da=3e4;this.ba=80};sjcl.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;if(d===this.u)throw new sjcl.exception.notReady("generator isn\'t seeded");if(d&this.J){d=!(d&this.I);e=[];var f=0,g;this.Z=e[0]=new Date().valueOf()+this.da;for(g=0;16>g;g++)e.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=f);this.P++;this.b=sjcl.hash.sha256.hash(this.b.concat(e));this.L=new sjcl.cipher.aes(this.b);for(d=0;4>d&&(this.h[d]=this.h[d]+1|0,!this.h[d]);d++);}for(d=0;d<a;d+=4)0===(d+1)%this.ca&&y(this),e=z(this),c.push(e[0],e[1],e[2],e[3]);y(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=new Date().valueOf(),g=this.H[c],h=this.isReady(),k=0;d=this.U[c];void 0===d&&(d=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case"number":void 0===b&&(b=1);this.c[g].update([d,this.N++,1,b,f,1,a|0]);break;case"object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d,this.N++,2,b,f,a.length].concat(a))}break;case"string":void 0===b&&(b=a.length);this.c[g].update([d,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)};if(window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,false),window.addEventListener("mousemove",this.a.mouseCollector,false),window.addEventListener("keypress",this.a.keyboardCollector,false),window.addEventListener("devicemotion",this.a.accelerometerCollector,false),window.addEventListener("touchmove",this.a.touchCollector,false);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl.exception.bug("can\'t attach event");this.D=true}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,false),window.removeEventListener("mousemove",this.a.mouseCollector,false),window.removeEventListener("keypress",this.a.keyboardCollector,false),window.removeEventListener("devicemotion",this.a.accelerometerCollector,false),window.removeEventListener("touchmove",this.a.touchCollector,false)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=false)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d,e=this.K[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},la:function(){C(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C(this,0)},qa:function(a){a=a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C(this,0)},ma:function(){C(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C(this,0)}};function A(a,b){var c,d=sjcl.random.K[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function C(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy(new Date().valueOf(),b,"loadtime")}function y(a){a.b=z(a).concat(z(a));a.L=new sjcl.cipher.aes(a.b)}function z(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}function B(a,b){return function(){b.apply(a,arguments)}}sjcl.random=new sjcl.prng(6);a:try{if(G="undefined"!==typeof module&&module.exports){try{H=__require2("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array(new Uint8Array(D).buffer),sjcl.random.addEntropy(D,1024,"crypto[\'randomBytes\']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F);else break a;sjcl.random.addEntropy(F,1024,"crypto[\'getRandomValues\']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}var D;var E;var F;var G;var H;sjcl.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.g({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[f.cipher](a);e.g(d,f);d.key=a;f.ct="ccm"===f.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d){var e=sjcl.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.g(e.g(e.g({},e.defaults),b),c,true);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl.codec.utf8String.toBits(f));g=new sjcl.cipher[b.cipher](a);f="ccm"===b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d,b);d.key=a;return 1===c.raw?f:sjcl.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=sjcl.json;return e.ia(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+\'"\'+b+\'":\';d=",";switch(typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+=\'"\'+escape(a[b])+\'"\';break;case"object":c+=\'"\'+sjcl.codec.base64.fromBits(a[b],0)+\'"\';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){a=a.replace(/\\s/g,"");if(!a.match(/^\\{.*\\}$/))throw new sjcl.exception.invalid("json decode: this isn\'t json!");a=a.replace(/^\\{|\\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^\\s*(?:(["\']?)([a-z][a-z0-9]*)\\1)\\s*:\\s*(?:(-?\\d+)|"([a-z0-9+\\/%*_.@=\\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn\'t json!");null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},sa:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},ra:function(a,b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.pa={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.pa,d;b=b||{};d=b.iter||1e3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};var _HTTPfrontend=class extends Service{constructor(options,path,fetched){super(options);this.name="http";this.fetchProxied=false;this.listening={};this.GET=(url="http://localhost:8080/ping",type="",mimeType)=>{if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"GET",url,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.POST=(message,url="http://localhost:8080/echo",type="",mimeType)=>{if(typeof message==="object"&&(type==="json"||type==="text"||!type)){message=JSON.stringify(message)}if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"POST",url,data:message,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.transmit=(message,url)=>{let obj=message;if(typeof obj==="object"){message=JSON.stringify(obj)}if(obj?.method?.toLowerCase()=="get"||message?.toLowerCase()==="get")return this.GET(url);return this.POST(message,url)};this.transponder=(url,message,type="",mimeType)=>{if(typeof message==="object")message=JSON.stringify(message);let method="GET";if(message){method="POST"}if(type==="json")mimeType="application/json";else return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method,url,data:message,responseType:type,onload:ev=>{let body=xhr.response;if(typeof body==="string"){let substr=body.substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))body=body.replace(/\\\\/g,"");if(body[0]===\'"\'){body=body.substring(1,body.length-1)};body=JSON.parse(body)}}if(typeof body?.method==="string"){return resolve(this.handleMethod(body.route,body.method,body.args))}else if(typeof body?.route==="string"){return resolve(this.handleServiceMessage(body))}else if(typeof body?.node==="string"||body.node instanceof GraphNode){return resolve(this.handleGraphNodeCall(body.node,body.args))}else return resolve(body)},onabort:er=>{reject(er)}})}).catch(console.error)};this.listen=(path2="0",fetched2=async(clone,args,response)=>{const result=await clone.text();const returned=this.receive(result);this.setState({[response.url]:returned})})=>{this.listening[path2]={};let listenerId=`${path2}${Math.floor(Math.random()*1e15)}`;this.listening[path2][listenerId]=fetched2;if(!this.fetchProxied){globalThis.fetch=new Proxy(globalThis.fetch,{apply(fetch,that,args){const result=fetch.apply(that,args);result.then(response=>{if(!response.ok)return;if(this.listening["0"]){for(const key in this.listeners){const clone=response.clone();this.listening["0"][key](clone,args,response)}}else{for(const key in this.listening){if(response.url.includes(key)){for(const key2 in this.listening[path2]){const clone=response.clone();this.listening[path2][key2](clone,args,response)}break}}}}).catch(er=>{console.error(er)});return result}});this.fetchProxied=true}return listenerId};this.stopListening=(path2,listener)=>{if(!path2&&path2!==0){for(const key in this.listening)delete this.listening[key]}else{if(!listener)delete this.listening[path2];else delete this.listening[listener]}};this.load(this);this.listen(path,fetched)}};var HTTPfrontend=_HTTPfrontend;HTTPfrontend.request=options=>{const xhr=new XMLHttpRequest;if(options.responseType)xhr.responseType=options.responseType;else options.responseType="json";if(options.mimeType){xhr.overrideMimeType(options.mimeType)}if(options.onload)xhr.addEventListener("load",options.onload,false);if(options.onprogress)xhr.addEventListener("progress",options.onprogress,false);if(options.onabort)xhr.addEventListener("abort",options.onabort,false);if(options.onloadend)xhr.addEventListener("loadend",options.onloadend,false);if(options.onerror)xhr.addEventListener("error",options.onerror,false);xhr.open(options.method,options.url,true,options.user,options.pass);if(!options.onerror)xhr.onerror=function(){xhr.abort()};xhr.send(options.data);return xhr};var import_web_worker=__toESM(require_browser());var WorkerService=class extends Service{constructor(options){super();this.name="worker";this.workers={};this.threadRot=0;this.loadWorkerRoute=(rt,routeKey)=>{if(rt.workerUrl)rt.url=rt.workerUrl;if(rt.workerId)rt.__node.tag=rt.workerId;if(!rt.__node.tag)rt.__node.tag=routeKey;rt._id=rt.__node.tag;let worker;if(this.workers[rt._id])worker=this.workers[rt._id];else if(rt.worker)worker=rt.worker;if(!worker){worker=this.addWorker(rt)}rt.worker=worker;if(!rt.worker.__ondisconnected){let ondelete=rt2=>{rt2.worker?.terminate()};rt.__addOndisconnected(ondelete)}if(rt.transferFunctions){for(const prop in rt.transferFunctions){this.transferFunction(worker,rt.transferFunctions[prop],prop)}}if(rt.transferClasses){for(const prop in rt.transferClasses){this.transferClass(worker,rt.transferClasses[prop],prop)}}if(worker){if(!rt.__operator){rt.__operator=(...args)=>{if(rt.callback){if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.post(rt.callback,args);else return worker.run(rt.callback,args)}else{if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(rt.init){worker.run(rt.init,rt.initArgs,void 0,rt.initTransfer)}return worker}};this.workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?.workerId||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};this.addDefaultMessageListener=()=>{globalThis.onmessage=ev=>{let result=this.receive(ev.data);if(this.__node.keepState)this.setState({[this.name]:result})}};this.postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};this.addWorker=options2=>{let worker;if(!options2._id)options2._id=`worker${Math.floor(Math.random()*1e15)}`;if(options2.url)worker=new import_web_worker.default(options2.url);else if(options2.port){worker=options2.port}else if(this.workers[options2._id]){if(this.workers[options2._id].port)worker=this.workers[options2._id].port;else worker=this.workers[options2._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options2._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options2._id,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options2._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options2._id)};if(!options2.onmessage)options2.onmessage=ev=>{this.receive(ev.data);this.setState({[options2._id]:ev.data})};if(!options2.onerror){options2.onerror=ev=>{console.error(ev.data)}}worker.onmessage=options2.onmessage;worker.onerror=options2.onerror;this.workers[options2._id]={worker,send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options2};return this.workers[options2._id]};this.open=this.addWorker;this.toObjectURL=scriptTemplate=>{let blob=new Blob([scriptTemplate],{type:"text/javascript"});return URL.createObjectURL(blob)};this.transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys2=Object.keys(this.workers);this.workers[keys2[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys2.length)this.threadRot=0}return message};this.terminate=worker=>{let onclose;if(typeof worker==="string"){let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof import_web_worker.default){worker.terminate();if(onclose)onclose(worker);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);return true}return false};this.establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof import_web_worker.default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};this.request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};this.runRequest=(message,worker,callbackId)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId})})}else{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId})}return res};this.subscribeWorker=(route,worker,args,key,subInput,blocking)=>{let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{if(worker?.postMessage)worker.postMessage({args:r,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route})})}else{if(worker?.postMessage)worker.postMessage({args:res,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route})}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};this.subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking])}};this.triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i2=0;i2<this.__node.state.triggers[workerId].length;i2++){await this.__node.state.triggers[workerId][i2].onchange({args:result,callbackId:route})}return true};this.pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking])};this.unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}};this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}};var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","timeStamp"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function focusEventHandler(event,sendFn){const data={type:event.type};data.isTrusted=event.isTrusted;data.bubbles=event.bubbles;data.cancelBubble=event.cancelBubble;data.cancelable=event.cancelable;data.composed=event.composed;data.defaultPrevent=event.defaultPrevented;data.eventPhase=event.eventPhase;data.returnValue=event.returnValue;data.currentTarget=event.currentTarget.id?event.currentTarget.id:event.currentTarget.constructor.name;data.target=data.currentTarget;data.srcElement=data.currentTarget;sendFn(data)}function wheelEventHandler(event,sendFn){event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event){event.preventDefault()}function copyProperties(src,properties,dst){for(const name2 of properties){dst[name2]=src[name2]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn){const touches=[];const data={type:event.type,touches};for(let i2=0;i2<event.touches.length;++i2){const touch=event.touches[i2];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var i=1;var keys={};while(i<222){keys[i]=true;i++}function filteredKeydownEventHandler(event,sendFn){let{keyCode}=event;if(keys[keyCode]){if(event.preventDefault&&(keyCode<110||keyCode>123))event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,pointerlockchange:mouseEventHandler,webkitpointerlockchange:mouseEventHandler,focus:focusEventHandler,blur:focusEventHandler,pointerout:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler,keyup:filteredKeydownEventHandler};function initProxyElement(element,worker,id){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent)})}if(eventHandlers.keydown){globalThis.addEventListener("keydown",function(ev){eventHandlers.keydown(ev,sendEvent)})}if(eventHandlers.keyup){globalThis.addEventListener("keyup",function(ev){eventHandlers.keyup(ev,sendEvent)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i2=0,l=array.length;i2<l;i2++){array[i2].call(this,event)}}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy);addTo.blur=proxy.blur.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={elementFromPoint:(...args)=>{return this.targets[Object.keys(this.targets)[0]].proxied}}}};function makeProxy(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else{initProxyElement(options.canvas,void 0,options._id);return setupCanvas(options)}}function transferCanvas(worker,options,route){console.log(options);if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id);else initProxyElement(options.canvas,worker,options._id);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let tr=[offscreen];if(options.transfer){tr.push(...options.transfer);delete options.transfer}worker.postMessage(message,tr);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:(props,transfer)=>{worker.postMessage({route:"drawFrame",args:[props,options._id]},transfer)},update:(props,transfer)=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]},transfer)},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:(newDrawProps,transfer)=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]},transfer)},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText3(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw.bind(settings)}if(typeof settings.update==="string")settings.update=parseFunctionFromText3(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update.bind(settings)}if(typeof settings.init==="string")settings.init=parseFunctionFromText3(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init.bind(settings)}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText3(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear.bind(settings)}return settings._id}return void 0}function setupCanvas(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{if(this?.__node?.graph){canvasOptions.graph=this.__node.graph;if(!canvasOptions.__node){canvasOptions.__node={}}if(!canvasOptions.__node.tag)canvasOptions.__node.tag=canvasOptions._id;canvasOptions=this.__node.graph.add(canvasOptions);canvasOptions.__addOndisconnected=()=>{canvasOptions.stop();delete this.__node.graph.CANVASES[canvasOptions._id]}}if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText3(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw.bind(canvasOptions)}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText3(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update.bind(canvasOptions)}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText3(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init.bind(canvasOptions)}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText3(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear.bind(canvasOptions)}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{if(this.__node?.graph)this.__node.graph.remove(options._id);else{stopAnim(options._id);if(this?.__node?.graph)delete this.__node.graph.CANVASES[canvasOptions._id];else delete globalThis.CANVASES[canvasOptions._id]}}};return canvascontrols}}function drawFrame(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts=getCanvas.call(this,_id);canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText3(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")requestAnimationFrame(canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context));return _id}return void 0}function getCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}return canvasopts}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim,getCanvas};function parseFunctionFromText3(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var _ArrayManip=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return y2*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return 2*((y2-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps9){let now=Date.now();let toInterp=[now-ct*1e3/sps9,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i2=incr;i2<array.length;i2+=incr){let rounded=Math.round(i2);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i2=1;i2<fitCount-1;i2++){var tmp=i2*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i2]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x;b=0}else if(60<=h&&h<120){r=x;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x}else if(180<=h&&h<240){r=0;g=x;b=c}else if(240<=h&&h<300){r=x;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d={};data.forEach((arr,i2)=>{d[i2]=arr});data=d;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i2)=>lastValue+slopeIncr*(i2+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip=_ArrayManip;ArrayManip.bufferValues=(objects,property,keys2,buffer)=>{if(!Array.isArray(keys2)&&typeof keys2==="object")keys2=Object.keys(keys2);if(!buffer){let object_keys=Object.keys(objects);if(keys2)buffer=new Float32Array(object_keys.length*keys2.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys2=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys2.length)}else buffer=new Float32Array(object_keys.length)}}let i2=0;for(const key in objects){if(objects[key][property]){if(keys2){for(let j=0;j<keys2.length;j++){buffer[i2]=objects[key][property][keys2[j]];i2++}}else{buffer[i2]=objects[key][property];i2++}}}return buffer};var rechk=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str=(v,o,c)=>String.fromCharCode(...new Uint8Array(v.buffer,v.byteOffset+o,c));var rts=(v,o,c,s)=>new Uint8Array(v.buffer,v.byteOffset+o,c).set(s.split("").map(str2=>str2.charCodeAt(0)));var pst=(v,o,c)=>str(v,o+1,Math.min(v.getUint8(o),c-1));var tsp=(v,o,c,s)=>{v.setUint8(o,s.length);rts(v,o+1,c-1,s)};var lut=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v=>str(v,o,1),p:(v,c2)=>rts(v,o,1,c2)})],"?":c=>[c,1,o=>({u:v=>Boolean(v.getUint8(o)),p:(v,B2)=>v.setUint8(o,B2)})],b:c=>[c,1,o=>({u:v=>v.getInt8(o),p:(v,b)=>v.setInt8(o,b)})],B:c=>[c,1,o=>({u:v=>v.getUint8(o),p:(v,B2)=>v.setUint8(o,B2)})],h:c=>[c,2,o=>({u:v=>v.getInt16(o,le),p:(v,h)=>v.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v=>v.getUint16(o,le),p:(v,H2)=>v.setUint16(o,H2,le)})],i:c=>[c,4,o=>({u:v=>v.getInt32(o,le),p:(v,i2)=>v.setInt32(o,i2,le)})],I:c=>[c,4,o=>({u:v=>v.getUint32(o,le),p:(v,I)=>v.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v=>v.getFloat32(o,le),p:(v,f)=>v.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v=>v.getFloat64(o,le),p:(v,d)=>v.setFloat64(o,d,le)})],s:c=>[1,c,o=>({u:v=>str(v,o,c),p:(v,s)=>rts(v,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v=>pst(v,o,c),p:(v,s)=>tsp(v,o,c,s.slice(0,c-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var _ByteParser=class extends ArrayManip{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){indices.push(i2);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y2){return[y2&255,y2>>8&255]}static bytesToInt24(x0,x1,x2){let int24=(255&x0)<<16|(255&x1)<<8|255&x2;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x2){return x0*65536+x1*256+x2}static Uint24ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255]}static bytesToInt32(x0,x1,x2,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x2)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x2,x3){return x0*16777216+x1*65536+x2*256+x3}static Uint32ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255,y2>>24&255]}static get2sCompliment(val,nbits3){if(val>4294967296)return null;return val<<32-nbits3>>32-nbits3}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i2=0;i2<input.length;i2++){var c=input.charCodeAt(i2);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i2]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser.asUint8Array(patternBuffer);var M=pattern.length;if(M===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R=256;var rightmost_positions=new Int32Array(R);for(var c=0;c<R;c++){rightmost_positions[c]=-1}for(var j=0;j<M;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i2=start;i2<=lastIndex;i2+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i2+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i2}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk.exec(format);if(!m){throw new RangeError("Invalid format string")}const t2=lut("<"===m[1]),lu=(n,c)=>t2[c](n?parseInt(n,10):1);while(m=refmt.exec(format)){((r,s,f)=>{for(let i2=0;i2<r;++i2,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v=new DataView(arrb,offs|0);return fns.map(f=>f.u(v))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i2)=>f.p(v,values[i2]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser=_ByteParser;ByteParser.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92};var WebSerial=class extends ByteParser{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:`stream${Math.floor(Math.random()*1e15)}`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message){const writer=port.writable.getWriter();await writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=stream.buffering.lockIdx??0;for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))used=stream.buffering.lockIdx=i2;else{nextIndex=i2;if(nextIndex>=0){const len=nextIndex-used;if(!stream.buffering.locked){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(data);stream.buffering.locked=true}else if(len>0){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(new Uint8Array(data))}used=nextIndex}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}writeStream(stream,message){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i2=0;i2<ports.length;i2++){if(ports[i2].getInfo().usbVendorId===info.usbVendorId&&ports[i2].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i2],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i2]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t2=>{let opt=transforms[t2];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str2=stream;transform.forEach(transform2=>{str2=str2.pipeThrough(transform2)});return str2}};function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i2=0;i2<9;i2++){let j=i2*25;output[0][i2]=ByteParser.bytesToInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var sps=250;var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var gain=32;var nbits=24;var vref=1.2;var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};var accScale=.002/Math.pow(2,4);var getAcc=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b)=>a+b;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale*ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale*ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale*ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;if(arr[0]%2===0)output[i2+7]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);return output}var sps2=250;var cytonSerialSettings={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<128;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i2=0;i2<128;i2++){freeeeg128ChartSettings.lines[i2]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i2]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<32;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i2=0;i2<32;i2++){freeeeg32ChartSettings.lines[i2]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i2]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps5=40;var hegduinoSerialSettings={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\\n",codec:hegduinocodec,sps:sps5};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={deviceType:"BLE",deviceName:"hegduino",sps:sps5,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps5}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i2=0;while(i2<pktCt){let idx=i2*6;if(i2%2===0){output["ir"][i2]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i2+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i2-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i2]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i2++}return output}function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i2=0;i2<20;i2++){let idx=i2*12;output.ax[i2]=ByteParser.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i2]=ByteParser.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i2]=ByteParser.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i2]=ByteParser.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i2]=ByteParser.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i2]=ByteParser.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i2=0;i2<7;i2++){let j=i2*26+1;if(!arr[j+23])break;output[0][i2]=ByteParser.bytesToUInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToUInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToUInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToUInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToUInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToUInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToUInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToUInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var sps6=250;var cognixionONEBLESettings={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps6}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps6};var cognixionONESerialSettings=Object.assign({},cytonSerialSettings);cognixionONESerialSettings.sps=sps6;cognixionONESerialSettings.deviceName="cognixionONE";var defaultChartSetting4={nSec:10,sps:sps6,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting4)),"1":JSON.parse(JSON.stringify(defaultChartSetting4)),"2":JSON.parse(JSON.stringify(defaultChartSetting4)),"3":JSON.parse(JSON.stringify(defaultChartSetting4)),"4":JSON.parse(JSON.stringify(defaultChartSetting4)),"5":JSON.parse(JSON.stringify(defaultChartSetting4)),"6":JSON.parse(JSON.stringify(defaultChartSetting4)),"7":JSON.parse(JSON.stringify(defaultChartSetting4))}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i2=0;while(i2<data.length){if(PeanutCodes[data[i2]]&&i2+1+PeanutCodes[data[i2]].byteLength<=data.length){let slice=data.slice(i2+1,i2+1+PeanutCodes[data[i2]].byteLength).buffer;let unpacked=ByteParser.struct(PeanutCodes[data[i2]].format).unpack(slice);let code=PeanutCodes[data[i2]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i2]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type]=unpacked;else result[PeanutCodes[data[i2]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type].push(...unpacked);else result[PeanutCodes[data[i2]].type].push(unpacked)}i2+=PeanutCodes[data[i2]].byteLength+1}else i2++}result.timestamp=Date.now();return result}var peanutSerialSettings={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j=0;j<3;j++){let i2=j*16+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}else{output.humidity=[];for(let j=0;j<3;j++){let i2=j*24+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser.bytesToInt32(arr[19+i2],arr[18+i2],arr[17+i2],arr[16+i2]);let hfrac=ByteParser.bytesToInt32(arr[23+i2],arr[22+i2],arr[21+i2],arr[20+i2]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}return output};function altitude(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa,.1903))}function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=ads131m08codec(arr.subarray(2));Object.keys(result).forEach((key,i2)=>{output[i2+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,ads131m08codec(arr))}return output}var nrf5xSerialSettings={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xBLESettings={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting5={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))},generateNewLines:true,cleanGeneration:false};var gain2=32;var nbits2=24;var vref2=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec,sps:20};var statechangerBLESettings={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps7=40;var blueberryBLESettings={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps7}}},sps:sps7};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps8=40;var blueberry2BLESettings={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps8},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps8}}},sps:sps8};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop2=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v,i2)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i2+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop2()},loopTime)}};loop2();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings}};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.buffer)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps9=this.sps;this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps9=this.sps){this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps9=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f,i2)=>{out=f.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad=class{constructor(type,freq,sps9,Q=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: \'lowpass\',\'highpass\',\'bandpass\',\'notch\',\'peak\',\'lowshelf\',\'highshelf\'");return}this.type=type;this.freq=freq;this.sps=sps9;this.Q=Q;this.dbGain=dbGain;let A2=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps9;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q);let beta=Math.sqrt(A2+A2);this[type](A2,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A2,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A2,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A2,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A2,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A2,sn,cs,alpha,beta){this.b0=1+alpha*A2;this.b1=-2*cs;this.b2=1-alpha*A2;this.a0=1+alpha/A2;this.a1=-2*cs;this.a2=1-alpha/A2}lowshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1-(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1-(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1+(A2+1)*cs+beta*sn;this.a1=2*(A2-1+(A2+1)*cs);this.a2=A2+1+(A2-1)*cs-beta*sn}highshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1+(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1+(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1-(A2+1)*cs-beta*sn;this.a1=2*(A2-1-(A2+1)*cs);this.a2=A2+1-(A2-1)*cs-beta*sn}applyFilter(signal_step){let y2=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y2;return y2}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y2=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y2;return y2}};var makeNotchFilter=(frequency,sps9,bandwidth)=>{return new Biquad("notch",frequency,sps9,Biquad.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps9,resonance=Math.pow(10,Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad("bandpass",Biquad.calcCenterFrequency(freqStart,freqEnd),sps9,Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart,freqEnd),Biquad.calcBandwidth(freqStart,freqEnd),resonance),0)};function parseFunctionFromText2(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs3(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs2}var stringifyFast2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast3(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast2}function loadStreamWorkerGlobals(){globalThis.Devices=Devices;globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser;globalThis.filtering=true;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"transferDevice":function transferDevice(device,worker){let cpy=Object.assign({},device);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}worker.send({route:"receiveDevice",args:cpy})},"receiveDevice":function receiveDevice(device){for(const key in device){if(typeof device[key]==="string"){let fn=parseFunctionFromText2(device[key]);if(typeof fn==="function"){device[key]=fn}}}if(!globalThis.Devices[device.deviceType])globalThis.Devices[device.deviceType]={};globalThis.Devices[device.deviceType][device.deviceName]=device},"receiveDecoder":function receiveDecoder(decoder2,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder2+")")},"receiveCodec":function receiveDeviceCodec(decoder2,deviceType,device,service,characteristic){let codec=parseFunctionFromText2(decoder2);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters)globalThis.filters={};for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService2=this.__node.graph;if(!globalThis.Serial)WorkerService2.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(typeof stream.settings.pipeTo==="string")WorkerService2.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService2.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService2.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(`${stream._id} disconnected`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(`disconnected`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){globalThis.Devices=Devices;const worker=new WorkerService({roots:{...workerCanvasRoutes,...remoteGraphRoutes,...streamWorkerRoutes}})}var stream_worker_default=self;})();\n'],{type:"text/javascript"})),ah=oh,ki=class{constructor(){this.recursivelyAssign=(e,i)=>{for(const r in i)typeof i[r]=="object"?typeof e[r]=="object"?this.recursivelyAssign(e[r],i[r]):e[r]=this.recursivelyAssign({},i[r]):e[r]=i[r];return e}}static autoscale(e,i=0,r=1,s=!1,n,a,l){if((e==null?void 0:e.length)===0)return e;let c=a||Math.max(...e),f=n||Math.min(...e),u=1/r,h=1;if(s){let p=Math.max(Math.abs(f),Math.abs(c));return p!==0&&(h=u/p),e.map(y=>(l&&(y<f&&(y=f),y>c&&(y=c)),y*h+(u*(i+1)*2-1-u)))}else return c===f?c!==0?h=u/c:f!==0&&(h=u/Math.abs(f)):h=u/(c-f),e.map(p=>(l&&(p<f&&(p=f),p>c&&(p=c)),2*((p-f)*h-1/(2*r))+(u*(i+1)*2-1-u)))}static genTimestamps(e,i){let r=Date.now(),s=[r-e*1e3/i,r];return ki.upsample(s,e)}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,i,r=1){if(e.length>i){let s=new Array(i),n=e.length/i,a=e.length-1,l=0,c=0;for(let f=n;f<e.length;f+=n){let u=Math.round(f);u>a&&(u=a);for(let h=l;h<u;h++)s[c]+=e[h];s[c]/=(u-l)*r,c++,l=u}return s}else return e}static upsample(e,i,r=1){var s=function(p,y,_){return(p+(y-p)*_)*r},n=new Array(i),a=(e.length-1)/(i-1);n[0]=e[0];for(var l=1;l<i-1;l++){var c=l*a,f=Math.floor(c),u=Math.ceil(c),h=c-f;n[l]=s(e[f],e[u],h)}return n[i-1]=e[e.length-1],n}static interpolate(e,i,r=1){return e.length>i?ki.downsample(e,i,r):e.length<i?ki.upsample(e,i,r):e}static HSLToRGB(e,i,r,s=255){i/=100,r/=100;let n=(1-Math.abs(2*r-1))*i,a=n*(1-Math.abs(e/60%2-1)),l=r-n/2,c=0,f=0,u=0;return 0<=e&&e<60?(c=n,f=a,u=0):60<=e&&e<120?(c=a,f=n,u=0):120<=e&&e<180?(c=0,f=n,u=a):180<=e&&e<240?(c=0,f=a,u=n):240<=e&&e<300?(c=a,f=0,u=n):300<=e&&e<360&&(c=n,f=0,u=a),c=(c+l)*s,f=(f+l)*s,u=(u+l)*s,[c,f,u]}static circularBuffer(e,i){if(i.length<e.length){let r=e.slice(i.length),s=e.length;e.splice(0,s,...r,...i)}else if(i.length>e.length){let r=e.length;e.splice(0,r,i.slice(r-i.length))}else e.splice(0,e.length,...i);return e}static reformatData(e,i){var r;if(Array.isArray(e)){if(Array.isArray(e[0])){let s={};if(e.forEach((n,a)=>{s[a]=n}),e=s,isNaN(e[0][0]))return}else if(i){if(e={[i]:e},isNaN(e[i][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(const s in e)if(typeof e[s]=="number"?e[s]=[e[s]]:(r=e[s])!=null&&r.values&&typeof e[s].values=="number"&&(e[s].values=[e[s].values]),isNaN(e[s][0]))return}else if(typeof e=="string"){let s;if(e.includes(`\r
`)){let n=e.split(`\r
`);e={},n.forEach((a,l)=>{a.includes("	")?s=a.split("	"):a.includes(",")?s=a.split(","):a.includes("|")&&(s=a.split("|")),Array.isArray(s)&&s.forEach((c,f)=>{if(c.includes(":")){let[u,h]=c.split(":"),p=parseFloat(h);if(p)e[u]=[p];else return}else{let u=parseFloat(c);if(u)e[f]=[u];else return}})})}else e.includes("	")?s=e.split("	"):e.includes(",")?s=e.split(","):e.includes("|")&&(s=e.split("|"));e={},Array.isArray(s)&&s.forEach((n,a)=>{if(n.includes(":")){let[l,c]=n.split(":"),f=parseFloat(c);if(f)e[l]=[f];else return}else{let l=parseFloat(n);if(l)e[a]=[l];else return}})}else typeof e=="number"&&(i?e={[i]:[e]}:e={0:[e]});return e}static padTime(e,i,r,s){let n=(e[0]-i)/r/s;return[...new Array(s-e.length).map((l,c)=>i+n*(c+1)),...e]}static interpolateForTime(e,i,r){return ki.interpolate(e,Math.ceil(r*i))}isTypedArray(e){return ArrayBuffer.isView(e)&&Object.prototype.toString.call(e)!=="[object DataView]"}spliceTypedArray(e,i,r){let s=e.subarray(0,i),n;r&&(n=e.subarray(r+1));let a;return(s.length>0||(n==null?void 0:n.length)>0)&&(a=new e.constructor(s.length+n.length)),s.length>0&&a.set(s),n&&n.length>0&&a.set(n,s.length),a}},qo=ki;qo.bufferValues=(t,e,i,r)=>{if(!Array.isArray(i)&&typeof i=="object"&&(i=Object.keys(i)),!r){let n=Object.keys(t);i?r=new Float32Array(n.length*i.length):typeof t[n[0]][e]=="object"?(i=Object.keys(t[n[0]][e]),r=new Float32Array(n.length*i.length)):r=new Float32Array(n.length)}let s=0;for(const n in t)if(t[n][e])if(i)for(let a=0;a<i.length;a++)r[s]=t[n][e][i[a]],s++;else r[s]=t[n][e],s++;return r};var lh=/^([<>])?(([1-9]\d*)?([xcbB?hHiIfdsp]))*$/,ch=/([1-9]\d*)?([xcbB?hHiIfdsp])/g,Ns=(t,e,i)=>String.fromCharCode(...new Uint8Array(t.buffer,t.byteOffset+e,i)),Bs=(t,e,i,r)=>new Uint8Array(t.buffer,t.byteOffset+e,i).set(r.split("").map(s=>s.charCodeAt(0))),hh=(t,e,i)=>Ns(t,e+1,Math.min(t.getUint8(e),i-1)),fh=(t,e,i,r)=>{t.setUint8(e,r.length),Bs(t,e+1,i-1,r)},uh=t=>({x:e=>[1,e,0],c:e=>[e,1,i=>({u:r=>Ns(r,i,1),p:(r,s)=>Bs(r,i,1,s)})],"?":e=>[e,1,i=>({u:r=>!!r.getUint8(i),p:(r,s)=>r.setUint8(i,s)})],b:e=>[e,1,i=>({u:r=>r.getInt8(i),p:(r,s)=>r.setInt8(i,s)})],B:e=>[e,1,i=>({u:r=>r.getUint8(i),p:(r,s)=>r.setUint8(i,s)})],h:e=>[e,2,i=>({u:r=>r.getInt16(i,t),p:(r,s)=>r.setInt16(i,s,t)})],H:e=>[e,2,i=>({u:r=>r.getUint16(i,t),p:(r,s)=>r.setUint16(i,s,t)})],i:e=>[e,4,i=>({u:r=>r.getInt32(i,t),p:(r,s)=>r.setInt32(i,s,t)})],I:e=>[e,4,i=>({u:r=>r.getUint32(i,t),p:(r,s)=>r.setUint32(i,s,t)})],f:e=>[e,4,i=>({u:r=>r.getFloat32(i,t),p:(r,s)=>r.setFloat32(i,s,t)})],d:e=>[e,8,i=>({u:r=>r.getFloat64(i,t),p:(r,s)=>r.setFloat64(i,s,t)})],s:e=>[1,e,i=>({u:r=>Ns(r,i,e),p:(r,s)=>Bs(r,i,e,s.slice(0,e))})],p:e=>[1,e,i=>({u:r=>hh(r,i,e),p:(r,s)=>fh(r,i,e,s.slice(0,e-1))})]}),ao=new RangeError("Structure larger than remaining buffer"),dh=new RangeError("Not enough values for structure"),Zt=class extends qo{static toDataView(e){if(!(e instanceof DataView))if(typeof e=="string"&&parseInt(e)&&(e=parseInt(e)),typeof e=="string"){let i=new TextEncoder,r={};for(const n in Zt.codes)for(;e.indexOf(n)>-1;){let a=e.indexOf(n);e=e.replace(n,""),r[a]=n}let s=Array.from(i.encode(e));for(const n in r)s.splice(parseInt(n),0,Zt.codes[r[n]]);e=new DataView(new Uint8Array(s).buffer)}else if(typeof e=="number"){let i=e;e<256?(e=new DataView(new ArrayBuffer(1)),e.setUint8(0,i)):e<65536?(e=new DataView(new ArrayBuffer(2)),e.setInt16(0,i)):(e=new DataView(new ArrayBuffer(4)),e.setUint32(0,i))}else e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer?e=new DataView(e):Array.isArray(e)?e=new DataView(Uint8Array.from(e).buffer):typeof e=="object"&&(e=new TextEncoder().encode(JSON.stringify(e)));return e}static searchBuffer(e,i,r){for(var s=i,n=e,a=Zt.boyerMoore(s),l=a.byteLength,c=[],f=a(n);f!==-1&&(c.push(f),!(r&&c.length>=r));f=a(n,f+l));return c}static bytesToInt16(e,i){let r=(255&e)<<8|255&i;return(r&32768)>0?r|=4294901760:r&=65535,r}static bytesToUInt16(e,i){return e*256+i}static Uint16ToBytes(e){return[e&255,e>>8&255]}static bytesToInt24(e,i,r){let s=(255&e)<<16|(255&i)<<8|255&r;return(s&8388608)>0?s|=4278190080:s&=16777215,s}static bytesToUInt24(e,i,r){return e*65536+i*256+r}static Uint24ToBytes(e){return[e&255,e>>8&255,e>>16&255]}static bytesToInt32(e,i,r,s){let n=(255&e)<<24|(255&i)<<16|(255&r)<<8|255&s;return(n&2147483648)>0?n|=0:n&=4294967295,n}static bytesToUInt32(e,i,r,s){return e*16777216+i*65536+r*256+s}static Uint32ToBytes(e){return[e&255,e>>8&255,e>>16&255,e>>24&255]}static get2sCompliment(e,i){return e>4294967296?null:e<<32-i>>32-i}static getSignedInt(...e){let i=0;function r(s){for(var n=0,a=!0;s--;)if(a){let l=e[i++];n+=l&127,l&128&&(n-=128),a=!1}else n*=256,n+=e[i++];return n}return r(e.length)}static asUint8Array(e){if(e instanceof Uint8Array)return e;if(typeof e=="string"){for(var i=new Uint8Array(e.length),r=0;r<e.length;r++){var s=e.charCodeAt(r);if(s>127)throw new TypeError("Only ASCII patterns are supported");i[r]=s}return i}else return new Uint8Array(e)}static boyerMoore(e){var i=Zt.asUint8Array(e),r=i.length;if(r===0)throw new TypeError("patternBuffer must be at least 1 byte long");for(var s=256,n=new Int32Array(s),a=0;a<s;a++)n[a]=-1;for(var l=0;l<r;l++)n[i[l]]=l;var c=(f,u,h)=>{var p=Zt.asUint8Array(f);u===void 0&&(u=0),h===void 0&&(h=p.length);for(var y=i,_=n,m=h-y.length,A=y.length-1,O,E=u;E<=m;E+=O){O=0;for(var L=A;L>=0;L--){var H=p[E+L];if(y[L]!==H){O=Math.max(1,L-_[H]);break}}if(O===0)return E}return-1};return c.byteLength=i.byteLength,c}static struct(e){let i=[],r=0,s=lh.exec(e);if(!s)throw new RangeError("Invalid format string");const n=uh(s[1]==="<"),a=(p,y)=>n[y](p?parseInt(p,10):1);for(;s=ch.exec(e);)((p,y,_)=>{for(let m=0;m<p;++m,r+=y)_&&i.push(_(r))})(...a(...s.slice(1)));const l=(p,y)=>{if(p.byteLength<(y|0)+r)throw ao;let _=new DataView(p,y|0);return i.map(m=>m.u(_))},c=(p,y,..._)=>{if(_.length<i.length)throw dh;if(p.byteLength<y+r)throw ao;const m=new DataView(p,y);new Uint8Array(p,y,r).fill(0),i.forEach((A,O)=>A.p(m,_[O]))},f=(...p)=>{let y=new ArrayBuffer(r);return c(y,0,...p),y},u=p=>l(p,0);function*h(p){for(let y=0;y+r<=p.byteLength;y+=r)yield l(p,y)}return Object.freeze({unpack:u,pack:f,unpack_from:l,pack_into:c,iter_unpack:h,format:e,size:r})}},q=Zt;q.codes={"\\n":10,"\\r":13,"\\t":9,"\\s":32,"\\b":8,"\\f":12,"\\":92};var lo;(function(t){t[t.SCAN_MODE_LOW_POWER=0]="SCAN_MODE_LOW_POWER",t[t.SCAN_MODE_BALANCED=1]="SCAN_MODE_BALANCED",t[t.SCAN_MODE_LOW_LATENCY=2]="SCAN_MODE_LOW_LATENCY"})(lo||(lo={}));Fs();Us();Fs();var ne=No("BluetoothLe",{web:()=>Promise.resolve().then(()=>(vc(),To)).then(t=>new t.BluetoothLeWeb)}),ph=dc(wc());function ls(t){return t?(0,ph.default)(1):e=>e()}function ke(t){if(typeof t!="string")throw new Error(`Invalid UUID type ${typeof t}. Expected string.`);if(t=t.toLowerCase(),!(t.search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${t}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return t}var gh=class{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=ls(!0)}enableQueue(){this.queue=ls(!0)}disableQueue(){this.queue=ls(!1)}async initialize(t){await this.queue(async()=>{await ne.initialize(t)})}async getEnabled(){return this.isEnabled()}async isEnabled(){return await this.queue(async()=>(await ne.isEnabled()).value)}async enable(){await this.queue(async()=>{await ne.enable()})}async disable(){await this.queue(async()=>{await ne.disable()})}async startEnabledNotifications(t){await this.queue(async()=>{var e;const i="onEnabledChanged";await((e=this.eventListeners.get(i))===null||e===void 0?void 0:e.remove());const r=await ne.addListener(i,s=>{t(s.value)});this.eventListeners.set(i,r),await ne.startEnabledNotifications()})}async stopEnabledNotifications(){await this.queue(async()=>{var t;const e="onEnabledChanged";await((t=this.eventListeners.get(e))===null||t===void 0?void 0:t.remove()),this.eventListeners.delete(e),await ne.stopEnabledNotifications()})}async isLocationEnabled(){return await this.queue(async()=>(await ne.isLocationEnabled()).value)}async openLocationSettings(){await this.queue(async()=>{await ne.openLocationSettings()})}async openBluetoothSettings(){await this.queue(async()=>{await ne.openBluetoothSettings()})}async openAppSettings(){await this.queue(async()=>{await ne.openAppSettings()})}async setDisplayStrings(t){await this.queue(async()=>{await ne.setDisplayStrings(t)})}async requestDevice(t){return t=t?this.validateRequestBleDeviceOptions(t):void 0,await this.queue(async()=>await ne.requestDevice(t))}async requestLEScan(t,e){t=this.validateRequestBleDeviceOptions(t),await this.queue(async()=>{var i;await((i=this.scanListener)===null||i===void 0?void 0:i.remove()),this.scanListener=await ne.addListener("onScanResult",r=>{const s=Object.assign(Object.assign({},r),{manufacturerData:this.convertObject(r.manufacturerData),serviceData:this.convertObject(r.serviceData),rawAdvertisement:r.rawAdvertisement?this.convertValue(r.rawAdvertisement):void 0});e(s)}),await ne.requestLEScan(t)})}async stopLEScan(){await this.queue(async()=>{var t;await((t=this.scanListener)===null||t===void 0?void 0:t.remove()),this.scanListener=null,await ne.stopLEScan()})}async getDevices(t){return this.queue(async()=>(await ne.getDevices({deviceIds:t})).devices)}async getConnectedDevices(t){return this.queue(async()=>(await ne.getConnectedDevices({services:t})).devices)}async connect(t,e,i){await this.queue(async()=>{var r;if(e){const s=`disconnected|${t}`;await((r=this.eventListeners.get(s))===null||r===void 0?void 0:r.remove());const n=await ne.addListener(s,()=>{e(t)});this.eventListeners.set(s,n)}await ne.connect(Object.assign({deviceId:t},i))})}async createBond(t){await this.queue(async()=>{await ne.createBond({deviceId:t})})}async isBonded(t){return await this.queue(async()=>(await ne.isBonded({deviceId:t})).value)}async disconnect(t){await this.queue(async()=>{await ne.disconnect({deviceId:t})})}async getServices(t){return await this.queue(async()=>(await ne.getServices({deviceId:t})).services)}async discoverServices(t){await this.queue(async()=>{await ne.discoverServices({deviceId:t})})}async readRssi(t){return await this.queue(async()=>{const i=await ne.readRssi({deviceId:t});return parseFloat(i.value)})}async read(t,e,i,r){return e=ke(e),i=ke(i),await this.queue(async()=>{const n=await ne.read(Object.assign({deviceId:t,service:e,characteristic:i},r));return this.convertValue(n.value)})}async write(t,e,i,r,s){return e=ke(e),i=ke(i),this.queue(async()=>{if(!(r!=null&&r.buffer))throw new Error("Invalid data.");let n=r;mt.getPlatform()!=="web"&&(n=ts(r)),await ne.write(Object.assign({deviceId:t,service:e,characteristic:i,value:n},s))})}async writeWithoutResponse(t,e,i,r,s){e=ke(e),i=ke(i),await this.queue(async()=>{if(!(r!=null&&r.buffer))throw new Error("Invalid data.");let n=r;mt.getPlatform()!=="web"&&(n=ts(r)),await ne.writeWithoutResponse(Object.assign({deviceId:t,service:e,characteristic:i,value:n},s))})}async readDescriptor(t,e,i,r,s){return e=ke(e),i=ke(i),r=ke(r),await this.queue(async()=>{const a=await ne.readDescriptor(Object.assign({deviceId:t,service:e,characteristic:i,descriptor:r},s));return this.convertValue(a.value)})}async writeDescriptor(t,e,i,r,s,n){return e=ke(e),i=ke(i),r=ke(r),this.queue(async()=>{if(!(s!=null&&s.buffer))throw new Error("Invalid data.");let a=s;mt.getPlatform()!=="web"&&(a=ts(s)),await ne.writeDescriptor(Object.assign({deviceId:t,service:e,characteristic:i,descriptor:r,value:a},n))})}async startNotifications(t,e,i,r){e=ke(e),i=ke(i),await this.queue(async()=>{var s;const n=`notification|${t}|${e}|${i}`;await((s=this.eventListeners.get(n))===null||s===void 0?void 0:s.remove());const a=await ne.addListener(n,l=>{r(this.convertValue(l==null?void 0:l.value))});this.eventListeners.set(n,a),await ne.startNotifications({deviceId:t,service:e,characteristic:i})})}async stopNotifications(t,e,i){e=ke(e),i=ke(i),await this.queue(async()=>{var r;const s=`notification|${t}|${e}|${i}`;await((r=this.eventListeners.get(s))===null||r===void 0?void 0:r.remove()),this.eventListeners.delete(s),await ne.stopNotifications({deviceId:t,service:e,characteristic:i})})}validateRequestBleDeviceOptions(t){return t.services&&(t.services=t.services.map(ke)),t.optionalServices&&(t.optionalServices=t.optionalServices.map(ke)),t}convertValue(t){return typeof t=="string"?er(t):t===void 0?new DataView(new ArrayBuffer(0)):t}convertObject(t){if(t===void 0)return;const e={};for(const i of Object.keys(t))e[i]=this.convertValue(t[i]);return e}},yh=new gh;Us();var sr=class extends q{constructor(t,e){super(),this.client=yh,this.devices={},this.location=!1,this.initialized=!1,this.setupDevice=(i,r)=>new Promise(async(s,n)=>{this.devices[i.deviceId]={device:i,deviceId:i.deviceId,...r},this.client.connect(i.deviceId,a=>{var l;(l=this.devices[i.deviceId])!=null&&l.ondisconnect&&this.devices[i.deviceId].ondisconnect(a)},r==null?void 0:r.connectOptions).then(async()=>{let a=await this.getServices(i.deviceId);for(const l in r==null?void 0:r.services){let c=a.find(f=>{if(f.uuid===l)return!0});if(c)for(const f in r.services[l]){if(!c.characteristics.find(h=>{if(h.uuid===f)return!0}))continue;let u=r.services[l][f];u.write&&await this.write(i,l,f,u.write,u.writeCallback,u.writeOptions),u.read&&await this.read(i,l,f,u.readCallback,u.readOptions),u.notify&&u.notifyCallback&&(await this.subscribe(i,l,f,u.notifyCallback),u.notifying=!0)}}}).catch(n),s(this.devices[i.deviceId])}),this.triangulate=(i,r=1500,s=60)=>new Promise((n,a)=>{if("Accelerometer"in globalThis){if(typeof globalThis.Accelerometer=="function"){let l=new globalThis.Accelerometer({frequency:s}),c=performance.now(),f=c,u=()=>{f-c<r?this.readRssi(i).then(h=>{l.x,l.y,l.z,f=performance.now()}):l.removeEventListener("reading",u)};l.addEventListener("reading",u)}}else a(new Error("No Accelerometer API detected"))}),e&&(this.location=e),t&&this.setup(t)}setup(t,e=this.location){if(t)for(const r in t.services);let i={};return e||(i.androidNeverForLocation=!1),new Promise(async(r,s)=>{if(this.initialized||(await this.client.initialize(i),this.initialized=!0),t!=null&&t.deviceId)r(await this.reconnect(t.deviceId));else if(t){let n=Array.from(Object.keys(t.services)),a={};this.isMobile()||(a.optionalServices=n),t.name&&(a.name=t.name),t.namePrefix&&(a.namePrefix=t.namePrefix),this.client.requestDevice(a).then(l=>{r(this.setupDevice(l,t))}).catch(s)}else this.client.requestDevice().then(n=>{r(this.setupDevice(n,t))}).catch(s)})}initialize(t){return new Promise((e,i)=>{this.client.initialize(t).then(()=>{e(!0)}).catch(i)})}requestDevice(t,e){return new Promise((i,r)=>{this.client.requestDevice(t).then(s=>{this.devices[s.deviceId]={device:s,deviceId:s.deviceId,...e},i(s)}).catch(r)})}getServices(t){return this.client.getServices(t)}connect(t,e){return new Promise((i,r)=>{this.client.connect(t.deviceId,s=>{e!=null&&e.ondisconnect&&e.ondisconnect(s)},e==null?void 0:e.connectOptions).then(s=>{i(t)}).catch(r)})}reconnect(t,e){return new Promise((i,r)=>{var l;let s=this.isAndroid(),n=this.isMobile();console.log(t);let a=e;this.devices[t]&&(a=Object.assign(Object.assign({},this.devices[t]),a)),a!=null&&a.deviceId&&delete a.deviceId,!n&&!((l=navigator.bluetooth)!=null&&l.getDevices)&&this.setup(a).then(c=>{i(c)}),s&&this.client.getDevices([t]).then(c=>{this.setupDevice(c[0],a).then(f=>{i(f)})}).catch(r)})}disconnect(t){if(typeof t=="object"&&t!=null&&t.deviceId&&(t=t.deviceId),typeof t=="string"){let e=this.devices[t];return e.beforedisconnect&&e.beforedisconnect(this,e),delete this.devices[t],this.client.disconnect(t)}}write(t,e,i,r,s,n){return typeof t=="object"&&(t=t.deviceId),s?this.client.write(t,e,i,sr.toDataView(r)).then(s):this.client.writeWithoutResponse(t,e,i,sr.toDataView(r),n)}read(t,e,i,r,s){return typeof t=="object"&&(t=t.deviceId),r?this.client.read(t,e,i,s).then(r):this.client.read(t,e,i,s)}subscribe(t,e,i,r){return typeof t=="object"&&(t=t.deviceId),this.client.startNotifications(t,e,i,r)}unsubscribe(t,e,i){return typeof t=="object"&&(t=t.deviceId),this.client.stopNotifications(t,e,i)}scan(t,e){return this.client.requestLEScan(t,e)}stopScanning(){return this.client.stopLEScan()}readDescriptor(t,e,i,r,s){return this.client.readDescriptor(t.deviceId,e,i,r,s)}writeDescriptor(t,e,i,r,s,n){return this.client.writeDescriptor(t.deviceId,e,i,r,sr.toDataView(s),n)}readRssi(t){return this.client.readRssi(t.deviceId)}isMobile(){let t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t}isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}async distance(t,e,i,r,s){let n=await this.readRssi(t);if(n==0)return;let a=n/e;return a<1?Math.pow(a,10):i*Math.pow(a,r)+s}async distanceFromPhone(t,e,i){let r,s,n;return i&&(i==="nexus5"?(r=.42093,s=6.9476,n=.54992):i==="motoX"?(r=.9401940951,s=6.170094565,n=0):i==="iphone5"&&(r=.89976,s=7.7095,n=.111)),await this.distance(t,e,r,s,n)}},Ai=class extends q{constructor(){super(...arguments),this.streams={},this.createStream=t=>{var i;let e={_id:t._id?t._id:`stream${Math.floor(Math.random()*1e15)}`,info:t.port.getInfo(),running:!1,...t};return(i=t.port)!=null&&i.readable&&(t.transforms?e.reader=Ai.setStreamTransforms(t.port.readable,t.transforms).getReader():e.reader=t.port.readable.getReader()),this.streams[e._id]=e,e}}getPorts(){return navigator.serial.getPorts()}requestPort(t,e){let i={};return t&&(i.usbVendorId=t),e&&(i.usbProductId=e),i.usbVendorId?navigator.serial.requestPort({filters:[i]}):navigator.serial.requestPort()}openPort(t,e){return e&&(e=Object.assign({},e)),e!=null&&e.ondisconnect&&(t.ondisconnect=e.ondisconnect,delete e.ondisconnect),t.open(e).then(()=>{e!=null&&e.onconnect&&e.onconnect(t)})}async readWithTimeout(t,e){const i=t.readable.getReader(),r=setTimeout(()=>{i.releaseLock()},e),s=await i.read();return clearTimeout(r),i.releaseLock(),s}async writePort(t,e){const i=t.writable.getWriter();return await i.write(Ai.toDataView(e)),i.releaseLock(),!0}getSignals(t){return t.getSignals()}setSignals(t,e){return t.setSignals(e)}readStream(t){if(t.reader&&!t.running){let e=t.reader;t.buffering&&(typeof t.buffering!="object"&&(t.buffering={}),t.buffering.buffer||(t.buffering.buffer=[]),t.buffering.searchBytes||(t.buffering.searchBytes=new Uint8Array([13,10])));let i=()=>{if(t.port.readable&&t.running)e.read().then(r=>{if(r.done)e.releaseLock();else{if(t.buffering){t.buffering.buffer.push(...r.value);const n=t.buffering.searchBytes,a=t.buffering.buffer,l=Ai.boyerMoore(n),c=l.byteLength;let f=-1,u=t.buffering.lockIdx??0;for(var s=l(a);s!==-1;s=l(a,s+c))if(!t.buffering.locked&&!("lockIdx"in t.buffering))u=t.buffering.lockIdx=s;else if(f=s,f>=0){const h=f-u;if(t.buffering.locked){if(h>0){const p=t.buffering.buffer.splice(t.buffering.lockIdx,h),y=new Uint8Array(p.slice(t.buffering.searchBytes.length));t.ondata(new Uint8Array(y))}}else{const p=t.buffering.buffer.splice(t.buffering.lockIdx,h),y=new Uint8Array(p.slice(t.buffering.searchBytes.length));t.ondata(y),t.buffering.locked=!0}u=f}}else t.ondata(r.value);setTimeout(()=>{i()},t.frequency)}}).catch(r=>{console.error(t._id," Read error:",r),(r.message.includes("overrun")||r.message.includes("framing"))&&(delete t.reader,this.reconnect(t))});else if(!t.running&&t.port.readable)try{e.releaseLock()}catch(r){console.error(r)}};return t.running=!0,i(),t}}writeStream(t,e){if(typeof t=="string"&&(t=this.streams[t]),t.port.writable){let i=t.port.writable.getWriter();return i.write(Ai.toDataView(e)),i.releaseLock(),!0}}closeStream(t,e){return typeof t=="string"&&(t=this.streams[t]),t.running=!1,new Promise((i,r)=>{t.settings.beforedisconnect&&t.settings.beforedisconnect(this,t.port),setTimeout(async()=>{if(t.port.readable&&t.reader){try{t.reader.releaseLock()}catch(s){console.error(s)}if(t.transforms)try{await t.reader.cancel()}catch(s){console.error(s)}}try{await t.port.close().then(()=>{e&&e(this.streams[t._id])}),delete this.streams[t._id],i(!0)}catch(s){r(s)}},300)})}reconnect(t,e){return typeof t=="string"&&(t=this.streams[t]),new Promise((i,r)=>{if(typeof t!="object"){r(void 0);return}let s=t.port.getInfo();this.closeStream(t._id).then(n=>{setTimeout(()=>{this.getPorts().then(a=>{for(let l=0;l<a.length;l++)a[l].getInfo().usbVendorId===s.usbVendorId&&a[l].getInfo().usbProductId===s.usbProductId&&(e?e._id=t._id:e=t,delete e.port,this.openPort(a[l],e.settings).then(()=>{const c=this.createStream({...e,port:a[l]});this.readStream(c),i(c)}).catch(r))}).catch(r)},100)})})}static setStreamTransforms(t,e){let i=[];Object.keys(e).forEach(s=>{let n=e[s];if(n instanceof TransformStream)i.push(n);else{n.start||(n.start=function(){}),n.flush||(n.flush=function(){});let a=new TransformStream({start:n.start,transform:n.transform,flush:n.flush},n.writableStrategy,n.readableStrategy);i.push(a)}});let r=t;return i.forEach(s=>{r=r.pipeThrough(s)}),r}};function Oi(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let r=0;r<9;r++){let s=r*25;i[0][r]=q.bytesToInt24(e[s],e[s+1],e[s+2]),i[1][r]=q.bytesToInt24(e[s+3],e[s+4],e[s+5]),i[2][r]=q.bytesToInt24(e[s+6],e[s+7],e[s+8]),i[3][r]=q.bytesToInt24(e[s+9],e[s+10],e[s+11]),i[4][r]=q.bytesToInt24(e[s+12],e[s+13],e[s+14]),i[5][r]=q.bytesToInt24(e[s+15],e[s+16],e[s+17]),i[6][r]=q.bytesToInt24(e[s+18],e[s+19],e[s+20]),i[7][r]=q.bytesToInt24(e[s+21],e[s+22],e[s+23])}return i}new TextDecoder;var Vo=250,ut={nSec:10,sps:Vo,units:"mV"},co={lines:{0:JSON.parse(JSON.stringify(ut)),1:JSON.parse(JSON.stringify(ut)),2:JSON.parse(JSON.stringify(ut)),3:JSON.parse(JSON.stringify(ut)),4:JSON.parse(JSON.stringify(ut)),5:JSON.parse(JSON.stringify(ut)),6:JSON.parse(JSON.stringify(ut)),7:JSON.parse(JSON.stringify(ut))}},bh=32,_h=24,mh=1.2,dt={sps:Vo,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*mh/(bh*(Math.pow(2,_h)-1))};JSON.parse(JSON.stringify(dt)),JSON.parse(JSON.stringify(dt)),JSON.parse(JSON.stringify(dt)),JSON.parse(JSON.stringify(dt)),JSON.parse(JSON.stringify(dt)),JSON.parse(JSON.stringify(dt)),JSON.parse(JSON.stringify(dt)),JSON.parse(JSON.stringify(dt));var cs=.002/Math.pow(2,4),Ho=(t,e,i=8)=>{const r=i*3+1,s=(a,l)=>a+l;t.slice(r).reduce(s,0)!==0&&(e.ax=cs*q.bytesToInt16(t[r],t[r+1]),e.ay=cs*q.bytesToInt16(t[r+2],t[r+3]),e.az=cs*q.bytesToInt16(t[r+4],t[r+5]))};function vh(t){let e;t.buffer?e=t:e=new Uint8Array(t);let i={};for(let r=0;r<8;r++){let s=1+3*r;i[r]=q.bytesToInt24(e[s],e[s+1],e[s+2])}return Ho(e,i),i.timestamp=Date.now(),i}function wh(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i={};for(let r=0;r<8;r++){let s=1+3*r;e[0]%2===0?i[r+7]=q.bytesToInt24(e[s],e[s+1],e[s+2]):i[r]=q.bytesToInt24(e[s],e[s+1],e[s+2])}return Ho(e,i),i}var Ci=250,Ts={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:vh,write:"b",beforedisconnect:(t,e)=>{t.writePort(e,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Ci},Sh={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:wh,write:"b",beforedisconnect:(t,e)=>{t.writePort(e,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Ci},pt={nSec:10,sps:Ci,units:"mV"},hs={nSec:10,sps:Ci},kh={lines:{0:JSON.parse(JSON.stringify(pt)),1:JSON.parse(JSON.stringify(pt)),2:JSON.parse(JSON.stringify(pt)),3:JSON.parse(JSON.stringify(pt)),4:JSON.parse(JSON.stringify(pt)),5:JSON.parse(JSON.stringify(pt)),6:JSON.parse(JSON.stringify(pt)),7:JSON.parse(JSON.stringify(pt)),ax:JSON.parse(JSON.stringify(hs)),ay:JSON.parse(JSON.stringify(hs)),az:JSON.parse(JSON.stringify(hs))},generateNewLines:!0},Ne={sps:Ci,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne)),JSON.parse(JSON.stringify(Ne));function Ah(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i={};for(let s=0;s<128;s++){let n=s*3+1;i[s]=q.bytesToInt24(e[n],e[n+1],e[n+2])}let r=385;return i.ax=q.bytesToInt16(e[r],e[r+1]),i.ay=q.bytesToInt16(e[r+2],e[r+3]),i.az=q.bytesToInt16(e[r+4],e[r+5]),i.gx=q.bytesToInt16(e[r+6],e[r+7]),i.gy=q.bytesToInt16(e[r+8],e[r+9]),i.gz=q.bytesToInt16(e[r+10],e[r+11]),i.timestamp=Date.now(),i}var bt=250,xh={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:Ah,sps:bt,buffering:{searchBytes:new Uint8Array([192,160])}},Go={lines:{ax:{nSec:10,sps:bt},ay:{nSec:10,sps:bt},az:{nSec:10,sps:bt},gx:{nSec:10,sps:bt},gy:{nSec:10,sps:bt},gz:{nSec:10,sps:bt}}};for(let t=0;t<128;t++)Go.lines[t]={sps:bt,nSec:10,units:"mV"};function Wo(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i={};for(let s=0;s<32;s++){let n=s*3+1;i[s]=q.bytesToInt24(e[n],e[n+1],e[n+2])}let r=97;return i.ax=q.bytesToInt16(e[r],e[r+1]),i.ay=q.bytesToInt16(e[r+2],e[r+3]),i.az=q.bytesToInt16(e[r+4],e[r+5]),i.gx=q.bytesToInt16(e[r+6],e[r+7]),i.gy=q.bytesToInt16(e[r+8],e[r+9]),i.gz=q.bytesToInt16(e[r+10],e[r+11]),i.timestamp=Date.now(),i}var mr=512,Oh={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:Wo,sps:mr,buffering:{searchBytes:new Uint8Array([192,160])}},Eh={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:Wo,sps:mr,buffering:{searchBytes:new Uint8Array([192,160])}},Wt={nSec:10,sps:mr},Yo={lines:{ax:JSON.parse(JSON.stringify(Wt)),ay:JSON.parse(JSON.stringify(Wt)),az:JSON.parse(JSON.stringify(Wt)),gx:JSON.parse(JSON.stringify(Wt)),gy:JSON.parse(JSON.stringify(Wt)),gz:JSON.parse(JSON.stringify(Wt))}};for(let t=0;t<32;t++)Yo.lines[t]={sps:mr,nSec:10,units:"mV"};var Nh=new TextDecoder;function Xo(t){let e={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0},i=Nh.decode(t),r=i.split("|");if(r.length===3)e.timestamp=Date.now(),e.red=parseInt(r[0]),e.infrared=parseInt(r[1]),e.heg=parseFloat(r[2]);else return r.length>=2?(e.timestamp=Date.now(),e.red=parseInt(r[1]),e.infrared=parseInt(r[2]),e.heg=parseFloat(r[3]),r[4]&&(e.ambient=parseFloat(r[4])),r[5]&&(e.temperature=parseFloat(r[5])),e):i}var vt=40,Vs={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:`t
`,codec:Xo,sps:vt},Ko=Object.assign({},Vs);Ko.sps=19;var Bh={deviceType:"BLE",deviceName:"hegduino",sps:vt,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:Xo,sps:vt}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"},Zo=Object.assign({},Vs);Zo.sps=19;var ho={lines:{red:{nSec:60,sps:vt},ir:{nSec:60,sps:vt},heg:{nSec:60,sps:vt},ambient:{nSec:60,sps:vt},temperature:{nSec:60,sps:vt,units:"C"}}};function Qo(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i=32;const r={red:new Array(i),ir:new Array(i),max_dietemp:q.get2sCompliment(e[193],8)+.0625*e[194],timestamp:Date.now()};let s=0;for(;s<i;){let n=s*6;s%2===0?(r.ir[s]=(e[n+1]<<16|e[n+2]<<8|e[n+3])&524287,r.ir[s+1]=(e[n+4]<<16|e[n+5]<<8|e[n+6])&524287):(r.red[s-1]=(e[n+1]<<16|e[n+2]<<8|e[n+3])&524287,r.red[s]=(e[n+4]<<16|e[n+5]<<8|e[n+6])&524287),s++}return r}var Th={lines:{red:{nSec:10,sps:96},ir:{nSec:10,sps:96},max_dietemp:{nSec:10,sps:3.33,units:"C"}}};function ea(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i={ax:new Array(20),ay:new Array(20),az:new Array(20),gx:new Array(20),gy:new Array(20),gz:new Array(20),mpu_dietemp:(q.bytesToInt16(e[241],e[242])+521)/340+35,timestamp:Date.now()};for(let r=0;r<20;r++){let s=r*12;i.ax[r]=q.bytesToInt16(e[s+1],e[s+2]),i.ay[r]=q.bytesToInt16(e[s+3],e[s+4]),i.az[r]=q.bytesToInt16(e[s+5],e[s+6]),i.gx[r]=q.bytesToInt16(e[s+7],e[s+8]),i.gy[r]=q.bytesToInt16(e[s+9],e[s+10]),i.gz[r]=q.bytesToInt16(e[s+11],e[s+12])}return i}var Yt=100,jh={lines:{ax:{nSec:10,sps:Yt},ay:{nSec:10,sps:Yt},az:{nSec:10,sps:Yt},gx:{nSec:10,sps:Yt},gy:{nSec:10,sps:Yt},gz:{nSec:10,sps:Yt},mpu_dietemp:{nSec:10,sps:5,units:"C"}}};function Ch(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let r=0;r<7;r++){let s=r*26+1;if(!e[s+23])break;i[0][r]=q.bytesToUInt24(e[s],e[s+1],e[s+2]),i[1][r]=q.bytesToUInt24(e[s+3],e[s+4],e[s+5]),i[2][r]=q.bytesToUInt24(e[s+6],e[s+7],e[s+8]),i[3][r]=q.bytesToUInt24(e[s+9],e[s+10],e[s+11]),i[4][r]=q.bytesToUInt24(e[s+12],e[s+13],e[s+14]),i[5][r]=q.bytesToUInt24(e[s+15],e[s+16],e[s+17]),i[6][r]=q.bytesToUInt24(e[s+18],e[s+19],e[s+20]),i[7][r]=q.bytesToUInt24(e[s+21],e[s+22],e[s+23])}return i}var dr=250,Ph={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:!0,notifyCallback:void 0,codec:Ch,sps:dr}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:!0}}},sps:dr},ta=Object.assign({},Ts);ta.sps=dr;ta.deviceName="cognixionONE";var gt={nSec:10,sps:dr,units:"mV"},Lh={lines:{0:JSON.parse(JSON.stringify(gt)),1:JSON.parse(JSON.stringify(gt)),2:JSON.parse(JSON.stringify(gt)),3:JSON.parse(JSON.stringify(gt)),4:JSON.parse(JSON.stringify(gt)),5:JSON.parse(JSON.stringify(gt)),6:JSON.parse(JSON.stringify(gt)),7:JSON.parse(JSON.stringify(gt))}},Ve={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function Ih(t){let e={},i=0;for(;i<t.length;)if(Ve[t[i]]&&i+1+Ve[t[i]].byteLength<=t.length){let r=t.slice(i+1,i+1+Ve[t[i]].byteLength).buffer,s=q.struct(Ve[t[i]].format).unpack(r),n=Ve[t[i]].type;n==="unfilteredHEG"||n==="heg"?s=s[0]/256:(n==="POOR_SIGNAL"||n==="sampleNumber"||n==="debug0"||n==="debug1"||n==="debug2"||n==="debug3")&&(s=s[0]),e[Ve[t[i]].type]?Array.isArray(s)?e[Ve[t[i]].type].push(...s):e[Ve[t[i]].type].push(s):Array.isArray(s)?e[Ve[t[i]].type]=s:e[Ve[t[i]].type]=[s],i+=Ve[t[i]].byteLength+1}else i++;return e.timestamp=Date.now(),e}var Mh={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:`protocol 3
`,buffering:{searchBytes:new Uint8Array([170,170])},codec:Ih,sps:10.101},Dh={lines:{filteredHEG:{sps:10.101,nSec:60},heg:{sps:10.101,nSec:60},debug0:{sps:10.101,nSec:60},debug1:{sps:10.101,nSec:60},debug2:{sps:10.101,nSec:60},debug3:{sps:10.101,nSec:60},debug4:{sps:60.101,nSec:60}},generateNewLines:!1,cleanGeneration:!1},Rh=1013.25,ia=t=>{let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let i={timestamp:Date.now(),temp:[],pressure:[],altitude:[]},r=0;if(e[0].length===74&&(r=1),r){i.humidity=[];for(let s=0;s<3;s++){let n=s*24+2,a=q.bytesToInt32(e[3+n],e[2+n],e[1+n],e[0+n]),l=q.bytesToInt32(e[7+n],e[6+n],e[5+n],e[4+n]);i.temp.push(a+l/Math.pow(10,Math.ceil(Math.log10(l))));let c=10*q.bytesToInt32(e[11+n],e[10+n],e[9+n],e[8+n]),f=q.bytesToInt32(e[15+n],e[14+n],e[13+n],e[12+n]);i.pressure.push(c+f/Math.pow(10,Math.ceil(Math.log10(f))));let u=q.bytesToInt32(e[19+n],e[18+n],e[17+n],e[16+n]),h=q.bytesToInt32(e[23+n],e[22+n],e[21+n],e[20+n]);i.humidity.push(u+h/Math.pow(10,Math.ceil(Math.log10(h)))),i.altitude.push(fo(i.pressure[s],i.temp[s]))}}else for(let s=0;s<3;s++){let n=s*16+2,a=q.bytesToInt32(e[3+n],e[2+n],e[1+n],e[0+n]),l=q.bytesToInt32(e[7+n],e[6+n],e[5+n],e[4+n]);i.temp.push(a+l/Math.pow(10,Math.ceil(Math.log10(l))));let c=10*q.bytesToInt32(e[11+n],e[10+n],e[9+n],e[8+n]),f=q.bytesToInt32(e[15+n],e[14+n],e[13+n],e[12+n]);i.pressure.push(c+f/Math.pow(10,Math.ceil(Math.log10(f)))),i.altitude.push(fo(i.pressure[s],i.temp[s]))}return i};function fo(t,e){return 44330*(1-Math.pow(t/Rh,.1903))}function Fh(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);const i={};if(e[0]===2)Object.assign(i,Oi(e.subarray(2)));else if(e[0]===3){let r=Oi(e.subarray(2));Object.keys(r).forEach((s,n)=>{i[n+8]=r[s]})}else e[0]===4?Object.assign(i,ea(e.subarray(2))):e[0]===5?Object.assign(i,Qo(e.subarray(2))):e[0]===6?Object.assign(i,ia(e.subarray(2))):Object.assign(i,Oi(e));return i}var Uh={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:Fh,sps:250},Jh={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Oi,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Qo,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:ea,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Oi,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:ia,sps:3.33}}}},yt={nSec:10,sps:250,units:"mV"},$h={lines:{0:JSON.parse(JSON.stringify(yt)),1:JSON.parse(JSON.stringify(yt)),2:JSON.parse(JSON.stringify(yt)),3:JSON.parse(JSON.stringify(yt)),4:JSON.parse(JSON.stringify(yt)),5:JSON.parse(JSON.stringify(yt)),6:JSON.parse(JSON.stringify(yt)),7:JSON.parse(JSON.stringify(yt))},generateNewLines:!0,cleanGeneration:!1},zh=32,qh=24,Vh=1.2,Be={sps:250,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*Vh/(zh*(Math.pow(2,qh)-1))};JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be)),JSON.parse(JSON.stringify(Be));var Hh=new TextDecoder;function ra(t){let e={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0},i=Hh.decode(t),r=i.split("|");return r.length>=5?(e.timestamp=Date.now(),e.left_red=parseInt(r[1]),e.left_infrared=parseInt(r[2]),e.left_heg=parseFloat(r[3]),e.center_red=parseInt(r[4]),e.center_infrared=parseInt(r[5]),e.center_heg=parseFloat(r[6]),e.right_red=parseInt(r[7]),e.right_infrared=parseInt(r[8]),e.right_heg=parseFloat(r[9]),e):i}var Gh={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:ra,sps:20},Wh={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:ra}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"},Yh={lines:{left_red:{nSec:60,sps:20},left_infrared:{nSec:60,sps:20},left_heg:{nSec:60,sps:20},center_red:{nSec:60,sps:20},center_infrared:{nSec:60,sps:20},center_heg:{nSec:60,sps:20},right_red:{nSec:60,sps:20},right_infrared:{nSec:60,sps:20},right_heg:{nSec:60,sps:20}}};function Xh(t){let e={red:t.getInt32(2),ir:t.getInt32(6),ir2:t.getInt32(10),timestamp:Date.now()};return e.heg=e.red/(.5*(e.ir+e.ir2)),e}var ti=40,Kh={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:!0,notifyCallback:void 0,codec:Xh,sps:ti}}},sps:ti},Zh={lines:{red:{nSec:60,sps:ti},ir:{nSec:60,sps:ti},ir2:{nSec:60,sps:ti},heg:{nSec:60,sps:ti}}};function Qh(t){let e={sred:t.getInt32(2),sir:t.getInt32(6),sir2:t.getInt32(10),timestamp:Date.now()};return e.sheg=e.sred/(.5*(e.sir+e.sir2)),e}function ef(t){let e={red:t.getInt32(2),ir:t.getInt32(6),ir2:t.getInt32(10),timestamp:Date.now()};return e.heg=e.sred/(.5*(e.ir+e.ir2)),e}var He=40,tf={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:!0,notifyCallback:void 0,codec:ef,sps:He},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:!0,notifyCallback:void 0,codec:Qh,sps:He}}},sps:He},rf={lines:{red:{nSec:60,sps:He},ir:{nSec:60,sps:He},ir2:{nSec:60,sps:He},heg:{nSec:60,sps:He},sred:{nSec:60,sps:He},sir:{nSec:60,sps:He},sir2:{nSec:60,sps:He},sheg:{nSec:60,sps:He}}},Hi={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45};JSON.parse(JSON.stringify(Hi)),JSON.parse(JSON.stringify(Hi)),JSON.parse(JSON.stringify(Hi)),JSON.parse(JSON.stringify(Hi));var Gi={nSec:10,sps:250,units:"mV"},sf={lines:{0:JSON.parse(JSON.stringify(Gi)),1:JSON.parse(JSON.stringify(Gi)),2:JSON.parse(JSON.stringify(Gi)),3:JSON.parse(JSON.stringify(Gi)),ax:{nSec:10,sps:250,units:"mg"},ay:{nSec:10,sps:250,units:"mg"},az:{nSec:10,sps:250,units:"mg"}},generateNewLines:!0},vi={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45};JSON.parse(JSON.stringify(vi)),JSON.parse(JSON.stringify(vi)),JSON.parse(JSON.stringify(vi)),JSON.parse(JSON.stringify(vi)),JSON.parse(JSON.stringify(vi));var nf={lines:{0:{nSec:10,sps:250,units:"uV"},1:{nSec:10,sps:250,units:"uV"},2:{nSec:10,sps:250,units:"uV"},3:{nSec:10,sps:250,units:"uV"},4:{nSec:10,sps:250,units:"uV"},ax:{nSec:10,sps:100,units:"mg"},ay:{nSec:10,sps:100,units:"mg"},az:{nSec:10,sps:100,units:"mg"},gx:{nSec:10,sps:100,units:"rps"},gy:{nSec:10,sps:100,units:"rps"},gz:{nSec:10,sps:100,units:"rps"}},generateNewLines:!0};function of(t){return{hr:t.getInt8(1),timestamp:Date.now()}}var af={deviceType:"BLE",deviceName:"heartrate",services:{heart_rate:{heart_rate_measurement:{notify:!0,notifyCallback:void 0,codec:of}}}},sa={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{0:{sps:250,freq:1,amplitude:1,offset:0},1:{sps:250,freq:10,amplitude:1,offset:0},2:{sps:250,freq:100,amplitude:.5,offset:.5},3:{sps:250,freq:25,amplitude:1,offset:0}},connect:(t={})=>new Promise(async(e,i)=>{let s={_id:`simulated${Math.floor(Math.random()*1e15)}`,settings:Object.assign(Object.assign({},sa),t)};s.settings.looping=!0;let n=50,a=Date.now(),l=()=>{if(s.settings.looping){let c={},f=Date.now(),u=f-a;for(const h in s.settings.simulate){let p=Math.floor(s.settings.simulate[h].sps*u/1e3);c[h]=new Array(p).fill(0),c[h]=c[h].map((y,_)=>Math.sin(2*Math.PI*s.settings.simulate[h].freq*.001*(a+u*(_+1)/p))*s.settings.simulate[h].amplitude+s.settings.simulate[h].offset)}a=f,c.timestamp=a,s.settings.ondata(c),setTimeout(()=>{l()},n)}};l(),s.settings.onconnect&&s.settings.onconnect(s),e(s)}),codec:t=>t,disconnect:t=>{console.log(t),t.settings.looping=!1,t.settings.ondisconnect(t)},onconnect:t=>{console.log("simulator connected!",t)},ondisconnect:t=>{console.log("simulator disconnected!",t)},ondata:t=>{}},na={BLE:{nrf5x:Jh,hegduino:Bh,hegduinoV1:Zo,cognixionONE:Ph,statechanger:Wh,blueberry:Kh,blueberry2:tf,heart_rate:af},USB:{nrf5x:Uh,freeEEG32:Oh,freeEEG32_optical:Eh,freeEEG128:xh,hegduino:Vs,hegduinoV1:Ko,cyton:Ts,cyton_daisy:Sh,peanut:Mh,statechanger:Gh,cognixionONE:Ts},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{simulator:sa}},wi={lines:{0:{nPoints:1e3}},generateNewLines:!0,cleanGeneration:!0},lf={raw:wi,utf8:wi,"console-f12":wi,debug:wi,ads131m08:co,max3010x:Th,mpu6050:jh,freeeeg32:Yo,freeeeg128:Go,cyton:kh,cognixionONE_BLE:Lh,hegduino:ho,hegduinoV1:ho,nrf5x:$h,statechanger:Yh,peanut:Dh,blueberry:Zh,blueberry2:rf,ganglion:sf,muse:nf,arduino_ads131m08:co,simulator:wi};new TextDecoder;var Wi=new sr,oa=new Wc({roots:{...nh,...Hc}});function cf(t,e){var n,a,l,c,f,u,h,p,y;if(!t)return;let i=t.deviceType,r=t.deviceName;e.workerUrl||(e.workerUrl=ah),e.service||(e.service=oa);let s=e.service.addWorker({url:e.workerUrl});if(e.devices||(e.devices=na),!e.devices[i][r]){let _=Object.assign({},t);for(const m in _)typeof _[m]=="function"&&(_[m]=_[m].toString());s.send({route:"receiveDevice",args:_})}if(e.roots){for(const _ in e.roots){let m={callback:"decodeAndParseDevice",worker:s};e.roots[_].__parent=e.roots[_].__parent?Object.assign(e.roots[_].__parent,m):m}e.service.load(e.roots)}if(i.includes("CUSTOM"))return new Promise(async(_,m)=>{t.ondata=E=>{s.run("decodeAndParseDevice",[E,i,r]).then(L=>{typeof e.ondecoded=="function"&&e.ondecoded(L)})},t.ondisconnect=()=>{if(e.service.terminate(s._id),e.roots)for(const E in e.roots)e.service.remove(E)};let A=await t.connect(t),O={workers:{streamworker:s},disconnect:()=>{if(e.beforedisconnect&&e.beforedisconnect(O),t.disconnect(A),e.ondisconnect&&e.ondisconnect(O),e.roots)for(const E in e.roots)e.service.remove(E)},device:A,options:e,read:E=>{if(t.read)return new Promise((L,H)=>{L(t.read(t,E))})},write:E=>{if(t.write)return new Promise((L,H)=>{L(t.write(t,E))})},roots:e.roots};e.onconnect&&e.onconnect(O),_(O)}).catch(_=>{if(console.error(_),e.service.terminate(s._id),e.roots)for(const m in e.roots)e.service.remove(m)});if(i==="BLE"){for(const _ in t.services)for(const m in t.services[_])if(typeof e.ondecoded=="function"){if((l=(a=(n=t.services)==null?void 0:n[_])==null?void 0:a[m])!=null&&l.notify){t.services[_][m].notifyCallback||(t.services[_][m].notifyCallback=A=>{s.run("decodeAndParseDevice",[A,i,r,_,m],void 0,[A.buffer]).then(e.ondecoded)});break}}else typeof e.ondecoded=="object"&&e.ondecoded[m]&&((u=(f=(c=t.services)==null?void 0:c[_])==null?void 0:f[m])!=null&&u.notify&&(t.services[_][m].notifyCallback||(t.services[_][m].notifyCallback=A=>{s.run("decodeAndParseDevice",[A,i,r,_,m],void 0,[A.buffer]).then(e.ondecoded[m])})),(y=(p=(h=t.services)==null?void 0:h[_])==null?void 0:p[m])!=null&&y.read&&(t.services[_][m].readCallback||(t.services[m].readCallback=A=>{s.run("decodeAndParseDevice",[A,i,r,_,m],void 0,[A.buffer]).then(e.ondecoded[m])})));return new Promise((_,m)=>{Wi.setup(t).then(A=>{let O={workers:{streamworker:s},options:e,device:A,disconnect:async()=>{if(await Wi.disconnect(A.deviceId),e.ondisconnect&&e.ondisconnect(O),s.terminate(),e.roots)for(const E in e.roots)e.service.remove(E)},read:E=>Wi.read(A.device,E.service,E.characteristic,E.ondata,E.timeout),write:E=>Wi.write(A.device,E.service,E.characteristic,E.data,E.callback,E.timeout),roots:e.roots};e.onconnect&&e.onconnect(O),_(O)}).catch(A=>{if(console.error(A),s.terminate(),e.roots)for(const O in e.roots)e.service.remove(O);m(A)})})}else if(i==="USB"){let _=e.service.addWorker({url:e.workerUrl});_.worker.addEventListener("message",O=>{if(typeof O.data=="string"&&O.data.includes("disconnected")&&(e.service.terminate(_._id),e.service.terminate(s._id),e.roots))for(const E in e.roots)e.service.remove(E)}),_.post("setupSerial");let m=e.service.establishMessageChannel(s.worker,_.worker);const A=new Ai;return new Promise((O,E)=>{A.requestPort(t.usbVendorId,t.usbProductId).then(L=>{let H=L.getInfo();_.run("openPort",{baudRate:t.baudRate,usbVendorId:H.usbVendorId,usbProductId:H.usbProductId,bufferSize:t.bufferSize,buffering:t.buffering?t.buffering:void 0,frequency:t.frequency?t.frequency:void 0,pipeTo:{route:"decodeAndParseDevice",_id:m,extraArgs:[i,r]}}).then(K=>{t.write&&_.post("writeStream",[K._id,t.write]),typeof e.ondecoded=="function"&&s.subscribe("decodeAndParseDevice",e.ondecoded);let le={workers:{streamworker:s,serialworker:_},device:K,options:e,disconnect:()=>{_.post("closeStream",K._id),e.ondisconnect&&e.ondisconnect(le)},read:()=>new Promise((V,G)=>{let ye;ye=s.subscribe("decodeAndParseDevice",pe=>{_.unsubscribe("decodeAndParseDevice",ye),V(pe)})}),write:V=>_.run("writeStream",[K._id,V]),roots:e.roots};e.onconnect&&e.onconnect(le),O(le)})}).catch(L=>{if(console.error(L),e.service.terminate(_._id),e.service.terminate(s._id),e.roots)for(const H in e.roots)e.service.remove(H);E(L)})})}else return}/*! Capacitor: https://capacitorjs.com/ - MIT License */let nr=null;const fs={BLE:{hegduino:"HEGduino",hegduinoV1:"HEGduino V1",statechanger:"Statechanger",blueberry2:"Blueberry",blueberry:"Blueberry V1",nrf5x:"NRF5x"},USB:{hegduino:"HEGduino",hegduinoV1:"HEGduino V1",peanut:"Biocomp Peanut",statechanger:"Statechanger",nrf5x:"NRF5x"}},hf=async(t,e)=>{if(nr)throw new Error("Already connected to a device");const i=await cf(na[t][e],{ondecoded:r=>{Ji({decoded:r})},ondisconnect:()=>{nr=null,Ji({status:"disconnected"})},onconnect:r=>{nr=r,Ji({status:"connected"})}});return Ji({device:i}),i};var ff=Object.create,Hs=Object.defineProperty,uf=Object.getOwnPropertyDescriptor,aa=Object.getOwnPropertyNames,df=Object.getPrototypeOf,pf=Object.prototype.hasOwnProperty,gf=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof require<"u"?require:e)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')}),yf=(t,e)=>function(){return e||(0,t[aa(t)[0]])((e={exports:{}}).exports,e),e.exports},bf=(t,e)=>{for(var i in e)Hs(t,i,{get:e[i],enumerable:!0})},_f=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of aa(e))!pf.call(t,s)&&s!==i&&Hs(t,s,{get:()=>e[s],enumerable:!(r=uf(e,s))||r.enumerable});return t},mf=(t,e,i)=>(i=t!=null?ff(df(t)):{},_f(e||!t||!t.__esModule?Hs(i,"default",{value:t,enumerable:!0}):i,t)),vf=yf({"struct/datastructures/bson.cjs"(t){var Ln;var e=5,i=2147483647,r=-2147483648,s=Math.pow(2,63)-1,n=-Math.pow(2,63),a=Math.pow(2,53),l=-Math.pow(2,53),c=1,f=2,u=3,h=4,p=5,y=6,_=7,m=8,A=9,O=10,E=11,L=12,H=13,K=14,le=15,V=16,G=17,ye=18,pe=19,ee=255,$=127,ae=0,Ye=4,Xe=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127}),C=class extends Error{get bsonError(){return!0}get name(){return"BSONError"}constructor(o){super(o)}static isBSONError(o){return o!=null&&typeof o=="object"&&"bsonError"in o&&o.bsonError===!0&&"name"in o&&"message"in o&&"stack"in o}},Ce=class extends C{get name(){return"BSONVersionError"}constructor(){super(`Unsupported BSON version, bson types must be from bson ${e}.0 or later`)}},Je=class extends C{get name(){return"BSONRuntimeError"}constructor(o){super(o)}};function Ke(o){return ie.fromNumberArray(Array.from({length:o},()=>Math.floor(Math.random()*256)))}var ge=(()=>{try{return gf("crypto").randomBytes}catch{return Ke}})(),ie={toLocalBufferType(o){if(Buffer.isBuffer(o))return o;if(ArrayBuffer.isView(o))return Buffer.from(o.buffer,o.byteOffset,o.byteLength);const d=(o==null?void 0:o[Symbol.toStringTag])??Object.prototype.toString.call(o);if(d==="ArrayBuffer"||d==="SharedArrayBuffer"||d==="[object ArrayBuffer]"||d==="[object SharedArrayBuffer]")return Buffer.from(o);throw new C(`Cannot create Buffer from ${String(o)}`)},allocate(o){return Buffer.alloc(o)},equals(o,d){return ie.toLocalBufferType(o).equals(d)},fromNumberArray(o){return Buffer.from(o)},fromBase64(o){return Buffer.from(o,"base64")},toBase64(o){return ie.toLocalBufferType(o).toString("base64")},fromISO88591(o){return Buffer.from(o,"binary")},toISO88591(o){return ie.toLocalBufferType(o).toString("binary")},fromHex(o){return Buffer.from(o,"hex")},toHex(o){return ie.toLocalBufferType(o).toString("hex")},fromUTF8(o){return Buffer.from(o,"utf8")},toUTF8(o){return ie.toLocalBufferType(o).toString("utf8")},utf8ByteLength(o){return Buffer.byteLength(o,"utf8")},encodeUTF8Into(o,d,b){return ie.toLocalBufferType(o).write(d,b,void 0,"utf8")},randomBytes:ge};function Pe(){const{navigator:o}=globalThis;return typeof o=="object"&&o.product==="ReactNative"}function Te(o){if(o<0)throw new RangeError(`The argument 'byteLength' is invalid. Received ${o}`);return Le.fromNumberArray(Array.from({length:o},()=>Math.floor(Math.random()*256)))}var Fe=(()=>{var d;const{crypto:o}=globalThis;if(o!=null&&typeof o.getRandomValues=="function")return b=>o.getRandomValues(Le.allocate(b));if(Pe()){const{console:b}=globalThis;(d=b==null?void 0:b.warn)==null||d.call(b,"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return Te})(),Oe=/(\d|[a-f])/i,Le={toLocalBufferType(o){const d=(o==null?void 0:o[Symbol.toStringTag])??Object.prototype.toString.call(o);if(d==="Uint8Array")return o;if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength));if(d==="ArrayBuffer"||d==="SharedArrayBuffer"||d==="[object ArrayBuffer]"||d==="[object SharedArrayBuffer]")return new Uint8Array(o);throw new C(`Cannot make a Uint8Array from ${String(o)}`)},allocate(o){if(typeof o!="number")throw new TypeError(`The "size" argument must be of type number. Received ${String(o)}`);return new Uint8Array(o)},equals(o,d){if(o.byteLength!==d.byteLength)return!1;for(let b=0;b<o.byteLength;b++)if(o[b]!==d[b])return!1;return!0},fromNumberArray(o){return Uint8Array.from(o)},fromBase64(o){return Uint8Array.from(atob(o),d=>d.charCodeAt(0))},toBase64(o){return btoa(Le.toISO88591(o))},fromISO88591(o){return Uint8Array.from(o,d=>d.charCodeAt(0)&255)},toISO88591(o){return Array.from(Uint16Array.from(o),d=>String.fromCharCode(d)).join("")},fromHex(o){const d=o.length%2===0?o:o.slice(0,o.length-1),b=[];for(let g=0;g<d.length;g+=2){const k=d[g],B=d[g+1];if(!Oe.test(k)||!Oe.test(B))break;const T=Number.parseInt(`${k}${B}`,16);b.push(T)}return Uint8Array.from(b)},toHex(o){return Array.from(o,d=>d.toString(16).padStart(2,"0")).join("")},fromUTF8(o){return new TextEncoder().encode(o)},toUTF8(o){return new TextDecoder("utf8",{fatal:!1}).decode(o)},utf8ByteLength(o){return Le.fromUTF8(o).byteLength},encodeUTF8Into(o,d,b){const g=Le.fromUTF8(d);return o.set(g,b),g.byteLength},randomBytes:Fe},Qe=typeof Buffer=="function"&&((Ln=Buffer.prototype)==null?void 0:Ln._isBuffer)!==!0,N=Qe?ie:Le,At=class extends DataView{static fromUint8Array(o){return new DataView(o.buffer,o.byteOffset,o.byteLength)}},Pi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,sn=o=>typeof o=="string"&&Pi.test(o),Sr=o=>{if(!sn(o))throw new C('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');const d=o.replace(/-/g,"");return N.fromHex(d)};function nn(o,d=!0){return d?[N.toHex(o.subarray(0,4)),N.toHex(o.subarray(4,6)),N.toHex(o.subarray(6,8)),N.toHex(o.subarray(8,10)),N.toHex(o.subarray(10,16))].join("-"):N.toHex(o)}function on(o){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(o))}function ct(o){return Object.prototype.toString.call(o)==="[object Uint8Array]"}function Rt(o){return Object.prototype.toString.call(o)==="[object RegExp]"}function an(o){return Object.prototype.toString.call(o)==="[object Map]"}function Ft(o){return Object.prototype.toString.call(o)==="[object Date]"}var Ie=class{get[Symbol.for("@@mdb.bson.version")](){return e}},oe=class extends Ie{get _bsontype(){return"Binary"}constructor(o,d){if(super(),o!=null&&typeof o!="string"&&!ArrayBuffer.isView(o)&&!(o instanceof ArrayBuffer)&&!Array.isArray(o))throw new C("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=d??oe.BSON_BINARY_SUBTYPE_DEFAULT,o==null?(this.buffer=N.allocate(oe.BUFFER_SIZE),this.position=0):(typeof o=="string"?this.buffer=N.fromISO88591(o):Array.isArray(o)?this.buffer=N.fromNumberArray(o):this.buffer=N.toLocalBufferType(o),this.position=this.buffer.byteLength)}put(o){if(typeof o=="string"&&o.length!==1)throw new C("only accepts single character String");if(typeof o!="number"&&o.length!==1)throw new C("only accepts single character Uint8Array or Array");let d;if(typeof o=="string"?d=o.charCodeAt(0):typeof o=="number"?d=o:d=o[0],d<0||d>255)throw new C("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.byteLength>this.position)this.buffer[this.position++]=d;else{const b=N.allocate(oe.BUFFER_SIZE+this.buffer.length);b.set(this.buffer,0),this.buffer=b,this.buffer[this.position++]=d}}write(o,d){if(d=typeof d=="number"?d:this.position,this.buffer.byteLength<d+o.length){const b=N.allocate(this.buffer.byteLength+o.length);b.set(this.buffer,0),this.buffer=b}if(ArrayBuffer.isView(o))this.buffer.set(N.toLocalBufferType(o),d),this.position=d+o.byteLength>this.position?d+o.length:this.position;else if(typeof o=="string"){const b=N.fromISO88591(o);this.buffer.set(b,d),this.position=d+o.length>this.position?d+o.length:this.position}}read(o,d){return d=d&&d>0?d:this.position,this.buffer.slice(o,o+d)}value(o){return o=!!o,o&&this.buffer.length===this.position?this.buffer:o?this.buffer.slice(0,this.position):N.toISO88591(this.buffer.subarray(0,this.position))}length(){return this.position}toJSON(){return N.toBase64(this.buffer)}toString(o){return o==="hex"?N.toHex(this.buffer):o==="base64"?N.toBase64(this.buffer):o==="utf8"||o==="utf-8"?N.toUTF8(this.buffer):N.toUTF8(this.buffer)}toExtendedJSON(o){o=o||{};const d=N.toBase64(this.buffer),b=Number(this.sub_type).toString(16);return o.legacy?{$binary:d,$type:b.length===1?"0"+b:b}:{$binary:{base64:d,subType:b.length===1?"0"+b:b}}}toUUID(){if(this.sub_type===oe.SUBTYPE_UUID)return new De(this.buffer.slice(0,this.position));throw new C(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${oe.SUBTYPE_UUID}" is currently supported.`)}static fromExtendedJSON(o,d){d=d||{};let b,g;if("$binary"in o?d.legacy&&typeof o.$binary=="string"&&"$type"in o?(g=o.$type?parseInt(o.$type,16):0,b=N.fromBase64(o.$binary)):typeof o.$binary!="string"&&(g=o.$binary.subType?parseInt(o.$binary.subType,16):0,b=N.fromBase64(o.$binary.base64)):"$uuid"in o&&(g=4,b=Sr(o.$uuid)),!b)throw new C(`Unexpected Binary Extended JSON format ${JSON.stringify(o)}`);return g===Ye?new De(b):new oe(b,g)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Binary(Buffer.from("${N.toHex(this.buffer)}", "hex"), ${this.sub_type})`}};oe.BSON_BINARY_SUBTYPE_DEFAULT=0,oe.BUFFER_SIZE=256,oe.SUBTYPE_DEFAULT=0,oe.SUBTYPE_FUNCTION=1,oe.SUBTYPE_BYTE_ARRAY=2,oe.SUBTYPE_UUID_OLD=3,oe.SUBTYPE_UUID=4,oe.SUBTYPE_MD5=5,oe.SUBTYPE_ENCRYPTED=6,oe.SUBTYPE_COLUMN=7,oe.SUBTYPE_USER_DEFINED=128;var kr=16,De=class extends oe{constructor(o){let d,b;if(o==null)d=De.generate();else if(o instanceof De)d=N.toLocalBufferType(new Uint8Array(o.buffer)),b=o.__id;else if(ArrayBuffer.isView(o)&&o.byteLength===kr)d=N.toLocalBufferType(o);else if(typeof o=="string")d=Sr(o);else throw new C("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");super(d,Ye),this.__id=b}get id(){return this.buffer}set id(o){this.buffer=o,De.cacheHexString&&(this.__id=nn(o))}toHexString(o=!0){if(De.cacheHexString&&this.__id)return this.__id;const d=nn(this.id,o);return De.cacheHexString&&(this.__id=d),d}toString(o){return o==="hex"?N.toHex(this.id):o==="base64"?N.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(o){if(!o)return!1;if(o instanceof De)return N.equals(o.id,this.id);try{return N.equals(new De(o).id,this.id)}catch{return!1}}toBinary(){return new oe(this.id,oe.SUBTYPE_UUID)}static generate(){const o=N.randomBytes(kr);return o[6]=o[6]&15|64,o[8]=o[8]&63|128,o}static isValid(o){return o?o instanceof De?!0:typeof o=="string"?sn(o):ct(o)?o.byteLength!==kr?!1:(o[6]&240)===64&&(o[8]&128)===128:!1:!1}static createFromHexString(o){const d=Sr(o);return new De(d)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new UUID("${this.toHexString()}")`}},ht=class extends Ie{get _bsontype(){return"Code"}constructor(o,d){super(),this.code=o.toString(),this.scope=d??null}toJSON(){return this.scope!=null?{code:this.code,scope:this.scope}:{code:this.code}}toExtendedJSON(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}static fromExtendedJSON(o){return new ht(o.$code,o.$scope)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){const o=this.toJSON();return`new Code("${String(o.code)}"${o.scope!=null?`, ${JSON.stringify(o.scope)}`:""})`}};function ln(o){return o!=null&&typeof o=="object"&&"$id"in o&&o.$id!=null&&"$ref"in o&&typeof o.$ref=="string"&&(!("$db"in o)||"$db"in o&&typeof o.$db=="string")}var et=class extends Ie{get _bsontype(){return"DBRef"}constructor(o,d,b,g){super();const k=o.split(".");k.length===2&&(b=k.shift(),o=k.shift()),this.collection=o,this.oid=d,this.db=b,this.fields=g||{}}get namespace(){return this.collection}set namespace(o){this.collection=o}toJSON(){const o=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(o.$db=this.db),o}toExtendedJSON(o){o=o||{};let d={$ref:this.collection,$id:this.oid};return o.legacy||(this.db&&(d.$db=this.db),d=Object.assign(d,this.fields)),d}static fromExtendedJSON(o){const d=Object.assign({},o);return delete d.$ref,delete d.$id,delete d.$db,new et(o.$ref,o.$id,o.$db,d)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){const o=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return`new DBRef("${this.namespace}", new ObjectId("${String(o)}")${this.db?`, "${this.db}"`:""})`}},Ue=void 0;try{Ue=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var cn=1<<16,Xa=1<<24,Ut=cn*cn,hn=Ut*Ut,fn=hn/2,un={},dn={},Ka=20,Za=/^(\+?0|(\+|-)?[1-9][0-9]*)$/,w=class extends Ie{get _bsontype(){return"Long"}get __isLong__(){return!0}constructor(o=0,d,b){super(),typeof o=="bigint"?Object.assign(this,w.fromBigInt(o,!!d)):typeof o=="string"?Object.assign(this,w.fromString(o,!!d)):(this.low=o|0,this.high=d|0,this.unsigned=!!b)}static fromBits(o,d,b){return new w(o,d,b)}static fromInt(o,d){let b,g,k;return d?(o>>>=0,(k=0<=o&&o<256)&&(g=dn[o],g)?g:(b=w.fromBits(o,(o|0)<0?-1:0,!0),k&&(dn[o]=b),b)):(o|=0,(k=-128<=o&&o<128)&&(g=un[o],g)?g:(b=w.fromBits(o,o<0?-1:0,!1),k&&(un[o]=b),b))}static fromNumber(o,d){if(isNaN(o))return d?w.UZERO:w.ZERO;if(d){if(o<0)return w.UZERO;if(o>=hn)return w.MAX_UNSIGNED_VALUE}else{if(o<=-fn)return w.MIN_VALUE;if(o+1>=fn)return w.MAX_VALUE}return o<0?w.fromNumber(-o,d).neg():w.fromBits(o%Ut|0,o/Ut|0,d)}static fromBigInt(o,d){return w.fromString(o.toString(),d)}static fromString(o,d,b){if(o.length===0)throw new C("empty string");if(o==="NaN"||o==="Infinity"||o==="+Infinity"||o==="-Infinity")return w.ZERO;if(typeof d=="number"?(b=d,d=!1):d=!!d,b=b||10,b<2||36<b)throw new C("radix");let g;if((g=o.indexOf("-"))>0)throw new C("interior hyphen");if(g===0)return w.fromString(o.substring(1),d,b).neg();const k=w.fromNumber(Math.pow(b,8));let B=w.ZERO;for(let T=0;T<o.length;T+=8){const F=Math.min(8,o.length-T),S=parseInt(o.substring(T,T+F),b);if(F<8){const D=w.fromNumber(Math.pow(b,F));B=B.mul(D).add(w.fromNumber(S))}else B=B.mul(k),B=B.add(w.fromNumber(S))}return B.unsigned=d,B}static fromBytes(o,d,b){return b?w.fromBytesLE(o,d):w.fromBytesBE(o,d)}static fromBytesLE(o,d){return new w(o[0]|o[1]<<8|o[2]<<16|o[3]<<24,o[4]|o[5]<<8|o[6]<<16|o[7]<<24,d)}static fromBytesBE(o,d){return new w(o[4]<<24|o[5]<<16|o[6]<<8|o[7],o[0]<<24|o[1]<<16|o[2]<<8|o[3],d)}static isLong(o){return o!=null&&typeof o=="object"&&"__isLong__"in o&&o.__isLong__===!0}static fromValue(o,d){return typeof o=="number"?w.fromNumber(o,d):typeof o=="string"?w.fromString(o,d):w.fromBits(o.low,o.high,typeof d=="boolean"?d:o.unsigned)}add(o){w.isLong(o)||(o=w.fromValue(o));const d=this.high>>>16,b=this.high&65535,g=this.low>>>16,k=this.low&65535,B=o.high>>>16,T=o.high&65535,F=o.low>>>16,S=o.low&65535;let D=0,P=0,j=0,I=0;return I+=k+S,j+=I>>>16,I&=65535,j+=g+F,P+=j>>>16,j&=65535,P+=b+T,D+=P>>>16,P&=65535,D+=d+B,D&=65535,w.fromBits(j<<16|I,D<<16|P,this.unsigned)}and(o){return w.isLong(o)||(o=w.fromValue(o)),w.fromBits(this.low&o.low,this.high&o.high,this.unsigned)}compare(o){if(w.isLong(o)||(o=w.fromValue(o)),this.eq(o))return 0;const d=this.isNegative(),b=o.isNegative();return d&&!b?-1:!d&&b?1:this.unsigned?o.high>>>0>this.high>>>0||o.high===this.high&&o.low>>>0>this.low>>>0?-1:1:this.sub(o).isNegative()?-1:1}comp(o){return this.compare(o)}divide(o){if(w.isLong(o)||(o=w.fromValue(o)),o.isZero())throw new C("division by zero");if(Ue){if(!this.unsigned&&this.high===-2147483648&&o.low===-1&&o.high===-1)return this;const k=(this.unsigned?Ue.div_u:Ue.div_s)(this.low,this.high,o.low,o.high);return w.fromBits(k,Ue.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w.UZERO:w.ZERO;let d,b,g;if(this.unsigned){if(o.unsigned||(o=o.toUnsigned()),o.gt(this))return w.UZERO;if(o.gt(this.shru(1)))return w.UONE;g=w.UZERO}else{if(this.eq(w.MIN_VALUE))return o.eq(w.ONE)||o.eq(w.NEG_ONE)?w.MIN_VALUE:o.eq(w.MIN_VALUE)?w.ONE:(d=this.shr(1).div(o).shl(1),d.eq(w.ZERO)?o.isNegative()?w.ONE:w.NEG_ONE:(b=this.sub(o.mul(d)),g=d.add(b.div(o)),g));if(o.eq(w.MIN_VALUE))return this.unsigned?w.UZERO:w.ZERO;if(this.isNegative())return o.isNegative()?this.neg().div(o.neg()):this.neg().div(o).neg();if(o.isNegative())return this.div(o.neg()).neg();g=w.ZERO}for(b=this;b.gte(o);){d=Math.max(1,Math.floor(b.toNumber()/o.toNumber()));const k=Math.ceil(Math.log(d)/Math.LN2),B=k<=48?1:Math.pow(2,k-48);let T=w.fromNumber(d),F=T.mul(o);for(;F.isNegative()||F.gt(b);)d-=B,T=w.fromNumber(d,this.unsigned),F=T.mul(o);T.isZero()&&(T=w.ONE),g=g.add(T),b=b.sub(F)}return g}div(o){return this.divide(o)}equals(o){return w.isLong(o)||(o=w.fromValue(o)),this.unsigned!==o.unsigned&&this.high>>>31===1&&o.high>>>31===1?!1:this.high===o.high&&this.low===o.low}eq(o){return this.equals(o)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq(w.MIN_VALUE)?64:this.neg().getNumBitsAbs();const o=this.high!==0?this.high:this.low;let d;for(d=31;d>0&&!(o&1<<d);d--);return this.high!==0?d+33:d+1}greaterThan(o){return this.comp(o)>0}gt(o){return this.greaterThan(o)}greaterThanOrEqual(o){return this.comp(o)>=0}gte(o){return this.greaterThanOrEqual(o)}ge(o){return this.greaterThanOrEqual(o)}isEven(){return(this.low&1)===0}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return(this.low&1)===1}isPositive(){return this.unsigned||this.high>=0}isZero(){return this.high===0&&this.low===0}lessThan(o){return this.comp(o)<0}lt(o){return this.lessThan(o)}lessThanOrEqual(o){return this.comp(o)<=0}lte(o){return this.lessThanOrEqual(o)}modulo(o){if(w.isLong(o)||(o=w.fromValue(o)),Ue){const d=(this.unsigned?Ue.rem_u:Ue.rem_s)(this.low,this.high,o.low,o.high);return w.fromBits(d,Ue.get_high(),this.unsigned)}return this.sub(this.div(o).mul(o))}mod(o){return this.modulo(o)}rem(o){return this.modulo(o)}multiply(o){if(this.isZero())return w.ZERO;if(w.isLong(o)||(o=w.fromValue(o)),Ue){const z=Ue.mul(this.low,this.high,o.low,o.high);return w.fromBits(z,Ue.get_high(),this.unsigned)}if(o.isZero())return w.ZERO;if(this.eq(w.MIN_VALUE))return o.isOdd()?w.MIN_VALUE:w.ZERO;if(o.eq(w.MIN_VALUE))return this.isOdd()?w.MIN_VALUE:w.ZERO;if(this.isNegative())return o.isNegative()?this.neg().mul(o.neg()):this.neg().mul(o).neg();if(o.isNegative())return this.mul(o.neg()).neg();if(this.lt(w.TWO_PWR_24)&&o.lt(w.TWO_PWR_24))return w.fromNumber(this.toNumber()*o.toNumber(),this.unsigned);const d=this.high>>>16,b=this.high&65535,g=this.low>>>16,k=this.low&65535,B=o.high>>>16,T=o.high&65535,F=o.low>>>16,S=o.low&65535;let D=0,P=0,j=0,I=0;return I+=k*S,j+=I>>>16,I&=65535,j+=g*S,P+=j>>>16,j&=65535,j+=k*F,P+=j>>>16,j&=65535,P+=b*S,D+=P>>>16,P&=65535,P+=g*F,D+=P>>>16,P&=65535,P+=k*T,D+=P>>>16,P&=65535,D+=d*S+b*F+g*T+k*B,D&=65535,w.fromBits(j<<16|I,D<<16|P,this.unsigned)}mul(o){return this.multiply(o)}negate(){return!this.unsigned&&this.eq(w.MIN_VALUE)?w.MIN_VALUE:this.not().add(w.ONE)}neg(){return this.negate()}not(){return w.fromBits(~this.low,~this.high,this.unsigned)}notEquals(o){return!this.equals(o)}neq(o){return this.notEquals(o)}ne(o){return this.notEquals(o)}or(o){return w.isLong(o)||(o=w.fromValue(o)),w.fromBits(this.low|o.low,this.high|o.high,this.unsigned)}shiftLeft(o){return w.isLong(o)&&(o=o.toInt()),(o&=63)===0?this:o<32?w.fromBits(this.low<<o,this.high<<o|this.low>>>32-o,this.unsigned):w.fromBits(0,this.low<<o-32,this.unsigned)}shl(o){return this.shiftLeft(o)}shiftRight(o){return w.isLong(o)&&(o=o.toInt()),(o&=63)===0?this:o<32?w.fromBits(this.low>>>o|this.high<<32-o,this.high>>o,this.unsigned):w.fromBits(this.high>>o-32,this.high>=0?0:-1,this.unsigned)}shr(o){return this.shiftRight(o)}shiftRightUnsigned(o){if(w.isLong(o)&&(o=o.toInt()),o&=63,o===0)return this;{const d=this.high;if(o<32){const b=this.low;return w.fromBits(b>>>o|d<<32-o,d>>>o,this.unsigned)}else return o===32?w.fromBits(d,0,this.unsigned):w.fromBits(d>>>o-32,0,this.unsigned)}}shr_u(o){return this.shiftRightUnsigned(o)}shru(o){return this.shiftRightUnsigned(o)}subtract(o){return w.isLong(o)||(o=w.fromValue(o)),this.add(o.neg())}sub(o){return this.subtract(o)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*Ut+(this.low>>>0):this.high*Ut+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(o){return o?this.toBytesLE():this.toBytesBE()}toBytesLE(){const o=this.high,d=this.low;return[d&255,d>>>8&255,d>>>16&255,d>>>24,o&255,o>>>8&255,o>>>16&255,o>>>24]}toBytesBE(){const o=this.high,d=this.low;return[o>>>24,o>>>16&255,o>>>8&255,o&255,d>>>24,d>>>16&255,d>>>8&255,d&255]}toSigned(){return this.unsigned?w.fromBits(this.low,this.high,!1):this}toString(o){if(o=o||10,o<2||36<o)throw new C("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(w.MIN_VALUE)){const k=w.fromNumber(o),B=this.div(k),T=B.mul(k).sub(this);return B.toString(o)+T.toInt().toString(o)}else return"-"+this.neg().toString(o);const d=w.fromNumber(Math.pow(o,6),this.unsigned);let b=this,g="";for(;;){const k=b.div(d);let T=(b.sub(k.mul(d)).toInt()>>>0).toString(o);if(b=k,b.isZero())return T+g;for(;T.length<6;)T="0"+T;g=""+T+g}}toUnsigned(){return this.unsigned?this:w.fromBits(this.low,this.high,!0)}xor(o){return w.isLong(o)||(o=w.fromValue(o)),w.fromBits(this.low^o.low,this.high^o.high,this.unsigned)}eqz(){return this.isZero()}le(o){return this.lessThanOrEqual(o)}toExtendedJSON(o){return o&&o.relaxed?this.toNumber():{$numberLong:this.toString()}}static fromExtendedJSON(o,d){const{useBigInt64:b=!1,relaxed:g=!0}={...d};if(o.$numberLong.length>Ka)throw new C("$numberLong string is too long");if(!Za.test(o.$numberLong))throw new C(`$numberLong string "${o.$numberLong}" is in an invalid format`);if(b){const B=BigInt(o.$numberLong);return BigInt.asIntN(64,B)}const k=w.fromString(o.$numberLong);return g?k.toNumber():k}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Long("${this.toString()}"${this.unsigned?", true":""})`}};w.TWO_PWR_24=w.fromInt(Xa),w.MAX_UNSIGNED_VALUE=w.fromBits(-1,-1,!0),w.ZERO=w.fromInt(0),w.UZERO=w.fromInt(0,!0),w.ONE=w.fromInt(1),w.UONE=w.fromInt(1,!0),w.NEG_ONE=w.fromInt(-1),w.MAX_VALUE=w.fromBits(-1,2147483647,!1),w.MIN_VALUE=w.fromBits(0,-2147483648,!1);var Qa=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,el=/^(\+|-)?(Infinity|inf)$/i,tl=/^(\+|-)?NaN$/i,ui=6111,Ar=-6176,pn=6176,il=34,xr=N.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),gn=N.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),yn=N.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),rl=/^([-+])?(\d+)?$/,sl=31,bn=16383,nl=30,ol=31;function _n(o){return!isNaN(parseInt(o,10))}function al(o){const d=w.fromNumber(1e9);let b=w.fromNumber(0);if(!o.parts[0]&&!o.parts[1]&&!o.parts[2]&&!o.parts[3])return{quotient:o,rem:b};for(let g=0;g<=3;g++)b=b.shiftLeft(32),b=b.add(new w(o.parts[g],0)),o.parts[g]=b.div(d).low,b=b.modulo(d);return{quotient:o,rem:b}}function ll(o,d){if(!o&&!d)return{high:w.fromNumber(0),low:w.fromNumber(0)};const b=o.shiftRightUnsigned(32),g=new w(o.getLowBits(),0),k=d.shiftRightUnsigned(32),B=new w(d.getLowBits(),0);let T=b.multiply(k),F=b.multiply(B);const S=g.multiply(k);let D=g.multiply(B);return T=T.add(F.shiftRightUnsigned(32)),F=new w(F.getLowBits(),0).add(S).add(D.shiftRightUnsigned(32)),T=T.add(F.shiftRightUnsigned(32)),D=F.shiftLeft(32).add(new w(D.getLowBits(),0)),{high:T,low:D}}function cl(o,d){const b=o.high>>>0,g=d.high>>>0;if(b<g)return!0;if(b===g){const k=o.low>>>0,B=d.low>>>0;if(k<B)return!0}return!1}function Jt(o,d){throw new C(`"${o}" is not a valid Decimal128 string - ${d}`)}var Re=class extends Ie{get _bsontype(){return"Decimal128"}constructor(o){if(super(),typeof o=="string")this.bytes=Re.fromString(o).bytes;else if(ct(o)){if(o.byteLength!==16)throw new C("Decimal128 must take a Buffer of 16 bytes");this.bytes=o}else throw new C("Decimal128 must take a Buffer or string")}static fromString(o){let d=!1,b=!1,g=!1,k=0,B=0,T=0,F=0,S=0;const D=[0];let P=0,j=0,I=0,z=0,M=0,we=0,je=new w(0,0),he=new w(0,0),ve=0,J=0;if(o.length>=7e3)throw new C(""+o+" not a valid Decimal128 string");const Ee=o.match(Qa),gi=o.match(el),Fi=o.match(tl);if(!Ee&&!gi&&!Fi||o.length===0)throw new C(""+o+" not a valid Decimal128 string");if(Ee){const re=Ee[2],Q=Ee[4],U=Ee[5],W=Ee[6];Q&&W===void 0&&Jt(o,"missing exponent power"),Q&&re===void 0&&Jt(o,"missing exponent base"),Q===void 0&&(U||W)&&Jt(o,"missing e before exponent")}if((o[J]==="+"||o[J]==="-")&&(d=o[J++]==="-"),!_n(o[J])&&o[J]!=="."){if(o[J]==="i"||o[J]==="I")return new Re(d?gn:yn);if(o[J]==="N")return new Re(xr)}for(;_n(o[J])||o[J]===".";){if(o[J]==="."){b&&Jt(o,"contains multiple periods"),b=!0,J=J+1;continue}P<34&&(o[J]!=="0"||g)&&(g||(S=B),g=!0,D[j++]=parseInt(o[J],10),P=P+1),g&&(T=T+1),b&&(F=F+1),B=B+1,J=J+1}if(b&&!B)throw new C(""+o+" not a valid Decimal128 string");if(o[J]==="e"||o[J]==="E"){const re=o.substr(++J).match(rl);if(!re||!re[2])return new Re(xr);M=parseInt(re[0],10),J=J+re[0].length}if(o[J])return new Re(xr);if(I=0,!P)I=0,z=0,D[0]=0,T=1,P=1,k=0;else if(z=P-1,k=T,k!==1)for(;D[S+k-1]===0;)k=k-1;for(M<=F&&F-M>1<<14?M=Ar:M=M-F;M>ui;){if(z=z+1,z-I>il){if(D.join("").match(/^0+$/)){M=ui;break}Jt(o,"overflow")}M=M-1}for(;M<Ar||P<T;){if(z===0&&k<P){M=Ar,k=0;break}if(P<T?T=T-1:z=z-1,M<ui)M=M+1;else{if(D.join("").match(/^0+$/)){M=ui;break}Jt(o,"overflow")}}if(z-I+1<k){let re=B;b&&(S=S+1,re=re+1),d&&(S=S+1,re=re+1);const Q=parseInt(o[S+z+1],10);let U=0;if(Q>=5&&(U=1,Q===5)){for(U=D[z]%2===1?1:0,we=S+z+2;we<re;we++)if(parseInt(o[we],10)){U=1;break}}if(U){let W=z;for(;W>=0;W--)if(++D[W]>9&&(D[W]=0,W===0))if(M<ui)M=M+1,D[W]=1;else return new Re(d?gn:yn)}}if(je=w.fromNumber(0),he=w.fromNumber(0),k===0)je=w.fromNumber(0),he=w.fromNumber(0);else if(z-I<17){let re=I;for(he=w.fromNumber(D[re++]),je=new w(0,0);re<=z;re++)he=he.multiply(w.fromNumber(10)),he=he.add(w.fromNumber(D[re]))}else{let re=I;for(je=w.fromNumber(D[re++]);re<=z-17;re++)je=je.multiply(w.fromNumber(10)),je=je.add(w.fromNumber(D[re]));for(he=w.fromNumber(D[re++]);re<=z;re++)he=he.multiply(w.fromNumber(10)),he=he.add(w.fromNumber(D[re]))}const Y=ll(je,w.fromString("100000000000000000"));Y.low=Y.low.add(he),cl(Y.low,he)&&(Y.high=Y.high.add(w.fromNumber(1))),ve=M+pn;const R={low:w.fromNumber(0),high:w.fromNumber(0)};Y.high.shiftRightUnsigned(49).and(w.fromNumber(1)).equals(w.fromNumber(1))?(R.high=R.high.or(w.fromNumber(3).shiftLeft(61)),R.high=R.high.or(w.fromNumber(ve).and(w.fromNumber(16383).shiftLeft(47))),R.high=R.high.or(Y.high.and(w.fromNumber(0x7fffffffffff)))):(R.high=R.high.or(w.fromNumber(ve&16383).shiftLeft(49)),R.high=R.high.or(Y.high.and(w.fromNumber(562949953421311)))),R.low=Y.low,d&&(R.high=R.high.or(w.fromString("9223372036854775808")));const ue=N.allocate(16);return J=0,ue[J++]=R.low.low&255,ue[J++]=R.low.low>>8&255,ue[J++]=R.low.low>>16&255,ue[J++]=R.low.low>>24&255,ue[J++]=R.low.high&255,ue[J++]=R.low.high>>8&255,ue[J++]=R.low.high>>16&255,ue[J++]=R.low.high>>24&255,ue[J++]=R.high.low&255,ue[J++]=R.high.low>>8&255,ue[J++]=R.high.low>>16&255,ue[J++]=R.high.low>>24&255,ue[J++]=R.high.high&255,ue[J++]=R.high.high>>8&255,ue[J++]=R.high.high>>16&255,ue[J++]=R.high.high>>24&255,new Re(ue)}toString(){let o,d=0;const b=new Array(36);for(let J=0;J<b.length;J++)b[J]=0;let g=0,k=!1,B,T={parts:[0,0,0,0]},F,S;const D=[];g=0;const P=this.bytes,j=P[g++]|P[g++]<<8|P[g++]<<16|P[g++]<<24,I=P[g++]|P[g++]<<8|P[g++]<<16|P[g++]<<24,z=P[g++]|P[g++]<<8|P[g++]<<16|P[g++]<<24,M=P[g++]|P[g++]<<8|P[g++]<<16|P[g++]<<24;g=0,{low:new w(j,I),high:new w(z,M)}.high.lessThan(w.ZERO)&&D.push("-");const je=M>>26&sl;if(je>>3===3){if(je===nl)return D.join("")+"Infinity";if(je===ol)return"NaN";o=M>>15&bn,B=8+(M>>14&1)}else B=M>>14&7,o=M>>17&bn;const he=o-pn;if(T.parts[0]=(M&16383)+((B&15)<<14),T.parts[1]=z,T.parts[2]=I,T.parts[3]=j,T.parts[0]===0&&T.parts[1]===0&&T.parts[2]===0&&T.parts[3]===0)k=!0;else for(S=3;S>=0;S--){let J=0;const Ee=al(T);if(T=Ee.quotient,J=Ee.rem.low,!!J)for(F=8;F>=0;F--)b[S*9+F]=J%10,J=Math.floor(J/10)}if(k)d=1,b[g]=0;else for(d=36;!b[g];)d=d-1,g=g+1;const ve=d-1+he;if(ve>=34||ve<=-7||he>0){if(d>34)return D.push("0"),he>0?D.push(`E+${he}`):he<0&&D.push(`E${he}`),D.join("");D.push(`${b[g++]}`),d=d-1,d&&D.push(".");for(let J=0;J<d;J++)D.push(`${b[g++]}`);D.push("E"),ve>0?D.push(`+${ve}`):D.push(`${ve}`)}else if(he>=0)for(let J=0;J<d;J++)D.push(`${b[g++]}`);else{let J=d+he;if(J>0)for(let Ee=0;Ee<J;Ee++)D.push(`${b[g++]}`);else D.push("0");for(D.push(".");J++<0;)D.push("0");for(let Ee=0;Ee<d-Math.max(J-1,0);Ee++)D.push(`${b[g++]}`)}return D.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(o){return Re.fromString(o.$numberDecimal)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Decimal128("${this.toString()}")`}},xt=class extends Ie{get _bsontype(){return"Double"}constructor(o){super(),o instanceof Number&&(o=o.valueOf()),this.value=+o}valueOf(){return this.value}toJSON(){return this.value}toString(o){return this.value.toString(o)}toExtendedJSON(o){return o&&(o.legacy||o.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-0.0"}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(o,d){const b=parseFloat(o.$numberDouble);return d&&d.relaxed?b:new xt(b)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Double(${this.toExtendedJSON().$numberDouble})`}},Ot=class extends Ie{get _bsontype(){return"Int32"}constructor(o){super(),o instanceof Number&&(o=o.valueOf()),this.value=+o|0}valueOf(){return this.value}toString(o){return this.value.toString(o)}toJSON(){return this.value}toExtendedJSON(o){return o&&(o.relaxed||o.legacy)?this.value:{$numberInt:this.value.toString()}}static fromExtendedJSON(o,d){return d&&d.relaxed?parseInt(o.$numberInt,10):new Ot(o.$numberInt)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Int32(${this.valueOf()})`}},$t=class extends Ie{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new $t}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MaxKey()"}},zt=class extends Ie{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new zt}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MinKey()"}},hl=new RegExp("^[0-9a-fA-F]{24}$"),Et=null,Ze=Symbol("id"),de=class extends Ie{get _bsontype(){return"ObjectId"}constructor(o){super();let d;if(typeof o=="object"&&o&&"id"in o){if(typeof o.id!="string"&&!ArrayBuffer.isView(o.id))throw new C("Argument passed in must have an id that is of type string or Buffer");"toHexString"in o&&typeof o.toHexString=="function"?d=N.fromHex(o.toHexString()):d=o.id}else d=o;if(d==null||typeof d=="number")this[Ze]=de.generate(typeof d=="number"?d:void 0);else if(ArrayBuffer.isView(d)&&d.byteLength===12)this[Ze]=N.toLocalBufferType(d);else if(typeof d=="string")if(d.length===12){const b=N.fromUTF8(d);if(b.byteLength===12)this[Ze]=b;else throw new C("Argument passed in must be a string of 12 bytes")}else if(d.length===24&&hl.test(d))this[Ze]=N.fromHex(d);else throw new C("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new C("Argument passed in does not match the accepted types");de.cacheHexString&&(this.__id=N.toHex(this.id))}get id(){return this[Ze]}set id(o){this[Ze]=o,de.cacheHexString&&(this.__id=N.toHex(o))}toHexString(){if(de.cacheHexString&&this.__id)return this.__id;const o=N.toHex(this.id);return de.cacheHexString&&!this.__id&&(this.__id=o),o}static getInc(){return de.index=(de.index+1)%16777215}static generate(o){typeof o!="number"&&(o=Math.floor(Date.now()/1e3));const d=de.getInc(),b=N.allocate(12);return At.fromUint8Array(b).setUint32(0,o,!1),Et===null&&(Et=N.randomBytes(5)),b[4]=Et[0],b[5]=Et[1],b[6]=Et[2],b[7]=Et[3],b[8]=Et[4],b[11]=d&255,b[10]=d>>8&255,b[9]=d>>16&255,b}toString(o){return o==="base64"?N.toBase64(this.id):o==="hex"?this.toHexString():this.toHexString()}toJSON(){return this.toHexString()}equals(o){if(o==null)return!1;if(o instanceof de)return this[Ze][11]===o[Ze][11]&&N.equals(this[Ze],o[Ze]);if(typeof o=="string"&&de.isValid(o)&&o.length===12&&ct(this.id))return N.equals(this.id,N.fromISO88591(o));if(typeof o=="string"&&de.isValid(o)&&o.length===24)return o.toLowerCase()===this.toHexString();if(typeof o=="string"&&de.isValid(o)&&o.length===12)return N.equals(N.fromUTF8(o),this.id);if(typeof o=="object"&&"toHexString"in o&&typeof o.toHexString=="function"){const d=o.toHexString(),b=this.toHexString().toLowerCase();return typeof d=="string"&&d.toLowerCase()===b}return!1}getTimestamp(){const o=new Date,d=At.fromUint8Array(this.id).getUint32(0,!1);return o.setTime(Math.floor(d)*1e3),o}static createPk(){return new de}static createFromTime(o){const d=N.fromNumberArray([0,0,0,0,0,0,0,0,0,0,0,0]);return At.fromUint8Array(d).setUint32(0,o,!1),new de(d)}static createFromHexString(o){if(typeof o>"u"||o!=null&&o.length!==24)throw new C("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new de(N.fromHex(o))}static isValid(o){if(o==null)return!1;try{return new de(o),!0}catch{return!1}}toExtendedJSON(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}static fromExtendedJSON(o){return new de(o.$oid)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new ObjectId("${this.toHexString()}")`}};de.index=Math.floor(Math.random()*16777215);function Li(o,d,b){let g=5;if(Array.isArray(o))for(let k=0;k<o.length;k++)g+=mn(k.toString(),o[k],d,!0,b);else{typeof(o==null?void 0:o.toBSON)=="function"&&(o=o.toBSON());for(const k of Object.keys(o))g+=mn(k,o[k],d,!1,b)}return g}function mn(o,d,b=!1,g=!1,k=!1){switch(typeof(d==null?void 0:d.toBSON)=="function"&&(d=d.toBSON()),typeof d){case"string":return 1+N.utf8ByteLength(o)+1+4+N.utf8ByteLength(d)+1;case"number":return Math.floor(d)===d&&d>=l&&d<=a&&d>=r&&d<=i?(o!=null?N.utf8ByteLength(o)+1:0)+(4+1):(o!=null?N.utf8ByteLength(o)+1:0)+(8+1);case"undefined":return g||!k?(o!=null?N.utf8ByteLength(o)+1:0)+1:0;case"boolean":return(o!=null?N.utf8ByteLength(o)+1:0)+(1+1);case"object":if(d!=null&&typeof d._bsontype=="string"&&d[Symbol.for("@@mdb.bson.version")]!==e)throw new Ce;if(d==null||d._bsontype==="MinKey"||d._bsontype==="MaxKey")return(o!=null?N.utf8ByteLength(o)+1:0)+1;if(d._bsontype==="ObjectId")return(o!=null?N.utf8ByteLength(o)+1:0)+(12+1);if(d instanceof Date||Ft(d))return(o!=null?N.utf8ByteLength(o)+1:0)+(8+1);if(ArrayBuffer.isView(d)||d instanceof ArrayBuffer||on(d))return(o!=null?N.utf8ByteLength(o)+1:0)+(1+4+1)+d.byteLength;if(d._bsontype==="Long"||d._bsontype==="Double"||d._bsontype==="Timestamp")return(o!=null?N.utf8ByteLength(o)+1:0)+(8+1);if(d._bsontype==="Decimal128")return(o!=null?N.utf8ByteLength(o)+1:0)+(16+1);if(d._bsontype==="Code")return d.scope!=null&&Object.keys(d.scope).length>0?(o!=null?N.utf8ByteLength(o)+1:0)+1+4+4+N.utf8ByteLength(d.code.toString())+1+Li(d.scope,b,k):(o!=null?N.utf8ByteLength(o)+1:0)+1+4+N.utf8ByteLength(d.code.toString())+1;if(d._bsontype==="Binary"){const B=d;return B.sub_type===oe.SUBTYPE_BYTE_ARRAY?(o!=null?N.utf8ByteLength(o)+1:0)+(B.position+1+4+1+4):(o!=null?N.utf8ByteLength(o)+1:0)+(B.position+1+4+1)}else{if(d._bsontype==="Symbol")return(o!=null?N.utf8ByteLength(o)+1:0)+N.utf8ByteLength(d.value)+4+1+1;if(d._bsontype==="DBRef"){const B=Object.assign({$ref:d.collection,$id:d.oid},d.fields);return d.db!=null&&(B.$db=d.db),(o!=null?N.utf8ByteLength(o)+1:0)+1+Li(B,b,k)}else return d instanceof RegExp||Rt(d)?(o!=null?N.utf8ByteLength(o)+1:0)+1+N.utf8ByteLength(d.source)+1+(d.global?1:0)+(d.ignoreCase?1:0)+(d.multiline?1:0)+1:d._bsontype==="BSONRegExp"?(o!=null?N.utf8ByteLength(o)+1:0)+1+N.utf8ByteLength(d.pattern)+1+N.utf8ByteLength(d.options)+1:(o!=null?N.utf8ByteLength(o)+1:0)+Li(d,b,k)+1}case"function":if(b)return(o!=null?N.utf8ByteLength(o)+1:0)+1+4+N.utf8ByteLength(d.toString())+1}return 0}function fl(o){return o.split("").sort().join("")}var $e=class extends Ie{get _bsontype(){return"BSONRegExp"}constructor(o,d){if(super(),this.pattern=o,this.options=fl(d??""),this.pattern.indexOf("\0")!==-1)throw new C(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`);if(this.options.indexOf("\0")!==-1)throw new C(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`);for(let b=0;b<this.options.length;b++)if(!(this.options[b]==="i"||this.options[b]==="m"||this.options[b]==="x"||this.options[b]==="l"||this.options[b]==="s"||this.options[b]==="u"))throw new C(`The regular expression option [${this.options[b]}] is not supported`)}static parseOptions(o){return o?o.split("").sort().join(""):""}toExtendedJSON(o){return o=o||{},o.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(o){if("$regex"in o)if(typeof o.$regex!="string"){if(o.$regex._bsontype==="BSONRegExp")return o}else return new $e(o.$regex,$e.parseOptions(o.$options));if("$regularExpression"in o)return new $e(o.$regularExpression.pattern,$e.parseOptions(o.$regularExpression.options));throw new C(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(o)}`)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new BSONRegExp(${JSON.stringify(this.pattern)}, ${JSON.stringify(this.options)})`}},qt=class extends Ie{get _bsontype(){return"BSONSymbol"}constructor(o){super(),this.value=o}valueOf(){return this.value}toString(){return this.value}inspect(){return`new BSONSymbol("${this.value}")`}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(o){return new qt(o.$symbol)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}},ul=w,ze=class extends ul{get _bsontype(){return"Timestamp"}constructor(o){if(o==null)super(0,0,!0);else if(typeof o=="bigint")super(o,!0);else if(w.isLong(o))super(o.low,o.high,!0);else if(typeof o=="object"&&"t"in o&&"i"in o){if(typeof o.t!="number"&&(typeof o.t!="object"||o.t._bsontype!=="Int32"))throw new C("Timestamp constructed from { t, i } must provide t as a number");if(typeof o.i!="number"&&(typeof o.i!="object"||o.i._bsontype!=="Int32"))throw new C("Timestamp constructed from { t, i } must provide i as a number");if(o.t<0)throw new C("Timestamp constructed from { t, i } must provide a positive t");if(o.i<0)throw new C("Timestamp constructed from { t, i } must provide a positive i");if(o.t>4294967295)throw new C("Timestamp constructed from { t, i } must provide t equal or less than uint32 max");if(o.i>4294967295)throw new C("Timestamp constructed from { t, i } must provide i equal or less than uint32 max");super(o.i.valueOf(),o.t.valueOf(),!0)}else throw new C("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }")}toJSON(){return{$timestamp:this.toString()}}static fromInt(o){return new ze(w.fromInt(o,!0))}static fromNumber(o){return new ze(w.fromNumber(o,!0))}static fromBits(o,d){return new ze({i:o,t:d})}static fromString(o,d){return new ze(w.fromString(o,!0,d))}toExtendedJSON(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}static fromExtendedJSON(o){const d=w.isLong(o.$timestamp.i)?o.$timestamp.i.getLowBitsUnsigned():o.$timestamp.i,b=w.isLong(o.$timestamp.t)?o.$timestamp.t.getLowBitsUnsigned():o.$timestamp.t;return new ze({t:b,i:d})}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Timestamp({ t: ${this.getHighBits()}, i: ${this.getLowBits()} })`}};ze.MAX_VALUE=w.MAX_UNSIGNED_VALUE;var dl=128,pl=192,gl=224,yl=240,bl=248,_l=192,ml=224,vl=240,wl=128;function vn(o,d,b){let g=0;for(let k=d;k<b;k+=1){const B=o[k];if(g){if((B&pl)!==wl)return!1;g-=1}else if(B&dl)if((B&gl)===_l)g=1;else if((B&yl)===ml)g=2;else if((B&bl)===vl)g=3;else return!1}return!g}var Sl=w.fromNumber(a),kl=w.fromNumber(l);function wn(o,d,b){d=d??{};const g=d&&d.index?d.index:0,k=o[g]|o[g+1]<<8|o[g+2]<<16|o[g+3]<<24;if(k<5)throw new C(`bson size must be >= 5, is ${k}`);if(d.allowObjectSmallerThanBufferSize&&o.length<k)throw new C(`buffer length ${o.length} must be >= bson size ${k}`);if(!d.allowObjectSmallerThanBufferSize&&o.length!==k)throw new C(`buffer length ${o.length} must === bson size ${k}`);if(k+g>o.byteLength)throw new C(`(bson size ${k} + options.index ${g} must be <= buffer length ${o.byteLength})`);if(o[g+k-1]!==0)throw new C("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return Ii(o,g,d,b)}var Al=/^\$ref$|^\$id$|^\$db$/;function Ii(o,d,b,g=!1){const k=b.fieldsAsRaw==null?null:b.fieldsAsRaw,B=b.raw==null?!1:b.raw,T=typeof b.bsonRegExp=="boolean"?b.bsonRegExp:!1,F=b.promoteBuffers??!1,S=b.promoteLongs??!0,D=b.promoteValues??!0,P=b.useBigInt64??!1;if(P&&!D)throw new C("Must either request bigint or Long for int64 deserialization");if(P&&!S)throw new C("Must either request bigint or Long for int64 deserialization");const j=b.validation==null?{utf8:!0}:b.validation;let I=!0,z;const M=new Set,we=j.utf8;if(typeof we=="boolean")z=we;else{I=!1;const Y=Object.keys(we).map(function(R){return we[R]});if(Y.length===0)throw new C("UTF-8 validation setting cannot be empty");if(typeof Y[0]!="boolean")throw new C("Invalid UTF-8 validation option, must specify boolean values");if(z=Y[0],!Y.every(R=>R===z))throw new C("Invalid UTF-8 validation option - keys must be all true or all false")}if(!I)for(const Y of Object.keys(we))M.add(Y);const je=d;if(o.length<5)throw new C("corrupt bson message < 5 bytes long");const he=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;if(he<5||he>o.length)throw new C("corrupt bson message");const ve=g?[]:{};let J=0;const Ee=!1;let gi=g?!1:null;const Fi=new DataView(o.buffer,o.byteOffset,o.byteLength);for(;!Ee;){const Y=o[d++];if(Y===0)break;let R=d;for(;o[R]!==0&&R<o.length;)R++;if(R>=o.byteLength)throw new C("Bad BSON Document: illegal CString");const ue=g?J++:N.toUTF8(o.subarray(d,R));let re=!0;I||M.has(ue)?re=z:re=!z,gi!==!1&&ue[0]==="$"&&(gi=Al.test(ue));let Q;if(d=R+1,Y===f){const U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;if(U<=0||U>o.length-d||o[d+U-1]!==0)throw new C("bad string length in bson");Q=Mi(o,d,d+U-1,re),d=d+U}else if(Y===_){const U=N.allocate(12);U.set(o.subarray(d,d+12)),Q=new de(U),d=d+12}else if(Y===V&&D===!1)Q=new Ot(o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24);else if(Y===V)Q=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;else if(Y===c&&D===!1)Q=new xt(Fi.getFloat64(d,!0)),d=d+8;else if(Y===c)Q=Fi.getFloat64(d,!0),d=d+8;else if(Y===A){const U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24,W=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;Q=new Date(new w(U,W).toNumber())}else if(Y===m){if(o[d]!==0&&o[d]!==1)throw new C("illegal boolean type value");Q=o[d++]===1}else if(Y===u){const U=d,W=o[d]|o[d+1]<<8|o[d+2]<<16|o[d+3]<<24;if(W<=0||W>o.length-d)throw new C("bad embedded document length in bson");if(B)Q=o.slice(d,d+W);else{let fe=b;I||(fe={...b,validation:{utf8:re}}),Q=Ii(o,U,fe,!1)}d=d+W}else if(Y===h){const U=d,W=o[d]|o[d+1]<<8|o[d+2]<<16|o[d+3]<<24;let fe=b;const Me=d+W;if(k&&k[ue]&&(fe={...b,raw:!0}),I||(fe={...fe,validation:{utf8:re}}),Q=Ii(o,U,fe,!0),d=d+W,o[d-1]!==0)throw new C("invalid array terminator byte");if(d!==Me)throw new C("corrupted array bson")}else if(Y===y)Q=void 0;else if(Y===O)Q=null;else if(Y===ye){const U=At.fromUint8Array(o.subarray(d,d+8)),W=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24,fe=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24,Me=new w(W,fe);P?Q=U.getBigInt64(0,!0):S&&D===!0?Q=Me.lessThanOrEqual(Sl)&&Me.greaterThanOrEqual(kl)?Me.toNumber():Me:Q=Me}else if(Y===pe){const U=N.allocate(16);U.set(o.subarray(d,d+16),0),d=d+16,Q=new Re(U)}else if(Y===p){let U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;const W=U,fe=o[d++];if(U<0)throw new C("Negative binary type element size found");if(U>o.byteLength)throw new C("Binary type size larger than document size");if(o.slice!=null){if(fe===oe.SUBTYPE_BYTE_ARRAY){if(U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24,U<0)throw new C("Negative binary type element size found for subtype 0x02");if(U>W-4)throw new C("Binary type with subtype 0x02 contains too long binary size");if(U<W-4)throw new C("Binary type with subtype 0x02 contains too short binary size")}F&&D?Q=N.toLocalBufferType(o.slice(d,d+U)):(Q=new oe(o.slice(d,d+U),fe),fe===Ye&&(Q=Q.toUUID()))}else{const Me=N.allocate(U);if(fe===oe.SUBTYPE_BYTE_ARRAY){if(U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24,U<0)throw new C("Negative binary type element size found for subtype 0x02");if(U>W-4)throw new C("Binary type with subtype 0x02 contains too long binary size");if(U<W-4)throw new C("Binary type with subtype 0x02 contains too short binary size")}for(R=0;R<U;R++)Me[R]=o[d+R];F&&D?Q=Me:fe===Ye?Q=new oe(o.slice(d,d+U),fe).toUUID():Q=new oe(o.slice(d,d+U),fe)}d=d+U}else if(Y===E&&T===!1){for(R=d;o[R]!==0&&R<o.length;)R++;if(R>=o.length)throw new C("Bad BSON Document: illegal CString");const U=N.toUTF8(o.subarray(d,R));for(d=R+1,R=d;o[R]!==0&&R<o.length;)R++;if(R>=o.length)throw new C("Bad BSON Document: illegal CString");const W=N.toUTF8(o.subarray(d,R));d=R+1;const fe=new Array(W.length);for(R=0;R<W.length;R++)switch(W[R]){case"m":fe[R]="m";break;case"s":fe[R]="g";break;case"i":fe[R]="i";break}Q=new RegExp(U,fe.join(""))}else if(Y===E&&T===!0){for(R=d;o[R]!==0&&R<o.length;)R++;if(R>=o.length)throw new C("Bad BSON Document: illegal CString");const U=N.toUTF8(o.subarray(d,R));for(d=R+1,R=d;o[R]!==0&&R<o.length;)R++;if(R>=o.length)throw new C("Bad BSON Document: illegal CString");const W=N.toUTF8(o.subarray(d,R));d=R+1,Q=new $e(U,W)}else if(Y===K){const U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;if(U<=0||U>o.length-d||o[d+U-1]!==0)throw new C("bad string length in bson");const W=Mi(o,d,d+U-1,re);Q=D?W:new qt(W),d=d+U}else if(Y===G){const U=o[d++]+o[d++]*256+o[d++]*65536+o[d++]*16777216,W=o[d++]+o[d++]*(1<<8)+o[d++]*(1<<16)+o[d++]*(1<<24);Q=new ze({i:U,t:W})}else if(Y===ee)Q=new zt;else if(Y===$)Q=new $t;else if(Y===H){const U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;if(U<=0||U>o.length-d||o[d+U-1]!==0)throw new C("bad string length in bson");const W=Mi(o,d,d+U-1,re);Q=new ht(W),d=d+U}else if(Y===le){const U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;if(U<4+4+4+1)throw new C("code_w_scope total size shorter minimum expected length");const W=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;if(W<=0||W>o.length-d||o[d+W-1]!==0)throw new C("bad string length in bson");const fe=Mi(o,d,d+W-1,re);d=d+W;const Me=d,Hr=o[d]|o[d+1]<<8|o[d+2]<<16|o[d+3]<<24,Ll=Ii(o,Me,b,!1);if(d=d+Hr,U<4+4+Hr+W)throw new C("code_w_scope total size is too short, truncating scope");if(U>4+4+Hr+W)throw new C("code_w_scope total size is too long, clips outer document");Q=new ht(fe,Ll)}else if(Y===L){const U=o[d++]|o[d++]<<8|o[d++]<<16|o[d++]<<24;if(U<=0||U>o.length-d||o[d+U-1]!==0)throw new C("bad string length in bson");if(j!=null&&j.utf8&&!vn(o,d,d+U-1))throw new C("Invalid UTF-8 string in BSON document");const W=N.toUTF8(o.subarray(d,d+U-1));d=d+U;const fe=N.allocate(12);fe.set(o.subarray(d,d+12),0);const Me=new de(fe);d=d+12,Q=new et(W,Me)}else throw new C(`Detected unknown BSON type ${Y.toString(16)} for fieldname "${ue}"`);ue==="__proto__"?Object.defineProperty(ve,ue,{value:Q,writable:!0,enumerable:!0,configurable:!0}):ve[ue]=Q}if(he!==d-je)throw g?new C("corrupt array bson"):new C("corrupt object bson");if(!gi)return ve;if(ln(ve)){const Y=Object.assign({},ve);return delete Y.$ref,delete Y.$id,delete Y.$db,new et(ve.$ref,ve.$id,ve.$db,Y)}return ve}function Mi(o,d,b,g){const k=N.toUTF8(o.subarray(d,b));if(g){for(let B=0;B<k.length;B++)if(k.charCodeAt(B)===65533){if(!vn(o,d,b))throw new C("Invalid UTF-8 string in BSON document");break}}return k}var Di=/\x00/,Sn=new Set(["$db","$ref","$id","$clusterTime"]);function Or(o,d,b,g){o[g++]=f;const k=N.encodeUTF8Into(o,d,g);g=g+k+1,o[g-1]=0;const B=N.encodeUTF8Into(o,b,g+4);return o[g+3]=B+1>>24&255,o[g+2]=B+1>>16&255,o[g+1]=B+1>>8&255,o[g]=B+1&255,g=g+4+B,o[g++]=0,g}var Vt=new DataView(new ArrayBuffer(8),0,8),xl=new Uint8Array(Vt.buffer,0,4),Ri=new Uint8Array(Vt.buffer,0,8);function Er(o,d,b,g){const B=!Object.is(b,-0)&&Number.isSafeInteger(b)&&b<=i&&b>=r?V:c;B===V?Vt.setInt32(0,b,!0):Vt.setFloat64(0,b,!0);const T=B===V?xl:Ri;o[g++]=B;const F=N.encodeUTF8Into(o,d,g);return g=g+F,o[g++]=0,o.set(T,g),g+=T.byteLength,g}function Nr(o,d,b,g){o[g++]=ye;const k=N.encodeUTF8Into(o,d,g);return g+=k,o[g++]=0,Vt.setBigInt64(0,b,!0),o.set(Ri,g),g+=Ri.byteLength,g}function di(o,d,b,g){o[g++]=O;const k=N.encodeUTF8Into(o,d,g);return g=g+k,o[g++]=0,g}function Br(o,d,b,g){o[g++]=m;const k=N.encodeUTF8Into(o,d,g);return g=g+k,o[g++]=0,o[g++]=b?1:0,g}function Tr(o,d,b,g){o[g++]=A;const k=N.encodeUTF8Into(o,d,g);g=g+k,o[g++]=0;const B=w.fromNumber(b.getTime()),T=B.getLowBits(),F=B.getHighBits();return o[g++]=T&255,o[g++]=T>>8&255,o[g++]=T>>16&255,o[g++]=T>>24&255,o[g++]=F&255,o[g++]=F>>8&255,o[g++]=F>>16&255,o[g++]=F>>24&255,g}function jr(o,d,b,g){o[g++]=E;const k=N.encodeUTF8Into(o,d,g);if(g=g+k,o[g++]=0,b.source&&b.source.match(Di)!=null)throw new C("value "+b.source+" must not contain null bytes");return g=g+N.encodeUTF8Into(o,b.source,g),o[g++]=0,b.ignoreCase&&(o[g++]=105),b.global&&(o[g++]=115),b.multiline&&(o[g++]=109),o[g++]=0,g}function Cr(o,d,b,g){o[g++]=E;const k=N.encodeUTF8Into(o,d,g);if(g=g+k,o[g++]=0,b.pattern.match(Di)!=null)throw new C("pattern "+b.pattern+" must not contain null bytes");g=g+N.encodeUTF8Into(o,b.pattern,g),o[g++]=0;const B=b.options.split("").sort().join("");return g=g+N.encodeUTF8Into(o,B,g),o[g++]=0,g}function Pr(o,d,b,g){b===null?o[g++]=O:b._bsontype==="MinKey"?o[g++]=ee:o[g++]=$;const k=N.encodeUTF8Into(o,d,g);return g=g+k,o[g++]=0,g}function Lr(o,d,b,g){o[g++]=_;const k=N.encodeUTF8Into(o,d,g);if(g=g+k,o[g++]=0,ct(b.id))o.set(b.id.subarray(0,12),g);else throw new C("object ["+JSON.stringify(b)+"] is not a valid ObjectId");return g+12}function Ir(o,d,b,g){o[g++]=p;const k=N.encodeUTF8Into(o,d,g);g=g+k,o[g++]=0;const B=b.length;return o[g++]=B&255,o[g++]=B>>8&255,o[g++]=B>>16&255,o[g++]=B>>24&255,o[g++]=ae,o.set(b,g),g=g+B,g}function Mr(o,d,b,g,k,B,T,F,S){if(S.has(b))throw new C("Cannot convert circular structure to BSON");S.add(b),o[g++]=Array.isArray(b)?h:u;const D=N.encodeUTF8Into(o,d,g);g=g+D,o[g++]=0;const P=pi(o,b,k,g,B+1,T,F,S);return S.delete(b),P}function Dr(o,d,b,g){o[g++]=pe;const k=N.encodeUTF8Into(o,d,g);return g=g+k,o[g++]=0,o.set(b.bytes.subarray(0,16),g),g+16}function Rr(o,d,b,g){o[g++]=b._bsontype==="Long"?ye:G;const k=N.encodeUTF8Into(o,d,g);g=g+k,o[g++]=0;const B=b.getLowBits(),T=b.getHighBits();return o[g++]=B&255,o[g++]=B>>8&255,o[g++]=B>>16&255,o[g++]=B>>24&255,o[g++]=T&255,o[g++]=T>>8&255,o[g++]=T>>16&255,o[g++]=T>>24&255,g}function Fr(o,d,b,g){b=b.valueOf(),o[g++]=V;const k=N.encodeUTF8Into(o,d,g);return g=g+k,o[g++]=0,o[g++]=b&255,o[g++]=b>>8&255,o[g++]=b>>16&255,o[g++]=b>>24&255,g}function Ur(o,d,b,g){o[g++]=c;const k=N.encodeUTF8Into(o,d,g);return g=g+k,o[g++]=0,Vt.setFloat64(0,b.value,!0),o.set(Ri,g),g=g+8,g}function Jr(o,d,b,g){o[g++]=H;const k=N.encodeUTF8Into(o,d,g);g=g+k,o[g++]=0;const B=b.toString(),T=N.encodeUTF8Into(o,B,g+4)+1;return o[g]=T&255,o[g+1]=T>>8&255,o[g+2]=T>>16&255,o[g+3]=T>>24&255,g=g+4+T-1,o[g++]=0,g}function $r(o,d,b,g,k=!1,B=0,T=!1,F=!0,S){if(b.scope&&typeof b.scope=="object"){o[g++]=le;const D=N.encodeUTF8Into(o,d,g);g=g+D,o[g++]=0;let P=g;const j=b.code;g=g+4;const I=N.encodeUTF8Into(o,j,g+4)+1;o[g]=I&255,o[g+1]=I>>8&255,o[g+2]=I>>16&255,o[g+3]=I>>24&255,o[g+4+I-1]=0,g=g+I+4;const z=pi(o,b.scope,k,g,B+1,T,F,S);g=z-1;const M=z-P;o[P++]=M&255,o[P++]=M>>8&255,o[P++]=M>>16&255,o[P++]=M>>24&255,o[g++]=0}else{o[g++]=H;const D=N.encodeUTF8Into(o,d,g);g=g+D,o[g++]=0;const P=b.code.toString(),j=N.encodeUTF8Into(o,P,g+4)+1;o[g]=j&255,o[g+1]=j>>8&255,o[g+2]=j>>16&255,o[g+3]=j>>24&255,g=g+4+j-1,o[g++]=0}return g}function zr(o,d,b,g){o[g++]=p;const k=N.encodeUTF8Into(o,d,g);g=g+k,o[g++]=0;const B=b.buffer;let T=b.position;return b.sub_type===oe.SUBTYPE_BYTE_ARRAY&&(T=T+4),o[g++]=T&255,o[g++]=T>>8&255,o[g++]=T>>16&255,o[g++]=T>>24&255,o[g++]=b.sub_type,b.sub_type===oe.SUBTYPE_BYTE_ARRAY&&(T=T-4,o[g++]=T&255,o[g++]=T>>8&255,o[g++]=T>>16&255,o[g++]=T>>24&255),o.set(B,g),g=g+b.position,g}function qr(o,d,b,g){o[g++]=K;const k=N.encodeUTF8Into(o,d,g);g=g+k,o[g++]=0;const B=N.encodeUTF8Into(o,b.value,g+4)+1;return o[g]=B&255,o[g+1]=B>>8&255,o[g+2]=B>>16&255,o[g+3]=B>>24&255,g=g+4+B-1,o[g++]=0,g}function Vr(o,d,b,g,k,B,T){o[g++]=u;const F=N.encodeUTF8Into(o,d,g);g=g+F,o[g++]=0;let S=g,D={$ref:b.collection||b.namespace,$id:b.oid};b.db!=null&&(D.$db=b.db),D=Object.assign(D,b.fields);const P=pi(o,D,!1,g,k+1,B,!0,T),j=P-S;return o[S++]=j&255,o[S++]=j>>8&255,o[S++]=j>>16&255,o[S++]=j>>24&255,P}function pi(o,d,b,g,k,B,T,F){if(F==null){if(d==null)return o[0]=5,o[1]=0,o[2]=0,o[3]=0,o[4]=0,5;if(Array.isArray(d))throw new C("serialize does not support an array as the root input");if(typeof d!="object")throw new C("serialize does not support non-object as the root input");if("_bsontype"in d&&typeof d._bsontype=="string")throw new C("BSON types cannot be serialized as a document");if(Ft(d)||Rt(d)||ct(d)||on(d))throw new C("date, regexp, typedarray, and arraybuffer cannot be BSON documents");F=new Set}F.add(d);let S=g+4;if(Array.isArray(d))for(let P=0;P<d.length;P++){const j=`${P}`;let I=d[P];if(typeof(I==null?void 0:I.toBSON)=="function"&&(I=I.toBSON()),typeof I=="string")S=Or(o,j,I,S);else if(typeof I=="number")S=Er(o,j,I,S);else if(typeof I=="bigint")S=Nr(o,j,I,S);else if(typeof I=="boolean")S=Br(o,j,I,S);else if(I instanceof Date||Ft(I))S=Tr(o,j,I,S);else if(I===void 0)S=di(o,j,I,S);else if(I===null)S=di(o,j,I,S);else if(ct(I))S=Ir(o,j,I,S);else if(I instanceof RegExp||Rt(I))S=jr(o,j,I,S);else if(typeof I=="object"&&I._bsontype==null)S=Mr(o,j,I,S,b,k,B,T,F);else{if(typeof I=="object"&&I[Symbol.for("@@mdb.bson.version")]!==e)throw new Ce;if(I._bsontype==="ObjectId")S=Lr(o,j,I,S);else if(I._bsontype==="Decimal128")S=Dr(o,j,I,S);else if(I._bsontype==="Long"||I._bsontype==="Timestamp")S=Rr(o,j,I,S);else if(I._bsontype==="Double")S=Ur(o,j,I,S);else if(typeof I=="function"&&B)S=Jr(o,j,I,S);else if(I._bsontype==="Code")S=$r(o,j,I,S,b,k,B,T,F);else if(I._bsontype==="Binary")S=zr(o,j,I,S);else if(I._bsontype==="BSONSymbol")S=qr(o,j,I,S);else if(I._bsontype==="DBRef")S=Vr(o,j,I,S,k,B,F);else if(I._bsontype==="BSONRegExp")S=Cr(o,j,I,S);else if(I._bsontype==="Int32")S=Fr(o,j,I,S);else if(I._bsontype==="MinKey"||I._bsontype==="MaxKey")S=Pr(o,j,I,S);else if(typeof I._bsontype<"u")throw new C(`Unrecognized or invalid _bsontype: ${String(I._bsontype)}`)}}else if(d instanceof Map||an(d)){const P=d.entries();let j=!1;for(;!j;){const I=P.next();if(j=!!I.done,j)continue;const z=I.value[0];let M=I.value[1];typeof(M==null?void 0:M.toBSON)=="function"&&(M=M.toBSON());const we=typeof M;if(typeof z=="string"&&!Sn.has(z)){if(z.match(Di)!=null)throw new C("key "+z+" must not contain null bytes");if(b){if(z[0]==="$")throw new C("key "+z+" must not start with '$'");if(~z.indexOf("."))throw new C("key "+z+" must not contain '.'")}}if(we==="string")S=Or(o,z,M,S);else if(we==="number")S=Er(o,z,M,S);else if(we==="bigint")S=Nr(o,z,M,S);else if(we==="boolean")S=Br(o,z,M,S);else if(M instanceof Date||Ft(M))S=Tr(o,z,M,S);else if(M===null||M===void 0&&T===!1)S=di(o,z,M,S);else if(ct(M))S=Ir(o,z,M,S);else if(M instanceof RegExp||Rt(M))S=jr(o,z,M,S);else if(we==="object"&&M._bsontype==null)S=Mr(o,z,M,S,b,k,B,T,F);else{if(typeof M=="object"&&M[Symbol.for("@@mdb.bson.version")]!==e)throw new Ce;if(M._bsontype==="ObjectId")S=Lr(o,z,M,S);else if(we==="object"&&M._bsontype==="Decimal128")S=Dr(o,z,M,S);else if(M._bsontype==="Long"||M._bsontype==="Timestamp")S=Rr(o,z,M,S);else if(M._bsontype==="Double")S=Ur(o,z,M,S);else if(M._bsontype==="Code")S=$r(o,z,M,S,b,k,B,T,F);else if(typeof M=="function"&&B)S=Jr(o,z,M,S);else if(M._bsontype==="Binary")S=zr(o,z,M,S);else if(M._bsontype==="BSONSymbol")S=qr(o,z,M,S);else if(M._bsontype==="DBRef")S=Vr(o,z,M,S,k,B,F);else if(M._bsontype==="BSONRegExp")S=Cr(o,z,M,S);else if(M._bsontype==="Int32")S=Fr(o,z,M,S);else if(M._bsontype==="MinKey"||M._bsontype==="MaxKey")S=Pr(o,z,M,S);else if(typeof M._bsontype<"u")throw new C(`Unrecognized or invalid _bsontype: ${String(M._bsontype)}`)}}}else{if(typeof(d==null?void 0:d.toBSON)=="function"&&(d=d.toBSON(),d!=null&&typeof d!="object"))throw new C("toBSON function did not return an object");for(const P of Object.keys(d)){let j=d[P];typeof(j==null?void 0:j.toBSON)=="function"&&(j=j.toBSON());const I=typeof j;if(typeof P=="string"&&!Sn.has(P)){if(P.match(Di)!=null)throw new C("key "+P+" must not contain null bytes");if(b){if(P[0]==="$")throw new C("key "+P+" must not start with '$'");if(~P.indexOf("."))throw new C("key "+P+" must not contain '.'")}}if(I==="string")S=Or(o,P,j,S);else if(I==="number")S=Er(o,P,j,S);else if(I==="bigint")S=Nr(o,P,j,S);else if(I==="boolean")S=Br(o,P,j,S);else if(j instanceof Date||Ft(j))S=Tr(o,P,j,S);else if(j===void 0)T===!1&&(S=di(o,P,j,S));else if(j===null)S=di(o,P,j,S);else if(ct(j))S=Ir(o,P,j,S);else if(j instanceof RegExp||Rt(j))S=jr(o,P,j,S);else if(I==="object"&&j._bsontype==null)S=Mr(o,P,j,S,b,k,B,T,F);else{if(typeof j=="object"&&j[Symbol.for("@@mdb.bson.version")]!==e)throw new Ce;if(j._bsontype==="ObjectId")S=Lr(o,P,j,S);else if(I==="object"&&j._bsontype==="Decimal128")S=Dr(o,P,j,S);else if(j._bsontype==="Long"||j._bsontype==="Timestamp")S=Rr(o,P,j,S);else if(j._bsontype==="Double")S=Ur(o,P,j,S);else if(j._bsontype==="Code")S=$r(o,P,j,S,b,k,B,T,F);else if(typeof j=="function"&&B)S=Jr(o,P,j,S);else if(j._bsontype==="Binary")S=zr(o,P,j,S);else if(j._bsontype==="BSONSymbol")S=qr(o,P,j,S);else if(j._bsontype==="DBRef")S=Vr(o,P,j,S,k,B,F);else if(j._bsontype==="BSONRegExp")S=Cr(o,P,j,S);else if(j._bsontype==="Int32")S=Fr(o,P,j,S);else if(j._bsontype==="MinKey"||j._bsontype==="MaxKey")S=Pr(o,P,j,S);else if(typeof j._bsontype<"u")throw new C(`Unrecognized or invalid _bsontype: ${String(j._bsontype)}`)}}}F.delete(d),o[S++]=0;const D=S-g;return o[g++]=D&255,o[g++]=D>>8&255,o[g++]=D>>16&255,o[g++]=D>>24&255,S}function Ol(o){return o!=null&&typeof o=="object"&&"_bsontype"in o&&typeof o._bsontype=="string"}var El={$oid:de,$binary:oe,$uuid:oe,$symbol:qt,$numberInt:Ot,$numberDecimal:Re,$numberDouble:xt,$numberLong:w,$minKey:zt,$maxKey:$t,$regex:$e,$regularExpression:$e,$timestamp:ze};function kn(o,d={}){if(typeof o=="number"){const g=o<=i&&o>=r,k=o<=s&&o>=n;if(d.relaxed||d.legacy)return o;if(Number.isInteger(o)&&!Object.is(o,-0)){if(g)return new Ot(o);if(k)return d.useBigInt64?BigInt(o):w.fromNumber(o)}return new xt(o)}if(o==null||typeof o!="object")return o;if(o.$undefined)return null;const b=Object.keys(o).filter(g=>g.startsWith("$")&&o[g]!=null);for(let g=0;g<b.length;g++){const k=El[b[g]];if(k)return k.fromExtendedJSON(o,d)}if(o.$date!=null){const g=o.$date,k=new Date;if(d.legacy)if(typeof g=="number")k.setTime(g);else if(typeof g=="string")k.setTime(Date.parse(g));else if(typeof g=="bigint")k.setTime(Number(g));else throw new Je(`Unrecognized type for EJSON date: ${typeof g}`);else if(typeof g=="string")k.setTime(Date.parse(g));else if(w.isLong(g))k.setTime(g.toNumber());else if(typeof g=="number"&&d.relaxed)k.setTime(g);else if(typeof g=="bigint")k.setTime(Number(g));else throw new Je(`Unrecognized type for EJSON date: ${typeof g}`);return k}if(o.$code!=null){const g=Object.assign({},o);return o.$scope&&(g.$scope=kn(o.$scope)),ht.fromExtendedJSON(o)}if(ln(o)||o.$dbPointer){const g=o.$ref?o:o.$dbPointer;if(g instanceof et)return g;const k=Object.keys(g).filter(T=>T.startsWith("$"));let B=!0;if(k.forEach(T=>{["$ref","$id","$db"].indexOf(T)===-1&&(B=!1)}),B)return et.fromExtendedJSON(g)}return o}function Nl(o,d){return o.map((b,g)=>{d.seenObjects.push({propertyName:`index ${g}`,obj:null});try{return tt(b,d)}finally{d.seenObjects.pop()}})}function An(o){const d=o.toISOString();return o.getUTCMilliseconds()!==0?d:d.slice(0,-5)+"Z"}function tt(o,d){if(o instanceof Map||an(o)){const b=Object.create(null);for(const[g,k]of o){if(typeof g!="string")throw new C("Can only serialize maps with string keys");b[g]=k}return tt(b,d)}if((typeof o=="object"||typeof o=="function")&&o!==null){const b=d.seenObjects.findIndex(g=>g.obj===o);if(b!==-1){const g=d.seenObjects.map(P=>P.propertyName),k=g.slice(0,b).map(P=>`${P} -> `).join(""),B=g[b],T=" -> "+g.slice(b+1,g.length-1).map(P=>`${P} -> `).join(""),F=g[g.length-1],S=" ".repeat(k.length+B.length/2),D="-".repeat(T.length+(B.length+F.length)/2-1);throw new C(`Converting circular structure to EJSON:
    ${k}${B}${T}${F}
    ${S}\\${D}/`)}d.seenObjects[d.seenObjects.length-1].obj=o}if(Array.isArray(o))return Nl(o,d);if(o===void 0)return null;if(o instanceof Date||Ft(o)){const b=o.getTime(),g=b>-1&&b<2534023188e5;return d.legacy?d.relaxed&&g?{$date:o.getTime()}:{$date:An(o)}:d.relaxed&&g?{$date:An(o)}:{$date:{$numberLong:o.getTime().toString()}}}if(typeof o=="number"&&(!d.relaxed||!isFinite(o))){if(Number.isInteger(o)&&!Object.is(o,-0)){if(o>=r&&o<=i)return{$numberInt:o.toString()};if(o>=n&&o<=s)return{$numberLong:o.toString()}}return{$numberDouble:Object.is(o,-0)?"-0.0":o.toString()}}if(typeof o=="bigint")return d.relaxed?Number(BigInt.asIntN(64,o)):{$numberLong:BigInt.asIntN(64,o).toString()};if(o instanceof RegExp||Rt(o)){let b=o.flags;if(b===void 0){const k=o.toString().match(/[gimuy]*$/);k&&(b=k[0])}return new $e(o.source,b).toExtendedJSON(d)}return o!=null&&typeof o=="object"?Tl(o,d):o}var Bl={Binary:o=>new oe(o.value(),o.sub_type),Code:o=>new ht(o.code,o.scope),DBRef:o=>new et(o.collection||o.namespace,o.oid,o.db,o.fields),Decimal128:o=>new Re(o.bytes),Double:o=>new xt(o.value),Int32:o=>new Ot(o.value),Long:o=>w.fromBits(o.low!=null?o.low:o.low_,o.low!=null?o.high:o.high_,o.low!=null?o.unsigned:o.unsigned_),MaxKey:()=>new $t,MinKey:()=>new zt,ObjectId:o=>new de(o),BSONRegExp:o=>new $e(o.pattern,o.options),BSONSymbol:o=>new qt(o.value),Timestamp:o=>ze.fromBits(o.low,o.high)};function Tl(o,d){if(o==null||typeof o!="object")throw new C("not an object instance");const b=o._bsontype;if(typeof b>"u"){const g={};for(const k of Object.keys(o)){d.seenObjects.push({propertyName:k,obj:null});try{const B=tt(o[k],d);k==="__proto__"?Object.defineProperty(g,k,{value:B,writable:!0,enumerable:!0,configurable:!0}):g[k]=B}finally{d.seenObjects.pop()}}return g}else{if(o!=null&&typeof o=="object"&&typeof o._bsontype=="string"&&o[Symbol.for("@@mdb.bson.version")]!==e)throw new Ce;if(Ol(o)){let g=o;if(typeof g.toExtendedJSON!="function"){const k=Bl[o._bsontype];if(!k)throw new C("Unrecognized or invalid _bsontype: "+o._bsontype);g=k(g)}return b==="Code"&&g.scope?g=new ht(g.code,tt(g.scope,d)):b==="DBRef"&&g.oid&&(g=new et(tt(g.collection,d),tt(g.oid,d),tt(g.db,d),tt(g.fields,d))),g.toExtendedJSON(d)}else throw new C("_bsontype must be a string, but was: "+typeof b)}}function xn(o,d){const b={useBigInt64:(d==null?void 0:d.useBigInt64)??!1,relaxed:(d==null?void 0:d.relaxed)??!0,legacy:(d==null?void 0:d.legacy)??!1};return JSON.parse(o,(g,k)=>{if(g.indexOf("\0")!==-1)throw new C(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(g)}`);return kn(k,b)})}function On(o,d,b,g){b!=null&&typeof b=="object"&&(g=b,b=0),d!=null&&typeof d=="object"&&!Array.isArray(d)&&(g=d,d=void 0,b=0);const k=Object.assign({relaxed:!0,legacy:!1},g,{seenObjects:[{propertyName:"(root)",obj:null}]}),B=tt(o,k);return JSON.stringify(B,d,b)}function jl(o,d){return d=d||{},JSON.parse(On(o,d))}function Cl(o,d){return d=d||{},xn(JSON.stringify(o),d)}var Nt=Object.create(null);Nt.parse=xn,Nt.stringify=On,Nt.serialize=jl,Nt.deserialize=Cl,Object.freeze(Nt);var En=1024*1024*17,ft=N.allocate(En);function Nn(o){ft.length<o&&(ft=N.allocate(o))}function Bn(o,d={}){const b=typeof d.checkKeys=="boolean"?d.checkKeys:!1,g=typeof d.serializeFunctions=="boolean"?d.serializeFunctions:!1,k=typeof d.ignoreUndefined=="boolean"?d.ignoreUndefined:!0,B=typeof d.minInternalBufferSize=="number"?d.minInternalBufferSize:En;ft.length<B&&(ft=N.allocate(B));const T=pi(ft,o,b,0,0,g,k,null),F=N.allocate(T);return F.set(ft.subarray(0,T),0),F}function Tn(o,d,b={}){const g=typeof b.checkKeys=="boolean"?b.checkKeys:!1,k=typeof b.serializeFunctions=="boolean"?b.serializeFunctions:!1,B=typeof b.ignoreUndefined=="boolean"?b.ignoreUndefined:!0,T=typeof b.index=="number"?b.index:0,F=pi(ft,o,g,0,0,k,B,null);return d.set(ft.subarray(0,F),T),T+F-1}function jn(o,d={}){return wn(N.toLocalBufferType(o),d)}function Cn(o,d={}){d=d||{};const b=typeof d.serializeFunctions=="boolean"?d.serializeFunctions:!1,g=typeof d.ignoreUndefined=="boolean"?d.ignoreUndefined:!0;return Li(o,b,g)}function Pn(o,d,b,g,k,B){const T=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},B),F=N.toLocalBufferType(o);let S=d;for(let D=0;D<b;D++){const P=F[S]|F[S+1]<<8|F[S+2]<<16|F[S+3]<<24;T.index=S,g[k+D]=wn(F,T),S=S+P}return S}var Pl=Object.freeze({__proto__:null,Code:ht,BSONSymbol:qt,DBRef:et,Binary:oe,ObjectId:de,UUID:De,Long:w,Timestamp:ze,Double:xt,Int32:Ot,MinKey:zt,MaxKey:$t,BSONRegExp:$e,Decimal128:Re,setInternalBufferSize:Nn,serialize:Bn,serializeWithBufferAndIndex:Tn,deserialize:jn,calculateObjectSize:Cn,deserializeStream:Pn,BSONValue:Ie,BSONError:C,BSONVersionError:Ce,BSONRuntimeError:Je,BSONType:Xe,EJSON:Nt});t.BSON=Pl,t.BSONError=C,t.BSONRegExp=$e,t.BSONRuntimeError=Je,t.BSONSymbol=qt,t.BSONType=Xe,t.BSONValue=Ie,t.BSONVersionError=Ce,t.Binary=oe,t.Code=ht,t.DBRef=et,t.Decimal128=Re,t.Double=xt,t.EJSON=Nt,t.Int32=Ot,t.Long=w,t.MaxKey=$t,t.MinKey=zt,t.ObjectId=de,t.Timestamp=ze,t.UUID=De,t.calculateObjectSize=Cn,t.deserialize=jn,t.deserializeStream=Pn,t.serialize=Bn,t.serializeWithBufferAndIndex=Tn,t.setInternalBufferSize=Nn}}),wf={};bf(wf,{AuthorizationStruct:()=>ga,ChatroomStruct:()=>ma,CoherenceMap:()=>Ws,CoherenceStruct:()=>Gs,CommentStruct:()=>va,Data:()=>kf,DataStruct:()=>ba,DateStruct:()=>ka,ECGStruct:()=>Xs,EDAStruct:()=>ha,EEGCoordinates:()=>Sf,EEGStruct:()=>wt,EMGStruct:()=>da,EventStruct:()=>_a,EyeTrackerStruct:()=>ca,FNIRSStruct:()=>Ys,FrequencyBandsStruct:()=>wr,GroupStruct:()=>ya,HRVStruct:()=>ua,IMUStruct:()=>la,NotificationStruct:()=>wa,PPGStruct:()=>fa,ProfileStruct:()=>pa,ScheduleStruct:()=>Sa,Struct:()=>xe,eegCoordinates:()=>jt,setCoordinate:()=>vr,structRegistry:()=>Af});function xe(t="struct",e={},i={_id:""},r={structType:"struct",_id:""}){var a;function s(l=""){return`${l+Math.floor(Math.random()+Math.random()*Math.random()*1e16)}`}let n={_id:s(t+"defaultId"),structType:t,ownerId:i==null?void 0:i._id,timestamp:Date.now(),parent:{structType:r==null?void 0:r.structType,_id:r==null?void 0:r._id}};return n.ownerId||delete n.ownerId,(a=n==null?void 0:n.parent)!=null&&a._id||delete n.parent,Object.keys(e).length>0&&Object.assign(n,e),n}var jt={FP1:[-21.2,66.9,12.1],FPZ:[1.4,65.1,11.3],FP2:[24.3,66.3,12.5],AF7:[-41.7,52.8,11.3],AF3:[-32.7,48.4,32.8],AFZ:[1.8,54.8,37.9],AF4:[35.1,50.1,31.1],AF8:[43.9,52.7,9.3],F5:[-51.4,26.7,24.7],F3:[-39.7,25.3,44.7],F1:[-22.1,26.8,54.9],FZ:[0,26.8,60.6],F2:[23.6,28.2,55.6],F4:[41.9,27.5,43.9],F6:[52.9,28.7,25.2],F7:[-52.1,28.6,3.8],F8:[53.2,28.4,3.1],FC5:[-59.1,3,26.1],FC3:[-45.5,2.4,51.3],FC1:[-24.7,.3,66.4],FCZ:[1,1,72.8],FC2:[26.1,3.2,66],FC4:[47.5,4.6,49.7],FC6:[60.5,4.9,25.5],FT9:[-53.8,-2.1,-29.1],FT7:[-59.2,3.4,-2.1],FT8:[60.2,4.7,-2.8],FT10:[55,-3.6,-31],T7:[-65.8,-17.8,-2.9],T5:[-61.5,-65.3,1.1],T3:[-70.2,-21.3,-10.7],T4:[71.9,-25.2,-8.2],T6:[59.3,-67.6,3.8],T8:[67.4,-18.5,-3.4],C5:[-63.6,-18.9,25.8],C3:[-49.1,-20.7,53.2],C1:[-25.1,-22.5,70.1],CZ:[.8,-21.9,77.4],C2:[26.7,-20.9,69.5],C4:[50.3,-18.8,53],C6:[65.2,-18,26.4],CP5:[-61.8,-46.2,22.5],CP3:[-46.9,-47.7,49.7],CP1:[-24,-49.1,66.1],CPZ:[.7,-47.9,72.6],CP2:[25.8,-47.1,66],CP4:[49.5,-45.5,50.7],CP6:[62.9,-44.6,24.4],TP9:[-73.6,-46.7,-4],TP7:[-63.6,-44.7,-4],TP8:[64.6,-45.4,-3.7],TP10:[74.6,-47.4,-3.7],P9:[-50.8,-51.3,-37.7],P7:[-55.9,-64.8,0],P5:[-52.7,-67.1,19.9],P3:[-41.4,-67.8,42.4],P1:[-21.6,-71.3,52.6],PZ:[.7,-69.3,56.9],P2:[24.4,-69.9,53.5],P4:[44.2,-65.8,42.7],P6:[54.4,-65.3,20.2],P8:[56.4,-64.4,.1],P10:[51,-53.9,-36.5],PO7:[-44,-81.7,1.6],PO3:[-33.3,-84.3,26.5],POZ:[0,-87.9,33.5],PO4:[35.2,-82.6,26.1],PO8:[43.3,-82,.7],O1:[-25.8,-93.3,7.7],OZ:[.3,-97.1,8.7],O2:[25,-95.2,6.2]};function vr(t,e={}){if(!jt[t.tag]&&t.position&&(jt[t.tag]=[t.position.x,t.position.y,t.position.z]),jt[t.tag]){let i={channel:"",position:{x:jt[t.tag][0],y:jt[t.tag][1],z:jt[t.tag][2]}};return Object.assign(e,i)}else return Object.assign(e,t)}function Sf(t=[],e=!0){let i=[];for(let r of t){let s=wt(r);i.push(s)}return e&&i.push(...Ws({channelDicts:t})),i}function wr(t=[],e={}){let i={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]};return t.forEach(r=>i[r]=[]),Object.assign(e,i)}function wt(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s=wr(),n={tag:t,position:{x:0,y:0,z:0},count:0,times:[],raw:[],filtered:[],fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(s)),means:JSON.parse(JSON.stringify(s)),startTime:Date.now()},a=xe("eeg",n,i,r);return t&&vr(n,a),Object.assign(a,e)}function Gs(t={0:wt("FP1"),1:wt("FP2")},e={},i={_id:""},r={structType:"struct",_id:""}){var l,c,f,u,h,p,y,_,m,A,O,E,L,H;let s=wr(),n={tag:((l=t[0])==null?void 0:l.tag)+"::"+((c=t[1])==null?void 0:c.tag),x0:(u=(f=t[0])==null?void 0:f.position)==null?void 0:u.x,y0:(p=(h=t[0])==null?void 0:h.position)==null?void 0:p.y,z0:(_=(y=t[0])==null?void 0:y.position)==null?void 0:_.z,x1:(A=(m=t[1])==null?void 0:m.position)==null?void 0:A.x,y1:(E=(O=t[1])==null?void 0:O.position)==null?void 0:E.y,z1:(H=(L=t[1])==null?void 0:L.position)==null?void 0:H.z,fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(s)),means:JSON.parse(JSON.stringify(s)),startTime:Date.now()},a=xe("coherence",n,i,r);return Object.assign(a,e)}function Ws(t={channelDicts:[{ch:0,tag:"FP1",analyze:!1},{ch:1,tag:"FP2",analyze:!1}],taggedOnly:!0},e={},i={_id:""},r={structType:"struct",_id:""}){for(var s=[],n=1,a=0,l=0;l<t.channelDicts.length*(t.channelDicts.length+1)/2-t.channelDicts.length;l++){if(t.taggedOnly===!1||t.taggedOnly===!0&&t.channelDicts[a].tag!==null&&t.channelDicts[a+n].tag!==null&&t.channelDicts[a].tag!=="other"&&t.channelDicts[a+n].tag!=="other"&&t.channelDicts[a].analyze===!0&&t.channelDicts[a+n].analyze===!0){var c=wt(t.channelDicts[a].tag),f=wt(t.channelDicts[a+n].tag);s.push(Gs({0:c,1:f},{},i,r))}n++,n+a===t.channelDicts.length&&(a++,n=1)}return s}function Ys(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,position:{x:0,y:0,z:0},count:0,times:[],red:[],ir:[],ir2:[],ambient:[],ratio:[],temp:[],beat_detect:{beats:[],breaths:[],rir:[],rir2:[],drir_dt:[],localmins:[],localmaxs:[],val_dists:[],peak_dists:[],localmins2:[],localmaxs2:[],val_dists2:[],peak_dists2:[]},startTime:Date.now()},n=xe("fnirs",s,i,r);return t&&vr(s,n),Object.assign(n,e)}function la(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[],startTime:Date.now()},n=xe("imu",s,i,r);return t&&vr(s,n),Object.assign(n,e)}function ca(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,count:0,times:[],x:[],y:[],smax:[],smay:[],startTime:Date.now()},n=xe("eyetracker",s,i,r);return Object.assign(n,e)}function Xs(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,count:0,times:[],raw:[],filtered:[],bpm:[],hrv:[],startTime:Date.now()},n=xe("ecg",s,i,r);return Object.assign(n,e)}function ha(t="",e={},i={_id:""},r={structType:"struct",_id:""}){}function fa(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s=Ys(t,i,r,e);return s.structType="ppg",s}function ua(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s=Xs(t,i,r,e);return s.structType="hrv",s}function da(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s=wt(t,i,r,e);return s.structType="emg",s}function pa(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let n=xe("profile",{tag:t,name:"",username:"",firstName:"",lastName:"",email:"",phone:"",sex:"",birthday:"",type:"",pictureUrl:"",userRoles:{},socials:{},data:{},accessToken:"",refreshToken:"",id:""},i,r);return Object.assign(n,e)}function ga(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let n=xe("authorization",{tag:t,authorizedId:"",authorizedName:"",authorizerId:"",authorizerName:"",authorizations:{},structs:{},excluded:{},groups:{},status:"PENDING",expires:!1,associatedAuthId:""},i,r);return Object.assign(n,e)}function ya(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let n=xe("group",{tag:t,name:"",details:"",admins:{},peers:{},clients:{},users:{}},i,r);return Object.assign(n,e)}function kf(t,e){return{type:t,data:e,timestamp:Date.now()}}function ba(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,title:"",author:"",expires:!1,type:"",data:new Array},n=xe("data",s,i,r);return Object.assign(n,e)}function _a(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,event:"",author:"",startTime:"",endTime:"",grade:0,notes:"",attachments:new Array,users:{}},n=xe("event",s,i,r);return Object.assign(n,e)}function ma(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,message:"",topic:"",author:"",attachments:new Array,comments:new Array,replies:new Array,users:{},audioChatActive:!1,videoChatActive:!1},n=xe("chatroom",s,i,r);return Object.assign(n,e)}function va(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,author:"",replyTo:"",message:"",rating:0,replies:new Array,users:{},attachments:new Array},n=xe("comment",s,i,r);return Object.assign(n,e)}function wa(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let n=xe("notification",{tag:t,note:"",parentUserId:""},i,r);return Object.assign(n,e)}function Sa(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,title:"",author:"",attachments:new Array,dates:new Array},n=xe("schedule",s,i,r);return Object.assign(n,e)}function ka(t="",e={},i={_id:""},r={structType:"struct",_id:""}){let s={tag:t,timeSet:"",notes:"",recurs:"NEVER",attachments:new Array},n=xe("date",s,i,r);return Object.assign(n,e)}var Af={Struct:xe,EEGStruct:wt,FNIRSStruct:Ys,CoherenceStruct:Gs,CoherenceMap:Ws,FrequencyBandsStruct:wr,IMUStruct:la,EyeTrackerStruct:ca,ECGStruct:Xs,EDAStruct:ha,PPGStruct:fa,HRVStruct:ua,EMGStruct:da,ProfileStruct:pa,AuthorizationStruct:ga,GroupStruct:ya,DataStruct:ba,EventStruct:_a,ChatroomStruct:ma,CommentStruct:va,NotificationStruct:wa,ScheduleStruct:Sa,DateStruct:ka};mf(vf());var X={collision:{setupEntities:function(t){for(const e in t){const i=t[e];i.components&&!i.components[this.__node.tag]||this.setupEntity(i)}return t},setupEntity:function(t){return"collisionEnabled"in t||(t.collisionEnabled=!0),t.collisionType||(t.collisionType="sphere"),t.collisionRadius||(t.collisionRadius=1),t.collisionBoundsScale||(t.collisionBoundsScale={x:1,y:1,z:1}),t.colliding||(t.colliding={}),t.position||(t.position={x:0,y:0,z:0}),t},__node:{tag:"collision"},__operator:function(t){let e=this.entityKeys;for(let i=0;i<e.length;i++){const r=t[e[i]];if(!(r.components&&(!r.components[this.__node.tag]||!r.collisionEnabled))&&r.collisionEnabled)for(let s=0;s<e.length;s++){if(i===s)continue;const n=t[e[s]];if(n.components&&!n.components[this.__node.tag]||!n.collisionEnabled)continue;let a=X.collision.collisionCheck(r,n);a!==!1&&(r.colliding||(r.colliding={}),n.colliding||(n.colliding={}),r.colliding[n.__node.tag]=a,n.colliding[r.__node.tag]=a)}}return t},collisionCheck:(t,e)=>{if(t.collisionEnabled===!1||e.collisionEnabled===!1)return!1;const i=X.collision.distance(t.position,e.position);if(i<Math.max(...Object.values(t.collisionBoundsScale))*t.collisionRadius+Math.max(...Object.values(e.collisionBoundsScale))*e.collisionRadius){let r=!1;if(t.collisionType==="sphere"?e.collisionType==="sphere"?r=X.collision.sphereCollisionCheck(t,e,i):e.collisionType==="box"?r=X.collision.sphereBoxCollisionCheck(t,e,i):e.collisionType==="point"&&(r=X.collision.isPointInsideSphere(e.position,t,i)):t.collisionType==="box"?e.collisionType==="sphere"?r=X.collision.sphereBoxCollisionCheck(e,t,i):e.collisionType==="box"?r=X.collision.boxCollisionCheck(t,e):e.collisionType==="point"&&(r=X.collision.isPointInsideBox(t.position,t)):t.collisionType==="point"&&(e.collisionType==="sphere"?r=X.collision.isPointInsideSphere(t.position,e,i):e.collisionType==="box"&&(r=X.collision.isPointInsideBox(t.position,e))),r)return i}return!1},sphereCollisionCheck:(t,e,i)=>(i===void 0&&(i=X.collision.distance(t.position,e.position)),i<t.collisionRadius+e.collisionRadius),boxCollisionCheck:(t,e)=>{let i=(t.position.x-t.collisionRadius)*t.collisionBoundsScale.x,r=(t.position.x+t.collisionRadius)*t.collisionBoundsScale.x,s=(t.position.y-t.collisionRadius)*t.collisionBoundsScale.y,n=(t.position.y+t.collisionRadius)*t.collisionBoundsScale.y,a=(t.position.z-t.collisionRadius)*t.collisionBoundsScale.z,l=(t.position.z+t.collisionRadius)*t.collisionBoundsScale.z,c=(e.position.x-e.collisionRadius)*t.collisionBoundsScale.x,f=(e.position.x+e.collisionRadius)*t.collisionBoundsScale.x,u=(e.position.y-e.collisionRadius)*t.collisionBoundsScale.y,h=(e.position.y+e.collisionRadius)*t.collisionBoundsScale.y,p=(e.position.z-e.collisionRadius)*t.collisionBoundsScale.z,y=(e.position.z+e.collisionRadius)*t.collisionBoundsScale.z;return(r<=f&&r>=c||i<=f&&i>=c)&&(n<=h&&n>=u||s<=h&&s>=u)&&(l<=y&&l>=p||a<=y&&a>=p)},sphereBoxCollisionCheck:(t,e,i)=>{let r=(e.position.x-e.collisionRadius)*e.collisionBoundsScale.x,s=(e.position.x+e.collisionRadius)*e.collisionBoundsScale.x,n=(e.position.y-e.collisionRadius)*e.collisionBoundsScale.y,a=(e.position.y+e.collisionRadius)*e.collisionBoundsScale.y,l=(e.position.z-e.collisionRadius)*e.collisionBoundsScale.z,c=(e.position.z+e.collisionRadius)*e.collisionBoundsScale.z,f={x:Math.max(r,Math.min(t.position.x,s)),y:Math.max(n,Math.min(t.position.y,a)),z:Math.max(l,Math.min(t.position.z,c))};return i===void 0&&(i=X.collision.distance(t.position,f)),i>t.collisionRadius},isPointInsideSphere:(t,e,i)=>(i===void 0&&(i=X.collision.distance(t,e.position)),i<e.collisionRadius),isPointInsideBox:(t,e)=>{let i=(e.position.x-e.collisionRadius)*e.collisionBoundsScale.x,r=(e.position.x+e.collisionRadius)*e.collisionBoundsScale.x,s=(e.position.y-e.collisionRadius)*e.collisionBoundsScale.x,n=(e.position.y+e.collisionRadius)*e.collisionBoundsScale.x,a=(e.position.z-e.collisionRadius)*e.collisionBoundsScale.x,l=(e.position.z+e.collisionRadius)*e.collisionBoundsScale.x;return t.x>=i&&t.x<=r&&t.y>=s&&t.y<=n&&t.z>=a&&t.z<=l},closestPointOnLine:(t,e,i)=>{let r={x:i.x-e.x,y:i.y-e.y,z:i.z-e.z},s={x:e.x-t.x,y:e.y-t.y,z:e.z-t.z},n={x:i.x-t.x,y:i.y-t.y,z:i.z-t.z},a=X.collision.dot(s,r);if(a<=0)return e;let l=X.collision.dot(n,r);if(l<=0)return i;let c=1/(a+l);return{x:e.x+(i.x-e.x)*a*c,y:e.y+(i.y-e.y)*a*c,z:e.z+(i.z-e.z)*a*c}},closestPointOnPolygon:(t,e,i,r)=>{let s=X.collision.calcNormal(e,i,r),n=X.collision.dot(t,s)-X.collision.dot(e,s),a=X.collision.vecadd(t,X.collision.vecscale(s,-n)),l=r[0]-e[0],c=r[1]-e[1],f=r[2]-e[2],u=i[0]-e[0],h=i[1]-e[1],p=i[2]-e[2],y=a[0]-e[0],_=a[1]-e[1],m=a[2]-e[2],A=l*l+c*c+f*f,O=l*u+c*h+f*p,E=l*y+c*_+f*m,L=u*u+h*h+p*p,H=u*y+h*_+p*m,K=A*L-O*O;if(Math.abs(K)<1e-30)return;let le=1/K,V=(L*E-O*H)*le,G=(A*H-O*E)*le;if(V>=0&&G>=0&&V+G<1)return a},calcNormal:(t,e,i,r=!0)=>{var s=X.collision.makeVec(t,e),n=X.collision.makeVec(t,i);return r===!0?X.collision.normalize(X.collision.cross3D(s,n)):X.collision.normalize(X.collision.cross3D(n,s))},dot:(t,e)=>{let i=0;for(const r in t)i+=t[r]*e[r];return i},makeVec(t,e){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z}},vecadd:(t,e)=>{let i=Object.assign({},t);for(const r in i)i[r]+=e[r];return i},vecsub:(t,e)=>{let i=Object.assign({},t);for(const r in i)i[r]-=e[r];return i},vecmul:(t,e)=>{let i=Object.assign({},t);for(const r in i)i[r]*=e[r];return i},vecdiv:(t,e)=>{let i=Object.assign({},t);for(const r in i)i[r]/=e[r];return i},vecscale:(t,e)=>{let i=Object.assign({},t);for(const r in i)i[r]*=e;return i},distance:(t,e)=>{let i=0;for(const r in t)i+=Math.pow(t[r]-e[r],2);return Math.sqrt(i)},magnitude:t=>{let e=0;for(const i in t)e+=t[i]*t[i];return Math.sqrt(e)},normalize:t=>{let e=X.collision.magnitude(t),i=e?1/e:0,r={};for(const s in t)r[s]=t[s]*i;return r},distance3D(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z))},cross3D(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},nearestNeighborSearch(t,e=1e15){var i={};for(const a in t){let l={tag:a,position:void 0,neighbors:[]};l.position=t[a].position,i[a]=l}for(const a in i){for(const l in i){var r=X.collision.distance3D(i[a].position,i[l].position);if(r<e){var s={tag:l,position:t[l].position,dist:r};i[a].neighbors.push(s);var n={tag:l,position:t[a].position,dist:r};i[l].neighbors.push(n)}}i[a].neighbors.sort(function(l,c){return l.dist-c.dist})}return i},generateBoundingVolumeTree(t,e="octree",i=1e15,r=3){let s={proto:{parent:void 0,children:{},entities:{},collisionType:"box",collisionRadius:1,collisionBoundsScale:{x:1,y:1,z:1},position:{x:0,y:0,z:0}},tree:{}},n,a,l,c=0,f=0,u=0,h={},p=i;for(const A in t){const O=t[A];let E=O.position.x+O.collisionRadius*O.collisionBoundsScale.x,L=O.position.y+O.collisionRadius*O.collisionBoundsScale.y,H=O.position.z+O.collisionRadius*O.collisionBoundsScale.z;n<E&&(n=E),c>E&&(c=E),a<L&&(a=L),f>L&&(f=L),l<H&&(l=H),u>H&&(u=H),p>O.collisionRadius&&(p=O.collisionRadius),h[A]=O.position}let y=JSON.parse(JSON.stringify(s.proto)),_={x:(n+c)*.5,y:(a+f)*.5,z:(l+u)*.5},m={x:n-_.x,y:a-_.y,z:l-_.z};if(y.position=_,y.collisionBoundsScale=m,y.entities=t,s.tree=y,p*=2,e==="octree"){let A=function(E,L){let H={x:E.x+L.x,y:E.y+L.y,z:E.z+L.z},K={x:E.x-L.x,y:E.y+L.y,z:E.z+L.z},le={x:E.x+L.x,y:E.y-L.y,z:E.z+L.z},V={x:E.x+L.x,y:E.y+L.y,z:E.z-L.z},G={x:E.x-L.x,y:E.y-L.y,z:E.z+L.z},ye={x:E.x-L.x,y:E.y+L.y,z:E.z-L.z},pe={x:E.x+L.x,y:E.y-L.y,z:E.z-L.z},ee={x:E.x-L.x,y:E.y-L.y,z:E.z-L.z};return[H,K,le,V,G,ye,pe,ee]},O=function(E){let L={x:E.collisionBoundsScale.x*.5,y:E.collisionBoundsScale.y*.5,z:E.collisionBoundsScale.z*.5},H=A(E.position,L),K=Object.assign({},E.bodies);for(let le=0;le<8;le++){let V=Object.assign(JSON.parse(JSON.stringify(s.proto)),{position:H[le],collisionBoundsScale:L});V.parent=E;for(const G in K)X.collision.collisionCheck(K[G],V)&&(V.entities[G]=K[G],delete K[G]);Object.keys(V.entities).length>r-1&&(E.children[le]=V,V.parent=E,Object.keys(V.entities).length>r&&V.collisionRadius*.5>p&&O(V))}};return O(y),y}else{let A=X.collision.nearestNeighborSearch(h,i),O=Object.keys(A),E=O[Math.floor(Math.random()*O.length)],L=!0,H=0,K=(V,G)=>{let ye={},pe={},ee=Object.keys(V);for(;L&&H<ee.length;){let $=V[E],ae=0,Ye=0,Xe=h[$.tag].x-G[$.tag].collisionBoundsScale.x,C=h[$.tag].y-G[$.tag].collisionBoundsScale.y,Ce=h[$.tag].z-G[$.tag].collisionBoundsScale.z,Je=h[$.tag].x+G[$.tag].collisionBoundsScale.x,Ke=h[$.tag].y+G[$.tag].collisionBoundsScale.y,ge=h[$.tag].z+G[$.tag].collisionBoundsScale.z,ie=JSON.parse(JSON.stringify(s.proto));ie.tag=`bound${Math.floor(Math.random()*1e15)}`,ie.children[$.tag]=G[$.tag],ie.bodies[$.tag]=t[$.tag],G[$.tag].parent=ie,pe[$.tag]=!0,ae++,Ye++;let Pe=Object.keys($.neighbors);for(;ae<Pe.length&&Ye<3;){if(pe[$.neighbors[ae].tag]){ae++;continue}let Oe=h[$.neighbors[ae].tag].x-G[$.neighbors[ae].tag].collisionBoundsScale.x,Le=h[$.neighbors[ae].tag].y-G[$.neighbors[ae].tag].collisionBoundsScale.y,Qe=h[$.neighbors[ae].tag].z-G[$.neighbors[ae].tag].collisionBoundsScale.z,N=h[$.neighbors[ae].tag].x+G[$.neighbors[ae].tag].collisionBoundsScale.x,At=h[$.neighbors[ae].tag].y+G[$.neighbors[ae].tag].collisionBoundsScale.y,Pi=h[$.neighbors[ae].tag].z+G[$.neighbors[ae].tag].collisionBoundsScale.z;Xe>Oe&&(Xe=Oe),Je<N&&(Je=N),C>Le&&(C=Le),Ke<At&&(Ke=At),Ce>Qe&&(Ce=Qe),ge<Pi&&(ge=Pi),ie.children[$.neighbors[ae].tag]=G[$.neighbors[ae].tag],ie.entities[$.neighbors[ae].tag]=t[$.neighbors[ae].tag],G[$.neighbors[ae].tag].parent=ie,pe[$.neighbors[ae].tag]=!0,ae++,Ye++}let Te={x:(Je+Xe)*.5,y:(Ke+C)*.5,z:(ge+Ce)*.5},Fe={x:Je-Te.x,y:Ke-Te.y,z:ge-Te.z};for(ie.position=Te,ie.collisionBoundsScale=Fe,ie.bodies.length===1&&(ie=$),ye[ie.tag]=ie;ae<$.neighbors.length&&pe[$.neighbors[ae].tag];)ae++;ae<$.neighbors.length?E=$.neighbors[ae].tag:Object.keys(pe).length<Object.keys(V).length?E=O[0]:L=!1,H++}return ye},le=K(A,t);for(;Object.keys(le).length>2;){let V=X.collision.nearestNeighborSearch(le,i);le=K(V,le)}return y.children=le,y.children.forEach(V=>{V.parent=y}),y}}},collider:{lastTime:performance.now(),setupEntities:function(t){for(const e in t){const i=t[e];i.components&&!i.components[this.__node.tag]||this.setupEntity(i)}return t},setupEntity:function(t){return"collisionEnabled"in t||X.collision.setupEntity(t),"boundingBox"in t||(t.boundingBox={bot:0,top:100,left:0,right:100,front:0,back:100}),"position"in t||X.movement.setupEntity(t),"restitution"in t||(t.restitution=1),"useBoundingBox"in t||(t.useBoundingBox=!0),!t.position.x&&!t.position.y&&!t.position.z&&(t.position.x=Math.random()*t.boundingBox.right,t.position.y=Math.random()*t.boundingBox.back,t.position.z=Math.random()*t.boundingBox.top),t},__operator:function(t){let e=this.entityKeys;for(let i=0;i<e.length;i++){const r=t[e[i]];if(!(r.components&&(!r.components[this.__node.tag]||!r.collisionEnabled))&&(r.useBoundingBox&&this.checkBoundingBox(r),!!r.collisionEnabled&&r.colliding)){for(const s in r.colliding){const n=t[s];if(r.colliding[s]===!1){delete r.colliding[s],delete n.colliding[r.__node.tag];continue}n.collisionEnabled&&(n.collisionType==="box"?this.resolveBoxCollision(r,n,r.colliding[s]):r.collisionType==="box"?(r.fixed=!0,this.resolveSphereCollisions(r,n,r.colliding[s]),r.fixed=!1):(this.resolveSphereCollisions(r,n,r.colliding[s]),delete n.colliding[r.__node.tag]),delete r.colliding[n.__node.tag])}delete r.colliding}}return t},__node:{tag:"collider"},checkBoundingBox:t=>{const e=t.collisionRadius*t.collisionBoundsScale.x,i=t.collisionRadius*t.collisionBoundsScale.y,r=t.collisionRadius*t.collisionBoundsScale.z;t.position.y-i<=t.boundingBox.front&&(t.velocity.y*=-t.restitution,t.position.y=t.boundingBox.front+i),t.position.y+i>=t.boundingBox.back&&(t.velocity.y*=-t.restitution,t.position.y=t.boundingBox.back-i),t.position.x-e<=t.boundingBox.left&&(t.velocity.x*=-t.restitution,t.position.x=t.boundingBox.left+e),t.position.x+e>=t.boundingBox.right&&(t.velocity.x*=-t.restitution,t.position.x=t.boundingBox.right-e),t.position.z-r<=t.boundingBox.bot&&(t.velocity.z*=-t.restitution,t.position.z=t.boundingBox.bot+r),t.position.z+r>=t.boundingBox.top&&(t.velocity.z*=-t.restitution,t.position.z=t.boundingBox.top-r)},resolveBoxCollision:(t,e,i)=>{let r=X.collision.makeVec(t.position,e.position);var s=Object.values(r);let n,a=1/0,l=-1;s[c]<0&&(l=1),i&&(l=-l);for(const p in t.position){let y=Math.abs(e.position[p]-t.position[p]);y<a&&Math.abs(e.position[p]-t.position[p]+t.velocity[p]*1e-17)<y&&(n=p,a=y)}var c=s.indexOf(n);c===0&&(c="x"),c===1&&(c="y"),c===2&&(c="z"),c===3&&(c="w");let f=e.position[c]+e.collisionRadius*e.collisionBoundsScale[c]*l;if(i){let p=f-t.collisionRadius*t.collisionBoundsScale[c]*l;t.position[c]=p}else{let p=f+t.collisionRadius*t.collisionBoundsScale[c]*l;t.position[c]=p}t.velocity[c]=-t.velocity[c]*t.restitution,i&&(t.force[c]=-t.velocity[c]);var u=X.collision.magnitude(e.acceleration),h=X.collision.normalize(e.acceleration);t.force[c]=-h[c]*u*e.mass,i&&(t.force[c]=-t.force[c])},resolveSphereCollisions:(t,e,i)=>{i===void 0&&(i=X.collision.distance(t.position,e.position));let r=X.collision.normalize(X.collision.makeVec(t.position,e.position)),s=t.mass+e.mass,n=t.mass/s,a=1-n;t.fixed===!1?(t.position.x+=r.x*a*1.01,t.position.y+=r.y*a*1.01,t.position.z+=r.z*a*1.001):(e.position.x-=r.x*1.01,e.position.y-=r.y*1.01,e.position.z-=r.z*1.01),e.fixed===!1?(e.position.x+=r.x*n*1.01,e.position.y+=r.y*n*1.01,e.position.z+=r.z*n*1.01):(t.position.x+=r.x*1.01,t.position.y+=r.y*1.01,t.position.z+=r.z*1.01),i=X.collision.distance(t.position,e.position);let l={x:t.velocity.x-e.velocity.x,y:t.velocity.y-e.velocity.y,z:t.velocity.z-e.velocity.z},c=l.x*r.x+l.y*r.y+l.z*r.z;if(c>0){let f=2*c/s;t.fixed===!1&&(t.velocity.x-=f*r.x*e.mass*t.restitution,t.velocity.y-=f*r.y*e.mass*t.restitution,t.velocity.z-=f*r.z*e.mass*t.restitution),e.fixed===!1&&(e.velocity.x+=f*r.x*e.mass*e.restitution/e.mass,e.velocity.y+=f*r.y*e.mass*e.restitution/e.mass,e.velocity.z+=f*r.z*e.mass*e.restitution/e.mass)}}},nbody:{lastTime:performance.now(),G:6674e-14,setupEntities:function(t){for(const e in t){const i=t[e];i.components&&!i.components[this.__node.tag]||this.setupEntity(i)}return t},setupEntity:function(t){return"collisionEnabled"in t||X.collider.setupEntity(t),t.isAttractor=!0,"attractorGroup"in t||(t.attractorGroup=0),"attractorFrameSearchMax"in t||(t.attractorFrameSearchMax=10),"attractorGroupRules"in t||(t.attractorGroupRules={0:{G:this.G,maxDist:void 0}}),t},__operator:function(t){let e=this.entityKeys;for(let i=0;i<e.length;i++){const r=t[e[i]];if(r.components&&!r.components[this.__node.tag]||!r.mass)continue;let s=0;e:for(let n=0;n<e.length;n++){let a=e[Math.floor(Math.random()*e.length)];s++;const l=t[a];if(l.components&&!l.components[this.__node.tag]||!l.mass||!l.isAttractor)continue e;if(this.attract(r,l,void 0,this.G),s>r.attractorFrameSearchMax)break e}}return t},__node:{tag:"nbody"},attract:function(t,e,i,r=this.G,s){i===void 0&&(i=X.collision.distance3D(t.position,e.position)),s===void 0&&(s=X.collision.normalize(X.collision.makeVec(t.position,e.position)));let n=0;i<.01&&(i=.01),t.attractorGroupRules[e.attractorGroup]?typeof t.attractorGroupRules[e.attractorGroup]=="object"?t.attractorGroupRules[e.attractorGroup].maxDist&&t.attractorGroupRules[e.attractorGroup].maxDist<i||(n=t.attractorGroupRules[e.attractorGroup].G*t.mass*e.mass/(i*i)):n=t.attractorGroupRules[e.attractorGroup]*t.mass*e.mass/(i*i):n=r*t.mass*e.mass/(i*i),t.force.x+=s.x*n,t.force.y+=s.y*n,t.force.z+=s.z*n,e.force.x-=s.x*n,e.force.y-=s.y*n,e.force.z-=s.z*n}},boid:{lastTime:performance.now(),defaultAnchor:{x:Math.random(),y:Math.random(),z:Math.random(),mul:.006},setupEntities:function(t){for(const e in t){const i=t[e];this.setupEntity(i)}return t},setupEntity:function(t){t.position||X.collider.setupEntity(t);let e=Object.assign({},this.defaultAnchor);e.x*=t.boundingBox.right,e.y*=t.boundingBox.back,e.z*=t.boundingBox.top;let i={cohesion:1e-5,separation:1e-4,alignment:.006,swirl:e,attractor:Object.assign(e,{mul:.002}),useCohesion:!0,useSeparation:!0,useAlignment:!0,useSwirl:!0,useAttractor:!0,useAttraction:!1,groupRadius:200,groupSize:5,searchLimit:5};return t.boid?t.boid=Object.assign(i,t.boid):t.boid=i,this.entityKeys.length>1e3&&(t.boid.groupSize=1,t.boid.searchLimit=1),t},__operator:function(t){let e=performance.now(),i=e-this.lastTime;this.lastTime=e;let r=this.entityKeys,s=r.length,n=1/i,a=-1;for(let l=0;l<r.length;l++){a++;let c=t[r[l]];const f=[],u=[],h=[c.position.x,c.position.y,c.position.z,0,0,0,c.velocity.x,c.velocity.y,c.velocity.z,0,0,0,0,0,0,0,0,0];let p=1,y=-1;e:for(let O=0;O<r.length;O++){if(y++,u.length>c.boid.groupSize||y>c.boid.searchLimit)break e;let E=r[Math.floor(Math.random()*s)];if(y===a||E===r[l]||f.indexOf(E)>-1)continue e;{let L=t[E],H=Math.sqrt((c.position.x-L.position.x)*(c.position.x-L.position.x)+(c.position.y-L.position.y)*(c.position.y-L.position.y)+(c.position.z-L.position.z)*(c.position.z-L.position.z));if(H>c.boid.groupRadius)continue e;{u.push(H),f.push(E);let K;if((c.boid.useSeparation||c.boid.useAlignment)&&(K=c.boid.groupRadius/(H*H),K>c.maxSpeed?K=c.maxSpeed:K<-c.maxSpeed&&(K=-c.maxSpeed)),c.boid.useCohesion&&(h[0]+=(L.position.x-c.position.x)*.5*H*n,h[1]+=(L.position.y-c.position.y)*.5*H*n,h[2]+=(L.position.z-c.position.z)*.5*H*n),isNaN(H)||isNaN(h[0])||isNaN(L.position.x)){console.log(H,l,E,c.position,L.position,h),c.position.x=NaN;return}c.boid.useSeparation&&(h[3]=h[3]+(c.position.x-L.position.x)*K,h[4]=h[4]+(c.position.y-L.position.y)*K,h[5]=h[5]+(c.position.z-L.position.z)*K),c.boid.useAttraction&&L.boid.useAttraction&&X.nbody.attract(c,L,H),c.boid.useAlignment&&(h[6]=h[6]+L.velocity.x*K,h[7]=h[7]+L.velocity.y*K,h[8]=h[8]+L.velocity.z*K),p++}}}let _=1/p;c.boid.useCohesion?(h[0]=c.boid.cohesion*(h[0]*_),h[1]=c.boid.cohesion*(h[1]*_),h[2]=c.boid.cohesion*(h[2]*_)):(h[0]=0,h[1]=0,h[2]=0),c.boid.useSeparation?(h[3]=c.boid.separation*h[3],h[4]=c.boid.separation*h[4],h[5]=c.boid.separation*h[5]):(h[3]=0,h[4]=0,h[5]=0),c.boid.useAlignment?(h[6]=-(c.boid.alignment*h[6]*_),h[7]=c.boid.alignment*h[7]*_,h[8]=c.boid.alignment*h[8]*_):(h[6]=0,h[7]=0,h[8]=0);const m=[0,0,0];c.boid.useSwirl==!0&&(h[9]=-(c.position.y-c.boid.swirl.y)*c.boid.swirl.mul,h[10]=(c.position.z-c.boid.swirl.z)*c.boid.swirl.mul,h[11]=(c.position.x-c.boid.swirl.x)*c.boid.swirl.mul);const A=[0,0,0];c.boid.useAttractor==!0&&(h[12]=(c.boid.attractor.x-c.position.x)*c.boid.attractor.mul,(c.position.x>c.boundingBox.left||c.position.x<c.boundingBox.right)&&(h[12]*=3),h[13]=(c.boid.attractor.y-c.position.y)*c.boid.attractor.mul,(c.position.y>c.boundingBox.top||c.position.y<c.boundingBox.bottom)&&(h[13]*=3),h[14]=(c.boid.attractor.z-c.position.z)*c.boid.attractor.mul,(c.position.z>c.boundingBox.front||c.position.z<c.boundingBox.back)&&(h[14]*=3)),c.velocity.x=c.velocity.x+h[0]+h[3]+h[6]+h[9]+h[12]+h[15],c.velocity.y=c.velocity.y+h[1]+h[4]+h[7]+h[10]+h[13]+h[16],c.velocity.z=c.velocity.z+h[2]+h[5]+h[8]+h[11]+h[14]+h[17],isNaN(c.velocity.x)&&console.error(c,l,p,c.position,c.velocity,m,A)}return t},__node:{tag:"boid"}},movement:{__node:{tag:"movement"},lastTime:performance.now(),setupEntities:function(t){for(const e in t){const i=t[e];i.components&&!i.components[this.__node.tag]||this.setupEntity(i)}},setupEntity:function(t){return"mass"in t||(t.mass=1),"fixed"in t||(t.fixed=!1),t.force||(t.force={x:0,y:0,z:0}),"mass"in t||(t.mass=1),"gravity"in t||(t.gravity=-9.81),t.acceleration||(t.acceleration={x:0,y:0,z:0}),t.velocity||(t.velocity={x:0,y:0,z:0}),"maxSpeed"in t||(t.maxSpeed=10),t.position||(t.position={x:0,y:0,z:0}),t},__operator:function(t){let e=performance.now(),i=(e-this.lastTime)*.001;this.lastTime=e;let r=this.entityKeys;for(let s=0;s<r.length;s++){const n=t[r[s]];if(!(n.components&&!n.components[this.__node.tag])&&!n.fixed){if(n.mass&&(n.force.x&&(n.acceleration.x+=n.force.x/n.mass,n.force.x=0),n.force.y&&(n.acceleration.y+=n.force.y/n.mass,n.force.y=0),n.force.z&&(n.acceleration.z+=n.force.z/n.mass+n.gravity,n.force.z=0)),n.drag&&(n.acceleration.x&&(n.acceleration.x-=n.acceleration.x*n.drag*i),n.acceleration.y&&(n.acceleration.y-=n.acceleration.y*n.drag*i),n.acceleration.z&&(n.acceleration.z-=n.acceleration.z*n.drag*i)),n.acceleration.x&&(n.velocity.x+=n.acceleration.x*i),n.acceleration.y&&(n.velocity.y+=n.acceleration.y*i),n.acceleration.z&&(n.velocity.z+=n.acceleration.z*i),n.maxSpeed>0){let a=X.collision.magnitude(n.velocity);if(a>n.maxSpeed){let l=n.maxSpeed/a;n.velocity.x*=l,n.velocity.y*=l,n.velocity.z*=l}}n.velocity.x&&(n.position.x+=n.velocity.x*i),n.velocity.y&&(n.position.y+=n.velocity.y*i),n.velocity.z&&(n.position.z+=n.velocity.z*i)}}return t}}},Ct=class{constructor(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}},Aa=class{constructor(){this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.loop=!1,this._vbuffer=0,this._coord=0,this.visible=!0,this.intensity=1,this.xy=new Float32Array([]),this.numPoints=0,this.color=new Ct(0,0,0,1),this.webglNumPoints=0}},Yi=class extends Aa{constructor(e,i){super(),this.currentIndex=0,this.webglNumPoints=i,this.numPoints=i,this.color=e,this.xy=new Float32Array(2*this.webglNumPoints)}setX(e,i){this.xy[e*2]=i}setY(e,i){this.xy[e*2+1]=i}getX(e){return this.xy[e*2]}getY(e){return this.xy[e*2+1]}lineSpaceX(e,i){for(let r=0;r<this.numPoints;r++)this.setX(r,e+i*r)}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(e){for(let i=0;i<this.numPoints;i++)this.setY(i,e)}shiftAdd(e){let i=e.length;for(let r=0;r<this.numPoints-i;r++)this.setY(r,this.getY(r+i));for(let r=0;r<i;r++)this.setY(r+this.numPoints-i,e[r])}addArrayY(e){if(this.currentIndex+e.length<=this.numPoints)for(let i=0;i<e.length;i++)this.setY(this.currentIndex,e[i]),this.currentIndex++}replaceArrayY(e){if(e.length==this.numPoints)for(let i=0;i<this.numPoints;i++)this.setY(i,e[i])}},uo=(t,e,i)=>{let r={x:0,y:0};return r.x=t.x+e.x*i,r.y=t.y+e.y*i,r},us=t=>Ks(-t.y,t.x),Xi=(t,e)=>{let i=Ef(t,e);return i=xa(i),i},xf=(t,e)=>{let i={x:0,y:0};return i.x=t.x+e.x,i.y=t.y+e.y,i},Of=(t,e)=>t.x*e.x+t.y*e.y,xa=t=>{let e={x:0,y:0},i=t.x*t.x+t.y*t.y;return i>0&&(i=1/Math.sqrt(i),e.x=t.x*i,e.y=t.y*i),e},Ks=(t,e)=>{let i={x:0,y:0};return i.x=t,i.y=e,i},Ef=(t,e)=>{let i={x:0,y:0};return i.x=t.x-e.x,i.y=t.y-e.y,i},Nf=t=>{let e,i={x:0,y:0},r={x:0,y:0},s=[],n=(c,f)=>{s.push({vec2:c,miterLength:f})},a=c=>({x:t[c*2],y:t[c*2+1]});i=Xi(a(1),a(0)),e=us(i),n(e,1);let l=t.length/2;for(let c=1;c<l-1;c++){let f=a(c-1),u=a(c),h=a(c+1);i=Xi(u,f),e=us(i),r=Xi(h,u);let p=Bf(i,r),y=Tf(i,p,1);n(p,y)}return i=Xi(a(l-1),a(l-2)),e=us(i),n(e,1),s},Bf=(t,e)=>{let i=xf(t,e);return i=xa(i),Ks(-i.y,i.x)},Tf=(t,e,i)=>{let r=Ks(-t.y,t.x);return i/Of(e,r)},ds=class extends Aa{constructor(e,i,r){super(),this.currentIndex=0,this._thicknessRequested=0,this._actualThickness=0,this.webglNumPoints=i*2,this.numPoints=i,this.color=e,this._thicknessRequested=r,this._linePoints=new Float32Array(i*2),this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){let e=this._actualThickness/2,i=Nf(this._linePoints);for(let r=0;r<this.numPoints;r++){let s=this._linePoints[2*r],n=this._linePoints[2*r+1],a={x:s,y:n},l=uo(a,i[r].vec2,i[r].miterLength*e),c=uo(a,i[r].vec2,-i[r].miterLength*e);this.xy[r*4]=l.x,this.xy[r*4+1]=l.y,this.xy[r*4+2]=c.x,this.xy[r*4+3]=c.y}}setX(e,i){this._linePoints[e*2]=i}setY(e,i){this._linePoints[e*2+1]=i}lineSpaceX(e,i){for(let r=0;r<this.numPoints;r++)this.setX(r,e+i*r)}setThickness(e){this._thicknessRequested=e}getThickness(){return this._thicknessRequested}setActualThickness(e){this._actualThickness=e}},jf=class{constructor(e,i){this.debug=!1,this.addLine=this.addDataLine,i==null?this.webgl=e.getContext("webgl",{antialias:!0,transparent:!1}):(this.webgl=e.getContext("webgl",{antialias:i.antialias,transparent:i.transparent,desynchronized:i.deSync,powerPerformance:i.powerPerformance,preserveDrawing:i.preserveDrawing}),this.debug=i.debug==null?!1:i.debug),this.log("canvas type is: "+e.constructor.name),this.log(`[webgl-plot]:width=${e.width}, height=${e.height}`),this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[],this.gScaleX=1,this.gScaleY=1,this.gXYratio=1,this.gOffsetX=0,this.gOffsetY=0,this.gLog10X=!1,this.gLog10Y=!1,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.webgl.viewport(0,0,e.width,e.height),this._progLine=this.webgl.createProgram(),this.initThinLineProgram(),this.webgl.enable(this.webgl.BLEND),this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(e){let i=this.webgl;e.forEach(r=>{if(r.visible){i.useProgram(this._progLine);let s=i.getUniformLocation(this._progLine,"uscale");i.uniformMatrix2fv(s,!1,new Float32Array([r.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,r.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let n=i.getUniformLocation(this._progLine,"uoffset");i.uniform2fv(n,new Float32Array([r.offsetX+this.gOffsetX,r.offsetY+this.gOffsetY]));let a=i.getUniformLocation(this._progLine,"is_log");i.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let l=i.getUniformLocation(this._progLine,"uColor");i.uniform4fv(l,[r.color.r,r.color.g,r.color.b,r.color.a]),i.bufferData(i.ARRAY_BUFFER,r.xy,i.STREAM_DRAW),i.drawArrays(r.loop?i.LINE_LOOP:i.LINE_STRIP,0,r.webglNumPoints)}})}_drawSurfaces(e){let i=this.webgl;e.forEach(r=>{if(r.visible){i.useProgram(this._progLine);let s=i.getUniformLocation(this._progLine,"uscale");i.uniformMatrix2fv(s,!1,new Float32Array([r.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,r.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let n=i.getUniformLocation(this._progLine,"uoffset");i.uniform2fv(n,new Float32Array([r.offsetX+this.gOffsetX,r.offsetY+this.gOffsetY]));let a=i.getUniformLocation(this._progLine,"is_log");i.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let l=i.getUniformLocation(this._progLine,"uColor");i.uniform4fv(l,[r.color.r,r.color.g,r.color.b,r.color.a]),i.bufferData(i.ARRAY_BUFFER,r.xy,i.STREAM_DRAW),i.drawArrays(i.TRIANGLE_STRIP,0,r.webglNumPoints)}})}_drawTriangles(e){let i=this.webgl;i.bufferData(i.ARRAY_BUFFER,e.xy,i.STREAM_DRAW),i.useProgram(this._progLine);let r=i.getUniformLocation(this._progLine,"uscale");i.uniformMatrix2fv(r,!1,new Float32Array([e.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,e.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let s=i.getUniformLocation(this._progLine,"uoffset");i.uniform2fv(s,new Float32Array([e.offsetX+this.gOffsetX,e.offsetY+this.gOffsetY]));let n=i.getUniformLocation(this._progLine,"is_log");i.uniform2iv(n,new Int32Array([0,0]));let a=i.getUniformLocation(this._progLine,"uColor");i.uniform4fv(a,[e.color.r,e.color.g,e.color.b,e.color.a]),i.drawArrays(i.TRIANGLE_STRIP,0,e.xy.length/2)}_drawThickLines(){this._thickLines.forEach(e=>{if(e.visible){let i=Math.min(this.gScaleX,this.gScaleY);e.setActualThickness(e.getThickness()/i),e.convertToTriPoints(),this._drawTriangles(e)}})}update(){this.clear(),this.draw()}draw(){this._drawLines(this.linesData),this._drawLines(this.linesAux),this._drawThickLines(),this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(e){e._vbuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,e._vbuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,e.xy,this.webgl.STREAM_DRAW),e._coord=this.webgl.getAttribLocation(this._progLine,"coordinates"),this.webgl.vertexAttribPointer(e._coord,2,this.webgl.FLOAT,!1,0,0),this.webgl.enableVertexAttribArray(e._coord)}addDataLine(e){this._addLine(e),this.linesData.push(e)}addAuxLine(e){this._addLine(e),this.linesAux.push(e)}addThickLine(e){this._addLine(e),this._thickLines.push(e)}addSurface(e){this._addLine(e),this.surfaces.push(e)}initThinLineProgram(){let e=`
      attribute vec2 coordinates;
      uniform mat2 uscale;
      uniform vec2 uoffset;
      uniform ivec2 is_log;

      void main(void) {
         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;
         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;
         vec2 line = vec2(x, y);
         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);
      }`,i=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(i,e),this.webgl.compileShader(i);let r=`
         precision mediump float;
         uniform highp vec4 uColor;
         void main(void) {
            gl_FragColor =  uColor;
         }`,s=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(s,r),this.webgl.compileShader(s),this._progLine=this.webgl.createProgram(),this.webgl.attachShader(this._progLine,i),this.webgl.attachShader(this._progLine,s),this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(e,i,r,s){this.webgl.viewport(e,i,r,s)}log(e){this.debug&&console.log("[webgl-plot]:"+e)}},_e=class{constructor(){this.plots={}}initPlot(e,i){var f,u;if(i||(i=new jf(e.canvas,e.webglOptions)),!e._id)e._id=`plot${Math.floor(Math.random()*1e15)}`;else if(this.plots[e._id]){let h=this.plots[e._id].initial;if(e.lines)for(let p in e.lines)h.lines[p]&&Array.isArray(e.lines[p])&&(e.lines[p],e.lines[p]=h.lines[p]);e=Object.assign(h,e)}e.overlay&&(typeof e.overlay!="object"&&(e.overlay=document.createElement("canvas"),e.overlay.style.position="absolute",e.overlay.width=e.canvas.width,e.overlay.height=e.canvas.height,e.canvas.appendChild(e.overlay)),e.overlayCtx||(e.overlayCtx=e.overlay.getContext("2d"))),e.width&&(e.canvas.width=e.width,e.canvas.style&&(e.canvas.style.width=e.width+"px"),typeof e.overlay=="object"&&(e.overlay.width=e.width,e.overlay.style&&(e.overlay.style.width=e.width+"px"))),e.height&&(e.canvas.height=e.height,e.canvas.style&&(e.canvas.style.height=e.height+"px"),typeof e.overlay=="object"&&(e.overlay.height=e.height,e.overlay.style&&(e.overlay.style.height=e.height+"px"))),(f=e.lines)!=null&&f.timestamp&&delete e.lines.timestamp,e.lines||(e.lines={});let r={};for(let h in e.lines)r[h]=Object.assign({},r[h]),"viewing"in e.lines[h]||(e.lines[h].viewing=!0),r[h].viewing=e.lines[h].viewing,r[h].sps=e.lines[h].sps,r[h].nSec=e.lines[h].nSec,r[h].nPoints=e.lines[h].nPoints,r[h].ymin=e.lines[h].ymin,r[h].ymax=e.lines[h].ymax,r[h].units=e.lines[h].units;let s={plot:i,settings:e,initial:Object.assign(Object.assign({},e),{lines:r}),anim:()=>{i.update()}};this.plots[e._id]=s;let n=0,a=0;Object.keys(e.lines).forEach(h=>{var p;((p=e.lines[h])==null?void 0:p.viewing)!==!1&&a++}),e.nLines=a;let l,c;typeof e.overlay=="object"&&(l=e.overlay,c=e.overlayCtx,c.clearRect(0,0,e.overlay.width,e.overlay.height),c.font=e.overlayFont?e.overlayFont:"1em Courier",c.fillStyle=e.overlayColor?e.overlayColor:"white");for(let h in e.lines){let p=e.lines[h];if(Array.isArray(p)&&(p={values:p},e.lines[h]=p),"viewing"in p||(p.viewing=!0),p.color)Array.isArray(p.color)&&(p.color=new Ct(...p.color));else{let E=_e.HSLToRGB(360*(n/a)%360,100,50,1);s.initial.lines[h].color=[...E,1],p.color=new Ct(...E,1)}let y;if(p.nSec&&p.sps?y=Math.ceil(p.nSec*p.sps):p.nPoints?y=p.nPoints:p.points?y=p.points:e.linePoints?y=e.linePoints:p.values?y=p.values.length:y=1e3,p.points=y,e.lines[h].viewing===!1)continue;if((p.width||e.lineWidth)&&p.width!==0){let E=e.lineWidth;E||(E=p.width),p.width?p.line=new ds(p.color,y,p.width):e.lineWidth&&(p.line=new ds(p.color,y,e.lineWidth)),p.line.lineSpaceX(-1,2/p.line.numPoints)}else p.line=new Yi(p.color,y),p.line.arrangeX();((u=p.values)==null?void 0:u.length)===p.points?p.values.length!==y&&(p.interpolate?p.values.length>y?p.values=_e.downsample(p.values,y):p.values.length<y&&(p.values=_e.upsample(p.values,y)):p.values.length>p.points?p.values=p.values.slice(p.values.length-p.points):p.values=[...new Array(p.points-p.values.length).fill(0),...p.values]):Array.isArray(p.values)?p.values.length>y?p.values=p.values.slice(p.values.length-y):p.values.length<y&&(p.values=[...new Array(y-p.values.length).fill(0),...p.values]):p.values=new Array(p.points).fill(0);let _=p.ymin,m=p.ymax,A=p.values.length<=1e5;if(_===m?(m=A?Math.max(...p.values):1,_=A?Math.min(...p.values):0):isNaN(m)&&(m=A?Math.max(...p.values):1),isNaN(_)&&(_=A?Math.min(...p.values):0),_>m){let E=_;m=_,_=E}let O=Math.abs(_);if(p.absmax=O>m?O:m,"autoscale"in p||(p.autoscale=!0),p.position||(p.position=e.nLines-n-1),p.autoscale?p.autoscale===2?("clamp"in p||(p.clamp=!0),p.scaled=_e.autoscale(p.values,p.position,a,p.centerZero,_,m,p.clamp)):(p.scaled=p.values,p.line.scaleY=_e.getYScalar(p.values,a,p.centerZero,_,m),p.line.offsetY=_e.getYOffset(p.position,a,_,p.line.scaleY)):p.scaled=p.values,p.scaled.forEach((E,L)=>p.line.setY(L,E)),p.line instanceof ds?i.addThickLine(p.line):p.line instanceof Yi&&i.addDataLine(p.line),"xAxis"in p||(p.xAxis=!0),p.xAxis){p.xColor?Array.isArray(p.xColor)&&(p.xColor=new Ct(...p.xColor)):p.xColor=new Ct(1,1,1,.3);let E=new Yi(p.xColor,2),L=p.autoscale?(n+1)*2/a-1-1/a:0;E.constY(L),E.arrangeX(),E.xy[2]=1,p.x=E,i.addAuxLine(E)}if(a>1&&p.autoscale&&n!==a-1){e.dividerColor?Array.isArray(e.dividerColor)&&(e.dividerColor=new Ct(...e.dividerColor)):e.dividerColor=new Ct(1,1,1,1);let E=new Yi(e.dividerColor,2);E.constY(p.autoscale?(n+1)*2/a-1:1),E.arrangeX(),E.xy[2]=1,p.divider=E,i.addAuxLine(E)}if(typeof e.overlay=="object"&&(p.useOverlay||!("useOverlay"in p))){let E=e.nLines-p.position-1;c.fillText(h,20,l.height*(E+.2)/e.nLines),c.fillText(`${Math.floor(m)===m?m:m==null?void 0:m.toFixed(5)} ${p.units?p.units:""}`,l.width-100,l.height*(E+.2)/e.nLines),c.fillText(`${Math.floor(_)===_?_:_==null?void 0:_.toFixed(5)} ${p.units?p.units:""}`,l.width-100,l.height*(E+.9)/e.nLines)}n++}return requestAnimationFrame(s.anim),this.plots[e._id]}deinitPlot(e){return typeof e=="string"&&(e=this.plots[e]),e.plot.clear(),e.plot.removeAllLines(),!0}reinitPlot(e,i){var r,s;if(typeof e=="string"){let n=e;e=this.plots[e],i._id||(i._id=n)}if(e.plot)return e.plot.clear(),e.plot.removeAllLines(),e.settings.overlayCtx&&e.settings.overlayCtx.clearRect(0,0,(r=e.settings.overlay)==null?void 0:r.width,(s=e.settings.overlay)==null?void 0:s.height),this.initPlot(i,e.plot)}getChartSettings(e,i){var s,n,a,l;let r=this.plots[e];if(r){let c=Object.assign({},r.initial);for(let f in r.initial.lines)typeof((s=r.initial.lines[f])==null?void 0:s.ymax)!="number"&&(c.lines[f].ymax=(n=r.settings.lines[f])==null?void 0:n.ymax),typeof((a=r.initial.lines[f])==null?void 0:a.ymin)!="number"&&(c.lines[f].ymin=(l=r.settings.lines[f])==null?void 0:l.ymin),i&&(c.lines[f].values=r.settings.lines[f].values);return delete c.canvas,delete c.overlay,delete c.overlayCtx,c}}update(e,i,r=!0){var s,n,a;if(typeof e=="string"&&(e=this.plots[e]),!e)return!1;if(i){let l=!1,c,f;typeof e.settings.overlay=="object"&&(c=e.settings.overlay,f=e.settings.overlayCtx,f.font=e.settings.overlayFont?e.settings.overlayFont:"1em Courier",f.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white");for(let u in i)if(e.settings.lines[u]&&e.settings.lines[u].line){if(((s=e.settings.lines[u])==null?void 0:s.viewing)===!1)continue;let h=e.settings.lines[u];if(h.values){if(e.settings.mode&&e.settings.mode==="sweep"){"ct"in h||(h.ct=0);let A=O=>{h.ct>h.values.length&&(h.ct=0),h.values[h.ct]=O,h.ct++};Array.isArray(i[u])?i[u].forEach(A):typeof i[u]=="number"?A(i[u]):i[u].values&&i[u].values.forEach(A)}else Array.isArray(i[u])&&((n=h.values)==null?void 0:n.length)<1e5?(h.values.length===0&&(h.values.length=h.points?h.points:1e3),i[u].length===h.values.length?h.values=i[u]:_e.circularBuffer(h.values,i[u])):typeof i[u]=="number"?(h.values.push(i[u]),h.values.shift()):(a=i[u])!=null&&a.values&&(h.values.length===0&&(h.values.length=h.points?h.points:1e3),i[u].values.length===h.values.length?h.values=i[u].values:_e.circularBuffer(h.values,i[u].values));h.values.length!==h.points&&(h.interpolate?h.values.length>h.points?h.values=_e.downsample(h.values,h.points):h.scaled.length<h.points&&(h.values=_e.upsample(h.values,h.points)):h.values.length>h.points?h.values.splice(0,h.values.length-h.points):h.values=new Array(h.points).fill(0).splice(h.points-h.values.length,0,h.values));let p=h.ymin,y=h.ymax,_=h.values.length<=1e5;if(p===y?(y=_?Math.max(...h.values):1,p=_?Math.min(...h.values):0):isNaN(y)&&(y=_?Math.max(...h.values):1),isNaN(p)&&(p=_?Math.min(...h.values):0),p>y){let A=p;y=p,p=A}let m=Math.abs(p);if(h.absmax=m>y?m:y,h.autoscale?h.autoscale===2?h.scaled=_e.autoscale(h.values,h.position,e.settings.nLines,h.centerZero,p,y,h.clamp):(h.scaled=h.values,h.line.scaleY=_e.getYScalar(h.values,e.settings.nLines,h.centerZero,p,y),h.line.offsetY=_e.getYOffset(h.position,e.settings.nLines,p,h.line.scaleY)):h.scaled=h.values,h.scaled.forEach((A,O)=>{!h.autoscale&&h.absmax>1?h.line.setY(O,A/h.absmax):h.line.setY(O,A)}),typeof e.settings.overlay=="object"&&(h.useOverlay||!("useOverlay"in h))){let A=e.settings.nLines-h.position-1,O=c.height*A/e.settings.nLines,E=c.height/e.settings.nLines;if(f.clearRect(0,O,c.width,E),e.settings.mode&&e.settings.mode==="sweep"){f.fillStyle=e.settings.sweepColor?e.settings.sweepColor:"rgba(0,255,0,0.25)",f.beginPath();let L=c.width*h.ct/h.values.length;f.moveTo(L,O),f.lineTo(L,E),f.stroke()}f.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white",f.fillText(u,20,c.height*(A+.2)/e.settings.nLines),f.fillText(`${Math.floor(y)===y?y:y==null?void 0:y.toFixed(5)} ${h.units?h.units:""}`,c.width-100,c.height*(A+.2)/e.settings.nLines),f.fillText(`${Math.floor(p)===p?p:p==null?void 0:p.toFixed(5)} ${h.units?h.units:""}`,c.width-100,c.height*(A+.9)/e.settings.nLines)}}}else e.settings.generateNewLines&&!u.includes("timestamp")&&(Array.isArray(i[u])&&(i[u]={values:i[u]}),!i[u].nSec&&!i[u].nPoints&&!e.settings.linePoints&&(i[u].nPoints=1e3),l=!0);if(l)return e.settings.cleanGeneration||Object.keys(e.initial.lines).forEach(u=>{i[u]?i[u]=Object.assign(e.initial.lines[u],i[u]):i[u]=e.initial.lines[u]}),this.reinitPlot(e,{_id:e.settings._id,lines:i}),!0}return r&&requestAnimationFrame(e.anim),!0}updateLine(e,i,r,s,n,a,l){return e.numPoints!==i.length&&(r?e.numPoints>i.length?i=_e.downsample(i,e.numPoints):e.numPoints<i.length&&(i=_e.upsample(i,e.numPoints)):i.length>e.numPoints?i=i.slice(i.length-e.numPoints):i=[...new Array(i.length).fill(0),...i]),s&&(i=_e.autoscale(i,n,a,l)),i.forEach((c,f)=>e.setY(f,c)),!0}static autoscale(e,i=0,r=1,s=!1,n,a,l){if((e==null?void 0:e.length)===0)return e;let c=typeof a=="number"?a:e.length<=1e5?Math.max(...e):1,f=typeof n=="number"?n:e.length<=1e5?Math.min(...e):0,u=1/r,h=1;if(s){let p=Math.max(Math.abs(f),Math.abs(c));return p!==0&&(h=u/p),e.map(y=>(l&&(y<f&&(y=f),y>c&&(y=c)),y*h+(u*(i+1)*2-1-u)))}else return c===f?c!==0?h=u/c:f!==0&&(h=u/Math.abs(f)):h=u/(c-f),e.map(p=>(l&&(p<f&&(p=f),p>c&&(p=c)),2*((p-f)*h-1/(2*r))+(u*(i+1)*2-1-u)))}static getYScalar(e,i=1,r=!1,s,n){if((e==null?void 0:e.length)===0)return e;let a=typeof n=="number"?n:e.length<=1e5?Math.max(...e):1,l=typeof s=="number"?s:e.length<=1e5?Math.min(...e):0,c=1/i,f=1;if(r){let u=Math.max(Math.abs(l),Math.abs(a));return u!==0&&(f=c/u),2*f}else return a===l?a!==0?f=c/a:l!==0&&(f=c/Math.abs(l)):f=c/(a-l),2*f}static getYOffset(e=0,i=1,r=0,s=1){let n=1/i,a=n*(e+1)*2-1-n;return r!==0?a-=r*s+1/i:a-=s+1/i,a}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,i,r=1){if(e.length>i){let s=new Array(i),n=e.length/i,a=e.length-1,l=0,c=0;for(let f=n;f<e.length;f+=n){let u=Math.round(f);u>a&&(u=a);for(let h=l;h<u;h++)s[c]+=e[h];s[c]/=(u-l)*r,c++,l=u}return s}else return e}static upsample(e,i,r=1){var s=function(p,y,_){return(p+(y-p)*_)*r},n=new Array(i),a=(e.length-1)/(i-1);n[0]=e[0];for(var l=1;l<i-1;l++){var c=l*a,f=Math.floor(c),u=Math.ceil(c),h=c-f;n[l]=s(e[f],e[u],h)}return n[i-1]=e[e.length-1],n}static interpolate(e,i,r=1){return e.length>i?_e.downsample(e,i,r):e.length<i?_e.upsample(e,i,r):e}static HSLToRGB(e,i,r,s=255){i/=100,r/=100;let n=(1-Math.abs(2*r-1))*i,a=n*(1-Math.abs(e/60%2-1)),l=r-n/2,c=0,f=0,u=0;return 0<=e&&e<60?(c=n,f=a,u=0):60<=e&&e<120?(c=a,f=n,u=0):120<=e&&e<180?(c=0,f=n,u=a):180<=e&&e<240?(c=0,f=a,u=n):240<=e&&e<300?(c=a,f=0,u=n):300<=e&&e<360&&(c=n,f=0,u=a),c=(c+l)*s,f=(f+l)*s,u=(u+l)*s,[c,f,u]}static circularBuffer(e,i){if(i.length<e.length){let r=e.slice(i.length),s=e.length;e.splice(0,s,...r,...i)}else if(i.length>e.length){let r=e.length;e.splice(0,r,...i.slice(i.length-r))}else e.splice(0,e.length,...i);return e}static formatDataForCharts(e,i){var r;if(Array.isArray(e)){if(Array.isArray(e[0])){let s={};if(e.forEach((n,a)=>{s[a]=n}),e=s,isNaN(e[0][0]))return}else if(i){if(e={[i]:e},isNaN(e[i][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let s in e)if(typeof e[s]=="number"?e[s]=[e[s]]:(r=e[s])!=null&&r.values&&typeof e[s].values=="number"&&(e[s].values=[e[s].values]),isNaN(e[s][0]))return}else if(typeof e=="string"){let s;if(e.includes(`\r
`)){let n=e.split(`\r
`);e={},n.forEach((a,l)=>{a.includes("	")?s=a.split("	"):a.includes(",")?s=a.split(","):a.includes("|")&&(s=a.split("|")),s&&s.forEach((c,f)=>{if(c.includes(":")){let[u,h]=c.split(":"),p=parseFloat(h);isNaN(p)||(e[u]=[p])}else{let u=parseFloat(c);isNaN(u)||(e[f]=[u])}})})}else e.includes("	")?s=e.split("	"):e.includes(",")?s=e.split(","):e.includes("|")&&(s=e.split("|"));e={},s&&s.forEach((n,a)=>{if(n.includes(":")){let[l,c]=n.split(":"),f=parseFloat(c);isNaN(f)||(e[l]=[f])}else{let l=parseFloat(n);isNaN(l)||(e[a]=[l])}})}else typeof e=="number"&&(i?e={[i]:[e]}:e={0:[e]});return e}static padTime(e,i,r,s){let n=(e[0]-i)/r/s;return[...new Array(s-e.length).map((a,l)=>i+n*(l+1)),...e]}static interpolateForTime(e,i,r){return _e.interpolate(e,Math.ceil(r*i))}},Cf=Object.defineProperty,Pf=(t,e,i)=>e in t?Cf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,se=(t,e,i)=>(Pf(t,typeof e!="symbol"?e+"":e,i),i),Ge=class{constructor(){}static genSineWave(t=20,e=1,i=1,r=512,s=0,n=1){for(var a=[],l=[],c=1/r,f=0;f<i;f+=c){var u=Math.sin(2*Math.PI*t*f)*e;u+=Math.sin(2*Math.PI*s*f)*n,a.push(u),l.push(f)}return[l,a]}static getSineAmplitude(t=20,e=1,i=0,r=0){return Math.sin(this.TWO_PI*t*i+r)*e}static mean(t){var e=t.reduce((i,r)=>r+=i);return e/t.length}static mode(t){return t.sort((e,i)=>t.filter(r=>r===e).length-t.filter(r=>r===i).length).pop()}static std(t,e=void 0){let i=e;e||(i=this.mean(t));let r=0;for(let s=0;s<t.length;s++){let n=t[s]-i;r+=n*n}return Math.sqrt(r/t.length)}static relError(t=[],e=[],i=!0){if(t.length!==e.length)throw new Error("Input arrays of same length!");let r=t.length,s=new Array(t.length);for(let n=0;n<r;n++){let a=(t[n]-e[n])/t[n];i&&(a=Math.abs(a)),s[n]=a}return s}static informationEntropy(t=[]){let e=t.length,i=new Array(e);for(let r=0;r<e;r++){let s=t[r]*Math.log(t[r]);isNaN(s)&&(s=0),i[r]=s}return i}static zscore(t){let e=this.mean(t),i=this.std(t,e),r=new Array().length(t.length);for(let s=0;s<t.length;s++)r[s]=(t[s]-e)/i;return r}static variance(t){var e=this.mean(t);return t.reduce((i,r)=>i+(r-e)**2,0)/t.length}static dot(t,e){for(var i=0,r=0;r<t.length;r++)i+=t[r]*e[r];return i}static cross3D(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}static magnitude(t){var e=0;return t.forEach(i=>{e+=i*i}),Math.sqrt(e)}static distance(t,e){var i=0;return t.forEach((r,s)=>{i+=(e[s]-r)*(e[s]-r)}),Math.sqrt(i)}static midpoint(t=[1,2,3],e=[3,4,5]){return t.map((i,r)=>(i+e[r])*.5)}static normalize(t){var e=0;e=this.magnitude(t);var i=new Array(t.length);return t.forEach((r,s)=>{i[s]=r*e}),i}static normalizeSeries(t=[],e=!0){let i=Math.max(...t),r=Math.min(...t);return e==!1&&(i=Math.max(i,Math.abs(r)),r=0),i-r===0&&(r=0,i===0&&(i=1e-13)),t.map(s=>(s-r)/(i-r))}static quadraticFormula(t,e,i){let r=Math.sqrt(e*e-4*t*i);if(!isNaN(r))return["complex","complex"];let s=1/(2*t);if(r===0)return[e*s];let n=-e;return[(n+r)*s,(n-r)*s]}static newtonsMethod(t=n=>Math.pow(n,5)+n*n-n-.2,e=0,i=1,r=.01,s=10){let n=[];for(let a=0;a<s;a++){let l=Math.random()*(i-e),c=t(l),f=t(l+r),u=(f-c)/r,h=l+r;for(;Math.abs(u)>r;){let _=-c/A,m=h+_;c=f,f=t(m);let A=(f-c)/(m-h)}let p,y=n.find((_,m)=>{if(Math.abs(xn1-_)<r)return p=m,!0});y?n[p]=(xn1+y)*.5:n.push(xn1)}return n}static makeVec(t,e){var i=[];return t.forEach((r,s)=>{i.push(e[s]-r)}),i}static getBufferedValueByCoordinates(t=new Array(300).fill(1),e=[10,10,2],i=[1,2,1],r=void 0){let s=(a=0,l=0)=>{if(l===e.length)return a;if(l==0)a+=i[l];else if(e[l]==0)dimsAt0++;else{let c=(f=i[l],u=l-1)=>(f*=e[u],u--,u==0?f:c(f,u));a+=c(i[l]+1,l-1)}return l++,s(a,l)},n=s();if(r){if(i[i.length-1]===0){let a=0,l=0;for(;l!==i.length-1;)i[l]!==0&&(a=l),l++;return t[n-a+r]}return t[n-e.length+r]}else{if(i[i.length-1]===0){let a=0,l=0;for(;l!==i.length-1;)i[l]!==0&&(a=l),l++;return t.slice(n-a,n+1)}return t.slice(n-e.length,n+1)}}static forBufferedMat(t=new Array(100).fill(1),e=[10,10],i=(r,s,n,a)=>r+n+a){let r=[],s=0,n=(l=0,c=l+1)=>{let f=new Array(t.length);for(let u=0;u<e[l];u++)r[l]=u,e[c]?n(c):(f[s]=i(t[s],s,...r),s++);return f},a=(l,c=l+1)=>{let f=new Array(t.length);for(let u=0;u<e[l];u++)if(r[l]=u,e[c])n(c);else for(let h=0;h<e.length;h++)f[s]=i[h](t[s],s,...r),s++;return f};if(typeof i=="function")return n();if(Array.isArray(i))return a()}static mapBufferedMat(t=new Array(100).fill(1),e=[10,10],i=(r,s,n,a)=>(console.log(`value:${r}, idx:${s}, x:${n},y:${a}`),r+n+a)){let r=new Array(e.length).fill(0);const s=(l,c=0)=>{if(l[c]>=e[c]){if(l[c]=0,c++,c===e.length)return;s(l,c)}else l[c]++};let n=new Array(t.length),a=0;if(typeof i=="function")for(;a<t.length;)n[a]=i(t[a],a,...r),a+=e.length,s(r);else if(Array.isArray(i))for(;a<t.length;)i.forEach(l=>{n[a]=l(t[a],a,...r),a++,s(r)});return n}static combinations(t=["a","b","c"],e=3){var i=[];return e<=0?i.push([]):Ge.combinations(t,e-1).forEach(function(r){t.forEach(function(s){i.push([s].concat(r))})}),i}static generateCoordinateSpace(t=[10,10,10],e=[-10,-10,-10],i=[1,1,1],r=void 0){for(let l=0;l<t.length;l++)if(e[l]>t[l]){let c=t[l];t[l]=e[l],e[l]=c}let s=[],n=[...t],a=n.length-1;for(s.push([...n]);n[0]>=e[0];){let l=f=>{if(n[f]<=e[f]){if(f===0||(n[f]=t[f],f--,f<0))return;typeof i[f]=="function"?n[f]-=i[f](n[f]):n[f]-=i[f],l(f)}},c=a;typeof i[c]=="function"?n[c]-=i[c](n[c]):n[c]-=i[c],s.push([...n]),l(c),r&&(s[s.length-1]=r(s[s.length-1]))}return s}static calcVectorField(t=[[0,0],[0,1],[1,0],[1,1]],e=(i,r)=>[i*10,r*10]){return t.map(i=>e(...i))}static transpose(t){return t[0].map((e,i)=>t.map(r=>r[i]))}static matmul(t,e){var i=t.length,r=t[0].length;e.length;for(var s=e[0].length,n=new Array(i),a=0;a<i;++a){n[a]=new Array(s);for(var l=0;l<s;++l){n[a][l]=0;for(var c=0;c<r;++c)n[a][l]+=t[a][c]*e[c][l]}}return n}static matscale(t,e){let i=[];for(var r=0;r<t.length;r++){i[r]=[];for(let s=0;s<t[0].length;s++)i[r][s]=t[r][s]*e}return i}static matadd(t,e){let i=[];for(let s=0;s<t.length;s++){i[s]=[];for(var r=0;r<t[0].length;r++)i[s][r]=t[s][r]+e[s][r]}return i}static matsub(t,e){let i=[];for(let s=0;s<t.length;s++){i[s]=[];for(var r=0;r<t[0].length;r++)i[s][r]=t[s][r]-e[s][r]}return i}static histogram(t=[],e=1,i=void 0){let r=[...t];r.sort(function(c,f){return c-f});let s=Math.min(...r);if(typeof i=="number"){let c=Math.max(...r);e=Math.abs((c-s)/(i-1))}let n=s,a=[],l=[];for(let c=0;c<r.length;c++){let f=e*n;if(r[c]>s+f){n++,f+=e;let h=s+f+f*.5;a.push(h),l.push(0)}l[l.length-1]++}return[a,l]}static normalDistribution(t=[],e=!0,i=1e-4){let r=this.mean(t),s=this.variance(t),n=t.length,a=[],l=1/(this.TWO_PI*s),c=1/s,f=0;for(let u=0;u<n;u++){let h=Math.exp(-.5*Math.pow((t[u]-r)*c,2))*l;h<i&&(h=0),a.push(h),f+=h}if(e){let u=1/f;a=a.map(h=>h*u)}return a}static expectedValue(t=[],e=this.normalDistribution(t)){return t.reduce((i,r,s)=>i+r*e[s])}static originMoment(t=[],e=this.normalDistribution(t),i=1){return t.reduce((r,s,n)=>r+Math.pow(s,i)*e[n])}static centralMoment(t=[],e=this.normalDistribution(t),i=1){let r=this.mean(t);return t.reduce((s,n,a)=>s+Math.pow(n-r,i)*e[a]/t.length)}static linearDiscriminantAnalysis(t=[],e=[]){let i=this.mean(t),r=this.mean(e),s=this.cov1d(t,e),n=this.normalDistribution(t),a=[];for(let l=0;l<t.length;l++)a.push(x[l]*s*r-.5*i*s*r+Math.log10(n[l]));return a}static conv1D(t=[],e=[1/3,1/3,1/3],i=Math.floor(e.length*.5)){let r=[],s=1/e.length;if(i>0){let l=new Array(i).fill(0);t=[...l,...t,...l]}let n=Math.floor(e.length*.5),a=t.length-e.length+n;for(let l=n;l<a;l++){let c=0;for(let f=0;f<e.length;f++)c+=t[l-n]*e[f];r.push(c*s)}return r}static conv2D(t=[[],[],[]],e=[[],[],[]],i=0){let r=new Array(t.length-Math.ceil(e.length*.5)).fill([]),s,n=Ge.transpose(n);if(i>0){let m=new Array(i).fill(0);s=Ge.transpose(t);for(let A=0;A<s.length;A++)s[A]=[...m,...s[A],...m];t=Ge.transpose(s);for(let A=0;A<t.length;A++)t[A]=[...m,...t[A],...m]}let a=Math.floor(e[0].length*.5),l=Math.floor(n[0].length*.5),c=t[0].length-e[0].length+a,f=s[0].length-n[0].length+l,u=1/(e[0].length*n[0].length),h=c*f,p=a,y,_=l;for(;p<h;){let m=0;y=p%t[0].length,y===0&&_++;for(let A=0;A<e[0].length;A++){for(let O=0;O<n[0].length;A++)m+=t[_-l+O][y-a+A]*e[O][A];r[_].push(m*u)}p++}return r}static cov2d(t){var e=this.transpose(t),i=[],r=[],s=[];t.forEach((y,_)=>{r.push(this.mean(y))}),e.forEach((y,_)=>{s.push(this.mean(y))}),t.forEach((y,_)=>{i.push([]);for(var m=0;m<y.length;m++)i[_].push((t[_][m]-r[_])*(t[_][m]-s[m])/(y.length-1))});var n=this.transpose(i),a=i.length,l=i[0].length;n.length;for(var c=n[0].length,f=new Array(a),u=0;u<a;++u){f[u]=new Array(c);for(var h=0;h<c;++h){f[u][h]=0;for(var p=0;p<l;++p)f[u][h]+=i[u][p]*n[p][h]/(t[0].length-1)}}return f}static cov1d(t=[],e=[]){return this.cov2d([t,e])}static cov3d(t=[],e=[],i=[]){return[[this.cov1d(t,t),this.cov1d(t,e),this.cov1d(t,i)],[this.cov1d(e,t),this.cov1d(e,e),this.cov1d(e,i)],[this.cov1d(i,t),this.cov1d(i,e),this.cov1d(i,i)]]}static covNd(t=[]){let e=[];t.forEach((i,r)=>{e.push([]),t.forEach((s,n)=>{e[r].push(this.cov1d(i,s))})})}static eigens2x2(t=[[1,2],[3,4]]){let e=t[0][0]*t[1][1]-t[0][1]*t[1][0],i=(t[0][0]+t[1][1])*.5,r=Math.sqrt(i*i-e),s=i+r,n=i-r;return[s,n]}static eigenvectors2x2(t=[[1,2],[3,4]],e=[1,2]){let i=[-t[0][1],t[0][0]-e[0]];i[0]===0&&i[1]===0&&(i[0]=t[1][1]-e[0],i[1]=-t[1][0]);let r=[-t[0][1],t[0][0]-e[1]];return r[0]===0&&r[1]===0&&(r[0]=t[1][1]-e[1],r[1]=-t[1][0]),[i,r]}static fastpca2d(t,e){let i=this.cov1d(t,e),r=this.eigens2x2(i);r[1]>r[0]&&r.reverse();let s=this.eigenvectors2x2(i,r);return console.log(r,s),[r,s]}static crosscorrelation(t,e){var i=[...e,...Array(e.length).fill(0)],r=this.mean(t),s=this.mean(e),n=t.reduce((p,y)=>p+=Math.pow(y-r,2));n=Math.sqrt(Math.abs(n));var a=e.reduce((p,y)=>p+=Math.pow(y-r,2));a=Math.sqrt(Math.abs(a));let l=n*a;l===0&&(l=1e-26);for(var c=1/l,f=new Array(t.length).fill(0),u=0;u<t.length;u++){var h=t.reduce((p,y,_)=>p+=(y-r)*(i[u+_]-s));f[u]=h*c}return f}static autocorrelation(t){var e=[...t,...Array(t.length).fill(0)],i=this.mean(t),r=t.reduce((f,u)=>f+=Math.pow(u-i,2));r=Math.sqrt(Math.abs(r));let s=r*arr2Est;s===0&&(s=1e-26);for(var n=1/s,a=new Array(t.length).fill(0),l=0;l<t.length;l++){var c=t.reduce((f,u,h)=>f+=(u-i)*(e[l+h]-i));a[l]=c*n}return a}static autocorrelation2dNormalized(t){let e=[];for(let i=0;i<t.length;i++){e.push([]);for(let r=0;r<t[i].length;r++){let s=0,n=0;for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)s+=t[i][r]*t[t.length-1-a][t[i].length-1-l],n+=t[i][r]*t[t.length-1][t[i].length-1];e[i][r]=s/n-1}}return e}static crosscorrelation2d(t,e){let i=[];for(let r=0;r<t.length;r++){i.push([]);for(let s=0;s<t[r].length;s++){let n=0;for(let a=0;a<e.length;a++)for(let l=0;l<e[a].length;l++)n+=t[r][s]*e[e.length-1-a][e[r].length-1-l];i[r][s]=n}}return i}static crosscorrelation2dNormalized(t,e){let i=[];for(let r=0;r<t.length;r++){i.push([]);for(let s=0;s<t[r].length;s++){let n=0,a=0;for(let l=0;l<e.length;l++)for(let c=0;c<e[l].length;c++)n+=t[r][s]*e[mat2d.length-1-l][e[r].length-1-c],a+=t[r][s]*e[e.length-1][e[r].length-1];i[r][s]=n/a-1}}return i}static correlograms(t=[[],[]]){var e=[];return t.forEach((i,r)=>{t.forEach((s,n)=>{n>=r&&e.push(Ge.crosscorrelation(i,s))})}),e}static dft(t=[]){for(var e=6.283185307179586,i=[],r=[],s=[],n=0;n<t.length;n++){i.push(0),r.push(0);for(var a=0;a<t.length;a++){var l=e*n*a/t.length;i[n]=i[n]+t[a]*Math.cos(l),r[n]=r[n]-t[a]*Math.sin(l)}s.push(Math.sqrt(i[n]*i[n]+r[n]*r[n]))}function c(h){return[...h.slice(Math.ceil(h.length*.5),h.length),...h.slice(0,Math.ceil(h.length*.5))]}s=c(s);let f=s.length*.5,u=s.map((h,p)=>p-f);return{real:i,imag:r,freqs:u,mags:s}}static sma(t=[],e){for(var i=[],r=0;r<t.length;r++)if(r==0)i.push(t[0]);else if(r<e){var s=t.slice(0,r+1);i.push(s.reduce((n,a)=>a+=n)/(r+1))}else{var s=t.slice(r-e,r);i.push(s.reduce((a,l)=>l+=a)/e)}return i}static sum(t=[]){if(t.length>0){var e=t.reduce((i,r)=>r+=i);return e}else return 0}static reduceArrByFactor(t,e=2){return t.filter((r,s)=>s%e===0)}static makeArr(t,e,i){for(var r=[],s=(e-t)/(i-1),n=0;n<i;n++)r.push(t+s*n);return r}static autoscale(t,e=1,i=0,r=!1){if((t==null?void 0:t.length)===0)return t;let s=Math.max(...t),n=Math.min(...t),a=1/e,l;if(r){let c=Math.max(Math.abs(n),Math.abs(s));return l=a/c,t.map(f=>f*l+(a*(i+1)*2-1-a))}else return l=a/(s-n),t.map(c=>2*((c-n)*l-1/(2*e))+(a*(i+1)*2-1-a))}static absmax(t){return Math.max(Math.abs(Math.min(...t)),Math.max(...t))}static downsample(t,e,i=1){if(t.length>e){let r=new Array(e),s=t.length/e,n=t.length-1,a=0,l=0;for(let c=s;c<t.length;c+=s){let f=Math.round(c);f>n&&(f=n);for(let u=a;u<f;u++)r[l]+=t[u];r[l]/=(f-a)*i,l++,a=f}return r}else return t}static interpolateArray(t,e,i=1){var r=function(h,p,y){return(h+(p-h)*y)*i},s=new Array,n=(t.length-1)/(e-1);s[0]=t[0];for(var a=1;a<e-1;a++){var l=a*n,c=Math.floor(l),f=Math.ceil(l),u=l-c;s[a]=r(t[c],t[f],u)}return s[e-1]=t[t.length-1],s}static isExtrema(t,e="peak"){let i=[...t];if(i.length%2===0&&i.pop(),t.length>1){let r=!0;for(let s=0;s<i.length;s++){let n=i[s];if(e==="peak"){if(s<Math.floor(i.length*.5)&&n>=i[Math.floor(i.length*.5)]){r=!1;break}else if(s>Math.floor(i.length*.5)&&n>=i[Math.floor(i.length*.5)]){r=!1;break}}else if(e==="valley"){if(s<Math.floor(i.length*.5)&&n<=i[Math.floor(i.length*.5)]){r=!1;break}else if(s>Math.floor(i.length*.5)&&n<=i[Math.floor(i.length*.5)]){r=!1;break}}else if(s<Math.floor(i.length*.5)&&n<=i[Math.floor(i.length*.5)]){r=!1;break}else if(s>Math.floor(i.length*.5)&&n<=i[Math.floor(i.length*.5)]){r=!1;break}}if(e!=="peak"&&e!=="valley"&&r===!1){r=!0;for(let s=0;s<i.length;s++){let n=i[s];if(s<Math.floor(i.length*.5)&&n>=i[Math.floor(i.length*.5)]){r=!1;break}else if(s>Math.floor(i.length*.5)&&n>=i[Math.floor(i.length*.5)]){r=!1;break}}}return r}else return}static isCriticalPoint(t,e="peak"){let i=[...t];if(i.length%2===0&&i.pop(),t.length>1){let r=!0;for(let s=0;s<i.length;s++){let n=i[s];if(e==="peak"){if(s<i.length*.5&&n<=0){r=!1;break}else if(s>i.length*.5&&n>0){r=!1;break}}else if(e==="valley"){if(s<i.length*.5&&n>=0){r=!1;break}else if(s>i.length*.5&&n<0){r=!1;break}}else if(s<i.length*.5&&n>=0){r=!1;break}else if(s>i.length*.5&&n<0){r=!1;break}}if(e!=="peak"&&e!=="valley"&&r===!1){r=!0;for(let s=0;s<i.length;s++){let n=i[s];if(s<i.length*.5&&n<=0){r=!1;break}else if(s>i.length*.5&&n>0){r=!1;break}}}return r}else return}static getPeakThreshold(t,e,i){let r,s=t.filter((n,a)=>{if(e.indexOf(a)>-1)return!0});return i===0?r=this.mean(s):r=(i+this.mean(s))*.5,r}static column(t,e){let i=new Array(t.length).fill(0).map(()=>new Array(1).fill(0));for(let r=0;r<t.length;r++)i[r][0]=t[r][e];return i}static flatten_vector(t){let e=[];for(let i=0;i<t.length;i++)e[i]=t[i][0];return e}static squared_difference(t,e){let i=0;for(let r=0;r<t.length;r++)i=i+Math.pow(t[r]-e[r],2);return i}static shift_deflate(t,e,i){let r=Math.sqrt(this.matmul(this.transpose(i),i)),s=this.matscale(i,1/r),n=this.matscale(this.matmul(s,this.transpose(s)),e);return this.matsub(t,n)}static eigenvalue_of_vector(t,e){return ev=this.matmul(this.matmul(this.transpose(e),t),e),ev}static power_iteration(t,e=1e-5,i=1e3){let r=t.length,s=new Array(r).fill(0).map(()=>new Array(1).fill(Math.sqrt(r))),n=this.eigenvalue_of_vector(t,s),a=1,l=0;for(;a>e&&l<i;){let c=JSON.parse(JSON.stringify(n)),f=this.matmul(t,s);s=this.normalize(f),n=this.eigenvalue_of_vector(t,s),a=Math.abs(n-c),l++}return[n,s]}static eigens(t,e=1e-4,i=1e3){let r=[],s=[];for(let n=0;n<t.length;n++){let a=this.power_iteration(t,e,i),l=a[0],c=a[1];r[n]=l,s[n]=this.flatten_vector(c),t=this.shift_deflate(t,l,c)}return[r,s]}static pca(t,e=1e-5){let i=t.length,r=new Array(i),s=new Array(i),n=this.transpose(t);for(r[0]=this.column(t,0);espilon>e;){s[0]=this.matmul(n,r[0]);let l=this.matmul(this.transpose(r[0]),r[0]);s[0]=this.matscale(s[0],1/l);let c=Math.sqrt(this.matmul(this.transpose(s[0]),s[0]));s[0]=this.matscale(s[0],1/c);let f=this.matmul(t,s[0]),u=this.matmul(this.transpose(s[0]),s[0]);f=this.matscale(f,1/u),this.squared_difference(r[0],f),r[0]=JSON.parse(JSON.stringify(f))}return this.matmul(this.transpose(r[0]),r[0])}static circularBuffer(t,e){if(Array.isArray(e))if(e.length<t.length){let i=t.slice(e.length),r=t.length;t.splice(0,r,...i,...e)}else if(e.length>t.length){let i=t.length;t.splice(0,i,e.slice(i-e.length))}else t.splice(0,t.length,...e);else t.push(e),t.shift();return t}static HSLToRGB(t,e,i,r=255){e/=100,i/=100;let s=(1-Math.abs(2*i-1))*e,n=s*(1-Math.abs(t/60%2-1)),a=i-s/2,l=0,c=0,f=0;return 0<=t&&t<60?(l=s,c=n,f=0):60<=t&&t<120?(l=n,c=s,f=0):120<=t&&t<180?(l=0,c=s,f=n):180<=t&&t<240?(l=0,c=n,f=s):240<=t&&t<300?(l=n,c=0,f=s):300<=t&&t<360&&(l=s,c=0,f=n),l=(l+a)*r,c=(c+a)*r,f=(f+a)*r,[l,c,f]}static p300(t=[],e=[],i=[],r=256){let s=Math.floor(r/10),n=this.sma(e,s),a=this.peakDetect(n,"peak",s),l=this.mean(n),c=this.std(n,l),f=0,u=[];return a.length>0&&t.forEach((h,p)=>{for(;i[a[f]]<h+200&&(f++,!!a[f]););let y=0,_=[];for(;i[a[f+y]]<h+600&&(_.push(f+y),y++,!!a[f+y]););if(_.length>1){let m=[];_.forEach(E=>{m.push(n[a[E]])});let A=Math.max(...m),O=_[m.indexOf(A)];u.push({event_timestamp:h,event_index:p,peak_timestamp:i[[a[O]]],signal_index:[a[O]],signal_amplitude:e[[a[O]]],zscore:(n[a[O]]-l)/c})}else _.length===1&&u.push({event_timestamp:h,event_index:p,peak_timestamp:i[a[_[0]]],signal_index:a[_[0]],signal_amplitude:e[[a[_[0]]]],zscore:(n[a[_[0]]]-l)/c})}),u}},te=Ge;se(te,"TWO_PI",Math.PI*2);se(te,"C",299792458);se(te,"G",66743e-15);se(te,"h",662607015e-42);se(te,"R",8314.32);se(te,"Ra",287);se(te,"H",69.3);se(te,"kbar",1054571817e-43);se(te,"kB",1380649e-29);se(te,"ke",89875517923e-1);se(te,"me",91093837015e-41);se(te,"mp",167262192369e-38);se(te,"mn",167492749804e-38);se(te,"P0",101325);se(te,"T0",288.15);se(te,"p0",1.225);se(te,"Na",60220978e16);se(te,"y",1.405);se(te,"M0",28.96643);se(te,"g0",9.80665);se(te,"Re",6378100);se(te,"B",1458e-9);se(te,"S",110.4);se(te,"Sigma",365e-12);se(te,"imgkernels",{edgeDetection:[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]],boxBlur:[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]],sobelLeft:[[1,0,-1],[2,0,-2],[1,0,-1]],sobelRight:[[-1,0,1],[-2,0,2],[-1,0,1]],sobelTop:[[1,2,1],[0,0,0],[-1,-2,-1]],sobelBottom:[[-1,2,1],[0,0,0],[1,2,1]],identity:[[0,0,0],[0,1,0],[0,0,0]],gaussian3x3:[[1,2,1],[2,4,2],[1,2,1]],guassian7x7:[[0,0,0,5,0,0,0],[0,5,18,32,18,5,0],[0,18,64,100,64,18,0],[5,32,100,100,100,32,5],[0,18,64,100,64,18,0],[0,5,18,32,18,5,0],[0,0,0,5,0,0,0]],emboss:[[-2,-1,0],[-1,1,1],[0,1,2]],sharpen:[[0,-1,0],[-1,5,-1],[0,-1,0]]});se(te,"integral",(t=r=>r,e=[],i=.01)=>{let r=0;for(let s=e[0];s<e[1];s+=i){let n=t(s);r+=n*i}return r});se(te,"dintegral",(t=(s,n)=>s+n,e=[[],[]],i=.01,r=i)=>{let s=0;for(let n=e[0][0]+i;n<e[0][1];n+=i)for(let a=e[1][0]+r;a<e[1][1];a+=r){let l=t(n,a);s+=l*i*r}return s});se(te,"tintegral",(t=(n,a,l)=>n+a+l,e=[[],[],[]],i=.01,r=i,s=i)=>{let n=0;for(let a=e[0][0]+i;a<e[0][1];a+=i)for(let l=e[1][0]+r;l<e[1][1];l+=r)for(let c=e[2][0]+s;c<e[2][1];c+=s){let f=t(a,l,c);n+=f*i*r*s}return n});se(te,"pintegral",(t=r=>r,e=[],i=.01)=>{let r=0,s,n;for(let a=e[0];a<e[1];a+=i)s=n,n=t(a),s&&(r+=Ge.distance([0,s],[i,n]));return r});se(te,"meshgrid",Ge.generateCoordinateSpace);se(te,"autocorrelation2d",t=>{let e=[];for(let i=0;i<t.length;i++){e.push([]);for(let r=0;r<t[i].length;r++){let s=0;for(let n=0;n<t.length;n++)for(let a=0;a<t[n].length;a++)s+=t[i][r]*t[t.length-1-n][t[i].length-1-a];e[i][r]=s}}return e});se(te,"lerp",Ge.makeArr);se(te,"upsample",Ge.interpolateArray);se(te,"lerp",(t,e,i,r=!0)=>{});se(te,"peakDetect",(t,e="peak",i=49)=>{let r=Math.floor(i*.5),s=[];for(let n=0;n<t.length-i;n++)Ge.isExtrema(t.slice(n,n+i),e)&&s.push(n+r-1);return s});Object.assign(Math,te);var Lf={accelConstant:1/8192,gyroConstant:1/65.5,gyroXAngle:0,gyroYAngle:0,gyroZAngle:0,px:0,py:0,pz:0,sps:100,lastAccelTime:Date.now(),lastGyroTime:Date.now(),__operator:function(t){if(!("ax"in t)&&!("gx"in t))return;if(!t.timestamp)if(t.ax&&Array.isArray(t.ax)||t.gx&&Array.isArray(t.gx)){let i=t.ax?t.ax.length:t.gx.length,r=Date.now(),s=[r-i*this.sps*1e3,r];t.timestamp=te.upsample(s,i)}else t.timestamp=Date.now();let e;if(t.ax){let i=(r,s,n,a)=>{s=s*this.accelConstant,n=n*this.accelConstant,a=a*this.accelConstant;const l=Math.atan(n/Math.sqrt(s*s)+a*a*180/Math.PI)+this.accelXError,c=Math.atan(-s/Math.sqrt(n*n)+a*a*180/Math.PI)+this.accelYError;return{ax:s,ay:n,az:a,roll:l,pitch:c}};Array.isArray(t.timestamp)?e=t.timestamp.map((r,s)=>i(r,t.ax[s],t.ay[s],t.az[s])):e=i(t.timestamp,t.ax,t.ay,t.az)}if(t.gx){let i=(s,n,a,l)=>{const c=s-this.lastGyroTime;return this.lastGyroTime=s,n=n*this.gyroConstant+this.gyroXError,a=a*this.gyroConstant+this.gyroYError,l=l*this.gyroConstant+this.gyroZError,this.gyroXAngle+=n*c,this.gyroYAngle+=a*c,this.gyroZAngle+=l*c,{gx:n,gy:a,gz:l,roll:this.gyroXAngle,pitch:this.gyroYAngle,yaw:this.gyroZAngle}},r;Array.isArray(t.timestamp)?(r=t.timestamp.map((s,n)=>{if(e){let a=i(s,t.gx[n],t.gy[n],t.gz[n]);e.roll=e.roll*.04+a.roll*.96,e.pitch=e.pitch*.04+a.pitch*.96,e.yaw=r.yaw}else return i(s,t.gx[n],t.gy[n],t.gz[n])}),e||(e=r)):(r=i(t.timestamp,t.gx,t.gy,t.gz),e?(e.roll=e.roll*.04+r.roll*.96,e.pitch=e.pitch*.04+r.pitch*.96,e.yaw=r.yaw):e=r)}else(this.gyroXAngle||this.gyroYAngle||this.gyroZAngle)&&(e.roll=e.roll*.04+this.gyroXAngle*.96,e.pitch=e.pitch*.04+this.gyroYAngle*.96,e.yaw=this.gyroXAngle);if(e.ax){const i=(r,s)=>{const n=r-this.lastAccelTime;return this.lastAccelTime=r,this.px+=s.ax*n*n*Math.cos(this.pitch*Math.PI*.005555555555),this.py+=s.ay*n*n*Math.cos(this.roll*Math.PI*.005555555555),this.pz+=s.az*n*n*Math.sin(this.pitch*Math.PI*.005555555555),s.px=this.px,s.py=this.py,s.pz=this.pz,s};Array.isArray(t.timestamp)?t.timestamp.map((r,s)=>{i(r,e)}):i(t.timestamp,e)}return e}},Oa=class{constructor(t,e,i,r=1/Math.sqrt(2),s=0){if(this.a0=0,this.a1=0,this.a2=0,this.b0=0,this.b1=0,this.b2=0,this.x1=0,this.x2=0,this.y1=0,this.y2=0,["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"].indexOf(t)<0){console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'");return}this.type=t,this.freq=e,this.sps=i,this.Q=r,this.dbGain=s;let a=Math.pow(10,s/40),l=2*Math.PI*e/i,c=Math.sin(l),f=Math.cos(l),u=c/(2*r),h=Math.sqrt(a+a);this[t](a,c,f,u,h),this.b0/=this.a0,this.b1/=this.a0,this.b2/=this.a0,this.a1/=this.a0,this.a2/=this.a0}lowpass(t,e,i,r,s){this.b0=(1-i)*.5,this.b1=1-i,this.b2=(1-i)*.5,this.a0=1+r,this.a1=-2*i,this.a2=1-r}highpass(t,e,i,r,s){this.b0=(1+i)*.5,this.b1=-(1+i),this.b2=(1+i)*.5,this.a0=1+r,this.a1=-2*i,this.a2=1-r}bandpass(t,e,i,r,s){this.b0=r,this.b1=0,this.b2=-r,this.a0=1+r,this.a1=-2*i,this.a2=1-r}notch(t,e,i,r,s){this.b0=1,this.b1=-2*i,this.b2=1,this.a0=1+r,this.a1=-2*i,this.a2=1-r}peak(t,e,i,r,s){this.b0=1+r*t,this.b1=-2*i,this.b2=1-r*t,this.a0=1+r/t,this.a1=-2*i,this.a2=1-r/t}lowshelf(t,e,i,r,s){this.b0=t*(t+1-(t-1)*i+s*e),this.b1=2*t*(t-1-(t+1)*i),this.b2=t*(t+1-(t-1)*i-s*e),this.a0=t+1+(t+1)*i+s*e,this.a1=2*(t-1+(t+1)*i),this.a2=t+1+(t-1)*i-s*e}highshelf(t,e,i,r,s){this.b0=t*(t+1+(t-1)*i+s*e),this.b1=2*t*(t-1+(t+1)*i),this.b2=t*(t+1-(t-1)*i-s*e),this.a0=t+1-(t+1)*i-s*e,this.a1=2*(t-1-(t+1)*i),this.a2=t+1-(t-1)*i-s*e}applyFilter(t){let e=this.b0*t+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;return this.x2=this.x1,this.x1=t,this.y2=this.y1,this.y1=e,e}zResult(t){try{let e=Math.pow(Math.sin(Math.PI*t*2/(2*this.sps)),2);return(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*e+16*this.b0*this.b2*e*e)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*e+16*this.a2*e*e)}catch{return-200}}static calcCenterFrequency(t,e){return(t+e)/2}static calcBandwidth(t,e){return e-this.calcCenterFrequency(t,e)}static calcBandpassQ(t,e,i=Math.pow(10,Math.floor(Math.log10(t)))){return i*Math.sqrt((t-e)*(t+e))/(2*e)}static calcNotchQ(t,e,i=Math.pow(10,Math.floor(Math.log10(t)))){return i*t*e/Math.sqrt((t-e)*(t+e))}},ps={refdata:[],lowpass:void 0,smoothed:[],timestamp:[],peaks:[],valleys:[],peak_distances:[],valley_distances:[],beats:[],lastPeak:0,lastValley:0,sps:100,maxFreq:4,limit:10,__onconnected:function(){this.lowpass||(this.maxFreq,this.lowpass=new Oa("lowpass",this.maxFreq,this.sps),this.peakFinderWindow=Math.floor(this.sps/this.maxFreq),this.peakFinderWindow%2===0&&(this.peakFinderWindow+=1),this.peakFinderWindow<5&&(this.peakFinderWindow=5),this.midpoint=Math.round(this.peakFinderWindow*.5))},__operator:function(t){if(!("red"in t)&&!("heg"in t)&&!("raw"in t))return;let e=t.red?t.red:t.heg?t.heg:t.raw;if(!("timestamp"in t))if(Array.isArray(e)){let r=Date.now();e&&e.length;let s=[r-e.length*this.sps*1e3,r];t.timestamp=te.upsample(s,e.length)}else t.timestamp=Date.now();let i=(r,s)=>{r&&this.refdata.push(r),this.timestamp.push(s);let n;if(this.refdata.length>this.peakFinderWindow&&(this.refdata.shift(),this.timestamp.shift()),this.smoothed.push(this.lowpass.applyFilter(this.refdata[this.refdata.length-1])),this.smoothed.length>this.peakFinderWindow&&this.smoothed.shift(),this.smoothed.length===this.peakFinderWindow&&(te.isExtrema(this.smoothed,"valley")?this.valleys.push({value:this.smoothed[this.smoothed.length-this.midpoint?this.midpoint:1],timestamp:this.timestamp[this.timestamp.length-this.midpoint?this.midpoint:1]}):te.isExtrema(this.smoothed,"peak")&&this.peaks.push({value:this.smoothed[this.smoothed.length-this.midpoint?this.midpoint:1],timestamp:this.timestamp[this.timestamp.length-this.midpoint?this.midpoint:1]}),this.valleys.length>2&&this.peaks.length>2)){if(this.valleys[this.valleys.length-1].timestamp<this.peaks[this.peaks.length-2].timestamp&&this.peaks.splice(this.peaks.length-1),this.peaks[this.peaks.length-1].timestamp<this.valleys[this.valleys.length-2].timestamp&&this.valleys.splice(this.valleys.length-1),this.valley_distances.push({distance:this.valleys[this.valleys.length-1].timestamp-this.valleys[this.valleys.length-2].timestamp,timestamp:this.valleys[this.valleys.length-1].timestamp,peak0:this.valleys[this.valleys.length-1].value,peak1:this.valleys[this.valleys.length-2].value}),this.peak_distances.push({distance:this.peaks[this.peaks.length-1].timestamp-this.peaks[this.peaks.length-2].timestamp,timestamp:this.peaks[this.peaks.length-1].timestamp,peak0:this.peaks[this.peaks.length-1].value,peak1:this.peaks[this.peaks.length-2].value}),this.peak_distances.length>1&&this.valley_distances.length>1&&this.lastPeak<this.peaks[this.peaks.length-1].timestamp&&this.lastValley<this.peaks[this.peaks.length-1].timestamp)if(this.valley_distances[this.valley_distances.length-1].timestamp>this.peak_distances[this.peak_distances.length-1].timestamp){let a,l=0;this.beats.length<1?a=60/(5e-4*(this.peak_distances[this.peak_distances.length-1].distance+this.valley_distances[this.valley_distances.length-1].distance)):this.beats[this.beats.length-1].timestamp!==this.peak_distances[this.peak_distances.length-1].timestamp&&(a=60/(5e-4*(this.peak_distances[this.peak_distances.length-1].dt+this.valley_distances[this.valley_distances.length-1].dt)),l=Math.abs(a-this.beats[this.beats.length-1].bpm)),n={timestamp:this.peak_distances[this.peak_distances.length-1].timestamp,change:l,bpm:a,height0:this.peak_distances[this.peak_distances.length-1].peak0-this.valley_distances[this.valley_distances.length-1].peak0,height1:this.peak_distances[this.peak_distances.length-1].peak1-this.valley_distances[this.valley_distances.length-1].peak1},this.beats.push(n),this.lastPeak=this.peaks[this.peaks.length-1].timestamp,this.lastValley=this.peaks[this.peaks.length-1].timestamp}else{let a,l=0;this.beats.length<2?a=60/(5e-4*(this.peak_distances[this.peak_distances.length-2].distance+this.valley_distances[this.valley_distances.length-2].distance)):this.beats[this.beats.length-1].timestamp!==this.peak_distances[this.peak_distances.length-2].timestamp&&(a=60/(5e-4*(this.peak_distances[this.peak_distances.length-2].distance+this.valley_distances[this.valley_distances.length-2].distance)),l=Math.abs(a-this.beats[this.beats.length-2].bpm)),n={timestamp:this.peak_distances[this.peak_distances.length-2].timestamp,change:l,bpm:a,height0:this.peak_distances[this.peak_distances.length-2].peak0-this.valley_distances[this.valley_distances.length-2].peak0,height1:this.peak_distances[this.peak_distances.length-2].peak1-this.valley_distances[this.valley_distances.length-2].peak1},this.beats.push(n),this.lastPeak=this.peaks[this.peaks.length-1].timestamp,this.lastValley=this.peaks[this.peaks.length-1].timestamp}this.peaks.length>this.limit&&this.peaks.shift(),this.valleys.length>this.limit&&this.valleys.shift(),this.peak_distances.length>this.limit&&this.peak_distances.shift(),this.valley_distances.length>this.limit&&this.valley_distances.shift(),this.beats.length>this.limit&&this.beats.shift()}return n};if(t.red){if("ir"in t&&!Array.isArray(t.red))return i(t.red+t.ir,t.timestamp);let r;return t.ir?r=t.red.map((s,n)=>i(s+t.ir[n],t.timestamp[n])):r=t.red.map((s,n)=>i(s,t.timestamp[n])),r}else{if(t.raw)return Array.isArray(t.raw)?t.raw.map((s,n)=>i(s,t.timestamp[n])):i(t.raw,t.timestamp);if(Array.isArray(t.heg))return Array.isArray(t.heg)?t.heg.map((s,n)=>i(s,t.timestamp[n])):i(t.heg,t.timestamp)}}},If={sps:250,intervals:{},watch:["0"],tolerance:.2,__onconnected:t=>{t.watch.forEach(e=>t.intervals[e]={lowpass:new Oa("lowpass",20,t.sps),filtered:[],averaged:[]})},__operator:function(t){let e=5,i=50,r={},s=!1,n=(a,l)=>{let c=this.intervals[a].lowpass.applyFilter(l);if(this.intervals[a].filtered.push(c),this.intervals[a].averaged.push(c),this.intervals[a].filtered.length>e)if(this.intervals[a].averaged.length>i){this.intervals[a].averaged.splice(0,e);let f=te.mean(this.intervals[a].averaged);Math.abs(Math.min(...this.intervals[a].filtered))>Math.abs(f)+this.tolerance&&(this.intervals[a].filtered.length=0,s=!0,r[a]=!0)}else this.intervals[a].filtered.shift()};for(const a in this.intervals)t[a]&&(Array.isArray(t[a])?t[a].forEach(l=>{n(a,l)}):typeof t[a]=="number"&&n(a,t[a]));if(s)return r}},xi=class{constructor(){this.recursivelyAssign=(t,e)=>{for(const i in e)typeof e[i]=="object"?typeof t[i]=="object"?this.recursivelyAssign(t[i],e[i]):t[i]=this.recursivelyAssign({},e[i]):t[i]=e[i];return t}}static autoscale(t,e=0,i=1,r=!1,s,n,a){if((t==null?void 0:t.length)===0)return t;let l=n||Math.max(...t),c=s||Math.min(...t),f=1/i,u=1;if(r){let h=Math.max(Math.abs(c),Math.abs(l));return h!==0&&(u=f/h),t.map(p=>(a&&(p<c&&(p=c),p>l&&(p=l)),p*u+(f*(e+1)*2-1-f)))}else return l===c?l!==0?u=f/l:c!==0&&(u=f/Math.abs(c)):u=f/(l-c),t.map(h=>(a&&(h<c&&(h=c),h>l&&(h=l)),2*((h-c)*u-1/(2*i))+(f*(e+1)*2-1-f)))}static genTimestamps(t,e){let i=Date.now(),r=[i-t*1e3/e,i];return xi.upsample(r,t)}static absmax(t){return Math.max(Math.abs(Math.min(...t)),Math.max(...t))}static downsample(t,e,i=1){if(t.length>e){let r=new Array(e),s=t.length/e,n=t.length-1,a=0,l=0;for(let c=s;c<t.length;c+=s){let f=Math.round(c);f>n&&(f=n);for(let u=a;u<f;u++)r[l]+=t[u];r[l]/=(f-a)*i,l++,a=f}return r}else return t}static upsample(t,e,i=1){var r=function(h,p,y){return(h+(p-h)*y)*i},s=new Array(e),n=(t.length-1)/(e-1);s[0]=t[0];for(var a=1;a<e-1;a++){var l=a*n,c=Math.floor(l),f=Math.ceil(l),u=l-c;s[a]=r(t[c],t[f],u)}return s[e-1]=t[t.length-1],s}static interpolate(t,e,i=1){return t.length>e?xi.downsample(t,e,i):t.length<e?xi.upsample(t,e,i):t}static HSLToRGB(t,e,i,r=255){e/=100,i/=100;let s=(1-Math.abs(2*i-1))*e,n=s*(1-Math.abs(t/60%2-1)),a=i-s/2,l=0,c=0,f=0;return 0<=t&&t<60?(l=s,c=n,f=0):60<=t&&t<120?(l=n,c=s,f=0):120<=t&&t<180?(l=0,c=s,f=n):180<=t&&t<240?(l=0,c=n,f=s):240<=t&&t<300?(l=n,c=0,f=s):300<=t&&t<360&&(l=s,c=0,f=n),l=(l+a)*r,c=(c+a)*r,f=(f+a)*r,[l,c,f]}static circularBuffer(t,e){if(e.length<t.length){let i=t.slice(e.length),r=t.length;t.splice(0,r,...i,...e)}else if(e.length>t.length){let i=t.length;t.splice(0,i,...e.slice(e.length-i))}else t.splice(0,t.length,...e);return t}static reformatData(t,e){var i;if(Array.isArray(t)){if(Array.isArray(t[0])){let r={};if(t.forEach((s,n)=>{r[n]=s}),t=r,isNaN(t[0][0]))return}else if(e){if(t={[e]:t},isNaN(t[e][0]))return}else if(t={0:t},isNaN(t[0][0]))return}else if(typeof t=="object"){for(const r in t)if(typeof t[r]=="number"?t[r]=[t[r]]:(i=t[r])!=null&&i.values&&typeof t[r].values=="number"&&(t[r].values=[t[r].values]),isNaN(t[r][0]))return}else if(typeof t=="string"){let r;if(t.includes(`\r
`)){let s=t.split(`\r
`);t={},s.forEach((n,a)=>{n.includes("	")?r=n.split("	"):n.includes(",")?r=n.split(","):n.includes("|")&&(r=n.split("|")),Array.isArray(r)&&r.forEach((l,c)=>{if(l.includes(":")){let[f,u]=l.split(":"),h=parseFloat(u);if(h)t[f]=[h];else return}else{let f=parseFloat(l);if(f)t[c]=[f];else return}})})}else t.includes("	")?r=t.split("	"):t.includes(",")?r=t.split(","):t.includes("|")&&(r=t.split("|"));t={},Array.isArray(r)&&r.forEach((s,n)=>{if(s.includes(":")){let[a,l]=s.split(":"),c=parseFloat(l);if(c)t[a]=[c];else return}else{let a=parseFloat(s);if(a)t[n]=[a];else return}})}else typeof t=="number"&&(e?t={[e]:[t]}:t={0:[t]});return t}static padTime(t,e,i,r){let s=(t[0]-e)/i/r;return[...new Array(r-t.length).map((a,l)=>e+s*(l+1)),...t]}static interpolateForTime(t,e,i){return xi.interpolate(t,Math.ceil(i*e))}isTypedArray(t){return ArrayBuffer.isView(t)&&Object.prototype.toString.call(t)!=="[object DataView]"}spliceTypedArray(t,e,i){let r=t.subarray(0,e),s;i&&(s=t.subarray(i+1));let n;return(r.length>0||(s==null?void 0:s.length)>0)&&(n=new t.constructor(r.length+s.length)),r.length>0&&n.set(r),s&&s.length>0&&n.set(s,r.length),n}},Ea=xi;Ea.bufferValues=(t,e,i,r)=>{if(!Array.isArray(i)&&typeof i=="object"&&(i=Object.keys(i)),!r){let n=Object.keys(t);i?r=new Float32Array(n.length*i.length):typeof t[n[0]][e]=="object"?(i=Object.keys(t[n[0]][e]),r=new Float32Array(n.length*i.length)):r=new Float32Array(n.length)}let s=0;for(const n in t)if(t[n][e])if(i)for(let a=0;a<i.length;a++)r[s]=t[n][e][i[a]],s++;else r[s]=t[n][e],s++;return r};var Mf=/^([<>])?(([1-9]\d*)?([xcbB?hHiIfdsp]))*$/,Df=/([1-9]\d*)?([xcbB?hHiIfdsp])/g,js=(t,e,i)=>String.fromCharCode(...new Uint8Array(t.buffer,t.byteOffset+e,i)),Cs=(t,e,i,r)=>new Uint8Array(t.buffer,t.byteOffset+e,i).set(r.split("").map(s=>s.charCodeAt(0))),Rf=(t,e,i)=>js(t,e+1,Math.min(t.getUint8(e),i-1)),Ff=(t,e,i,r)=>{t.setUint8(e,r.length),Cs(t,e+1,i-1,r)},Uf=t=>({x:e=>[1,e,0],c:e=>[e,1,i=>({u:r=>js(r,i,1),p:(r,s)=>Cs(r,i,1,s)})],"?":e=>[e,1,i=>({u:r=>!!r.getUint8(i),p:(r,s)=>r.setUint8(i,s)})],b:e=>[e,1,i=>({u:r=>r.getInt8(i),p:(r,s)=>r.setInt8(i,s)})],B:e=>[e,1,i=>({u:r=>r.getUint8(i),p:(r,s)=>r.setUint8(i,s)})],h:e=>[e,2,i=>({u:r=>r.getInt16(i,t),p:(r,s)=>r.setInt16(i,s,t)})],H:e=>[e,2,i=>({u:r=>r.getUint16(i,t),p:(r,s)=>r.setUint16(i,s,t)})],i:e=>[e,4,i=>({u:r=>r.getInt32(i,t),p:(r,s)=>r.setInt32(i,s,t)})],I:e=>[e,4,i=>({u:r=>r.getUint32(i,t),p:(r,s)=>r.setUint32(i,s,t)})],f:e=>[e,4,i=>({u:r=>r.getFloat32(i,t),p:(r,s)=>r.setFloat32(i,s,t)})],d:e=>[e,8,i=>({u:r=>r.getFloat64(i,t),p:(r,s)=>r.setFloat64(i,s,t)})],s:e=>[1,e,i=>({u:r=>js(r,i,e),p:(r,s)=>Cs(r,i,e,s.slice(0,e))})],p:e=>[1,e,i=>({u:r=>Rf(r,i,e),p:(r,s)=>Ff(r,i,e,s.slice(0,e-1))})]}),po=new RangeError("Structure larger than remaining buffer"),Jf=new RangeError("Not enough values for structure"),Qt=class extends Ea{static toDataView(t){if(!(t instanceof DataView))if(typeof t=="string"&&parseInt(t)&&(t=parseInt(t)),typeof t=="string"){let e=new TextEncoder,i={};for(const s in Qt.codes)for(;t.indexOf(s)>-1;){let n=t.indexOf(s);t=t.replace(s,""),i[n]=s}let r=Array.from(e.encode(t));for(const s in i)r.splice(parseInt(s),0,Qt.codes[i[s]]);t=new DataView(new Uint8Array(r).buffer)}else if(typeof t=="number"){let e=t;t<256?(t=new DataView(new ArrayBuffer(1)),t.setUint8(0,e)):t<65536?(t=new DataView(new ArrayBuffer(2)),t.setInt16(0,e)):(t=new DataView(new ArrayBuffer(4)),t.setUint32(0,e))}else t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer?t=new DataView(t):Array.isArray(t)?t=new DataView(Uint8Array.from(t).buffer):typeof t=="object"&&(t=new TextEncoder().encode(JSON.stringify(t)));return t}static searchBuffer(t,e,i){for(var r=e,s=t,n=Qt.boyerMoore(r),a=n.byteLength,l=[],c=n(s);c!==-1&&(l.push(c),!(i&&l.length>=i));c=n(s,c+a));return l}static bytesToInt16(t,e){let i=(255&t)<<8|255&e;return(i&32768)>0?i|=4294901760:i&=65535,i}static bytesToUInt16(t,e){return t*256+e}static Uint16ToBytes(t){return[t&255,t>>8&255]}static bytesToInt24(t,e,i){let r=(255&t)<<16|(255&e)<<8|255&i;return(r&8388608)>0?r|=4278190080:r&=16777215,r}static bytesToUInt24(t,e,i){return t*65536+e*256+i}static Uint24ToBytes(t){return[t&255,t>>8&255,t>>16&255]}static bytesToInt32(t,e,i,r){let s=(255&t)<<24|(255&e)<<16|(255&i)<<8|255&r;return(s&2147483648)>0?s|=0:s&=4294967295,s}static bytesToUInt32(t,e,i,r){return t*16777216+e*65536+i*256+r}static Uint32ToBytes(t){return[t&255,t>>8&255,t>>16&255,t>>24&255]}static get2sCompliment(t,e){return t>4294967296?null:t<<32-e>>32-e}static getSignedInt(...t){let e=0;function i(r){for(var s=0,n=!0;r--;)if(n){let a=t[e++];s+=a&127,a&128&&(s-=128),n=!1}else s*=256,s+=t[e++];return s}return i(t.length)}static asUint8Array(t){if(t instanceof Uint8Array)return t;if(typeof t=="string"){for(var e=new Uint8Array(t.length),i=0;i<t.length;i++){var r=t.charCodeAt(i);if(r>127)throw new TypeError("Only ASCII patterns are supported");e[i]=r}return e}else return new Uint8Array(t)}static boyerMoore(t){var e=Qt.asUint8Array(t),i=e.length;if(i===0)throw new TypeError("patternBuffer must be at least 1 byte long");for(var r=256,s=new Int32Array(r),n=0;n<r;n++)s[n]=-1;for(var a=0;a<i;a++)s[e[a]]=a;var l=(c,f,u)=>{var h=Qt.asUint8Array(c);f===void 0&&(f=0),u===void 0&&(u=h.length);for(var p=e,y=s,_=u-p.length,m=p.length-1,A,O=f;O<=_;O+=A){A=0;for(var E=m;E>=0;E--){var L=h[O+E];if(p[E]!==L){A=Math.max(1,E-y[L]);break}}if(A===0)return O}return-1};return l.byteLength=e.byteLength,l}static struct(t){let e=[],i=0,r=Mf.exec(t);if(!r)throw new RangeError("Invalid format string");const s=Uf(r[1]==="<"),n=(h,p)=>s[p](h?parseInt(h,10):1);for(;r=Df.exec(t);)((h,p,y)=>{for(let _=0;_<h;++_,i+=p)y&&e.push(y(i))})(...n(...r.slice(1)));const a=(h,p)=>{if(h.byteLength<(p|0)+i)throw po;let y=new DataView(h,p|0);return e.map(_=>_.u(y))},l=(h,p,...y)=>{if(y.length<e.length)throw Jf;if(h.byteLength<p+i)throw po;const _=new DataView(h,p);new Uint8Array(h,p,i).fill(0),e.forEach((m,A)=>m.p(_,y[A]))},c=(...h)=>{let p=new ArrayBuffer(i);return l(p,0,...h),p},f=h=>a(h,0);function*u(h){for(let p=0;p+i<=h.byteLength;p+=i)yield a(h,p)}return Object.freeze({unpack:f,pack:c,unpack_from:a,pack_into:l,iter_unpack:u,format:t,size:i})}},Zs=Qt;Zs.codes={"\\n":10,"\\r":13,"\\t":9,"\\s":32,"\\b":8,"\\f":12,"\\":92};var $f={sps:250,nSec:1,watch:["0","1","2","3"],data:{},rms:{},__operator:function(t){return this.watch.forEach(e=>{t[e]&&(this.data[e]||(Array.isArray(t[e])?this.data[e]=new Array(Math.floor(this.sps*this.nSec)).fill(t[e][0]):this.data[e]=new Array(Math.floor(this.sps*this.nSec)).fill(t[e])),Zs.circularBuffer(this.data[e],t[e]))}),t.timestamp?Array.isArray(t.timestamp)?this.rms.timestamp=t.timestamp[t.timestamp.length-1]:this.rms.timestamp=t.timestamp:this.rms.timestamp=Date.now(),new Promise(async e=>{await Promise.all(this.watch.map(async i=>{this.data[i]?this.rms[i]=Math.sqrt(Math.abs(this.data[i].reduce((r,s,n)=>r+s*s)/this.data[i].length)):delete this.rms[i]})),e(this.rms)})}},zf={bufferSize:250,watch:["0","1","2","3"],data:{},blocking:!1,__onconnected:function(t){for(const e in t.watch)t.data[e]=new Array(t.bufferSize).fill(0)},__operator:function(t){let e=[];return this.watch.forEach(i=>{t[i]&&(Zs.circularBuffer(this.data[i],t[i]),e.push(this.data[i]))}),e}},qf={beat_detect:ps,accel_gyro:Lf,heartrate:ps,breath:Object.assign({},ps),blink_detect:If,rms:$f,circularBuffer2d:zf};qf.breath.maxFreq=.2;const st=Qs(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]),Vf=Qs(["deltaX","deltaY"]),Hf=Qs(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function go(t,e){const i={type:t.type};i.isTrusted=t.isTrusted,i.bubbles=t.bubbles,i.cancelBubble=t.cancelBubble,i.cancelable=t.cancelable,i.composed=t.composed,i.defaultPrevent=t.defaultPrevented,i.eventPhase=t.eventPhase,i.returnValue=t.returnValue,i.currentTarget=t.currentTarget.id?t.currentTarget.id:t.currentTarget.constructor.name,i.target=i.currentTarget,i.srcElement=i.currentTarget,e(i)}function Gf(t,e){t.preventDefault&&t.preventDefault(),Vf(t,e)}function Wf(t){t.preventDefault&&t.preventDefault()}function Yf(t,e,i){for(const r of e)i[r]=t[r]}function Qs(t){return function(i,r){const s={type:i.type};Yf(i,t,s),r(s)}}function gs(t,e){const i=[],r={type:t.type,touches:i};for(let s=0;s<t.touches.length;++s){const n=t.touches[s];i.push({pageX:n.pageX,pageY:n.pageY})}e(r)}let ys=1,Na={};for(;ys<222;)Na[ys]=!0,ys++;function yo(t,e){let{keyCode:i}=t;Na[i]&&(t.preventDefault&&(i<110||i>123)&&t.preventDefault(),Hf(t,e))}const Si={contextmenu:Wf,mousedown:st,mousemove:st,mouseup:st,pointerdown:st,pointermove:st,pointerup:st,pointerlockchange:st,webkitpointerlockchange:st,focus:go,blur:go,pointerout:st,touchstart:gs,touchmove:gs,touchend:gs,wheel:Gf,keydown:yo,keyup:yo};function en(t,e,i){i||(i="proxy"+Math.floor(Math.random()*1e15));const r=a=>{e?e.postMessage({route:"handleProxyEvent",args:[a,i]}):Ba(a,i)};let s=Object.entries(Si);for(const[a,l]of s)t.addEventListener(a,function(c){l(c,r)});Si.keydown&&globalThis.addEventListener("keydown",function(a){Si.keydown(a,r)}),Si.keyup&&globalThis.addEventListener("keyup",function(a){Si.keyup(a,r)});const n=()=>{const a=t.getBoundingClientRect();r({type:"resize",left:a.left,top:a.top,width:t.clientWidth,height:t.clientHeight})};return n(),globalThis.addEventListener("resize",n),i}class Xf{constructor(){Z(this,"__listeners")}addEventListener(e,i){this.__listeners===void 0&&(this.__listeners={});const r=this.__listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this.__listeners===void 0)return!1;const r=this.__listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this.__listeners===void 0)return;const s=this.__listeners[e];if(s!==void 0){const n=s.indexOf(i);n!==-1&&s.splice(n,1)}}dispatchEvent(e,i){if(this.__listeners===void 0)return;const s=this.__listeners[e.type];if(s!==void 0){i?e.target=i:e.target=this;const n=s.slice(0);for(let a=0,l=n.length;a<l;a++)n[a].call(this,e)}}}function bo(){}class Kf extends Xf{constructor(){super();Z(this,"__listeners",{});Z(this,"proxied");Z(this,"style",{});Z(this,"width");Z(this,"left");Z(this,"right");Z(this,"top");Z(this,"height");Z(this,"setPointerCapture",()=>{});Z(this,"releasePointerCapture",()=>{});Z(this,"getBoundingClientRect",()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}));Z(this,"handleEvent",i=>{i.type==="resize"&&(this.left=i.left,this.top=i.top,this.width=i.width,this.height=i.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),i.preventDefault=bo,i.stopPropagation=bo,this.dispatchEvent(i,this.proxied)});this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}}class pr{constructor(){Z(this,"targets",{});Z(this,"makeProxy",(e,i=void 0)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let r;this.targets[e]?r=this.targets[e]:(r=new Kf,this.targets[e]=r),typeof i=="object"&&(i.proxy=r,r.proxied=i,typeof WorkerGlobalScope<"u"&&(i.style=r.style),r.width&&(i.style.width=r.width+"px",i.clientWidth=r.width),r.height&&(i.style.height=r.height+"px",i.clientHeight=r.height),i.setPointerCapture=r.setPointerCapture.bind(r),i.releasePointerCapture=r.releasePointerCapture.bind(r),i.getBoundingClientRect=r.getBoundingClientRect.bind(r),i.addEventListener=r.addEventListener.bind(r),i.removeEventListener=r.removeEventListener.bind(r),i.handleEvent=r.handleEvent.bind(r),i.dispatchEvent=r.dispatchEvent.bind(r),i.focus=r.focus.bind(r),i.blur=r.blur.bind(r))});Z(this,"getProxy",e=>this.targets[e]);Z(this,"handleEvent",(e,i)=>{if(this.targets[i]||this.makeProxy(i),this.targets[i])return this.targets[i].handleEvent(e),!0});globalThis.document||(globalThis.document={elementFromPoint:(...e)=>this.targets[Object.keys(this.targets)[0]].proxied})}}function Zf(t,e){var i;return(i=this==null?void 0:this.__node)!=null&&i.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new pr),this.__node.graph.ProxyManager.makeProxy(t,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new pr),globalThis.ProxyManager.makeProxy(t,e)),t}function Ba(t,e){var i;if((i=this==null?void 0:this.__node)!=null&&i.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new pr),this.__node.graph.ProxyManager.handleEvent(t,e))return t}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new pr),globalThis.ProxyManager.handleEvent(t,e))return t}const tn={initProxyElement:en,makeProxy:Zf,handleProxyEvent:Ba};function Qf(t){if(t.worker){let e=t.worker,i=t.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete t.worker,delete t.route,Ta(e,t,i)}else return en(t.canvas,void 0,t._id),ja(t)}function Ta(t,e,i){var l;if(console.log(e),!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let r=e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let s={route:i||"setupCanvas",args:{...e,canvas:r}};(l=this==null?void 0:this.__node)!=null&&l.graph?this.__node.graph.run("initProxyElement",e.canvas,t,e._id):en(e.canvas,t,e._id),e.draw&&(typeof e.draw=="function"?s.args.draw=e.draw.toString():s.args.draw=e.draw),e.update&&(typeof e.update=="function"?s.args.update=e.update.toString():s.args.update=e.update),e.init&&(typeof e.init=="function"?s.args.init=e.init.toString():s.args.init=e.init),e.clear&&(typeof e.clear=="function"?s.args.clear=e.clear.toString():s.args.clear=e.clear);let n=[r];return e.transfer&&(n.push(...e.transfer),delete e.transfer),t.postMessage(s,n),{_id:e._id,width:e.width,height:e.height,worker:t,draw:(c,f)=>{t.postMessage({route:"drawFrame",args:[c,e._id]},f)},update:(c,f)=>{t.postMessage({route:"updateCanvas",args:[c,e._id]},f)},clear:()=>{t.postMessage({route:"clearCanvas",args:e._id})},init:()=>{t.postMessage({route:"initCanvas",args:e._id})},stop:()=>{t.postMessage({route:"stopAnim",args:e._id})},start:()=>{t.postMessage({route:"startAnim",args:e._id})},set:(c,f)=>{t.postMessage({route:"setDraw",args:[c,e._id]},f)},terminate:()=>{t.terminate()}}}function or(t,e){var r,s,n,a,l,c,f,u;let i;if((r=this==null?void 0:this.__node)!=null&&r.graph?e?i=(s=this.__node.graph.CANVASES)==null?void 0:s[t._id]:t._id?i=(n=this.__node.graph.CANVASES)==null?void 0:n[t._id]:i=(a=this.__node.graph.CANVASES)==null?void 0:a[Object.keys(this.__node.graph.CANVASES)[0]]:e?i=(l=globalThis.CANVASES)==null?void 0:l[t._id]:t._id?i=(c=globalThis.CANVASES)==null?void 0:c[t._id]:i=(f=globalThis.CANVASES)==null?void 0:f[Object.keys(globalThis.CANVASES)[0]],i)return t.canvas&&(i.canvas=t.canvas,(u=this==null?void 0:this.__node)!=null&&u.graph?this.__node.graph.run("makeProxy",i._id,i.canvas):tn.makeProxy(i._id,i.canvas)),typeof t.context=="string"?i.context=i.canvas.getContext(t.context):t.context&&(i.context=t.context),t.width&&(i.canvas.width=t.width),t.height&&(i.canvas.height=t.height),typeof t.draw=="string"&&(t.draw=at(t.draw)),typeof t.draw=="function"&&(i.draw=t.draw.bind(t)),typeof t.update=="string"&&(t.update=at(t.update)),typeof t.update=="function"&&(i.update=t.update.bind(t)),typeof t.init=="string"&&(t.init=at(t.init)),typeof t.init=="function"&&(i.init=t.init.bind(t)),typeof t.clear=="string"&&(t.clear=at(t.clear)),typeof t.clear=="function"&&(i.clear=t.clear.bind(t)),t._id}function ja(t){var i,r,s,n,a,l,c;(i=this==null?void 0:this.__node)!=null&&i.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=t;if(t._id?e._id=t._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof t.context=="string"?e.context=t.canvas.getContext(t.context):e.context=t.context,"animating"in t?e.animating=t.animating:e.animating=!0,(s=(r=this==null?void 0:this.__node)==null?void 0:r.graph)!=null&&s.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if((n=globalThis.CANVASES)!=null&&n[e._id])or(e);else if((a=this==null?void 0:this.__node)!=null&&a.graph&&(e.graph=this.__node.graph,e.__node||(e.__node={}),e.__node.tag||(e.__node.tag=e._id),e=this.__node.graph.add(e),e.__addOndisconnected=()=>{e.stop(),delete this.__node.graph.CANVASES[e._id]}),(l=this==null?void 0:this.__node)!=null&&l.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,(c=this==null?void 0:this.__node)!=null&&c.graph?this.__node.graph.run("makeProxy",e._id,e.canvas):tn.makeProxy(e._id,e.canvas),t.width&&(e.canvas.width=t.width),t.height&&(e.canvas.height=t.height),typeof e.draw=="string"?e.draw=at(e.draw):typeof e.draw=="function"&&(e.draw=e.draw.bind(e)),typeof e.update=="string"?e.update=at(e.update):typeof e.update=="function"&&(e.update=e.update.bind(e)),typeof e.init=="string"?e.init=at(e.init):typeof e.init=="function"&&(e.init=e.init.bind(e)),typeof e.clear=="string"?e.clear=at(e.clear):typeof e.clear=="function"&&(e.clear=e.clear.bind(e)),typeof e.init=="function"&&e.init(e,e.canvas,e.context),e.stop=()=>{ar(e._id)},e.start=f=>{Ps(e._id,f)},e.set=f=>{or(f,e._id)},typeof e.draw=="function"&&e.animating){let f=(u,h,p)=>{u.animating&&(u.draw(u,h,p),requestAnimationFrame(()=>{f(u,h,p)}))};f(e,e.canvas,e.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?e._id:{_id:t._id,width:t.width,height:t.height,draw:u=>{Ca(u,t._id)},update:u=>{Ia(u,t._id)},clear:()=>{Pa(t._id)},init:()=>{La(t._id)},stop:()=>{ar(t._id)},start:()=>{Ps(t._id)},set:u=>{or(u,t._id)},terminate:()=>{var u,h;(u=this.__node)!=null&&u.graph?this.__node.graph.remove(t._id):(ar(t._id),(h=this==null?void 0:this.__node)!=null&&h.graph?delete this.__node.graph.CANVASES[e._id]:delete globalThis.CANVASES[e._id])}}}function Ca(t,e){let i=kt.call(this,e);if(i&&(t&&Object.assign(i,t),i.draw))return i.draw(i,i.canvas,i.context),e}function Pa(t){let e=kt.call(this,t);if(e!=null&&e.clear)return e.clear(e,e.canvas,e.context),t}function La(t){let e=kt.call(this,t);if(e!=null&&e.init)return e.init(e,e.canvas,e.context),t}function Ia(t,e){let i=kt.call(this,e);if(i!=null&&i.update)return i.update(i,i.canvas,i.context,t),e}function eu(t,e){let i=kt.call(this,e);if(i)return Object.assign(i,t),t.width&&(i.canvas.width=t.width),t.height&&(i.canvas.height=t.height),e}function Ps(t,e){let i=kt.call(this,t);if(i.animating=!0,i&&e)return typeof e=="string"&&(e=at(e)),typeof e=="function"&&(i.draw=e),t;if(typeof(i==null?void 0:i.draw)=="function"){let r=(s,n,a)=>{s.animating&&(s.draw(s,n,a),requestAnimationFrame(()=>{r(s,n,a)}))};return typeof i.clear=="function"&&i.clear(i,i.canvas,i.context),typeof i.init=="function"&&i.init(i,i.canvas,i.context),r(i,i.canvas,i.context),t}}function ar(t){let e=kt.call(this,t);if(e)return e.animating=!1,typeof e.clear=="function"&&requestAnimationFrame(e.clear(e,e.canvas,e.context)),t}function kt(t){var i,r,s,n,a;let e;return(i=this==null?void 0:this.__node)!=null&&i.graph?t?e=(s=this.__node.graph.CANVASES)==null?void 0:s[t]:e=(r=this.__node.graph.CANVASES)==null?void 0:r[Object.keys(this.__node.graph.CANVASES)[0]]:t?e=(a=globalThis.CANVASES)==null?void 0:a[t]:e=(n=globalThis.CANVASES)==null?void 0:n[Object.keys(globalThis.CANVASES)[0]],e}const Ma={...tn,Renderer:Qf,transferCanvas:Ta,setupCanvas:ja,setDraw:or,drawFrame:Ca,clearCanvas:Pa,initCanvas:La,updateCanvas:Ia,setProps:eu,startAnim:Ps,stopAnim:ar,getCanvas:kt};function at(t=""){let e=a=>a.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),r=(a=>{let l=a.indexOf("=>")+1;return l<=0&&(l=a.indexOf("){")),l<=0&&(l=a.indexOf(") {")),a.slice(0,a.indexOf("{",l)+1)})(t),s=e(t),n;if(r.includes("function")){let a=r.split("(")[1].split(")")[0];n=new Function(a,s)}else if(r.substring(0,6)===s.substring(0,6)){let a=r.split("(")[1].split(")")[0];n=new Function(a,s.substring(s.indexOf("{")+1,s.length-1))}else try{n=(0,eval)(r+s+"}")}catch{}return n}var Pt=class{constructor(t,e,i,r){this.r=t,this.g=e,this.b=i,this.a=r}},Da=class{constructor(){this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.loop=!1,this._vbuffer=0,this._coord=0,this.visible=!0,this.intensity=1,this.xy=new Float32Array([]),this.numPoints=0,this.color=new Pt(0,0,0,1),this.webglNumPoints=0}},Ki=class extends Da{constructor(t,e){super(),this.currentIndex=0,this.webglNumPoints=e,this.numPoints=e,this.color=t,this.xy=new Float32Array(2*this.webglNumPoints)}setX(t,e){this.xy[t*2]=e}setY(t,e){this.xy[t*2+1]=e}getX(t){return this.xy[t*2]}getY(t){return this.xy[t*2+1]}lineSpaceX(t,e){for(let i=0;i<this.numPoints;i++)this.setX(i,t+e*i)}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(t){for(let e=0;e<this.numPoints;e++)this.setY(e,t)}shiftAdd(t){let e=t.length;for(let i=0;i<this.numPoints-e;i++)this.setY(i,this.getY(i+e));for(let i=0;i<e;i++)this.setY(i+this.numPoints-e,t[i])}addArrayY(t){if(this.currentIndex+t.length<=this.numPoints)for(let e=0;e<t.length;e++)this.setY(this.currentIndex,t[e]),this.currentIndex++}replaceArrayY(t){if(t.length==this.numPoints)for(let e=0;e<this.numPoints;e++)this.setY(e,t[e])}},_o=(t,e,i)=>{let r={x:0,y:0};return r.x=t.x+e.x*i,r.y=t.y+e.y*i,r},bs=t=>rn(-t.y,t.x),Zi=(t,e)=>{let i=ru(t,e);return i=Ra(i),i},tu=(t,e)=>{let i={x:0,y:0};return i.x=t.x+e.x,i.y=t.y+e.y,i},iu=(t,e)=>t.x*e.x+t.y*e.y,Ra=t=>{let e={x:0,y:0},i=t.x*t.x+t.y*t.y;return i>0&&(i=1/Math.sqrt(i),e.x=t.x*i,e.y=t.y*i),e},rn=(t,e)=>{let i={x:0,y:0};return i.x=t,i.y=e,i},ru=(t,e)=>{let i={x:0,y:0};return i.x=t.x-e.x,i.y=t.y-e.y,i},su=t=>{let e,i={x:0,y:0},r={x:0,y:0},s=[],n=(c,f)=>{s.push({vec2:c,miterLength:f})},a=c=>({x:t[c*2],y:t[c*2+1]});i=Zi(a(1),a(0)),e=bs(i),n(e,1);let l=t.length/2;for(let c=1;c<l-1;c++){let f=a(c-1),u=a(c),h=a(c+1);i=Zi(u,f),e=bs(i),r=Zi(h,u);let p=nu(i,r),y=ou(i,p,1);n(p,y)}return i=Zi(a(l-1),a(l-2)),e=bs(i),n(e,1),s},nu=(t,e)=>{let i=tu(t,e);return i=Ra(i),rn(-i.y,i.x)},ou=(t,e,i)=>{let r=rn(-t.y,t.x);return i/iu(e,r)},_s=class extends Da{constructor(t,e,i){super(),this.currentIndex=0,this._thicknessRequested=0,this._actualThickness=0,this.webglNumPoints=e*2,this.numPoints=e,this.color=t,this._thicknessRequested=i,this._linePoints=new Float32Array(e*2),this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){let t=this._actualThickness/2,e=su(this._linePoints);for(let i=0;i<this.numPoints;i++){let r=this._linePoints[2*i],s=this._linePoints[2*i+1],n={x:r,y:s},a=_o(n,e[i].vec2,e[i].miterLength*t),l=_o(n,e[i].vec2,-e[i].miterLength*t);this.xy[i*4]=a.x,this.xy[i*4+1]=a.y,this.xy[i*4+2]=l.x,this.xy[i*4+3]=l.y}}setX(t,e){this._linePoints[t*2]=e}setY(t,e){this._linePoints[t*2+1]=e}lineSpaceX(t,e){for(let i=0;i<this.numPoints;i++)this.setX(i,t+e*i)}setThickness(t){this._thicknessRequested=t}getThickness(){return this._thicknessRequested}setActualThickness(t){this._actualThickness=t}},au=class{constructor(t,e){this.debug=!1,this.addLine=this.addDataLine,e==null?this.webgl=t.getContext("webgl",{antialias:!0,transparent:!1}):(this.webgl=t.getContext("webgl",{antialias:e.antialias,transparent:e.transparent,desynchronized:e.deSync,powerPerformance:e.powerPerformance,preserveDrawing:e.preserveDrawing}),this.debug=e.debug==null?!1:e.debug),this.log("canvas type is: "+t.constructor.name),this.log(`[webgl-plot]:width=${t.width}, height=${t.height}`),this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[],this.gScaleX=1,this.gScaleY=1,this.gXYratio=1,this.gOffsetX=0,this.gOffsetY=0,this.gLog10X=!1,this.gLog10Y=!1,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.webgl.viewport(0,0,t.width,t.height),this._progLine=this.webgl.createProgram(),this.initThinLineProgram(),this.webgl.enable(this.webgl.BLEND),this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(t){let e=this.webgl;t.forEach(i=>{if(i.visible){e.useProgram(this._progLine);let r=e.getUniformLocation(this._progLine,"uscale");e.uniformMatrix2fv(r,!1,new Float32Array([i.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,i.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let s=e.getUniformLocation(this._progLine,"uoffset");e.uniform2fv(s,new Float32Array([i.offsetX+this.gOffsetX,i.offsetY+this.gOffsetY]));let n=e.getUniformLocation(this._progLine,"is_log");e.uniform2iv(n,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let a=e.getUniformLocation(this._progLine,"uColor");e.uniform4fv(a,[i.color.r,i.color.g,i.color.b,i.color.a]),e.bufferData(e.ARRAY_BUFFER,i.xy,e.STREAM_DRAW),e.drawArrays(i.loop?e.LINE_LOOP:e.LINE_STRIP,0,i.webglNumPoints)}})}_drawSurfaces(t){let e=this.webgl;t.forEach(i=>{if(i.visible){e.useProgram(this._progLine);let r=e.getUniformLocation(this._progLine,"uscale");e.uniformMatrix2fv(r,!1,new Float32Array([i.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,i.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let s=e.getUniformLocation(this._progLine,"uoffset");e.uniform2fv(s,new Float32Array([i.offsetX+this.gOffsetX,i.offsetY+this.gOffsetY]));let n=e.getUniformLocation(this._progLine,"is_log");e.uniform2iv(n,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let a=e.getUniformLocation(this._progLine,"uColor");e.uniform4fv(a,[i.color.r,i.color.g,i.color.b,i.color.a]),e.bufferData(e.ARRAY_BUFFER,i.xy,e.STREAM_DRAW),e.drawArrays(e.TRIANGLE_STRIP,0,i.webglNumPoints)}})}_drawTriangles(t){let e=this.webgl;e.bufferData(e.ARRAY_BUFFER,t.xy,e.STREAM_DRAW),e.useProgram(this._progLine);let i=e.getUniformLocation(this._progLine,"uscale");e.uniformMatrix2fv(i,!1,new Float32Array([t.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,t.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let r=e.getUniformLocation(this._progLine,"uoffset");e.uniform2fv(r,new Float32Array([t.offsetX+this.gOffsetX,t.offsetY+this.gOffsetY]));let s=e.getUniformLocation(this._progLine,"is_log");e.uniform2iv(s,new Int32Array([0,0]));let n=e.getUniformLocation(this._progLine,"uColor");e.uniform4fv(n,[t.color.r,t.color.g,t.color.b,t.color.a]),e.drawArrays(e.TRIANGLE_STRIP,0,t.xy.length/2)}_drawThickLines(){this._thickLines.forEach(t=>{if(t.visible){let e=Math.min(this.gScaleX,this.gScaleY);t.setActualThickness(t.getThickness()/e),t.convertToTriPoints(),this._drawTriangles(t)}})}update(){this.clear(),this.draw()}draw(){this._drawLines(this.linesData),this._drawLines(this.linesAux),this._drawThickLines(),this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(t){t._vbuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,t._vbuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,t.xy,this.webgl.STREAM_DRAW),t._coord=this.webgl.getAttribLocation(this._progLine,"coordinates"),this.webgl.vertexAttribPointer(t._coord,2,this.webgl.FLOAT,!1,0,0),this.webgl.enableVertexAttribArray(t._coord)}addDataLine(t){this._addLine(t),this.linesData.push(t)}addAuxLine(t){this._addLine(t),this.linesAux.push(t)}addThickLine(t){this._addLine(t),this._thickLines.push(t)}addSurface(t){this._addLine(t),this.surfaces.push(t)}initThinLineProgram(){let t=`
      attribute vec2 coordinates;
      uniform mat2 uscale;
      uniform vec2 uoffset;
      uniform ivec2 is_log;

      void main(void) {
         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;
         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;
         vec2 line = vec2(x, y);
         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);
      }`,e=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(e,t),this.webgl.compileShader(e);let i=`
         precision mediump float;
         uniform highp vec4 uColor;
         void main(void) {
            gl_FragColor =  uColor;
         }`,r=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(r,i),this.webgl.compileShader(r),this._progLine=this.webgl.createProgram(),this.webgl.attachShader(this._progLine,e),this.webgl.attachShader(this._progLine,r),this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(t,e,i,r){this.webgl.viewport(t,e,i,r)}log(t){this.debug&&console.log("[webgl-plot]:"+t)}},me=class{constructor(){this.plots={}}initPlot(t,e){var c,f;if(e||(e=new au(t.canvas,t.webglOptions)),!t._id)t._id=`plot${Math.floor(Math.random()*1e15)}`;else if(this.plots[t._id]){let u=this.plots[t._id].initial;if(t.lines)for(let h in t.lines)u.lines[h]&&Array.isArray(t.lines[h])&&(t.lines[h],t.lines[h]=u.lines[h]);t=Object.assign(u,t)}t.overlay&&(typeof t.overlay!="object"&&(t.overlay=document.createElement("canvas"),t.overlay.style.position="absolute",t.overlay.width=t.canvas.width,t.overlay.height=t.canvas.height,t.canvas.appendChild(t.overlay)),t.overlayCtx||(t.overlayCtx=t.overlay.getContext("2d"))),t.width&&(t.canvas.width=t.width,t.canvas.style&&(t.canvas.style.width=t.width+"px"),typeof t.overlay=="object"&&(t.overlay.width=t.width,t.overlay.style&&(t.overlay.style.width=t.width+"px"))),t.height&&(t.canvas.height=t.height,t.canvas.style&&(t.canvas.style.height=t.height+"px"),typeof t.overlay=="object"&&(t.overlay.height=t.height,t.overlay.style&&(t.overlay.style.height=t.height+"px"))),(c=t.lines)!=null&&c.timestamp&&delete t.lines.timestamp,t.lines||(t.lines={});let i={};for(let u in t.lines)i[u]=Object.assign({},i[u]),"viewing"in t.lines[u]||(t.lines[u].viewing=!0),i[u].viewing=t.lines[u].viewing,i[u].sps=t.lines[u].sps,i[u].nSec=t.lines[u].nSec,i[u].nPoints=t.lines[u].nPoints,i[u].ymin=t.lines[u].ymin,i[u].ymax=t.lines[u].ymax,i[u].units=t.lines[u].units;let r={plot:e,settings:t,initial:Object.assign(Object.assign({},t),{lines:i}),anim:()=>{e.update()}};this.plots[t._id]=r;let s=0,n=0;Object.keys(t.lines).forEach(u=>{var h;((h=t.lines[u])==null?void 0:h.viewing)!==!1&&n++}),t.nLines=n;let a,l;typeof t.overlay=="object"&&(a=t.overlay,l=t.overlayCtx,l.clearRect(0,0,t.overlay.width,t.overlay.height),l.font=t.overlayFont?t.overlayFont:"1em Courier",l.fillStyle=t.overlayColor?t.overlayColor:"white");for(let u in t.lines){let h=t.lines[u];if(Array.isArray(h)&&(h={values:h},t.lines[u]=h),"viewing"in h||(h.viewing=!0),h.color)Array.isArray(h.color)&&(h.color=new Pt(...h.color));else{let O=me.HSLToRGB(360*(s/n)%360,100,50,1);r.initial.lines[u].color=[...O,1],h.color=new Pt(...O,1)}let p;if(h.nSec&&h.sps?p=Math.ceil(h.nSec*h.sps):h.nPoints?p=h.nPoints:h.points?p=h.points:t.linePoints?p=t.linePoints:h.values?p=h.values.length:p=1e3,h.points=p,t.lines[u].viewing===!1)continue;if((h.width||t.lineWidth)&&h.width!==0){let O=t.lineWidth;O||(O=h.width),h.width?h.line=new _s(h.color,p,h.width):t.lineWidth&&(h.line=new _s(h.color,p,t.lineWidth)),h.line.lineSpaceX(-1,2/h.line.numPoints)}else h.line=new Ki(h.color,p),h.line.arrangeX();((f=h.values)==null?void 0:f.length)===h.points?h.values.length!==p&&(h.interpolate?h.values.length>p?h.values=me.downsample(h.values,p):h.values.length<p&&(h.values=me.upsample(h.values,p)):h.values.length>h.points?h.values=h.values.slice(h.values.length-h.points):h.values=[...new Array(h.points-h.values.length).fill(0),...h.values]):Array.isArray(h.values)?h.values.length>p?h.values=h.values.slice(h.values.length-p):h.values.length<p&&(h.values=[...new Array(p-h.values.length).fill(0),...h.values]):h.values=new Array(h.points).fill(0);let y=h.ymin,_=h.ymax,m=h.values.length<=1e5;if(y===_?(_=m?Math.max(...h.values):1,y=m?Math.min(...h.values):0):isNaN(_)&&(_=m?Math.max(...h.values):1),isNaN(y)&&(y=m?Math.min(...h.values):0),y>_){let O=y;_=y,y=O}let A=Math.abs(y);if(h.absmax=A>_?A:_,"autoscale"in h||(h.autoscale=!0),h.position||(h.position=t.nLines-s-1),h.autoscale?h.autoscale===2?("clamp"in h||(h.clamp=!0),h.scaled=me.autoscale(h.values,h.position,n,h.centerZero,y,_,h.clamp)):(h.scaled=h.values,h.line.scaleY=me.getYScalar(h.values,n,h.centerZero,y,_),h.line.offsetY=me.getYOffset(h.position,n,y,h.line.scaleY)):h.scaled=h.values,h.scaled.forEach((O,E)=>h.line.setY(E,O)),h.line instanceof _s?e.addThickLine(h.line):h.line instanceof Ki&&e.addDataLine(h.line),"xAxis"in h||(h.xAxis=!0),h.xAxis){h.xColor?Array.isArray(h.xColor)&&(h.xColor=new Pt(...h.xColor)):h.xColor=new Pt(1,1,1,.3);let O=new Ki(h.xColor,2),E=h.autoscale?(s+1)*2/n-1-1/n:0;O.constY(E),O.arrangeX(),O.xy[2]=1,h.x=O,e.addAuxLine(O)}if(n>1&&h.autoscale&&s!==n-1){t.dividerColor?Array.isArray(t.dividerColor)&&(t.dividerColor=new Pt(...t.dividerColor)):t.dividerColor=new Pt(1,1,1,1);let O=new Ki(t.dividerColor,2);O.constY(h.autoscale?(s+1)*2/n-1:1),O.arrangeX(),O.xy[2]=1,h.divider=O,e.addAuxLine(O)}if(typeof t.overlay=="object"&&(h.useOverlay||!("useOverlay"in h))){let O=t.nLines-h.position-1;l.fillText(u,20,a.height*(O+.2)/t.nLines),l.fillText(`${Math.floor(_)===_?_:_==null?void 0:_.toFixed(5)} ${h.units?h.units:""}`,a.width-100,a.height*(O+.2)/t.nLines),l.fillText(`${Math.floor(y)===y?y:y==null?void 0:y.toFixed(5)} ${h.units?h.units:""}`,a.width-100,a.height*(O+.9)/t.nLines)}s++}return requestAnimationFrame(r.anim),this.plots[t._id]}deinitPlot(t){return typeof t=="string"&&(t=this.plots[t]),t.plot.clear(),t.plot.removeAllLines(),!0}reinitPlot(t,e){var i,r;if(typeof t=="string"){let s=t;t=this.plots[t],e._id||(e._id=s)}if(t.plot)return t.plot.clear(),t.plot.removeAllLines(),t.settings.overlayCtx&&t.settings.overlayCtx.clearRect(0,0,(i=t.settings.overlay)==null?void 0:i.width,(r=t.settings.overlay)==null?void 0:r.height),this.initPlot(e,t.plot)}getChartSettings(t,e){var r,s,n,a;let i=this.plots[t];if(i){let l=Object.assign({},i.initial);for(let c in i.initial.lines)typeof((r=i.initial.lines[c])==null?void 0:r.ymax)!="number"&&(l.lines[c].ymax=(s=i.settings.lines[c])==null?void 0:s.ymax),typeof((n=i.initial.lines[c])==null?void 0:n.ymin)!="number"&&(l.lines[c].ymin=(a=i.settings.lines[c])==null?void 0:a.ymin),e&&(l.lines[c].values=i.settings.lines[c].values);return delete l.canvas,delete l.overlay,delete l.overlayCtx,l}}update(t,e,i=!0){var r,s,n;if(typeof t=="string"&&(t=this.plots[t]),!t)return!1;if(e){let a=!1,l,c;typeof t.settings.overlay=="object"&&(l=t.settings.overlay,c=t.settings.overlayCtx,c.font=t.settings.overlayFont?t.settings.overlayFont:"1em Courier",c.fillStyle=t.settings.overlayColor?t.settings.overlayColor:"white");for(let f in e)if(t.settings.lines[f]&&t.settings.lines[f].line){if(((r=t.settings.lines[f])==null?void 0:r.viewing)===!1)continue;let u=t.settings.lines[f];if(u.values){if(t.settings.mode&&t.settings.mode==="sweep"){"ct"in u||(u.ct=0);let m=A=>{u.ct>u.values.length&&(u.ct=0),u.values[u.ct]=A,u.ct++};Array.isArray(e[f])?e[f].forEach(m):typeof e[f]=="number"?m(e[f]):e[f].values&&e[f].values.forEach(m)}else Array.isArray(e[f])&&((s=u.values)==null?void 0:s.length)<1e5?(u.values.length===0&&(u.values.length=u.points?u.points:1e3),e[f].length===u.values.length?u.values=e[f]:me.circularBuffer(u.values,e[f])):typeof e[f]=="number"?(u.values.push(e[f]),u.values.shift()):(n=e[f])!=null&&n.values&&(u.values.length===0&&(u.values.length=u.points?u.points:1e3),e[f].values.length===u.values.length?u.values=e[f].values:me.circularBuffer(u.values,e[f].values));u.values.length!==u.points&&(u.interpolate?u.values.length>u.points?u.values=me.downsample(u.values,u.points):u.scaled.length<u.points&&(u.values=me.upsample(u.values,u.points)):u.values.length>u.points?u.values.splice(0,u.values.length-u.points):u.values=new Array(u.points).fill(0).splice(u.points-u.values.length,0,u.values));let h=u.ymin,p=u.ymax,y=u.values.length<=1e5;if(h===p?(p=y?Math.max(...u.values):1,h=y?Math.min(...u.values):0):isNaN(p)&&(p=y?Math.max(...u.values):1),isNaN(h)&&(h=y?Math.min(...u.values):0),h>p){let m=h;p=h,h=m}let _=Math.abs(h);if(u.absmax=_>p?_:p,u.autoscale?u.autoscale===2?u.scaled=me.autoscale(u.values,u.position,t.settings.nLines,u.centerZero,h,p,u.clamp):(u.scaled=u.values,u.line.scaleY=me.getYScalar(u.values,t.settings.nLines,u.centerZero,h,p),u.line.offsetY=me.getYOffset(u.position,t.settings.nLines,h,u.line.scaleY)):u.scaled=u.values,u.scaled.forEach((m,A)=>{!u.autoscale&&u.absmax>1?u.line.setY(A,m/u.absmax):u.line.setY(A,m)}),typeof t.settings.overlay=="object"&&(u.useOverlay||!("useOverlay"in u))){let m=t.settings.nLines-u.position-1,A=l.height*m/t.settings.nLines,O=l.height/t.settings.nLines;if(c.clearRect(0,A,l.width,O),t.settings.mode&&t.settings.mode==="sweep"){c.fillStyle=t.settings.sweepColor?t.settings.sweepColor:"rgba(0,255,0,0.25)",c.beginPath();let E=l.width*u.ct/u.values.length;c.moveTo(E,A),c.lineTo(E,O),c.stroke()}c.fillStyle=t.settings.overlayColor?t.settings.overlayColor:"white",c.fillText(f,20,l.height*(m+.2)/t.settings.nLines),c.fillText(`${Math.floor(p)===p?p:p==null?void 0:p.toFixed(5)} ${u.units?u.units:""}`,l.width-100,l.height*(m+.2)/t.settings.nLines),c.fillText(`${Math.floor(h)===h?h:h==null?void 0:h.toFixed(5)} ${u.units?u.units:""}`,l.width-100,l.height*(m+.9)/t.settings.nLines)}}}else t.settings.generateNewLines&&!f.includes("timestamp")&&(Array.isArray(e[f])&&(e[f]={values:e[f]}),!e[f].nSec&&!e[f].nPoints&&!t.settings.linePoints&&(e[f].nPoints=1e3),a=!0);if(a)return t.settings.cleanGeneration||Object.keys(t.initial.lines).forEach(f=>{e[f]?e[f]=Object.assign(t.initial.lines[f],e[f]):e[f]=t.initial.lines[f]}),this.reinitPlot(t,{_id:t.settings._id,lines:e}),!0}return i&&requestAnimationFrame(t.anim),!0}updateLine(t,e,i,r,s,n,a){return t.numPoints!==e.length&&(i?t.numPoints>e.length?e=me.downsample(e,t.numPoints):t.numPoints<e.length&&(e=me.upsample(e,t.numPoints)):e.length>t.numPoints?e=e.slice(e.length-t.numPoints):e=[...new Array(e.length).fill(0),...e]),r&&(e=me.autoscale(e,s,n,a)),e.forEach((l,c)=>t.setY(c,l)),!0}static autoscale(t,e=0,i=1,r=!1,s,n,a){if((t==null?void 0:t.length)===0)return t;let l=typeof n=="number"?n:t.length<=1e5?Math.max(...t):1,c=typeof s=="number"?s:t.length<=1e5?Math.min(...t):0,f=1/i,u=1;if(r){let h=Math.max(Math.abs(c),Math.abs(l));return h!==0&&(u=f/h),t.map(p=>(a&&(p<c&&(p=c),p>l&&(p=l)),p*u+(f*(e+1)*2-1-f)))}else return l===c?l!==0?u=f/l:c!==0&&(u=f/Math.abs(c)):u=f/(l-c),t.map(h=>(a&&(h<c&&(h=c),h>l&&(h=l)),2*((h-c)*u-1/(2*i))+(f*(e+1)*2-1-f)))}static getYScalar(t,e=1,i=!1,r,s){if((t==null?void 0:t.length)===0)return t;let n=typeof s=="number"?s:t.length<=1e5?Math.max(...t):1,a=typeof r=="number"?r:t.length<=1e5?Math.min(...t):0,l=1/e,c=1;if(i){let f=Math.max(Math.abs(a),Math.abs(n));return f!==0&&(c=l/f),2*c}else return n===a?n!==0?c=l/n:a!==0&&(c=l/Math.abs(a)):c=l/(n-a),2*c}static getYOffset(t=0,e=1,i=0,r=1){let s=1/e,n=s*(t+1)*2-1-s;return i!==0?n-=i*r+1/e:n-=r+1/e,n}static absmax(t){return Math.max(Math.abs(Math.min(...t)),Math.max(...t))}static downsample(t,e,i=1){if(t.length>e){let r=new Array(e),s=t.length/e,n=t.length-1,a=0,l=0;for(let c=s;c<t.length;c+=s){let f=Math.round(c);f>n&&(f=n);for(let u=a;u<f;u++)r[l]+=t[u];r[l]/=(f-a)*i,l++,a=f}return r}else return t}static upsample(t,e,i=1){var r=function(h,p,y){return(h+(p-h)*y)*i},s=new Array(e),n=(t.length-1)/(e-1);s[0]=t[0];for(var a=1;a<e-1;a++){var l=a*n,c=Math.floor(l),f=Math.ceil(l),u=l-c;s[a]=r(t[c],t[f],u)}return s[e-1]=t[t.length-1],s}static interpolate(t,e,i=1){return t.length>e?me.downsample(t,e,i):t.length<e?me.upsample(t,e,i):t}static HSLToRGB(t,e,i,r=255){e/=100,i/=100;let s=(1-Math.abs(2*i-1))*e,n=s*(1-Math.abs(t/60%2-1)),a=i-s/2,l=0,c=0,f=0;return 0<=t&&t<60?(l=s,c=n,f=0):60<=t&&t<120?(l=n,c=s,f=0):120<=t&&t<180?(l=0,c=s,f=n):180<=t&&t<240?(l=0,c=n,f=s):240<=t&&t<300?(l=n,c=0,f=s):300<=t&&t<360&&(l=s,c=0,f=n),l=(l+a)*r,c=(c+a)*r,f=(f+a)*r,[l,c,f]}static circularBuffer(t,e){if(e.length<t.length){let i=t.slice(e.length),r=t.length;t.splice(0,r,...i,...e)}else if(e.length>t.length){let i=t.length;t.splice(0,i,...e.slice(e.length-i))}else t.splice(0,t.length,...e);return t}static formatDataForCharts(t,e){var i;if(Array.isArray(t)){if(Array.isArray(t[0])){let r={};if(t.forEach((s,n)=>{r[n]=s}),t=r,isNaN(t[0][0]))return}else if(e){if(t={[e]:t},isNaN(t[e][0]))return}else if(t={0:t},isNaN(t[0][0]))return}else if(typeof t=="object"){for(let r in t)if(typeof t[r]=="number"?t[r]=[t[r]]:(i=t[r])!=null&&i.values&&typeof t[r].values=="number"&&(t[r].values=[t[r].values]),isNaN(t[r][0]))return}else if(typeof t=="string"){let r;if(t.includes(`\r
`)){let s=t.split(`\r
`);t={},s.forEach((n,a)=>{n.includes("	")?r=n.split("	"):n.includes(",")?r=n.split(","):n.includes("|")&&(r=n.split("|")),r&&r.forEach((l,c)=>{if(l.includes(":")){let[f,u]=l.split(":"),h=parseFloat(u);isNaN(h)||(t[f]=[h])}else{let f=parseFloat(l);isNaN(f)||(t[c]=[f])}})})}else t.includes("	")?r=t.split("	"):t.includes(",")?r=t.split(","):t.includes("|")&&(r=t.split("|"));t={},r&&r.forEach((s,n)=>{if(s.includes(":")){let[a,l]=s.split(":"),c=parseFloat(l);isNaN(c)||(t[a]=[c])}else{let a=parseFloat(s);isNaN(a)||(t[n]=[a])}})}else typeof t=="number"&&(e?t={[e]:[t]}:t={0:[t]});return t}static padTime(t,e,i,r){let s=(t[0]-e)/i/r;return[...new Array(r-t.length).map((n,a)=>e+s*(a+1)),...t]}static interpolateForTime(t,e,i){return me.interpolate(t,Math.ceil(i*e))}};if(typeof WorkerGlobalScope<"u"){globalThis.plotter=new me;const t={...Ma};self.onmessage=e=>{e.data.route&&(Array.isArray(e.data.args)?t[e.data.route](...e.data.args):t[e.data.route](e.data.args))}}const lu=self;class cu{constructor(e){Z(this,"plotter",new _e);Z(this,"plot");Z(this,"options");Z(this,"create",(e=this.options)=>{const i=(n,a)=>{this.plotter.initPlot(n);let l=c=>{a.width=a.clientWidth,a.height=a.clientHeight,n.overlay.width=a.clientWidth,n.overlay.height=a.clientHeight,this.plotter.plots[n._id].plot.webgl.viewport(0,0,a.width,a.height),this.plotter.plots[n._id].plot.update()};typeof window<"u"?window.addEventListener("resize",l):a.addEventListener("resize",l),setTimeout(()=>{l()},10)},r=(n,a,l,c)=>{this.plotter.update(n._id,c)},s=(n,a,l)=>{this.plotter.deinitPlot(n._id)};if(e.init=i,e.update=r,e.clear=s,e.worker&&(e.worker===!0?e.worker=new Worker(lu):(typeof e.worker=="string"||e.worker instanceof Blob)&&(e.worker=new Worker(e.worker)),e.overlay)){let n=e.overlay.transferControlToOffscreen();e.overlay=n,e.transfer=[e.overlay]}return this.plot=Ma.Renderer(e),this.plot});Z(this,"update",e=>{this.plot||this.create(this.options),this.plot.update(e)});e&&(this.options=e,this.create(e))}}const hu=new Worker(new URL(""+new URL("canvas.worker-6e0ecbc0.js",import.meta.url).href,self.location),{type:"module"});class Fa extends We{constructor(...i){super(...i);Z(this,"canvas",document.createElement("canvas"));Z(this,"overlay",document.createElement("canvas"))}static get styles(){return fi`
      .row {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .row > div {
        padding: 10px;
        flex-grow: 1;
      }

      #plotter {
        position: relative;
        border: 1px solid gainsboro;
        height: 500px;
      }

      #plotter canvas:first-child {
        width: 100%;
        height: 100%;
        background: black;
      }

      #plotter canvas:nth-child(2) {
        position: absolute;
        top: 0;
        left: 0;
      }
    `}render(){let i=document.createElement("p");this.subscribe("decoded",a=>this.plotter.update(a));const r=document.createElement("p");r.innerHTML="-";const s=a=>a.reduce((l,c)=>l+c,0)/a.length;let n=[];return this.subscribe("decoded.heg",([a])=>{n.push(a),n.length>100&&n.shift(),r.innerHTML=s(n).toFixed(2)}),this.status=document.createElement("p"),this.subscribe("status",a=>{this.status.innerHTML=a[0].toUpperCase()+a.slice(1)}),this.subscribe("device",a=>{const l=this.shadowRoot.querySelector("#plotter");l.innerHTML="";const c=document.createElement("canvas"),f=document.createElement("canvas");l.appendChild(c),l.appendChild(f);const u=a.device.deviceName;let h={...lf[u]};if(h||(console.warn("No chart settings found, using default"),h={generateNewLines:!0}),h.lines){const p=h.lines,y={};p.heg&&(y.heg=p.heg),p.heg.ymin=1e-11,p.red&&(y.red=p.red),p.ir&&(y.infrared=p.ir),p.ambient&&(y.ambient=p.ambient),h.lines=y}this.plotter=new cu({canvas:c,overlay:f,worker:hu,...h}),oa.add(this.plotter)}),nr?this.status.innerHTML="Connected":this.status.innerHTML="Disconnected",be`
    <h1>Devices Manager</h1>
    <select>
    ${Object.keys(fs).map(a=>be`
      <optgroup label=${a}>
        ${Object.keys(fs[a]).map(l=>be`
          <option value=${a}_${l}>${fs[a][l]} - ${a}</option>
          `)}
      </optgroup>
      `)}
    </select>

    <hypergamma-button @click=${async()=>{const[a,l]=this.shadowRoot.querySelector("select").value.split("_");hf(a,l)}}>Connect</hypergamma-button>


   ${i}
   ${r}

    <div class="row">
      <div>
        <h3>Battery Life</h3>
        <p>100%</p>
      </div>
      <div>
        <h3>Device Status</h3>
        ${this.status}
      </div>
      <div>
        <h3>Last Session</h3>
        <p>${new Date().toUTCString()}</p>
      </div>
      <div>
        <h3>Average Session Duration</h3>
        <p>${(120*Math.random()).toFixed(2)} minutes</p>
      </div>
      <div>
        <h3>Current Average Ratio</h3>
        ${r}
      </div>
    </div>

    <h3>Data Streams</h3>
    <div id="plotter"></div>

    `}}customElements.get("hypergamma-devices-page")||customElements.define("hypergamma-devices-page",Fa);class Ua extends We{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",i=>{e.innerHTML=JSON.stringify(i)})}render(){return be`
    <h1>Analytics</h1>
    <p id="readout">No device connected</p>
    `}}customElements.get("hypergamma-analytics-page")||customElements.define("hypergamma-analytics-page",Ua);class Ja extends We{constructor(...e){super(...e)}render(){return be`
    <h1>Reports</h1>
    <p>Coming soon...</p>
    `}}customElements.get("hypergamma-reports-page")||customElements.define("hypergamma-reports-page",Ja);const fu=fi`
    :host {
        position: relative;
        display: grid;
        grid-template-rows: fit-content(100%) 1fr fit-content(100%);
        overflow-y: scroll;
        height: 100%;
    }

    section { 
      padding: 25px;
    }
`;var It;class $a extends lt{constructor({toRender:i}={}){super();Z(this,"history",[]);Z(this,"onTransition",()=>{});qe(this,It,[]);this.toRender=i}static get styles(){return fu}static get properties(){return{toRender:{type:Object,reflect:!1}}}attributeChangedCallback(...i){const r=["toRender"];super.attributeChangedCallback(...i),r.includes(i[0])&&this.requestUpdate()}set(i){let r=i.page??i;typeof r=="function"&&(r=new r),r.onTransition=this.onTransition,this.content?this.toRender=i.page?i:{page:r}:Se(this,It).push(r)}updated(){this.content=(this.shadowRoot??this).querySelector("#content"),Se(this,It).length&&(Se(this,It).forEach(i=>this.set(i)),it(this,It,[]))}render(){let{page:i=""}=this.toRender??{};return be`
      <main id="content">
        <section>
          ${i}
        </section>
      </main>
    `}}It=new WeakMap;customElements.get("hypergamma-main")||customElements.define("hypergamma-main",$a);const uu=fi`
 
a {
  text-decoration: none;
  display: flex;
  align-items: center;
  user-select: none;
}

img {
  width: 50px;
  padding-right: 15px;
  box-sizing: border-box;
}

li {
  margin-bottom: 10px;
}

#sidebarCollapse {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  background: transparent;
  position: absolute;
  top: 8px;
  left: 200px;
  cursor: pointer;
  border: none;
  z-index: 2;
  transition: all 0.25s linear;
}

#sidebarCollapse span {
  width: 80%;
  height: 2px;
  margin: 0 auto;
  display: block;
  background: var(--color-light-green);
  transition: all 0.25s linear;
  /* transition: all 0.1s cubic-bezier(0.81, -0.33, 0.345, 1.375); */
}
/* animate toggle button */
#sidebarCollapse span:first-of-type {
  transition: all 0.25s linear;
  transform: rotate(45deg) translate(2px, 2px);
}
#sidebarCollapse span:nth-of-type(2) {
  transition: all 0.25s linear;
  opacity: 0;
}
#sidebarCollapse span:last-of-type {
  transition: all 0.25s linear;
  transform: rotate(-45deg) translate(1px, -1px);
}

#sidebarCollapse.active span {
  transition: all 0.25s linear;
  transform: none;
  opacity: 1;
  margin: 5px auto;
}

#main-nav {
  background: var(--color-sidebar);
  color: white;
  font-family: "Source Sans Pro", sans-serif;
  transition: all 0.25s linear;
  transform-origin: 0 50%; /* Set the transformed position of sidebar to center left side. */
}

#main-nav.active {
  width: 0px;
  overflow: hidden;
  /* transform: rotateY(150deg);  */
}

.navbar-btn {
  transition: margin-left 600ms ease;
}

.navbar-btn.active {
  margin-left: -190px;
  transition: all 0.25s linear;
}

.navbar-btn:focus {
  outline: none;
}

.navbar-btn.active:focus {
  outline: none;
}

.dash-content.active {
  margin-left: -230px;
}

a[data-toggle="collapse"] {
  position: relative;
}

.dropdown-toggle::after {
  display: block;
  position: absolute;
  top: 50%;
  right: 20px;
  transform: translateY(-50%);
}

#main-nav .sidebar-header {
  padding: 20px;
  padding-bottom: 0px;
}

#main-nav ul.components {
  list-style: none;
  padding-right: 10px;
  padding-left: 3px;
  margin-right: 0;
  margin-top: 10px;
}

#main-nav ul p {
  color: white;
  padding: 10px;
}

#main-nav ul li a {
  font-size: 14px;
  line-height: 45px;
  padding-left: 20px;
  margin-bottom: 5px;
  text-align: left;
  padding-right: 10px;
  color: white;
  border: none;
  border-radius: 4px;
  border-left: 4px solid transparent;
}

#main-nav ul li a svg {
  fill: #000;
}

#main-nav ul li a a {
  padding-left: 10px;
  text-align: left;
  padding-right: 10px;
}

#main-nav ul li a i {
  margin-right: 25px;
  font-size: 20px;
}

#main-nav ul li a:hover {
  text-decoration: none;
  background: none;
  font-weight: 600;
}

#main-nav ul li a.is-selected {
  color: var(--color-accent);
  background: none;
  font-weight: 600;
  border-left: 4px solid var(--color-accent);
  /* margin-left: -3px; */
  border-radius: 0;
}

#main-nav ul li a.is-selected svg {
  fill: var(--color-accent);
}

.help-section {
  bottom: 2px;
  position: absolute;
  width: 230px;
}

.help-section ul {
  padding-left: 15px !important;
}

.help-section a {
  text-decoration: none;
  line-height: 5px;
  border: none;
  color: #f0f0f0;
  width: 35px !important;
  padding-right: 3px !important;
  padding-left: 3px !important;
  z-index: 200;
}

.help-section a i {
  font-size: 17px;
  opacity: 0.7;
}

.help-section a:hover {
  background: none !important;
  border: none !important;
}

.help-section a:hover i {
  opacity: 1;
}

.help-section a.is-selected {
  color: #000 !important;
  background: none !important;
  border: none !important;
}

.list-unstyled {
  list-style: none;
  border-bottom: none;
}

.list-unstyled.components li a {
  -webkit-user-drag: none;
}

.collapse:not(.show) {
  display: none;
}

.collapse.show {
  display: block;
}

.collapsing {
  position: relative;
  height: 0;
  overflow: hidden;
  -webkit-transition: height 0.35s ease;
  -o-transition: height 0.35s ease;
  transition: height 0.35s ease;
}
@media (prefers-reduced-motion: reduce) {
  .collapsing {
    -webkit-transition: none;
    -o-transition: none;
    transition: none;
  }
}

.nav {
  padding: 0px 0px;
  /* position: fixed; */
  width: 240px;
  min-height: 100vh;
  color: var(--color-subtle);
  visibility: visible;
  left: 0;
  z-index: 1;
  align-items: stretch;
  /* display: flex; */
  transition: 0.5s;
}

@media screen and (max-height: 500px) {
  #main-nav {
    padding-top: 15px;
  }
  #main-nav a {
    font-size: 13px;
  }
}

.nav.is-shown {
  visibility: visible;
  opacity: 1;
}

.nav-header {
  position: relative;
  padding: 10px 10px;
  margin-top: 10px;
  margin-bottom: 30px;
}

.nav-title strong {
  color: var(--color-light-green);
  opacity: 0.8;
  transition: color 0.1s ease-in;
}

.nav-title strong:hover {
  color: linear-gradient(90deg, rgba(37, 129, 147, 1) 0%, rgba(52, 207, 196, 1) 51%);
}

.nav-header-icon {
  position: absolute;
  width: 165px;
  height: 70px;
  top: 1.3rem;
  right: 1.8rem;
}

.nav-item {
  padding: 0.5em 0;
  vertical-align: middle;
  width: 240px !important;
}

.nav-icon {
  width: 30px;
  height: 30px;
  margin-right: 27px;
  padding-bottom: 1px;
  padding-top: 1px;
  margin-left: -22px;
  margin-top: 10px;
  margin-bottom: 10px;
  vertical-align: middle;
}

.nav-icon.logo {
  width: 45px;
  height: 45px;
  margin-right: 24px;
  margin-left: 15px;
  margin-bottom: 75px;
  vertical-align: middle;
}

.nav-video {
  width: 18px;
  height: 21px;
  vertical-align: sub;
  text-decoration: none;
}

.nav-category {
  margin: 0.2em 0;
  padding-left: 2rem;
  font-size: 11px;
  font-weight: normal;
  text-transform: uppercase;
}

.nav-button {
  display: block;
  width: 100%;
  padding: 0.5rem;
  padding-left: calc(5rem + 5px + 0.5rem); /* padding + icon + magic */
  padding-top: 0.8rem;
  padding-bottom: 0.8rem;
  line-height: 2;
  text-align: left;
  font-size: 16px;
  color: white;
  border: none;
  background-color: transparent;
  outline: none;
  opacity: 0.8;
  cursor: pointer;
  font-family: "Open Sans", sans-serif;
  background-size: 30px 30px;
  background-repeat: no-repeat;
  background-position: 22px center;
}

.nav-button:hover,
.nav-button:focus:not(.is-selected) {
  background-color: hsla(0, 0%, 0%, 0.1);
  color: white;
  opacity: 1;
}

.nav-button.is-selected {
  background-color: var(--color-accent);
}

.nav-button.is-selected,
.nav-button.is-selected em {
  color: white;
  font-weight: 500;
  opacity: 1;
}

.nav-button.is-selected:focus {
  opacity: 1;
}

.nav-button em {
  font-style: normal;
  font-weight: 600;
  color: var(--color-strong);
  pointer-events: none; /* makes it invisible to clicks */
}

.nav-footer {
  margin-top: 1rem;
  padding: 2rem;
  border-top: 1px solid var(--color-border);
  text-align: center;
}

.nav-footer-icon {
  width: calc(770px / 6.5);
  height: calc(88px / 6.5);
}

.nav-footer a {
  outline: none;
}

.nav-footer-button {
  display: block;
  width: 100%;
  padding: 0;
  margin-bottom: 0.75rem;
  line-height: 2;
  text-align: left;
  font: inherit;
  font-size: 15px;
  color: inherit;
  border: none;
  background-color: transparent;
  cursor: default;
  outline: none;
  text-align: center;
}

.nav-footer-button:focus {
  color: var(--color-strong);
}

.nav-footer-logo {
  color: hsl(0, 0%, 66%);
}

.nav-footer-logo:focus {
  color: hsl(0, 0%, 33%);
}

/* Remove border on the logo */
.nav-footer-logo.nav-footer-logo {
  border-bottom: none;
}

.logo-container {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  min-height: 50px;
}
.nav-center-logo-image {
  display: block;
  width: 100%;
  padding: 0px 25px;
}
`;var si,Ti,nt;class za extends lt{constructor(i={}){super();Z(this,"initialize",!0);Z(this,"show",()=>{it(this,si,!1),this.nav&&(this.nav.classList.remove("active"),this.toggle.classList.remove("active"),this.style.display="block")});qe(this,si,!1);Z(this,"hide",i=>{it(this,si,!0),this.nav&&(this.nav.classList.add("active"),this.toggle.classList.add("active"),i&&(this.style.display="none"))});Z(this,"onClick",()=>{});Z(this,"selectItem",i=>{it(this,nt,i.split("/")[0]||"/"),(this.shadowRoot??this).querySelectorAll("a").forEach(n=>n.classList.remove("is-selected"));const s=(this.shadowRoot??this).querySelector(`a[data-id="${Se(this,nt)}"]`);s&&s.classList.add("is-selected")});qe(this,Ti,i=>{if(!this.pages[i])throw new Error(`No page found for key ${i}`);this.selectItem(i),this.onClick(i,this.pages[i])});qe(this,nt,"");Z(this,"select",i=>{var s;const r=(s=this.pages)==null?void 0:s[i];r&&Se(this,Ti).call(this,i,r)});this.pages=i.pages,this.name=i.name??"",this.logo=i.logo,this.subtitle=i.subtitle,this.renderName=i.renderName??!0}static get styles(){return uu}static get properties(){return{pages:{type:Object,reflect:!1},name:{type:String,reflect:!0},logo:{type:String,reflect:!0},subtitle:{type:String,reflect:!0},renderName:{type:Boolean,reflect:!0}}}attributeChangedCallback(...i){const r=["pages","name","subtitle","renderName"];super.attributeChangedCallback(...i),r.includes(i[0])&&this.requestUpdate()}updated(){this.nav=(this.shadowRoot??this).querySelector("#main-nav"),this.subtitleElement=(this.shadowRoot??this).querySelector("#subtitle");const i=this.toggle=(this.shadowRoot??this).querySelector("#sidebarCollapse");i.onclick=()=>{this.nav.classList.toggle("active"),i.classList.toggle("active")};let r=Se(this,nt)?(this.shadowRoot??this).querySelector(`ul[data-id='${Se(this,nt)}']`):(this.shadowRoot??this).querySelector("ul").children[0];this.initialize&&r?r.click():Se(this,nt)&&this.selectItem(Se(this,nt)),Se(this,si)&&this.hide(!0)}render(){const i=this.name&&this.renderName,r=this.logo&&!i;return be`
    <button type="button" id="sidebarCollapse" class="navbar-btn">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <nav id="main-nav" class="nav js-nav">
        <div id="nav-items" class="nav-item u-category-windows">
          <!-- Sidebar Header -->
          <div class="sidebar-header">

              ${r?be`
                <div class="logo-container">
                  <img
                    class="nav-center-logo-image"
                    src="${this.logo}"
                  />
                </div>
              `:""}
                ${i?be`<h1 style="margin: 0;">${this.name}</h1>`:""}
                ${this.subtitle?be`<span id="subtitle" style="font-size: 14px; ${r?"padding-top: 15px; text-align: center; width: 100%; display: block;":""}">${this.subtitle}</span>`:""}
            </div>
            <!-- Sidebar Links -->
            <ul class="list-unstyled components">
              ${Object.entries(this.pages).map(([s,n])=>{const a=n.info??{};let l=a.label??s;const c=a.icon??"";return be`<li @click="${()=>Se(this,Ti).call(this,s)}">
                  <a data-id="${s}" href="#">
                    ${c}
                    ${l}
                  </a>
                </li>`})}
            </ul>
            <div>
            ${!r&&this.logo?be`
            <img
              class="nav-center-logo-image"
              style="padding:0px 40px;"
              src="${this.logo}"
            />
          `:""}
            </div>
          </div>
        </div>
      </nav>
    `}}si=new WeakMap,Ti=new WeakMap,nt=new WeakMap;customElements.get("hypergamma-sidebar")||customElements.define("hypergamma-sidebar",za);const du=fi`
    :host {
        display: flex;
        height: 100%;
        width: 100%;
        position: relative;
    }

    hypergamma-main {
        background: #fff;
    }
`;var ni,gr,oi,lr,yr,ji;class qa extends lt{constructor(i={}){super();qe(this,oi);Z(this,"main");Z(this,"sidebar");Z(this,"pagesById",{});qe(this,ni,void 0);qe(this,gr,void 0);qe(this,yr,i=>{const r=this.getPage(this.pagesById[i]);if(it(this,gr,i),r){const{id:s,label:n}=r.info;history.pushState({page:s,label:n},n,`?page=${s}`)}});Z(this,"addPage",(i,r)=>{let[s,n]=r;const a={...n.info};a.id?s=a.id:n.info.id=s;const l=a.pages;if(delete a.pages,n instanceof HTMLElement&&(i[s]=n),l){const c=Object.values(l);Object.entries(l).forEach(([f,u],h)=>{u.info.base=s,u.info.previous=c[h-1],u.info.next=c[h+1],u.info.id=`${s}/${f}`,u.info.parent=n}),Object.entries(l).forEach(f=>this.addPage(i,f))}return i});qe(this,ji,!0);this.main=new $a,this.main.classList.add("dash-app"),this.sidebar=new za,this.sidebar.onClick=(s,n)=>this.setAttribute("activePage",n.info.id),this.pages=i.pages??{},this.name=i.name,this.logo=i.logo,this.renderNameInSidebar=i.renderNameInSidebar??!0,i.activePage&&this.setAttribute("activePage",i.activePage);const r=window.history.pushState;window.history.pushState=function(s){return typeof window.onpushstate=="function"&&window.onpushstate({state:s}),r.apply(window.history,arguments)},window.onpushstate=window.onpopstate=s=>{s.state&&(document.title=`${s.state.label} - ${this.name}`,this.setMain(this.pagesById[s.state.page],void 0,!1))},Ui(this,oi,lr).call(this)}static get styles(){return du}static get properties(){return{renderNameInSidebar:{type:Boolean,reflect:!0},name:{type:String,reflect:!0},logo:{type:String,reflect:!0},subtitle:{type:String,reflect:!0},activePage:{type:String,reflect:!0}}}attributeChangedCallback(i,r,s){if(super.attributeChangedCallback(...arguments),this.sidebar&&(i==="name"||i==="logo"||i==="subtitle"))this.sidebar[i]=s;else if(i==="renderNameInSidebar")this.sidebar.renderName=s==="true"||s===!0;else if(i==="pages")Ui(this,oi,lr).call(this,s);else if(i.toLowerCase()==="activepage"){this.sidebar.selectItem(s),this.sidebar.initialize=!1,Se(this,yr).call(this,s);return}}getPage(i){if(!i)throw new Error("Page not found...");const r=i.page??i;if(r instanceof HTMLElement)return r;if(typeof r=="object")return this.getPage(Object.values(r)[0])}setMain(i,r={}){i.info;const s=Se(this,ni);if(s===i)return;s&&(s.info.parent&&s.info.section&&s.save(),s.active=!1),it(this,ni,i);const n={...r};s&&(n.globalState=s.info.globalState),i.set(n),this.main.set({page:i})}updated(){const i=(this.shadowRoot??this).querySelector("div");i.style.height="100vh",Se(this,ji)&&(it(this,ji,!1),Ui(this,oi,lr).call(this))}render(){return this.style.width="100%",this.style.height="100%",this.style.display="grid",this.style.gridTemplateColumns="fit-content(0px) 1fr",this.style.position="relative",this.name&&(this.sidebar.name=this.name),this.logo&&(this.sidebar.logo=this.logo),"renderNameInSidebar"in this&&(this.sidebar.renderName=this.renderNameInSidebar),be`
        <div>
          ${this.sidebar}
        </div>
        ${this.main}
    `}}ni=new WeakMap,gr=new WeakMap,oi=new WeakSet,lr=function(i=this.pages){const r=new URL(window.location.href);let s=r.pathname.slice(1);s=new URLSearchParams(r.search).get("page"),s||(s=this.activePage),this.main.onTransition=n=>{if(typeof n=="number"){const a=Se(this,ni).info,l=Math.sign(n);if(l===1)return this.setAttribute("activePage",a.next.info.id);if(l===-1)return this.setAttribute("activePage",(a.previous??a.parent).info.id)}n in this.pages?this.sidebar.select(n):this.setAttribute("activePage",n)},this.pagesById={},Object.entries(i).forEach(n=>this.addPage(this.pagesById,n)),this.sidebar.pages=i,s&&this.setAttribute("activePage",s)},yr=new WeakMap,ji=new WeakMap;customElements.get("hypergamma-dashboard")||customElements.define("hypergamma-dashboard",qa);class Va extends We{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",i=>{e.innerHTML=JSON.stringify(i)})}render(){return be`
      <h1>Training</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-training-page")||customElements.define("hypergamma-training-page",Va);class Ha extends We{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",i=>{e.innerHTML=JSON.stringify(i)})}render(){return be`
      <h1>Focus</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-focus-page")||customElements.define("hypergamma-focus-page",Ha);class Ga extends We{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",i=>{e.innerHTML=JSON.stringify(i)})}render(){return be`
      <h1>Peformance</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-performance-page")||customElements.define("hypergamma-performance-page",Ga);class Wa extends We{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",i=>{e.innerHTML=JSON.stringify(i)})}render(){return be`
      <h1>Meditation</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-meditation-page")||customElements.define("hypergamma-meditation-page",Wa);const pu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABACAYAAABFqxrgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAA97SURBVHgB7Vt5dFTVGf/dmTdbJjPJhEAWAgmQAEZQqAhIkKVYFHuqtDWoUTxAq7ZS14rbQY1KUdyquKBWioogGouCuBYrKogIkSoIioEEIkTIAllIZntz+7sheGLCm8yEJP0n3zn3vHnLvfe7v2+9ywDd1E3d1E3d1E0tSaALyHOVjLPZMMwsMEaEMBQS/SXQmyVeCNh4DfKzaiFxkAztkQI7pBlf2IBNxY+Lg+hk6jQQ+t4mPeIoJkLHZexlAh8lIHo6KiW+JCivWOuxZvcSUYpOoA4HIXWm7GO34nIyPotSzmx67OVgvuP1Uz77khLfJa0oNUkc4TNfsBYOmwZPQCAxZEF/vh9JjRlF7oawxDW1cSgE/IsMP1O8SHyNDqQOA2HwbNkjFMIlVPWbeNufVz+B2CZDeFmYsfr7RShmdzKaNjNmyGSLA1NYK4+3OSwOlnICuiwYxGPFi8VedACdPAi50jyoB0ZTqnfx7hwWf0hig0ngUZGCtTvyhR8nSbnsY1sihtFz3EiOp5LpGF6/4XXBjhSsQL4I4iTopEDIvFa6bT5Mo6TmUjp9Keav2OCDPgdWFj0hfOhgys6VVlMcxksT7mKfY6ltlez3RbMfC75eKg6hndRuEIbPlD1DAn+ijd/KVoJk6LWQH/eTmWJ0Ik2YILXDA3Ap+1xI5uMJvJePV9GX3LFtkdiDdpAJ7aDhs2Qq1f0mLYS5ZuAwpXK/w43rOxsARevWiaBdx+dmHSvN9JTkwa5J/N7mxWOnXylPRTsoak1QGmCRmE3J304I91IbFlgE3qCjGs77s4jqEEonk2qaSsfo4ndWPqulxlTxeSX9RQl/F9JhbpQ2bC98TlQjapJi5AxcxPaf5gDsbLeBbXoojNU6MGfLkug0IioQRl0m3SYTZrHWPN4qm9/Mzn1kYpxSTURPh1k+ZmL0kl/Df6IBZPTl8heMOvnsP5uAfsb++/H3CPL2KrV0zqdLRHmkbUUMgvLQB+y4UCivD6Q3f0eJ1FPiRXz3GVV0E++/Y5wvZ5ZYVVqDOgZ6s8kMDwFMExYM5rdjWC2H4A3k1UqtkXR2eynJF/n7nxuWin1t8XNGroyz2/Fn9nkP23uB2eib1LIH+Ko37582Z+LedRFGjYhB+GWeHKmbMI8VftU0cFoCQmQ6wFb+8fFScT2ioPx8aVq/G2m6jqkEYzpB+AWZV/woMJ/y+bB0Y4GoCtfG2ZfKqQT3KVbaGgpgjsnCNoBH2E4FTXPeuqViRQSsROYYJ10he/Ayhb5gEu3fm5yE78eMxcf9+qGIz8otQRQhSsrPF6G1lPhHy8XC2hqMZ54x2QKstlLL6OgeibHijXPz5MRwbXBuUcE6e/h9L4sJ6WYT3jOFsIjOejAd58Xn5Mq+kfASEQhmH84ic1e4YlE+Igd7Ro1DX6cLpwSOwsROD1lC0YPQnArXiPqPlokPg35cTqlewUF9zTKOGrJ4cp68bsYMaceJma+g+RWbJRI0M9I+fElUWnW8w4jxb9bPMVkxPZL+2wRhymUyTRP4JRFPS+4JW3IyMoi0TT8KW6AODgJQyUZK0AG0rkDUfbBMvKoFMFUL4mFNp4RDuLfCiwX0Sa0mYETmMAdcSiBcrJOknnkPYivrrVCh06Jj/Pm5cmhb/bYJApkZyk5+44lHVXoWftSYshJ5SB+segN/s1/aYy06kNYUiH0MOfPY9i3sy0snO9MncG9LIOqD8FLitfzGKZpmqSqPoGcp5MDe4fPTaL6/aau/sCDk5UkPbX4EtSA9Pg7OOBf6KwBUETo0EYCdtuyzuVGHDqa1BaI6WIPFpiBmc6AH2Od05gD3NAci6ISP7+spdYtV4ieTiQlhpzlA/6DDrWakU34n08L1FRYErxeZVK0ctwtVKWkooxZYfwIhCAuLjSrnO1LS8SAoevdd4TtSiVXkYS4HWkX/c6nUcYNKndX7CRnwk5d6gqRRKLbj9QoKhG6z4FsK8HOa0wCXaAzJhhQWBEo5g0ie6Y6BJTERdpWmNishFp0MmDIyoKGTqFG9zXibg51HIJhX4aIkDy5W7775BoL9C/IhOdhQ83qc1u9mnfVmNQYdI8P1YQhC7jkyjmYwgDlvTGwsNF77HNcCVawW+LkQ0kCgbL4KxKITiZJtsIe4oCLxEPvrz4H/cfoFcgRfWflb+agAQfD+vA4q6NB38nuqCfpdeoFMMmrfEARXDJJtOgY7rajtkYBys0K8GQg2EwJ2jY5Jhz2o5gidTC+8KY5wkrCGKr6SZSQZn6H54OYgndQEPx1j/c9rCEm/sJ/a8w1LCnOIU4zaNgSBKaiHL/s4bNDdcQg0B0AVi4YgtcFH9bS7JNzoAlqyCjsZKVZw4IfIW45DYhoHmESNraFGtFpPoLOs5PNifu+hQPsYtWsIAtUrjgin2G2wxMbA0RIEpw0BtxNegpBIh9APXUJCajasp40vYUZ4KpmfSV6y6TBrmLWWtfyaIbSa35Vpx4QUvTlQ3WNZuSevFvoDe0sQuJhqdruhMY9I0o5NhLqEFnM+QQGtp0lspykOo6AmURsqhYZWk64EpSHAQQWCSryM2jQ2B53rACE42AjT8tYg8KHLaUcvakIvcxBZ+U1hqysopPIAydSYqqEKgfgx4MPOlt/VNjCEUiGoDZotBLtRe4YgEDmNjTPc0gOHWpsDO7c7nZAxdubv3GaoFhiELqLn3hdlpgCn7Tp+oKCqKemixe+3nnFmTICfyVQD+bXQLziM2jP2CSya/Fle0Kowi6xPSuXyWohrBGaEnfF1NJnNqOLg9lk5gSKfmxDBOIzIEAQiHKQG+OiE/ESxoaUmqOKwIj4hASmcYabQPHJuPFe2Z5cpapoxQdrp+YdQG0dwcLu5frDxRN+VvMAMlyGc4wgwV2gwas8QBNq5n0AoewqwI++JQFDhMT4egfgElLKjbIahLtGGVDMGkq9fsRwiAJ89/MGJl9vTkxr9mpNJVkC0SKaakyEIlG4dVamCk6QAE9cTg8ASFw9LahoctL1T6Ed+d/ukxgWYTiM6YLsMcq1AxxSq+TZLAG8ZfuxgVJBIosnUMqIY7ksYgkD0qmkGZboPAa4bGIJANYvr1RvmnqkooXqOtR/bMus00s0YzrA9jVPkSva/dt4n4nujb2nKbvKUzHHU8Lfh7rYxCHQ8RLFU1sPsPcxIYQCCKpxlxqb0hUczIZlqd2H+GDkMnUD5OTKVeclvaZ5jObD1fhOWhfuezrMX+cukSRzm3MNw8dYQhIQ6LqAEsTN4FK76cvRkY9IQCIGY1HQE0weghGqXQ0ndeMck4wlLeyg/Q9rZ7vls/yr2uZ1ALJ//YbizC1KQ/xSazSkUZlmdFd8afWkIwnWbRI1Jed4gjnqrEaRfKA2nDUwoktOy4OnRk5MWgQs8ftz8aK50oANILfdb+2IymZ1DP1VPIFb4P8GacHXmn41EOu5slcHxWhwOsLDrCQyte+n1NweOIFB7gH4hFD5viItDfEY23Jx0BSmBvNAPuD4/W1pxEkQFFKN/xARGnrvISxr7WaXb8Uw+RChcPWaIA2gyOfy+hL83hfs2LAhxtSiilDf4a5BwpJTTUdm4koMwxdIrFc7BI+B12BmfuV/picPclyZLJ9pBSgOeGMNQGMQCqvQQhsQ3qQn33bY2/E7VVWdICx27ilYjmU8UcQrwGdoLwjXbxGGGl0LOy0vqD+Gorwp72gBBRYuYpHQkDB6FBk6ylEO9rroGD8wfLnsiClI+YGwpfk+TfEIBwBC8mhHh7ms3iANt1R1uwyDyfR5NoY4a+cVNG8V+tBcERZytbePe3pqGSiSU7USyWtNrEwiudSb1gefUMajh/KKBanxlggUvP3+mHIcI6AlGgcQk3E7bf5YqncaynPnvDbM3ijb3N56lFnD1W2WS5xG8r7jD9VZbdSLahnv+DPlrbrs9HhOP2AGjUOnpjUzRmE+1SXrdEZTt+QL1h/c3TrfLuFizhFtnC6/c1NpRLaH0/UkYR+Zv5Xcq+zxITJ/jhuujVxdGtln7/Ag5knXmcWSn0aEsvHKLmN9WnYhAeHKw7GF3YjY/vlvT4ItPQ+mAMxF0uJCFY3OUsKT7ceiHnTi072v0Y7anttK/pVd7hqr66qytonxhprTFenAG9zWvZR8XNgH8JQcxf28hVrflBI8TtSDRKjCb7czl7VvU8+tnbW77xFvEG7IvD5NnMltTG7KT1T2l6XX1RGnfoaiKT2rcbe4dtgE6VW8dfij+Et6KEmRRuip6KVvdwndxBCaHG7Fqh/oAzW+xWcNTeZsiP8OoolAfGy6hT3qY7RwUJtw3fbN4LZK6ES+EFP0XhQOHYVHjdrpABuOnve4AsnbQTZHhemcP7PL0QXl8CkyxLrj4zMUVD7eabHLAQV5r7RZ40zJRLRtQTPNQWpTWVIgD9vO75QTh+elfiV2IglQYXebABNb9K/2H4N7Eyt5fYWWk9aM6pLF4kHTF2DCTlf5GVQvQT2xRszPen83fUR/S4MBryPRGMr+cq0Xv521v3+nVV7Ll2dyWn0+bUcvwK7iyfMu0rZ1wSOM4rR4oE/02XMOfd7D2Pqrdg8KLN3QrhnFUZ1EVhxCY/gQlVU0yG1fnj51mqeZg1SCLyOR2xu5NlPyWaTvCn0EIR0oDCoZiHNP2eWx/NB+t4sNbLtrWicd1jtMrg2Qql9v/wso3sYUKPnpSs2LhBYWiHl1Er9EHMB0+jxO9+8hHNss70HH71B1iB6Kkdh/hUxoRMuNqkwm3QW1TCBQEBOZHK4X29s3Bz2Sfc3Bs4+cNzijntrfvkzrM+VG2jOWa1TT+vJMlnanqNjL2YJYfr2cVdfxhTpUIZdTjLF3gDpqWOj2rDn4t4cLPQ+cXRe4DWtJJH+vNhzSNGIzRDDN3NoVPv1ryYst/rzbhA9r8SR/rVYNPq8PpXK+4loOfSrC56dUI+AP2b1EwEf/HY73N6b00maA5kEvGbm463e5X548ZSpfRUb45qQh7oj3gvWGA7MUtrnOZPV7GNseyPSfLQbb5skXH4+N3d8zR/w4/6v/hQNnbrJiW+IM0/bQzpcLoLoawTxkptnJQ39Grldp8OGK3o2G/xq1NL+KtOpKDZmRxQnM6Ja5OtQ8nh4073lKl0CG8znafmbhbbEcHUqf96WNNX+lxWzCeEszjACayo0RESdSqOo5+Cwf+CpfK3h6zK/xssL3UJX//eSdBuhPicZp+7D8LQ6QyF8k0mwkWB6hOmASZfKk/gBw0qb//SOzg/RecPm8eXdz5f//ppm7qpm7qpm5qTf8D6FAlNg3TNMgAAAAASUVORK5CYII=",gu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABBCAYAAABhNaJ7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMFSURBVHgB7Zu/axRBFMe/M3e5xiDoH6BBrBRMoShYyB2KlXYWohYe6l8QsDRa6B+goKCiBAuLWAgKWggndqIR0UqDhqDYWmihl9w8Z2Iid9lhZ2/f7sTLvQ8ce8w+vvOYfT92bvcAQRAEYXhRKIDxM7SXFJpWbbsiVLvP2fFFbTALjbtvb6lXa6GXBnsBnLMV4KYBtlmxUY+m9Rk/7HHOaJwLOV20XogqmFQNJpTCuHXzDhncpwoWu8+rDqpa4YT92rRXbsIej8fUC/oPJhXCQXekDq68mcJn6yL1WpDadxrzSyFtcCi2XggNJpqwyV4JzHiddSh6OYZPzsbZxtYLzgcm9orpCv11bGXs+kNquc8/o4vKOBtnG1svRBEpkIRQz2QXQS8EewG0L0gz2sXQC1FKBPic40QARy+ELACY+JzTGe1i6IXgR4BJjvmal88uhl4ISQEwkRSQLpAcUwUvgJIUyGaXB0kBMNGeduS9ihnbVtF6IcqpARntYuiFiJ4CZ492bWs90BDsBerok4G7EfKFrE3ZBnKyLrbDtx+r58jJukgBDgO7F3hyL73gFT1vHsreDtdREv/3dnj52OnkL3w9c1TQyjJvHspJgeWxw838ha+bZ1OUad48SBEEk6y3rpON/gripZZqpOkNRAp0oxgFUZcYZdEWYGUsdEdoC2gr7xx5KKUN6hS7Cy/SC+PlA56Cl6LHRX4QAZN+UyC2XohSb4RCdjH0QsivwmCiMzrMejwuKZDNLg/ltMGCH45y9EJIFwATSQG5EUqODX0XGKonQ1IEfe3IJLe8nDbI0QvBfl3+wS5q2xwd2VpDbc+MWvDZvN5NI/NttElh4dg7VYupF4L/rrDBrAvHL22cdI6tPu/GvrZxytlY2w+x9ULwU0Dhqg3RGyBMfvuN5qOd1BOcdkxbZ7fAPfglXIutF4K9AL86mN6gsdE63bRO709o0tIfHj6Sxnkbb9Ox9UIU8p+hpztos3VsrAOMmlWvsGsFY8d/6irmjrxX39dCTxAEQRD8/AGgBO2QRI1L4wAAAABJRU5ErkJggg==",yu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAACO98lFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAzzSURBVHgB7Vp9cFTVFf/d995uNpEsBA2phRKKpvL9IbE2fqDFMRoVFNtYWwUxUmntSImMVafjNHWGcdqphYkDdZgBdMSPIUBqO0UGFSlFGAuRhgKCRIGQKljlI4Hsbnbfu/3dzW7Ix+7b93YX+k/OzNv79r17zz33d88959xzH9BP/dRP/dRP/dSbBLJEQx+XE8ntFmnhCpZ5yepJgaBl4ajQ8d6oAuzeUiMixQvk6KCJWylMiQYMSNqJRFhINId1bP5WEDsbloswskBZAWHYfDkTFqokMJF/h5CpNylvgbAlcUrTcECaWCkEzvJ60AIm8W0RB+lL1pYARlic5vUJ26yCjtdaFosAMqSMQRg6T07UdbwoNVzNmdrEazs0fG0J3iXqMIJ8DqCU10z+/ZwChAjASN6/47LtCSnxiyERvJ+pRhjIkHJ03K80wDKxkQN4waNjX1Mt2iBEwoGMmCN9ET82GibrSFQRhFyW69JqK/HQf3Xs5KtTyIA0ZEiaxFRDIo9orhaF2N30omhNNghFR14WwZZacUg3sYJXq25FZyKttpqFm3wyuf1xPAZkSBxEEQXSjRA+PvIbhBw39GA/wQsaCoQ023poQ2gkM9bmjEHwWgRAQmi5CNrNYm/irIc8ElJni7TbWjB8yJwyRlGpsyIP3NP/q21vcgTCd6ukcn23mGAMAORp3XwK3d0gVYogpk+YJVfteVWcg0OiPYm6JysIx1RZKfUjftzBfnNj/S655hF5ups8YRrNZs3AZnoZR7FEShDKZsuZZqcVn6gzBuAjLxW3C4au9WRhfp4HkbJq+coOh77bE1sAugtHfTQXM2gQn2CTQdFmEvd0f88JipDtaS2MCvJdVVYpX9tRZy+PLQg3PCgnWhqqNRNX0zdv4oi3Uwu/Jgi9128xwVhIIOaZbajnf0cgcDCdaLqwTB6BOYxKSxkoLWWwtZ8BlNmjgkQ+NayU5UzK/BTDtuYpU+T7DQ3JNcIWBKJ6v7CoARIb2dML5gDs+zCBH7/hJ7KA6jeXD8egHY5tlRFbDhE4Jw5wFAeYw+lePSyAPXV1ogcIKpYoCmOjx4M2yl4lNDykXcVYoiF5LKGlEHIqXVgeQVjt1bD7wyR+fNvr4hTrRDwWvG6stQJBuUifi8CXbbxcRiI3gpO9AVCkYokPXxeHtBBWsF4rZ/kmr2EfS9iCoKkYwIou2Y+3rErsx5WhKv+xnM4oLldZbDKcXj5LXgInAzLPW3mn5LTN52ewnxMTZAxTRFWz13i7l0RSj6JuJffjbV7MoMH8FTscpGbWKzHfCGMWDVIuUlBUE3i50R5a/2oWD1vtOGNXr+ltEaKWSfJPGUvYI6TWrBqYnrwOkZ5DTSmlO1rKuud4LeDjeYVGagPZm7/SqoDAdBqKGxVr8v7oKz/qP1iJs501gffeEH+GQ3IivyJbEKIuTF02fpzq+U0K7aER2soN0AnO1Fw+HsodnhcpKM4/EkQxAWihpt/JmXuSj8Yr1jTMLUPOIL+yEivr6uB6y+xE/ugY7F5GXZgE7OJZor2L11i6o2o6q7PUigFsto0BUAdSUJy/oeM5JlqaaclHcVlN4P1S8lNB1wI+qwqFsBZwD4IT+RXZa0LM9tqFXARgOWevgMthmmrCTnfyWa2Rg1akoDh/tp2sdqO09dGwgcHZVlrjExR+LuOAYflGetGxE/kV2YKgO4joxo9H477dWCQMvElN8HI5tLQG0LhpE1IGw3H+XDpPsYt29jOD93dxCVcTzLNSpdoktcpEWkkTJ/IrsgXBiLmiiI1hqakRqta/Y5crivNn9Pf26+vF0TmVcrfZwTyiQDnB0KkXOxkd1oYcaJUd/0gmhjGOZDZ2ak74v1yHvbNmYhG1aa2KT5iHbKHRbKz7C1xssZLzT0b2mhBjktLMp0Fz7pEjVD6AetQqOuK2S8hX67GXN3uRBXIqfyrvoCy8DLVjoJRSCBeJj970szvkErq8gfH/VhiDWQykym+LaC6ySg7pgQrpp/xq1x/KyEVyTR3m+hzp0XDdE9fhENJwU3HisrybEI6I/+d9q1rz3AjV5ufar/lHp0iPrxB3cUBlKsCkx9hlBrB+2RZxNlmbQuB68s6huz1MO2O7R0sVMdZT2O9R2EetfJx6vEJurt2Ar9LRCLZQFn/Q+QcIaBEcyz2Oxj/ssZ+rAZdhhqm26p3xiJdg3K774Ksuk68u3tEzV0AZ/Yw0S2lQ5+sa/NwXrKRG2CZ6bJ3HYzfLb3i9qGGlB8jsMMsmPm6j5e6zhTHDqF6yRZzGBaCF5VKF4LdTA5axPEc5FhCQ47z/iGUPEAgSE9AYzpFNlCpos/D0oDD21mwRSbXBVhOobsfn3ypfYPjZQks9nUasgsxzkAA8Xx5q0Hk6lHViv0M5OA9B2MoEzwn2rkLzktjVk2Q0s/QJtW4FrzpuuQ/YAaAoZXqt9h1xqOZm+VLYhy1EdRU7GUkhFpsC+7lcuvbz51Ls6jIh2qYGgjAuuqTAIMpiaC7wLuVYh9jOgG61mN5gobrl8992dGDnAA3HUgGgyNUx3LPT5AGi/J1IBFM+Leqb1blQ9PRUOdnwMFUmMY1g5FCGXZy95zkF2zjIKAjP3yAL2r3YQ20p5HK9atFmcdQpf1fnDgw+clR+YYCROKtzoci3FY3hMBYZNNCctUc5489y4W2PA6DomW1d2a2clImMXuTq3EGP7c+hwxWtYZ7g4HFMZ7Mbpc7WFj46Y6L+9x+czxPYUY2yCltTh+bpyucKBI/yCWr/73I7c+xz3MlYI5onoLsyyKNlsI78P5Zh5RM7kPHReqbyudYE1UmqRiq4KcllcCNRRqtzGdfpOE7OBBqvpXx9jgZ1AddtFQFJK0+QqXy9yVV9I2YFUm1IxuRwS2xFLfVYdQ6AmAGmfFsJyAlN5QksDOMZZEJWi8vkEhELsVmvjfe78k+i/pGD9svHqXx92rmprMfOCVL5FM70gxR8MrVzGWd8P+8r2ERpRjW65wkCifMEPUJsgSDr3x4YnHr5OJWvN7nThFicmCpxyd3haMqRY2hYfekw7DnRgn/yWZi+vVyoHIfKEwjURkTiPQPrVMtYiM2uivl/IcdXRXBtl49T+fq0c1O5C+lUTOlKWU9wC3fyPrpSntrtfakUi+gZonkCytrSHkLjk0n2DI/vOJ9RXkb/r3dgLoEbYxjRaDVj+frI66pyPB3msp5Q63hXenmCx+j/V1wjI2Tmk9J+jE7l69POVWXJvTmnlVbez0KIJEZKjx20Zvzxgwt+G66V/i8j0aOGoOnS37iKGLn1PUqVM3PCuO7lEclVU/nr6FFZlpyfE36tHbieNiGHdY/wcnPG6w4Eup632NE5gjHvkoG4e81kWag0onudNybJEZwOg2C1MmOUdiaqh5DkRX6SmlCsos/u75QGrJkgp7Gj+Xzv58u3/AKOPxRR5EpjwzrquTVV2Z17ObxfM/z90foJaFsnZVd+gTvNwURloNrLcyXbps3WjuuMB1p1VD/8r+S5CAK/neuhhP09px1E87rxsmvfEgjARx7DqSnqa5odXKprvvRcQBBmNYgv1k+Qv6P6NLOzOynUbRRA7VfOf7nCWSMAO/mkVp5OnjbbcKX0hzo/yhyeH8FiTvSZZDaGm+HluoECGkZ1wDNVdOuPoHcoefhkNWV6s+gs9t9/xN3HnWl90bputLycMcAo3haZKh4AfkrpryWzjSzXcoEcatXQOHsP2pNFePXjZQXD5lVsU8TB/TzUilfua0n8WU0NpDZpFMZqHlzB7fO9lLqSmvgp444/cRLO8NkpAvHJ5Xk4Utrg/uvWtAz4Dz4WX7D4Iv7/r6OlZEwwhoIVM78X4mnUgbv3on12AgCUBug6Sk0Tv+Tg/bEIb54nD6f4bnNFE3OYvdqpXeT7mjwcMFHImb+c9ZUhejMYxOr7PhMZJ3Oy8oH3BhpILYjnCMJsMvyMs3KQo1CZYJmgR+Xvh/PFJPNK5KmQUP8UFo3tPr5t4vM2AST6DEMlU4pVO6nhPdZ5JmcIDn7fQeYoFWUFBEWbRssS2oNKiv9DlX0iEHkJ+dPFSG6N5LeZnB2D6MkIjR00JvTFSf6PnnT05W8hamSP0p/9jVzXMMmy+44mkZXziqyBoOjdUfJSzug4S6PKcua6f+rHCV/MYpBezt8CjvNSlv6YBMpyfMWSNt3ciGjWkDgs4MC7VJ3aE2Gy96QMY59WjP9kQwPilFUQ7OgfJbKR0zk+9wHuKYYm7lnSlwRfY9lGD8O6N34mmnERKFuRbeqOlK+XKJF/R66lNCBBmCbpG/RANHP8gSazfzSXVDZcJGLgtJzqXBA+hmkc/2VIoAtcAirG2EWNqbUi6R3Hp0MXbTkoX18+EmN1QV9vwc/Z7qMLdJ0BLvRjbZeg8TabGKOf+qmf+qmf+unC0/8AohxNfqIfbKgAAAAASUVORK5CYII=",bu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAACO98lFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAjFSURBVHgB7VprbBTXGT13dmbXaxuydpwH4eUgFIOTCrmQPuI0MZUStT9CqNIHf9oG2ihVqQppKUiVqqxQo4iISEDUpiiV5YYqUuNIJa0IJDSOU9pCJGiiUBrIAzteQATjB37tc+bm3F0nwWZ25+56IEbaI429nrnz7Zlvvvc1UEYZZZRRRhlllFFGXgjvJVLUP4gbjDDWC4l7pIFaTHcI2MJBjA/3QvA8nvl/u0gVWm56yWv8EWoyFjbw40MSqIJEANMdMnvU8+fCVF32zO8KLfdUguGgiscD1OqoEPjeGHDc6x7TRpUFrOIb2SQFDo4ZWG1IOF7X/EIohZBh4uv8+BQ5P4CpKsEMISBszOXHWDyG17r3iiQ0cNuP5XMG8H0psTAC3Pz2TvGqzjW/0LBGwgqQOzDPa63htQAJIOAgwAPvaypAwblAn3TQyvuuMzL4WTQqDZ1rfiHsIGmSc8D2dl/PL6/gYdLHLImiwGA0Ek6hnUTO8P4v74lhuc41v1AMb603kNVoCV47lECM/t/K++vMSW+80DW/oMtbzxIoyCpBCeqNyzG0B8bf+OtdE60h3zU/UAxvzzqhZZWsh4Wu8cXdKBYSLC9wE2+2GAfOU+0jWtd8AGXX81d35y5xc6F1ntlBaTTzmTbrUSpyvlnHZFhX1LUpQqMa9FZCdlGOZHfC8T+AXS7wwepNA69pri2MrCXYOY3u+4voxlWClavkp7y9oGUJgSLT43SBLm9vJbBYMq2Jp1aulBHTxHpWfD/0up1la6yyEt969lnRhysJF975oOUO0r70vGUj4giNQMmGKz2oZ3F+Ih9vNxQTGD/F7t1ikNYQrZDYpnE7MiGmP5+giqrjb2I2C5y1hsAy+nzcluhABm3P7REDKMA7H/QswaXgUIrgr0FcQSgFfPgmFoUk2vjwDYx6YXWeCmnmj7vWrJA/aP2bGEYB3m4oyRIeZExge62GLJfEBBUDUgHGgL/6HwPOHEYt28J1lomm2jkwZy+mlbGl6zmKmqFetBg2fsplW/LxzgdvS2CAkS59WNBBRMpLYwKVEKjCZYsBlSyz7wubMJc0cMJTTW78smv4+Y2PMJN8VmBcCfl4u6EkS2ijK6xvkdFExD0mnLEmxoAopHHuXswWAazln8t4xDlQ6eDR9vQkPy4E9gGCgTbCF4Ab6Q/hNNtyJ6t4lQ4FLTNSiHfe5/NakPUtF2HbOvVigvLjvgNYZBlo4wM0KO7IyWxmdrlrI/34iXE/9iRrMvGl8T87idtPHgOWLmQm5PTw5LvZljnBbPC2F29XuVqLNFONG4Y7URs0sS5goGnGXJg3fIF+TFM9+xZqRs+hxclM9ONCqAlhYDiB7cwEf3yvCxU9p3LnE2lIWslZGsVTpfDWaqVV5VVq1ci3V8lgdl9FEObi24DZMznvug645daszJlMcyu0hfXCoJsnaeamzMBJJKjPOK0jg3+wbf5J7BQOl8Jbr2KcwnxZ2X7axjUsrnA9skPQrJmq4Z/q97MTbA1khy4HsIADmN8wBgxRxta0gRdMBuK4wAX7A/S3v3/RaL0I3loxwZlK75BBikSPywS+eJoeeysjeZJUT7+TDVxxBrMjWnJeQZ0TxK8tgQVsufeJCJ5+bDcuKC0KFRKnwFt7vGaWMFmKtsgIzXE1713EgIauk8D+DuCf/wLOnckqIcx6Y9nm5XJJITlbmuUMw8Iqvtj7Ka+L0+9Ho8xQgjMZNwUUy9tTCSEUrwSVEh+/Uy5gZfd7kt5Acxvg/b8Vafw9MYLe1Cj6qJRXeO55RvVGmnjrY3dL11nFzqXSSgfQxHWbGPxGKGvzsRtxwotDMbxL6iILIdoog9V1+Arz9xa+sUZm9hNMhZtg47CdRtCsRFimYdAKEsk0QlYYH/BdbmR6+8MTd8jHN/5HtH0mTYrhEG4K2lSggUo+zzNWEnva24V33Pe9i3TR5vPfkYGzPWhwuEXHIKUKoEE2Mq/Tts6T4jp+/7U8tzdl4dHIEE4+fIR24IKtS+U2UcF7BB9UYPO2ZtlAedePy0xTiX10gyZyOET/3/qLgyIODfjfO0wSphRwLoYlJL2L9Xo9T4UZ7B1G/CYqIDnupE9yA2Tn6XvQuykq8tLZcESc3/FN2eoMop/p8kk+qKoqA/ytngO8UylvgPK3rz2I3l9BH7ourD1yv1jgyFnUUnuPMKjN5w7PS5zl3UGSK2m2x1jbV9F3O+0Qdjz0hvgoWkABn+Dne8UQ+4H9vP/f/B4zKzOAZirlfsp6izKreXxJQGjnKTfe+VDSeC09xjdv4BtMfQOkFWWvcKL2FAIGN+3594tq/++RXFmtDSsBxkfcTuvqu0QmO3cuuRtFIuBXilTdmGpEJjcjtIIKdY5+1x/tFJn+ObDpu33jW18hFIk0myPuTs9wlclrqmstRl4+3m7QqxPsiXU4u7cEn/Iwz10bZmTftVTOmj+MxcEMfknzjdO89AogTJQZZOHkp8zJvPOu81rwSeV18eg6bmFgho3tPP0nXniYQezbwdylGqbDnsmNjA78lunGOx9K2pBV6S45iH00te+yJziohq7UeAV98EWmxjXzqnEUReJyyNTdkNWzBBdBq7tFgmXxq40X8F8ksymS7R0ScyPoX05/RgnwU2Y+3m7QqxjVKhe7iuaI9cJH+CazAO/J0LYEHd+aTiiGt15MyA0nQi/fIhfhKsBLC2WI1Wuj6ddQ5SLfmsVCpqOjQWr/39LnCgch3fJSr2JUSpBQGTdI+5qF6Y4c10FdH9bad1BlG+XFaGJfi6ev/L5iKWA/M4eWe8CXrXnuJtksWvrY2oYcG9XLu4XnP3N+3lAxodZBo1QWwV7Ea72nEjjEGKUT7Ddy/4XacWjBVRATcu4bYhc6wo8vey33VMJXT2Hg0HxsFib7GoF72eFN+5jAgKgsoIfHn0cd7PBarxU6JMdcR+chMhZEFef9V0VM4EvLpFMYvbMHg8XMIcooo4wyyiijjDLKmISPAcfCsmd6OJoeAAAAAElFTkSuQmCC",_u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAACO98lFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAuQSURBVHgB7VptcFTVGX7OvfuRLxLD8CEEDJ+GlGgVFD9QDFUDqMVgJ2q1Wh072IqjpbZ2Rp0x09E/HUZrnSrgDP5QC5QOpChUGJAMiEgxkCEC4bN81SQQKTEEsrv33uNz9u5qiLtkz90l/MmTudndc8895z3Ped/3vOc9F+hDH/rQhz70oTsEPGL403KoY2ICLIyRQD5bMpBpSDgU8Az/HQpb2Pb12/gKQkhkGJ5IGPa0vIqiPMiv03gpEvpdFBIAh38dbPmgcLDOsfH+//ZiF2qFhQxCm4QSakCnjeeEgYelRItjYJvhoJlEZFQwBbZpkNl7+fVqSnpa2qgRJt4cuQs7azNIhA+aoFre4hOYJjlwEvAWVXX16N1ors3w7ERRLY3RLSiGIkFC2cEMYQPHr8Sb5ZAZI0KbBJ/EBEpzBVVovmHjw9/eTYW9A7Pu+50cy5kKnFfZQGMohNrn7xfN8IJq4Zi/pr7JqFasZskAasZ09m80lUSJqM8EEfokOBhA1cwlCQcH7cPJrOl4SAjMdSTGs9wfr0cNaaS2LECaMB3XZml+GyyJYyRgriEwnRNgtJbgjUwQoe3M/BI+EmGYFkKq82wLN2ZFMD7Hhj+Hoqgr20YjyxaICJZ41oJ4f45LhBFGJE9iPQl43ZSoJzEVNI1n20pwTXm51J7MrtAmgTMACgEz9puDzjmPAIsEOJjfT2LJnDQJ6N5f3UIRySYRXCmiRJCcChkmEaPSI0KbBCWMz/n+wVwKmWu5l9KAbBJgdGDp/RkgIFF/igi/ifW0u9d5r55kVJh2ekR4MYfozAQc93e20gA7ZgI2CQiTgMczQ0Csv3McrBWwUThxtsxRZYoIp54aAfyFK9VOU6AiaGNOaARKIaX2sq/NnFA2ym5kjARlAnRajXSM8ynt0rszSEC0P4GDVPsTdIj3mp0Ycsuj8mz8nrTgpyg5HHY//qzk78O3PoLWTUCTRhf6JETdvxNdsqJQPkAaqA9ZWDp1jh4BUx+Rt9H1T3TUIihx2pA4atvY15GPZjXbUQFtrCURo/n1btaZnFBmV5hstnUXHXYtLjYJtL/omiVimhA0UBOxcHrSHH0NoDZVcoBPGGqPINDG6ygNdG9+B7bf/rCsbQrjwKZR+HLKfrxF57CNjwxhXf8P2olHlhIlnJDLoQkvcUKUBDv2u+RJ0QgN3P5zOZjmVMImiin8JLbVr3AQNSyAgrPtuOLsGUy2LcYBwC3FWVg8dBc2rlsmGvhoQ9JGq6R5hx/FJLGMphGEJvQ1QZ7/mSrU4Ll0TuZjUxgDXsWiYprVEB+93hVFQOFAgCSg7RREawuK2ttQRTJGBE0MqpglP1y7QpxI2vgyYfseZKtqEyf1nb0+CXBNwdHwwbMekGWWgyoKWUkTGMqi/3LGdqimGIaPymOjg3L5i1ekP3CqkPuDI/CdaMFNDLv7ZWXBuqNK1lAj2jIpVxz6jjHmFH1OavVn/kxezS3wbxjpVXKOmjhf77CBzYafO08LL7OdUVxao6tMFJzHfGpFIXchB/n9+Fco6+zE7CyJpokT5Ya6OtdhpitXV2irjoiHsXbPde+7Tw7jGvYYZ6mSDm03n5vHRMxrK5eJVTjLMTqMAdhW0HZjjfilArCheUAZ949F1IyAiUlBicriYgzPhFzdoR8s2dGd5HdhczJU0VkFBGbQd/yUBBxh/b/lZuFfHy0WrbzXP1vgRgZcRaqtuCZ0v4bSPEppPANz4GM7Mxg4TaQ2+NORKxE8hc2KcX9PDUcwggHONM52HgewJHAOG957T3Q8dI8c67Mwm1X+yPLxSn3pMBOSoDRi9GXMZBWwjolimtR1pcXcxaYhVyJ4Wh2U77F7WB04Kzdwl1fKanXMBm18f5X4/69mysEhA4/SeB9jeZjVrKgmWF18QjfkqLU0H2gOQJzqwDXMWQxDgmAoVbkSygpNxB1PT0skHdV4fqjA5QNKd0iV2Q7KOWOz+OhJqIWNOUq2d1vcJyRDUbbrKNvaMYraNTAduRI+C02YsWBJXkBotZujMIoAk/Z2ZOEKtB2eGi2bzCVyBPca87hk/pObn2tUZvJYC9XiXPL2znE9CHe6CR0+n+dVrmTwZg4yun1IihFsl2quIjeKjnOCafK5N0n/2Tz054MB5oEOBzrRZOXiDH9H9jfBf7AFF0TEzStEGBVaXuVKBk+aQEEu6IUb2mHfmIMIbd9nC7ePjWFYNzgctJuVvjwURIAavpx1Wrj3UKZ/JR3fJJW1ZizxKT+Pc2YL2M9trFPI+6upVVu5N2jwKlcy6AdLMZuTF7A9FdBMni5bGRUanKHBs++ROQs/Emdvmi53UlC1Lb4rC9gf6kRtnsCn54IYwymczfLr2exnloHX2MweDuxaDnwMv7fR4S2a/7FYn45cyXDRlkjWa6QNt3KJnJAVQlFUwAjWsewT3hvH2Z0b9OGFsIlnuWQ+wzZnsO5JTmYNw+iGt7maBBlNsv4Q3tudJS68Pe7dJTJmdI7TY72t/NgfzQEwZ/DXGfLoM//G/t9Pxzt8tpODvZNR3lO8R/+IdjZXTy1ZHBJY+8ZK0f7cXbKYWapyalMBHel/hB/HkAG5EsHLuYMbpPfQWd5x7OscxgQHd4xU8wdaLByqqkLdvGX4fO40nOTsb6Z9j+Y9FSu1kowvcpmcmbdafFNdLi8LhblBFlxNJLb7Itjy6hrRngm5Ej4LTZjKrRnfZ5aSoXq3CL80WK6UJkpV5Miip8edwtvV5dhRvUYc4O8D1SoxOpCtjYdVXe2maf5QLi+33b3GIxxQJ3eFf4+EsAcZkisRLupW+pUNYi8Huogz3o/S3c5Z7c8ZX/mnKXLLN6dxqLpWdKh6chnnvEIOYoT5Y8YBd7JopnB3hYty/Fj74uYLa4GuXN3hOWxONTKrBT7/iZtDVCo/Q6XAaPs7Cwqx95VyqRIl1qtqf9HJcNhg8KRWA8lTaGCJaWL5i2tESvlCXbm6wnM+IVW9U6dUtcDmP0+RJ+j0dlLQW3ldRa0oN9z4RsV4AeUcWXaQJvABC9bSjLa+9Ik4jRShK1dX6KfcY9tVRzM8fX6j2P+PH8kjeweglvY+npnR4RxwoaEmz2BkyaCJZ40H2HbDi5vQKqD3MoZXuRQ8aUK0U+jjfjpLfuyJXYg6xhMwXt7NcLjLoF+APtKRy3PY7MULd0d17DS5GukjHbk8xwndO3tzkqyMObZeAdNoNXO2iXr0IFcq8L6V7haUqDwiJfglegkc7GF+1PckVyrwHCf8AO77RIfRS5BdCFBIKlcK8LSLlAnC06fqRA0/anCJkEyuVKC/RFpuukinr3cnynFUV7UZSvmckGtFox1C7eO7Uzvj9CJXHJ5PpYXGWsST5XGs/yR1OGXHyfo1ZgDqnDMlErzI9Z180ISXs0iGv43c4i4QUuvEuNEfRson3V7PSBW0STDir87w9HcDg52pKbw59lBd9ORa6/RaB++OkFlcIn2QvZRZir+uY9oYE2pJnP7ubRTkYwwzUINicmnDW8Tofq0ICxyoKZOrCwagaerFeKO1BygNGJiHkUyzP0yhSr1ogYK3XaQbnpbxYw7PAK+nRjSvGid7nQSqcZAEjCQBN5OAIniEF58QYadqJdoh3RzGTHrkQtNDW2lDIMwd6UkSsC8mkyJC2yC8mMPXnIIz9PRfOgZzJuoVXweXOcJTojc9SPBoE62OhEN/8ARLgpTrDDShT4KB7Rz0Uc7+tUyHbSH/K6cMR5O4BD5hA32C5cfILIlHaaLD1eEvCTkCTejvIg1s4sA/5vUL5RNMges/O4bmTaN63yew/yBXq5Ec/M3UCvV+4/JOh9kp/Xb0sXm0LKMaPiBVFllgLFUwX3pYbtOGey55igQ0sP/lwSBWXLdHaL3D6DbjEV+UyiGhECbQIY6lR8oXl4gEqv8pyrCT6eiGOw8lf7GrD33oQx/60Ac9fAtt8L7+Seu5hAAAAABJRU5ErkJggg==",mu=""+new URL("hypergamma-logo-colorized-921f89f0.png",import.meta.url).href;class Ya extends We{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",i=>{e.innerHTML=JSON.stringify(i)})}render(){return be`
    <h1>Experiments</h1>
    <p id="readout">No device connected</p>
    `}}customElements.get("hypergamma-experiments-page")||customElements.define("hypergamma-experiments-page",Ya);const vu={home:pu,plus:gu,devices:yu,analytics:bu,reports:_u},ei={};for(const[t,e]of Object.entries(vu)){const i=document.createElement("img");i.src=e,ei[t]=i}let hi=document.querySelector("hypergamma-dashboard");hi||(hi=new qa);hi.logo=mu;hi.name="HyperGamma";hi.renderNameInSidebar=!1;const wu={"/":new Oo({label:"Home",icon:ei.home}),analytics:new Ua({label:"Analytics",icon:ei.analytics}),plus:new Eo({label:"Hyper+",icon:ei.plus,pages:{focus:new Ha({label:"Focus"}),training:new Va({label:"Training"}),performance:new Ga({label:"Performance"}),meditation:new Wa({label:"Meditation"})}}),experiments:new Ya({label:"Experiments"}),devices:new Fa({label:"Devices",icon:ei.devices}),reports:new Ja({label:"Reports",icon:ei.reports})};hi.pages=wu;
