var _e=Object.defineProperty;var me=(m,x,L)=>x in m?_e(m,x,{enumerable:!0,configurable:!0,writable:!0,value:L}):m[x]=L;var _=(m,x,L)=>(me(m,typeof x!="symbol"?x+"":x,L),L);(function(){"use strict";const m=F(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]),x=F(["deltaX","deltaY"]),L=F(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function H(e,t){const i={type:e.type};i.isTrusted=e.isTrusted,i.bubbles=e.bubbles,i.cancelBubble=e.cancelBubble,i.cancelable=e.cancelable,i.composed=e.composed,i.defaultPrevent=e.defaultPrevented,i.eventPhase=e.eventPhase,i.returnValue=e.returnValue,i.currentTarget=e.currentTarget.id?e.currentTarget.id:e.currentTarget.constructor.name,i.target=i.currentTarget,i.srcElement=i.currentTarget,t(i)}function ie(e,t){e.preventDefault&&e.preventDefault(),x(e,t)}function ne(e){e.preventDefault&&e.preventDefault()}function se(e,t,i){for(const s of t)i[s]=e[s]}function F(e){return function(i,s){const r={type:i.type};se(i,e,r),s(r)}}function R(e,t){const i=[],s={type:e.type,touches:i};for(let r=0;r<e.touches.length;++r){const l=e.touches[r];i.push({pageX:l.pageX,pageY:l.pageY})}t(s)}let k=1,U={};for(;k<222;)U[k]=!0,k++;function W(e,t){let{keyCode:i}=e;U[i]&&(e.preventDefault&&(i<110||i>123)&&e.preventDefault(),L(e,t))}const E={contextmenu:ne,mousedown:m,mousemove:m,mouseup:m,pointerdown:m,pointermove:m,pointerup:m,pointerlockchange:m,webkitpointerlockchange:m,focus:H,blur:H,pointerout:m,touchstart:R,touchmove:R,touchend:R,wheel:ie,keydown:W,keyup:W};function O(e,t,i){i||(i="proxy"+Math.floor(Math.random()*1e15));const s=o=>{t?t.postMessage({route:"handleProxyEvent",args:[o,i]}):$(o,i)};let r=Object.entries(E);for(const[o,c]of r)e.addEventListener(o,function(u){c(u,s)});E.keydown&&globalThis.addEventListener("keydown",function(o){E.keydown(o,s)}),E.keyup&&globalThis.addEventListener("keyup",function(o){E.keyup(o,s)});const l=()=>{const o=e.getBoundingClientRect();s({type:"resize",left:o.left,top:o.top,width:e.clientWidth,height:e.clientHeight})};return l(),globalThis.addEventListener("resize",l),i}class ae{constructor(){_(this,"__listeners")}addEventListener(t,i){this.__listeners===void 0&&(this.__listeners={});const s=this.__listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(i)===-1&&s[t].push(i)}hasEventListener(t,i){if(this.__listeners===void 0)return!1;const s=this.__listeners;return s[t]!==void 0&&s[t].indexOf(i)!==-1}removeEventListener(t,i){if(this.__listeners===void 0)return;const r=this.__listeners[t];if(r!==void 0){const l=r.indexOf(i);l!==-1&&r.splice(l,1)}}dispatchEvent(t,i){if(this.__listeners===void 0)return;const r=this.__listeners[t.type];if(r!==void 0){i?t.target=i:t.target=this;const l=r.slice(0);for(let o=0,c=l.length;o<c;o++)l[o].call(this,t)}}}function I(){}class re extends ae{constructor(){super();_(this,"__listeners",{});_(this,"proxied");_(this,"style",{});_(this,"width");_(this,"left");_(this,"right");_(this,"top");_(this,"height");_(this,"setPointerCapture",()=>{});_(this,"releasePointerCapture",()=>{});_(this,"getBoundingClientRect",()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}));_(this,"handleEvent",i=>{i.type==="resize"&&(this.left=i.left,this.top=i.top,this.width=i.width,this.height=i.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),i.preventDefault=I,i.stopPropagation=I,this.dispatchEvent(i,this.proxied)});this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}}class C{constructor(){_(this,"targets",{});_(this,"makeProxy",(t,i=void 0)=>{t||(t=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let s;this.targets[t]?s=this.targets[t]:(s=new re,this.targets[t]=s),typeof i=="object"&&(i.proxy=s,s.proxied=i,typeof WorkerGlobalScope<"u"&&(i.style=s.style),s.width&&(i.style.width=s.width+"px",i.clientWidth=s.width),s.height&&(i.style.height=s.height+"px",i.clientHeight=s.height),i.setPointerCapture=s.setPointerCapture.bind(s),i.releasePointerCapture=s.releasePointerCapture.bind(s),i.getBoundingClientRect=s.getBoundingClientRect.bind(s),i.addEventListener=s.addEventListener.bind(s),i.removeEventListener=s.removeEventListener.bind(s),i.handleEvent=s.handleEvent.bind(s),i.dispatchEvent=s.dispatchEvent.bind(s),i.focus=s.focus.bind(s),i.blur=s.blur.bind(s))});_(this,"getProxy",t=>this.targets[t]);_(this,"handleEvent",(t,i)=>{if(this.targets[i]||this.makeProxy(i),this.targets[i])return this.targets[i].handleEvent(t),!0});globalThis.document||(globalThis.document={elementFromPoint:(...t)=>this.targets[Object.keys(this.targets)[0]].proxied})}}function le(e,t){var i;return(i=this==null?void 0:this.__node)!=null&&i.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new C),this.__node.graph.ProxyManager.makeProxy(e,t)):(globalThis.ProxyManager||(globalThis.ProxyManager=new C),globalThis.ProxyManager.makeProxy(e,t)),e}function $(e,t){var i;if((i=this==null?void 0:this.__node)!=null&&i.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new C),this.__node.graph.ProxyManager.handleEvent(e,t))return e}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new C),globalThis.ProxyManager.handleEvent(e,t))return e}const X={initProxyElement:O,makeProxy:le,handleProxyEvent:$};function oe(e){if(e.worker){let t=e.worker,i=e.route;return(t instanceof Blob||typeof t=="string")&&(t=new Worker(t)),delete e.worker,delete e.route,q(t,e,i)}else return O(e.canvas,void 0,e._id),G(e)}function q(e,t,i){var c;if(console.log(t),!t)return;t._id||(t._id=`canvas${Math.floor(Math.random()*1e15)}`);let s=t.canvas.transferControlToOffscreen();t.width||(t.width=t.canvas.clientWidth),t.height||(t.height=t.canvas.clientHeight);let r={route:i||"setupCanvas",args:{...t,canvas:s}};(c=this==null?void 0:this.__node)!=null&&c.graph?this.__node.graph.run("initProxyElement",t.canvas,e,t._id):O(t.canvas,e,t._id),t.draw&&(typeof t.draw=="function"?r.args.draw=t.draw.toString():r.args.draw=t.draw),t.update&&(typeof t.update=="function"?r.args.update=t.update.toString():r.args.update=t.update),t.init&&(typeof t.init=="function"?r.args.init=t.init.toString():r.args.init=t.init),t.clear&&(typeof t.clear=="function"?r.args.clear=t.clear.toString():r.args.clear=t.clear);let l=[s];return t.transfer&&(l.push(...t.transfer),delete t.transfer),e.postMessage(r,l),{_id:t._id,width:t.width,height:t.height,worker:e,draw:(u,h)=>{e.postMessage({route:"drawFrame",args:[u,t._id]},h)},update:(u,h)=>{e.postMessage({route:"updateCanvas",args:[u,t._id]},h)},clear:()=>{e.postMessage({route:"clearCanvas",args:t._id})},init:()=>{e.postMessage({route:"initCanvas",args:t._id})},stop:()=>{e.postMessage({route:"stopAnim",args:t._id})},start:()=>{e.postMessage({route:"startAnim",args:t._id})},set:(u,h)=>{e.postMessage({route:"setDraw",args:[u,t._id]},h)},terminate:()=>{e.terminate()}}}function M(e,t){var s,r,l,o,c,u,h,a;let i;if((s=this==null?void 0:this.__node)!=null&&s.graph?t?i=(r=this.__node.graph.CANVASES)==null?void 0:r[e._id]:e._id?i=(l=this.__node.graph.CANVASES)==null?void 0:l[e._id]:i=(o=this.__node.graph.CANVASES)==null?void 0:o[Object.keys(this.__node.graph.CANVASES)[0]]:t?i=(c=globalThis.CANVASES)==null?void 0:c[e._id]:e._id?i=(u=globalThis.CANVASES)==null?void 0:u[e._id]:i=(h=globalThis.CANVASES)==null?void 0:h[Object.keys(globalThis.CANVASES)[0]],i)return e.canvas&&(i.canvas=e.canvas,(a=this==null?void 0:this.__node)!=null&&a.graph?this.__node.graph.run("makeProxy",i._id,i.canvas):X.makeProxy(i._id,i.canvas)),typeof e.context=="string"?i.context=i.canvas.getContext(e.context):e.context&&(i.context=e.context),e.width&&(i.canvas.width=e.width),e.height&&(i.canvas.height=e.height),typeof e.draw=="string"&&(e.draw=b(e.draw)),typeof e.draw=="function"&&(i.draw=e.draw.bind(e)),typeof e.update=="string"&&(e.update=b(e.update)),typeof e.update=="function"&&(i.update=e.update.bind(e)),typeof e.init=="string"&&(e.init=b(e.init)),typeof e.init=="function"&&(i.init=e.init.bind(e)),typeof e.clear=="string"&&(e.clear=b(e.clear)),typeof e.clear=="function"&&(i.clear=e.clear.bind(e)),e._id}function G(e){var i,s,r,l,o,c,u;(i=this==null?void 0:this.__node)!=null&&i.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let t=e;if(e._id?t._id=e._id:t._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof e.context=="string"?t.context=e.canvas.getContext(e.context):t.context=e.context,"animating"in e?t.animating=e.animating:t.animating=!0,(r=(s=this==null?void 0:this.__node)==null?void 0:s.graph)!=null&&r.CANVASES[t._id])this.__node.graph.run("setDraw",t);else if((l=globalThis.CANVASES)!=null&&l[t._id])M(t);else if((o=this==null?void 0:this.__node)!=null&&o.graph&&(t.graph=this.__node.graph,t.__node||(t.__node={}),t.__node.tag||(t.__node.tag=t._id),t=this.__node.graph.add(t),t.__addOndisconnected=()=>{t.stop(),delete this.__node.graph.CANVASES[t._id]}),(c=this==null?void 0:this.__node)!=null&&c.graph?this.__node.graph.CANVASES[t._id]=t:globalThis.CANVASES[t._id]=t,(u=this==null?void 0:this.__node)!=null&&u.graph?this.__node.graph.run("makeProxy",t._id,t.canvas):X.makeProxy(t._id,t.canvas),e.width&&(t.canvas.width=e.width),e.height&&(t.canvas.height=e.height),typeof t.draw=="string"?t.draw=b(t.draw):typeof t.draw=="function"&&(t.draw=t.draw.bind(t)),typeof t.update=="string"?t.update=b(t.update):typeof t.update=="function"&&(t.update=t.update.bind(t)),typeof t.init=="string"?t.init=b(t.init):typeof t.init=="function"&&(t.init=t.init.bind(t)),typeof t.clear=="string"?t.clear=b(t.clear):typeof t.clear=="function"&&(t.clear=t.clear.bind(t)),typeof t.init=="function"&&t.init(t,t.canvas,t.context),t.stop=()=>{N(t._id)},t.start=h=>{D(t._id,h)},t.set=h=>{M(h,t._id)},typeof t.draw=="function"&&t.animating){let h=(a,n,g)=>{a.animating&&(a.draw(a,n,g),requestAnimationFrame(()=>{h(a,n,g)}))};h(t,t.canvas,t.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?t._id:{_id:e._id,width:e.width,height:e.height,draw:a=>{K(a,e._id)},update:a=>{J(a,e._id)},clear:()=>{z(e._id)},init:()=>{Z(e._id)},stop:()=>{N(e._id)},start:()=>{D(e._id)},set:a=>{M(a,e._id)},terminate:()=>{var a,n;(a=this.__node)!=null&&a.graph?this.__node.graph.remove(e._id):(N(e._id),(n=this==null?void 0:this.__node)!=null&&n.graph?delete this.__node.graph.CANVASES[t._id]:delete globalThis.CANVASES[t._id])}}}function K(e,t){let i=A.call(this,t);if(i&&(e&&Object.assign(i,e),i.draw))return i.draw(i,i.canvas,i.context),t}function z(e){let t=A.call(this,e);if(t!=null&&t.clear)return t.clear(t,t.canvas,t.context),e}function Z(e){let t=A.call(this,e);if(t!=null&&t.init)return t.init(t,t.canvas,t.context),e}function J(e,t){let i=A.call(this,t);if(i!=null&&i.update)return i.update(i,i.canvas,i.context,e),t}function he(e,t){let i=A.call(this,t);if(i)return Object.assign(i,e),e.width&&(i.canvas.width=e.width),e.height&&(i.canvas.height=e.height),t}function D(e,t){let i=A.call(this,e);if(i.animating=!0,i&&t)return typeof t=="string"&&(t=b(t)),typeof t=="function"&&(i.draw=t),e;if(typeof(i==null?void 0:i.draw)=="function"){let s=(r,l,o)=>{r.animating&&(r.draw(r,l,o),requestAnimationFrame(()=>{s(r,l,o)}))};return typeof i.clear=="function"&&i.clear(i,i.canvas,i.context),typeof i.init=="function"&&i.init(i,i.canvas,i.context),s(i,i.canvas,i.context),e}}function N(e){let t=A.call(this,e);if(t)return t.animating=!1,typeof t.clear=="function"&&requestAnimationFrame(t.clear(t,t.canvas,t.context)),e}function A(e){var i,s,r,l,o;let t;return(i=this==null?void 0:this.__node)!=null&&i.graph?e?t=(r=this.__node.graph.CANVASES)==null?void 0:r[e]:t=(s=this.__node.graph.CANVASES)==null?void 0:s[Object.keys(this.__node.graph.CANVASES)[0]]:e?t=(o=globalThis.CANVASES)==null?void 0:o[e]:t=(l=globalThis.CANVASES)==null?void 0:l[Object.keys(globalThis.CANVASES)[0]],t}const ce={...X,Renderer:oe,transferCanvas:q,setupCanvas:G,setDraw:M,drawFrame:K,clearCanvas:z,initCanvas:Z,updateCanvas:J,setProps:he,startAnim:D,stopAnim:N,getCanvas:A};function b(e=""){let t=o=>o.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),s=(o=>{let c=o.indexOf("=>")+1;return c<=0&&(c=o.indexOf("){")),c<=0&&(c=o.indexOf(") {")),o.slice(0,o.indexOf("{",c)+1)})(e),r=t(e),l;if(s.includes("function")){let o=s.split("(")[1].split(")")[0];l=new Function(o,r)}else if(s.substring(0,6)===r.substring(0,6)){let o=s.split("(")[1].split(")")[0];l=new Function(o,r.substring(r.indexOf("{")+1,r.length-1))}else try{l=(0,eval)(s+r+"}")}catch{}return l}var P=class{constructor(e,t,i,s){this.r=e,this.g=t,this.b=i,this.a=s}},Q=class{constructor(){this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.loop=!1,this._vbuffer=0,this._coord=0,this.visible=!0,this.intensity=1,this.xy=new Float32Array([]),this.numPoints=0,this.color=new P(0,0,0,1),this.webglNumPoints=0}},Y=class extends Q{constructor(e,t){super(),this.currentIndex=0,this.webglNumPoints=t,this.numPoints=t,this.color=e,this.xy=new Float32Array(2*this.webglNumPoints)}setX(e,t){this.xy[e*2]=t}setY(e,t){this.xy[e*2+1]=t}getX(e){return this.xy[e*2]}getY(e){return this.xy[e*2+1]}lineSpaceX(e,t){for(let i=0;i<this.numPoints;i++)this.setX(i,e+t*i)}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(e){for(let t=0;t<this.numPoints;t++)this.setY(t,e)}shiftAdd(e){let t=e.length;for(let i=0;i<this.numPoints-t;i++)this.setY(i,this.getY(i+t));for(let i=0;i<t;i++)this.setY(i+this.numPoints-t,e[i])}addArrayY(e){if(this.currentIndex+e.length<=this.numPoints)for(let t=0;t<e.length;t++)this.setY(this.currentIndex,e[t]),this.currentIndex++}replaceArrayY(e){if(e.length==this.numPoints)for(let t=0;t<this.numPoints;t++)this.setY(t,e[t])}},ee=(e,t,i)=>{let s={x:0,y:0};return s.x=e.x+t.x*i,s.y=e.y+t.y*i,s},V=e=>j(-e.y,e.x),T=(e,t)=>{let i=fe(e,t);return i=te(i),i},ue=(e,t)=>{let i={x:0,y:0};return i.x=e.x+t.x,i.y=e.y+t.y,i},ge=(e,t)=>e.x*t.x+e.y*t.y,te=e=>{let t={x:0,y:0},i=e.x*e.x+e.y*e.y;return i>0&&(i=1/Math.sqrt(i),t.x=e.x*i,t.y=e.y*i),t},j=(e,t)=>{let i={x:0,y:0};return i.x=e,i.y=t,i},fe=(e,t)=>{let i={x:0,y:0};return i.x=e.x-t.x,i.y=e.y-t.y,i},de=e=>{let t,i={x:0,y:0},s={x:0,y:0},r=[],l=(u,h)=>{r.push({vec2:u,miterLength:h})},o=u=>({x:e[u*2],y:e[u*2+1]});i=T(o(1),o(0)),t=V(i),l(t,1);let c=e.length/2;for(let u=1;u<c-1;u++){let h=o(u-1),a=o(u),n=o(u+1);i=T(a,h),t=V(i),s=T(n,a);let g=pe(i,s),d=ye(i,g,1);l(g,d)}return i=T(o(c-1),o(c-2)),t=V(i),l(t,1),r},pe=(e,t)=>{let i=ue(e,t);return i=te(i),j(-i.y,i.x)},ye=(e,t,i)=>{let s=j(-e.y,e.x);return i/ge(t,s)},B=class extends Q{constructor(e,t,i){super(),this.currentIndex=0,this._thicknessRequested=0,this._actualThickness=0,this.webglNumPoints=t*2,this.numPoints=t,this.color=e,this._thicknessRequested=i,this._linePoints=new Float32Array(t*2),this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){let e=this._actualThickness/2,t=de(this._linePoints);for(let i=0;i<this.numPoints;i++){let s=this._linePoints[2*i],r=this._linePoints[2*i+1],l={x:s,y:r},o=ee(l,t[i].vec2,t[i].miterLength*e),c=ee(l,t[i].vec2,-t[i].miterLength*e);this.xy[i*4]=o.x,this.xy[i*4+1]=o.y,this.xy[i*4+2]=c.x,this.xy[i*4+3]=c.y}}setX(e,t){this._linePoints[e*2]=t}setY(e,t){this._linePoints[e*2+1]=t}lineSpaceX(e,t){for(let i=0;i<this.numPoints;i++)this.setX(i,e+t*i)}setThickness(e){this._thicknessRequested=e}getThickness(){return this._thicknessRequested}setActualThickness(e){this._actualThickness=e}},ve=class{constructor(e,t){this.debug=!1,this.addLine=this.addDataLine,t==null?this.webgl=e.getContext("webgl",{antialias:!0,transparent:!1}):(this.webgl=e.getContext("webgl",{antialias:t.antialias,transparent:t.transparent,desynchronized:t.deSync,powerPerformance:t.powerPerformance,preserveDrawing:t.preserveDrawing}),this.debug=t.debug==null?!1:t.debug),this.log("canvas type is: "+e.constructor.name),this.log(`[webgl-plot]:width=${e.width}, height=${e.height}`),this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[],this.gScaleX=1,this.gScaleY=1,this.gXYratio=1,this.gOffsetX=0,this.gOffsetY=0,this.gLog10X=!1,this.gLog10Y=!1,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.webgl.viewport(0,0,e.width,e.height),this._progLine=this.webgl.createProgram(),this.initThinLineProgram(),this.webgl.enable(this.webgl.BLEND),this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(e){let t=this.webgl;e.forEach(i=>{if(i.visible){t.useProgram(this._progLine);let s=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(s,!1,new Float32Array([i.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,i.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let r=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(r,new Float32Array([i.offsetX+this.gOffsetX,i.offsetY+this.gOffsetY]));let l=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(l,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let o=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(o,[i.color.r,i.color.g,i.color.b,i.color.a]),t.bufferData(t.ARRAY_BUFFER,i.xy,t.STREAM_DRAW),t.drawArrays(i.loop?t.LINE_LOOP:t.LINE_STRIP,0,i.webglNumPoints)}})}_drawSurfaces(e){let t=this.webgl;e.forEach(i=>{if(i.visible){t.useProgram(this._progLine);let s=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(s,!1,new Float32Array([i.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,i.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let r=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(r,new Float32Array([i.offsetX+this.gOffsetX,i.offsetY+this.gOffsetY]));let l=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(l,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let o=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(o,[i.color.r,i.color.g,i.color.b,i.color.a]),t.bufferData(t.ARRAY_BUFFER,i.xy,t.STREAM_DRAW),t.drawArrays(t.TRIANGLE_STRIP,0,i.webglNumPoints)}})}_drawTriangles(e){let t=this.webgl;t.bufferData(t.ARRAY_BUFFER,e.xy,t.STREAM_DRAW),t.useProgram(this._progLine);let i=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(i,!1,new Float32Array([e.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,e.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let s=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(s,new Float32Array([e.offsetX+this.gOffsetX,e.offsetY+this.gOffsetY]));let r=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(r,new Int32Array([0,0]));let l=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(l,[e.color.r,e.color.g,e.color.b,e.color.a]),t.drawArrays(t.TRIANGLE_STRIP,0,e.xy.length/2)}_drawThickLines(){this._thickLines.forEach(e=>{if(e.visible){let t=Math.min(this.gScaleX,this.gScaleY);e.setActualThickness(e.getThickness()/t),e.convertToTriPoints(),this._drawTriangles(e)}})}update(){this.clear(),this.draw()}draw(){this._drawLines(this.linesData),this._drawLines(this.linesAux),this._drawThickLines(),this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(e){e._vbuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,e._vbuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,e.xy,this.webgl.STREAM_DRAW),e._coord=this.webgl.getAttribLocation(this._progLine,"coordinates"),this.webgl.vertexAttribPointer(e._coord,2,this.webgl.FLOAT,!1,0,0),this.webgl.enableVertexAttribArray(e._coord)}addDataLine(e){this._addLine(e),this.linesData.push(e)}addAuxLine(e){this._addLine(e),this.linesAux.push(e)}addThickLine(e){this._addLine(e),this._thickLines.push(e)}addSurface(e){this._addLine(e),this.surfaces.push(e)}initThinLineProgram(){let e=`
      attribute vec2 coordinates;
      uniform mat2 uscale;
      uniform vec2 uoffset;
      uniform ivec2 is_log;

      void main(void) {
         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;
         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;
         vec2 line = vec2(x, y);
         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);
      }`,t=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(t,e),this.webgl.compileShader(t);let i=`
         precision mediump float;
         uniform highp vec4 uColor;
         void main(void) {
            gl_FragColor =  uColor;
         }`,s=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(s,i),this.webgl.compileShader(s),this._progLine=this.webgl.createProgram(),this.webgl.attachShader(this._progLine,t),this.webgl.attachShader(this._progLine,s),this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(e,t,i,s){this.webgl.viewport(e,t,i,s)}log(e){this.debug&&console.log("[webgl-plot]:"+e)}},p=class{constructor(){this.plots={}}initPlot(e,t){var u,h;if(t||(t=new ve(e.canvas,e.webglOptions)),!e._id)e._id=`plot${Math.floor(Math.random()*1e15)}`;else if(this.plots[e._id]){let a=this.plots[e._id].initial;if(e.lines)for(let n in e.lines)a.lines[n]&&Array.isArray(e.lines[n])&&(e.lines[n],e.lines[n]=a.lines[n]);e=Object.assign(a,e)}e.overlay&&(typeof e.overlay!="object"&&(e.overlay=document.createElement("canvas"),e.overlay.style.position="absolute",e.overlay.width=e.canvas.width,e.overlay.height=e.canvas.height,e.canvas.appendChild(e.overlay)),e.overlayCtx||(e.overlayCtx=e.overlay.getContext("2d"))),e.width&&(e.canvas.width=e.width,e.canvas.style&&(e.canvas.style.width=e.width+"px"),typeof e.overlay=="object"&&(e.overlay.width=e.width,e.overlay.style&&(e.overlay.style.width=e.width+"px"))),e.height&&(e.canvas.height=e.height,e.canvas.style&&(e.canvas.style.height=e.height+"px"),typeof e.overlay=="object"&&(e.overlay.height=e.height,e.overlay.style&&(e.overlay.style.height=e.height+"px"))),(u=e.lines)!=null&&u.timestamp&&delete e.lines.timestamp,e.lines||(e.lines={});let i={};for(let a in e.lines)i[a]=Object.assign({},i[a]),"viewing"in e.lines[a]||(e.lines[a].viewing=!0),i[a].viewing=e.lines[a].viewing,i[a].sps=e.lines[a].sps,i[a].nSec=e.lines[a].nSec,i[a].nPoints=e.lines[a].nPoints,i[a].ymin=e.lines[a].ymin,i[a].ymax=e.lines[a].ymax,i[a].units=e.lines[a].units;let s={plot:t,settings:e,initial:Object.assign(Object.assign({},e),{lines:i}),anim:()=>{t.update()}};this.plots[e._id]=s;let r=0,l=0;Object.keys(e.lines).forEach(a=>{var n;((n=e.lines[a])==null?void 0:n.viewing)!==!1&&l++}),e.nLines=l;let o,c;typeof e.overlay=="object"&&(o=e.overlay,c=e.overlayCtx,c.clearRect(0,0,e.overlay.width,e.overlay.height),c.font=e.overlayFont?e.overlayFont:"1em Courier",c.fillStyle=e.overlayColor?e.overlayColor:"white");for(let a in e.lines){let n=e.lines[a];if(Array.isArray(n)&&(n={values:n},e.lines[a]=n),"viewing"in n||(n.viewing=!0),n.color)Array.isArray(n.color)&&(n.color=new P(...n.color));else{let f=p.HSLToRGB(360*(r/l)%360,100,50,1);s.initial.lines[a].color=[...f,1],n.color=new P(...f,1)}let g;if(n.nSec&&n.sps?g=Math.ceil(n.nSec*n.sps):n.nPoints?g=n.nPoints:n.points?g=n.points:e.linePoints?g=e.linePoints:n.values?g=n.values.length:g=1e3,n.points=g,e.lines[a].viewing===!1)continue;if((n.width||e.lineWidth)&&n.width!==0){let f=e.lineWidth;f||(f=n.width),n.width?n.line=new B(n.color,g,n.width):e.lineWidth&&(n.line=new B(n.color,g,e.lineWidth)),n.line.lineSpaceX(-1,2/n.line.numPoints)}else n.line=new Y(n.color,g),n.line.arrangeX();((h=n.values)==null?void 0:h.length)===n.points?n.values.length!==g&&(n.interpolate?n.values.length>g?n.values=p.downsample(n.values,g):n.values.length<g&&(n.values=p.upsample(n.values,g)):n.values.length>n.points?n.values=n.values.slice(n.values.length-n.points):n.values=[...new Array(n.points-n.values.length).fill(0),...n.values]):Array.isArray(n.values)?n.values.length>g?n.values=n.values.slice(n.values.length-g):n.values.length<g&&(n.values=[...new Array(g-n.values.length).fill(0),...n.values]):n.values=new Array(n.points).fill(0);let d=n.ymin,y=n.ymax,v=n.values.length<=1e5;if(d===y?(y=v?Math.max(...n.values):1,d=v?Math.min(...n.values):0):isNaN(y)&&(y=v?Math.max(...n.values):1),isNaN(d)&&(d=v?Math.min(...n.values):0),d>y){let f=d;y=d,d=f}let w=Math.abs(d);if(n.absmax=w>y?w:y,"autoscale"in n||(n.autoscale=!0),n.position||(n.position=e.nLines-r-1),n.autoscale?n.autoscale===2?("clamp"in n||(n.clamp=!0),n.scaled=p.autoscale(n.values,n.position,l,n.centerZero,d,y,n.clamp)):(n.scaled=n.values,n.line.scaleY=p.getYScalar(n.values,l,n.centerZero,d,y),n.line.offsetY=p.getYOffset(n.position,l,d,n.line.scaleY)):n.scaled=n.values,n.scaled.forEach((f,S)=>n.line.setY(S,f)),n.line instanceof B?t.addThickLine(n.line):n.line instanceof Y&&t.addDataLine(n.line),"xAxis"in n||(n.xAxis=!0),n.xAxis){n.xColor?Array.isArray(n.xColor)&&(n.xColor=new P(...n.xColor)):n.xColor=new P(1,1,1,.3);let f=new Y(n.xColor,2),S=n.autoscale?(r+1)*2/l-1-1/l:0;f.constY(S),f.arrangeX(),f.xy[2]=1,n.x=f,t.addAuxLine(f)}if(l>1&&n.autoscale&&r!==l-1){e.dividerColor?Array.isArray(e.dividerColor)&&(e.dividerColor=new P(...e.dividerColor)):e.dividerColor=new P(1,1,1,1);let f=new Y(e.dividerColor,2);f.constY(n.autoscale?(r+1)*2/l-1:1),f.arrangeX(),f.xy[2]=1,n.divider=f,t.addAuxLine(f)}if(typeof e.overlay=="object"&&(n.useOverlay||!("useOverlay"in n))){let f=e.nLines-n.position-1;c.fillText(a,20,o.height*(f+.2)/e.nLines),c.fillText(`${Math.floor(y)===y?y:y==null?void 0:y.toFixed(5)} ${n.units?n.units:""}`,o.width-100,o.height*(f+.2)/e.nLines),c.fillText(`${Math.floor(d)===d?d:d==null?void 0:d.toFixed(5)} ${n.units?n.units:""}`,o.width-100,o.height*(f+.9)/e.nLines)}r++}return requestAnimationFrame(s.anim),this.plots[e._id]}deinitPlot(e){return typeof e=="string"&&(e=this.plots[e]),e.plot.clear(),e.plot.removeAllLines(),!0}reinitPlot(e,t){var i,s;if(typeof e=="string"){let r=e;e=this.plots[e],t._id||(t._id=r)}if(e.plot)return e.plot.clear(),e.plot.removeAllLines(),e.settings.overlayCtx&&e.settings.overlayCtx.clearRect(0,0,(i=e.settings.overlay)==null?void 0:i.width,(s=e.settings.overlay)==null?void 0:s.height),this.initPlot(t,e.plot)}getChartSettings(e,t){var s,r,l,o;let i=this.plots[e];if(i){let c=Object.assign({},i.initial);for(let u in i.initial.lines)typeof((s=i.initial.lines[u])==null?void 0:s.ymax)!="number"&&(c.lines[u].ymax=(r=i.settings.lines[u])==null?void 0:r.ymax),typeof((l=i.initial.lines[u])==null?void 0:l.ymin)!="number"&&(c.lines[u].ymin=(o=i.settings.lines[u])==null?void 0:o.ymin),t&&(c.lines[u].values=i.settings.lines[u].values);return delete c.canvas,delete c.overlay,delete c.overlayCtx,c}}update(e,t,i=!0){var s,r,l;if(typeof e=="string"&&(e=this.plots[e]),!e)return!1;if(t){let o=!1,c,u;typeof e.settings.overlay=="object"&&(c=e.settings.overlay,u=e.settings.overlayCtx,u.font=e.settings.overlayFont?e.settings.overlayFont:"1em Courier",u.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white");for(let h in t)if(e.settings.lines[h]&&e.settings.lines[h].line){if(((s=e.settings.lines[h])==null?void 0:s.viewing)===!1)continue;let a=e.settings.lines[h];if(a.values){if(e.settings.mode&&e.settings.mode==="sweep"){"ct"in a||(a.ct=0);let v=w=>{a.ct>a.values.length&&(a.ct=0),a.values[a.ct]=w,a.ct++};Array.isArray(t[h])?t[h].forEach(v):typeof t[h]=="number"?v(t[h]):t[h].values&&t[h].values.forEach(v)}else Array.isArray(t[h])&&((r=a.values)==null?void 0:r.length)<1e5?(a.values.length===0&&(a.values.length=a.points?a.points:1e3),t[h].length===a.values.length?a.values=t[h]:p.circularBuffer(a.values,t[h])):typeof t[h]=="number"?(a.values.push(t[h]),a.values.shift()):(l=t[h])!=null&&l.values&&(a.values.length===0&&(a.values.length=a.points?a.points:1e3),t[h].values.length===a.values.length?a.values=t[h].values:p.circularBuffer(a.values,t[h].values));a.values.length!==a.points&&(a.interpolate?a.values.length>a.points?a.values=p.downsample(a.values,a.points):a.scaled.length<a.points&&(a.values=p.upsample(a.values,a.points)):a.values.length>a.points?a.values.splice(0,a.values.length-a.points):a.values=new Array(a.points).fill(0).splice(a.points-a.values.length,0,a.values));let n=a.ymin,g=a.ymax,d=a.values.length<=1e5;if(n===g?(g=d?Math.max(...a.values):1,n=d?Math.min(...a.values):0):isNaN(g)&&(g=d?Math.max(...a.values):1),isNaN(n)&&(n=d?Math.min(...a.values):0),n>g){let v=n;g=n,n=v}let y=Math.abs(n);if(a.absmax=y>g?y:g,a.autoscale?a.autoscale===2?a.scaled=p.autoscale(a.values,a.position,e.settings.nLines,a.centerZero,n,g,a.clamp):(a.scaled=a.values,a.line.scaleY=p.getYScalar(a.values,e.settings.nLines,a.centerZero,n,g),a.line.offsetY=p.getYOffset(a.position,e.settings.nLines,n,a.line.scaleY)):a.scaled=a.values,a.scaled.forEach((v,w)=>{!a.autoscale&&a.absmax>1?a.line.setY(w,v/a.absmax):a.line.setY(w,v)}),typeof e.settings.overlay=="object"&&(a.useOverlay||!("useOverlay"in a))){let v=e.settings.nLines-a.position-1,w=c.height*v/e.settings.nLines,f=c.height/e.settings.nLines;if(u.clearRect(0,w,c.width,f),e.settings.mode&&e.settings.mode==="sweep"){u.fillStyle=e.settings.sweepColor?e.settings.sweepColor:"rgba(0,255,0,0.25)",u.beginPath();let S=c.width*a.ct/a.values.length;u.moveTo(S,w),u.lineTo(S,f),u.stroke()}u.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white",u.fillText(h,20,c.height*(v+.2)/e.settings.nLines),u.fillText(`${Math.floor(g)===g?g:g==null?void 0:g.toFixed(5)} ${a.units?a.units:""}`,c.width-100,c.height*(v+.2)/e.settings.nLines),u.fillText(`${Math.floor(n)===n?n:n==null?void 0:n.toFixed(5)} ${a.units?a.units:""}`,c.width-100,c.height*(v+.9)/e.settings.nLines)}}}else e.settings.generateNewLines&&!h.includes("timestamp")&&(Array.isArray(t[h])&&(t[h]={values:t[h]}),!t[h].nSec&&!t[h].nPoints&&!e.settings.linePoints&&(t[h].nPoints=1e3),o=!0);if(o)return e.settings.cleanGeneration||Object.keys(e.initial.lines).forEach(h=>{t[h]?t[h]=Object.assign(e.initial.lines[h],t[h]):t[h]=e.initial.lines[h]}),this.reinitPlot(e,{_id:e.settings._id,lines:t}),!0}return i&&requestAnimationFrame(e.anim),!0}updateLine(e,t,i,s,r,l,o){return e.numPoints!==t.length&&(i?e.numPoints>t.length?t=p.downsample(t,e.numPoints):e.numPoints<t.length&&(t=p.upsample(t,e.numPoints)):t.length>e.numPoints?t=t.slice(t.length-e.numPoints):t=[...new Array(t.length).fill(0),...t]),s&&(t=p.autoscale(t,r,l,o)),t.forEach((c,u)=>e.setY(u,c)),!0}static autoscale(e,t=0,i=1,s=!1,r,l,o){if((e==null?void 0:e.length)===0)return e;let c=typeof l=="number"?l:e.length<=1e5?Math.max(...e):1,u=typeof r=="number"?r:e.length<=1e5?Math.min(...e):0,h=1/i,a=1;if(s){let n=Math.max(Math.abs(u),Math.abs(c));return n!==0&&(a=h/n),e.map(g=>(o&&(g<u&&(g=u),g>c&&(g=c)),g*a+(h*(t+1)*2-1-h)))}else return c===u?c!==0?a=h/c:u!==0&&(a=h/Math.abs(u)):a=h/(c-u),e.map(n=>(o&&(n<u&&(n=u),n>c&&(n=c)),2*((n-u)*a-1/(2*i))+(h*(t+1)*2-1-h)))}static getYScalar(e,t=1,i=!1,s,r){if((e==null?void 0:e.length)===0)return e;let l=typeof r=="number"?r:e.length<=1e5?Math.max(...e):1,o=typeof s=="number"?s:e.length<=1e5?Math.min(...e):0,c=1/t,u=1;if(i){let h=Math.max(Math.abs(o),Math.abs(l));return h!==0&&(u=c/h),2*u}else return l===o?l!==0?u=c/l:o!==0&&(u=c/Math.abs(o)):u=c/(l-o),2*u}static getYOffset(e=0,t=1,i=0,s=1){let r=1/t,l=r*(e+1)*2-1-r;return i!==0?l-=i*s+1/t:l-=s+1/t,l}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t,i=1){if(e.length>t){let s=new Array(t),r=e.length/t,l=e.length-1,o=0,c=0;for(let u=r;u<e.length;u+=r){let h=Math.round(u);h>l&&(h=l);for(let a=o;a<h;a++)s[c]+=e[a];s[c]/=(h-o)*i,c++,o=h}return s}else return e}static upsample(e,t,i=1){var s=function(n,g,d){return(n+(g-n)*d)*i},r=new Array(t),l=(e.length-1)/(t-1);r[0]=e[0];for(var o=1;o<t-1;o++){var c=o*l,u=Math.floor(c),h=Math.ceil(c),a=c-u;r[o]=s(e[u],e[h],a)}return r[t-1]=e[e.length-1],r}static interpolate(e,t,i=1){return e.length>t?p.downsample(e,t,i):e.length<t?p.upsample(e,t,i):e}static HSLToRGB(e,t,i,s=255){t/=100,i/=100;let r=(1-Math.abs(2*i-1))*t,l=r*(1-Math.abs(e/60%2-1)),o=i-r/2,c=0,u=0,h=0;return 0<=e&&e<60?(c=r,u=l,h=0):60<=e&&e<120?(c=l,u=r,h=0):120<=e&&e<180?(c=0,u=r,h=l):180<=e&&e<240?(c=0,u=l,h=r):240<=e&&e<300?(c=l,u=0,h=r):300<=e&&e<360&&(c=r,u=0,h=l),c=(c+o)*s,u=(u+o)*s,h=(h+o)*s,[c,u,h]}static circularBuffer(e,t){if(t.length<e.length){let i=e.slice(t.length),s=e.length;e.splice(0,s,...i,...t)}else if(t.length>e.length){let i=e.length;e.splice(0,i,...t.slice(t.length-i))}else e.splice(0,e.length,...t);return e}static formatDataForCharts(e,t){var i;if(Array.isArray(e)){if(Array.isArray(e[0])){let s={};if(e.forEach((r,l)=>{s[l]=r}),e=s,isNaN(e[0][0]))return}else if(t){if(e={[t]:e},isNaN(e[t][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let s in e)if(typeof e[s]=="number"?e[s]=[e[s]]:(i=e[s])!=null&&i.values&&typeof e[s].values=="number"&&(e[s].values=[e[s].values]),isNaN(e[s][0]))return}else if(typeof e=="string"){let s;if(e.includes(`\r
`)){let r=e.split(`\r
`);e={},r.forEach((l,o)=>{l.includes("	")?s=l.split("	"):l.includes(",")?s=l.split(","):l.includes("|")&&(s=l.split("|")),s&&s.forEach((c,u)=>{if(c.includes(":")){let[h,a]=c.split(":"),n=parseFloat(a);isNaN(n)||(e[h]=[n])}else{let h=parseFloat(c);isNaN(h)||(e[u]=[h])}})})}else e.includes("	")?s=e.split("	"):e.includes(",")?s=e.split(","):e.includes("|")&&(s=e.split("|"));e={},s&&s.forEach((r,l)=>{if(r.includes(":")){let[o,c]=r.split(":"),u=parseFloat(c);isNaN(u)||(e[o]=[u])}else{let o=parseFloat(r);isNaN(o)||(e[l]=[o])}})}else typeof e=="number"&&(t?e={[t]:[e]}:e={0:[e]});return e}static padTime(e,t,i,s){let r=(e[0]-t)/i/s;return[...new Array(s-e.length).map((l,o)=>t+r*(o+1)),...e]}static interpolateForTime(e,t,i){return p.interpolate(e,Math.ceil(i*t))}};if(typeof WorkerGlobalScope<"u"){globalThis.plotter=new p;const e={...ce};self.onmessage=t=>{t.data.route&&(Array.isArray(t.data.args)?e[t.data.route](...t.data.args):e[t.data.route](t.data.args))}}})();
