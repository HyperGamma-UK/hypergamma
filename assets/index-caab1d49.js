var Vs=Object.defineProperty;var Hs=(t,e,r)=>e in t?Vs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var j=(t,e,r)=>(Hs(t,typeof e!="symbol"?e+"":e,r),r),wt=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var C=(t,e,r)=>(wt(t,e,"read from private field"),r?r.call(t):e.get(t)),V=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},z=(t,e,r,s)=>(wt(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);var $e=(t,e,r)=>(wt(t,e,"access private method"),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const rt=window,tr=rt.ShadowRoot&&(rt.ShadyCSS===void 0||rt.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,rr=Symbol(),gr=new WeakMap;let Gr=class{constructor(e,r,s){if(this._$cssResult$=!0,s!==rr)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=r}get styleSheet(){let e=this.o;const r=this.t;if(tr&&e===void 0){const s=r!==void 0&&r.length===1;s&&(e=gr.get(r)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&gr.set(r,e))}return e}toString(){return this.cssText}};const Gs=t=>new Gr(typeof t=="string"?t:t+"",void 0,rr),Ce=(t,...e)=>{const r=t.length===1?t[0]:e.reduce((s,i,n)=>s+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[n+1],t[0]);return new Gr(r,t,rr)},Ws=(t,e)=>{tr?t.adoptedStyleSheets=e.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet):e.forEach(r=>{const s=document.createElement("style"),i=rt.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=r.cssText,t.appendChild(s)})},br=tr?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let r="";for(const s of e.cssRules)r+=s.cssText;return Gs(r)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var kt;const dt=window,yr=dt.trustedTypes,zs=yr?yr.emptyScript:"",_r=dt.reactiveElementPolyfillSupport,qt={toAttribute(t,e){switch(e){case Boolean:t=t?zs:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let r=t;switch(e){case Boolean:r=t!==null;break;case Number:r=t===null?null:Number(t);break;case Object:case Array:try{r=JSON.parse(t)}catch{r=null}}return r}},Wr=(t,e)=>e!==t&&(e==e||t==t),St={attribute:!0,type:String,converter:qt,reflect:!1,hasChanged:Wr};let ye=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var r;this.finalize(),((r=this.h)!==null&&r!==void 0?r:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach((r,s)=>{const i=this._$Ep(s,r);i!==void 0&&(this._$Ev.set(i,s),e.push(i))}),e}static createProperty(e,r=St){if(r.state&&(r.attribute=!1),this.finalize(),this.elementProperties.set(e,r),!r.noAccessor&&!this.prototype.hasOwnProperty(e)){const s=typeof e=="symbol"?Symbol():"__"+e,i=this.getPropertyDescriptor(e,s,r);i!==void 0&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,r,s){return{get(){return this[r]},set(i){const n=this[e];this[r]=i,this.requestUpdate(e,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||St}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),e.h!==void 0&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const r=this.properties,s=[...Object.getOwnPropertyNames(r),...Object.getOwnPropertySymbols(r)];for(const i of s)this.createProperty(i,r[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const r=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const i of s)r.unshift(br(i))}else e!==void 0&&r.push(br(e));return r}static _$Ep(e,r){const s=r.attribute;return s===!1?void 0:typeof s=="string"?s:typeof e=="string"?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise(r=>this.enableUpdating=r),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach(r=>r(this))}addController(e){var r,s;((r=this._$ES)!==null&&r!==void 0?r:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((s=e.hostConnected)===null||s===void 0||s.call(e))}removeController(e){var r;(r=this._$ES)===null||r===void 0||r.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((e,r)=>{this.hasOwnProperty(r)&&(this._$Ei.set(r,this[r]),delete this[r])})}createRenderRoot(){var e;const r=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return Ws(r,this.constructor.elementStyles),r}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach(r=>{var s;return(s=r.hostConnected)===null||s===void 0?void 0:s.call(r)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach(r=>{var s;return(s=r.hostDisconnected)===null||s===void 0?void 0:s.call(r)})}attributeChangedCallback(e,r,s){this._$AK(e,s)}_$EO(e,r,s=St){var i;const n=this.constructor._$Ep(e,s);if(n!==void 0&&s.reflect===!0){const a=(((i=s.converter)===null||i===void 0?void 0:i.toAttribute)!==void 0?s.converter:qt).toAttribute(r,s.type);this._$El=e,a==null?this.removeAttribute(n):this.setAttribute(n,a),this._$El=null}}_$AK(e,r){var s;const i=this.constructor,n=i._$Ev.get(e);if(n!==void 0&&this._$El!==n){const a=i.getPropertyOptions(n),o=typeof a.converter=="function"?{fromAttribute:a.converter}:((s=a.converter)===null||s===void 0?void 0:s.fromAttribute)!==void 0?a.converter:qt;this._$El=n,this[n]=o.fromAttribute(r,a.type),this._$El=null}}requestUpdate(e,r,s){let i=!0;e!==void 0&&(((s=s||this.constructor.getPropertyOptions(e)).hasChanged||Wr)(this[e],r)?(this._$AL.has(e)||this._$AL.set(e,r),s.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(r){Promise.reject(r)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((i,n)=>this[n]=i),this._$Ei=void 0);let r=!1;const s=this._$AL;try{r=this.shouldUpdate(s),r?(this.willUpdate(s),(e=this._$ES)===null||e===void 0||e.forEach(i=>{var n;return(n=i.hostUpdate)===null||n===void 0?void 0:n.call(i)}),this.update(s)):this._$Ek()}catch(i){throw r=!1,this._$Ek(),i}r&&this._$AE(s)}willUpdate(e){}_$AE(e){var r;(r=this._$ES)===null||r===void 0||r.forEach(s=>{var i;return(i=s.hostUpdated)===null||i===void 0?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach((r,s)=>this._$EO(s,this[s],r)),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};ye.finalized=!0,ye.elementProperties=new Map,ye.elementStyles=[],ye.shadowRootOptions={mode:"open"},_r==null||_r({ReactiveElement:ye}),((kt=dt.reactiveElementVersions)!==null&&kt!==void 0?kt:dt.reactiveElementVersions=[]).push("1.6.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var At;const ft=window,Oe=ft.trustedTypes,vr=Oe?Oe.createPolicy("lit-html",{createHTML:t=>t}):void 0,Vt="$lit$",ne=`lit$${(Math.random()+"").slice(9)}$`,zr="?"+ne,$s=`<${zr}>`,Ee=document,Fe=()=>Ee.createComment(""),Re=t=>t===null||typeof t!="object"&&typeof t!="function",$r=Array.isArray,Ys=t=>$r(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",xt=`[ 	
\f\r]`,Te=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,mr=/-->/g,wr=/>/g,ce=RegExp(`>|${xt}(?:([^\\s"'>=/]+)(${xt}*=${xt}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),kr=/'/g,Sr=/"/g,Yr=/^(?:script|style|textarea|title)$/i,Qs=t=>(e,...r)=>({_$litType$:t,strings:e,values:r}),E=Qs(1),ue=Symbol.for("lit-noChange"),P=Symbol.for("lit-nothing"),Ar=new WeakMap,we=Ee.createTreeWalker(Ee,129,null,!1),Ks=(t,e)=>{const r=t.length-1,s=[];let i,n=e===2?"<svg>":"",a=Te;for(let c=0;c<r;c++){const l=t[c];let d,u,f=-1,h=0;for(;h<l.length&&(a.lastIndex=h,u=a.exec(l),u!==null);)h=a.lastIndex,a===Te?u[1]==="!--"?a=mr:u[1]!==void 0?a=wr:u[2]!==void 0?(Yr.test(u[2])&&(i=RegExp("</"+u[2],"g")),a=ce):u[3]!==void 0&&(a=ce):a===ce?u[0]===">"?(a=i??Te,f=-1):u[1]===void 0?f=-2:(f=a.lastIndex-u[2].length,d=u[1],a=u[3]===void 0?ce:u[3]==='"'?Sr:kr):a===Sr||a===kr?a=ce:a===mr||a===wr?a=Te:(a=ce,i=void 0);const g=a===ce&&t[c+1].startsWith("/>")?" ":"";n+=a===Te?l+$s:f>=0?(s.push(d),l.slice(0,f)+Vt+l.slice(f)+ne+g):l+ne+(f===-2?(s.push(void 0),c):g)}const o=n+(t[r]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[vr!==void 0?vr.createHTML(o):o,s]};class Ue{constructor({strings:e,_$litType$:r},s){let i;this.parts=[];let n=0,a=0;const o=e.length-1,c=this.parts,[l,d]=Ks(e,r);if(this.el=Ue.createElement(l,s),we.currentNode=this.el.content,r===2){const u=this.el.content,f=u.firstChild;f.remove(),u.append(...f.childNodes)}for(;(i=we.nextNode())!==null&&c.length<o;){if(i.nodeType===1){if(i.hasAttributes()){const u=[];for(const f of i.getAttributeNames())if(f.endsWith(Vt)||f.startsWith(ne)){const h=d[a++];if(u.push(f),h!==void 0){const g=i.getAttribute(h.toLowerCase()+Vt).split(ne),b=/([.?@])?(.*)/.exec(h);c.push({type:1,index:n,name:b[2],strings:g,ctor:b[1]==="."?Zs:b[1]==="?"?ti:b[1]==="@"?ri:yt})}else c.push({type:6,index:n})}for(const f of u)i.removeAttribute(f)}if(Yr.test(i.tagName)){const u=i.textContent.split(ne),f=u.length-1;if(f>0){i.textContent=Oe?Oe.emptyScript:"";for(let h=0;h<f;h++)i.append(u[h],Fe()),we.nextNode(),c.push({type:2,index:++n});i.append(u[f],Fe())}}}else if(i.nodeType===8)if(i.data===zr)c.push({type:2,index:n});else{let u=-1;for(;(u=i.data.indexOf(ne,u+1))!==-1;)c.push({type:7,index:n}),u+=ne.length-1}n++}}static createElement(e,r){const s=Ee.createElement("template");return s.innerHTML=e,s}}function je(t,e,r=t,s){var i,n,a,o;if(e===ue)return e;let c=s!==void 0?(i=r._$Co)===null||i===void 0?void 0:i[s]:r._$Cl;const l=Re(e)?void 0:e._$litDirective$;return(c==null?void 0:c.constructor)!==l&&((n=c==null?void 0:c._$AO)===null||n===void 0||n.call(c,!1),l===void 0?c=void 0:(c=new l(t),c._$AT(t,r,s)),s!==void 0?((a=(o=r)._$Co)!==null&&a!==void 0?a:o._$Co=[])[s]=c:r._$Cl=c),c!==void 0&&(e=je(t,c._$AS(t,e.values),c,s)),e}class Xs{constructor(e,r){this.u=[],this._$AN=void 0,this._$AD=e,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(e){var r;const{el:{content:s},parts:i}=this._$AD,n=((r=e==null?void 0:e.creationScope)!==null&&r!==void 0?r:Ee).importNode(s,!0);we.currentNode=n;let a=we.nextNode(),o=0,c=0,l=i[0];for(;l!==void 0;){if(o===l.index){let d;l.type===2?d=new He(a,a.nextSibling,this,e):l.type===1?d=new l.ctor(a,l.name,l.strings,this,e):l.type===6&&(d=new si(a,this,e)),this.u.push(d),l=i[++c]}o!==(l==null?void 0:l.index)&&(a=we.nextNode(),o++)}return n}p(e){let r=0;for(const s of this.u)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,r),r+=s.strings.length-2):s._$AI(e[r])),r++}}class He{constructor(e,r,s,i){var n;this.type=2,this._$AH=P,this._$AN=void 0,this._$AA=e,this._$AB=r,this._$AM=s,this.options=i,this._$Cm=(n=i==null?void 0:i.isConnected)===null||n===void 0||n}get _$AU(){var e,r;return(r=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&r!==void 0?r:this._$Cm}get parentNode(){let e=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=r.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,r=this){e=je(this,e,r),Re(e)?e===P||e==null||e===""?(this._$AH!==P&&this._$AR(),this._$AH=P):e!==this._$AH&&e!==ue&&this.g(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):Ys(e)?this.k(e):this.g(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}g(e){this._$AH!==P&&Re(this._$AH)?this._$AA.nextSibling.data=e:this.T(Ee.createTextNode(e)),this._$AH=e}$(e){var r;const{values:s,_$litType$:i}=e,n=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=Ue.createElement(i.h,this.options)),i);if(((r=this._$AH)===null||r===void 0?void 0:r._$AD)===n)this._$AH.p(s);else{const a=new Xs(n,this),o=a.v(this.options);a.p(s),this.T(o),this._$AH=a}}_$AC(e){let r=Ar.get(e.strings);return r===void 0&&Ar.set(e.strings,r=new Ue(e)),r}k(e){$r(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let s,i=0;for(const n of e)i===r.length?r.push(s=new He(this.S(Fe()),this.S(Fe()),this,this.options)):s=r[i],s._$AI(n),i++;i<r.length&&(this._$AR(s&&s._$AB.nextSibling,i),r.length=i)}_$AR(e=this._$AA.nextSibling,r){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,r);e&&e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var r;this._$AM===void 0&&(this._$Cm=e,(r=this._$AP)===null||r===void 0||r.call(this,e))}}class yt{constructor(e,r,s,i,n){this.type=1,this._$AH=P,this._$AN=void 0,this.element=e,this.name=r,this._$AM=i,this.options=n,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=P}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,r=this,s,i){const n=this.strings;let a=!1;if(n===void 0)e=je(this,e,r,0),a=!Re(e)||e!==this._$AH&&e!==ue,a&&(this._$AH=e);else{const o=e;let c,l;for(e=n[0],c=0;c<n.length-1;c++)l=je(this,o[s+c],r,c),l===ue&&(l=this._$AH[c]),a||(a=!Re(l)||l!==this._$AH[c]),l===P?e=P:e!==P&&(e+=(l??"")+n[c+1]),this._$AH[c]=l}a&&!i&&this.j(e)}j(e){e===P?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Zs extends yt{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===P?void 0:e}}const ei=Oe?Oe.emptyScript:"";class ti extends yt{constructor(){super(...arguments),this.type=4}j(e){e&&e!==P?this.element.setAttribute(this.name,ei):this.element.removeAttribute(this.name)}}class ri extends yt{constructor(e,r,s,i,n){super(e,r,s,i,n),this.type=5}_$AI(e,r=this){var s;if((e=(s=je(this,e,r,0))!==null&&s!==void 0?s:P)===ue)return;const i=this._$AH,n=e===P&&i!==P||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,a=e!==P&&(i===P||n);n&&this.element.removeEventListener(this.name,this,i),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var r,s;typeof this._$AH=="function"?this._$AH.call((s=(r=this.options)===null||r===void 0?void 0:r.host)!==null&&s!==void 0?s:this.element,e):this._$AH.handleEvent(e)}}let si=class{constructor(e,r,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=r,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){je(this,e)}};const xr=ft.litHtmlPolyfillSupport;xr==null||xr(Ue,He),((At=ft.litHtmlVersions)!==null&&At!==void 0?At:ft.litHtmlVersions=[]).push("2.7.0");const ii=(t,e,r)=>{var s,i;const n=(s=r==null?void 0:r.renderBefore)!==null&&s!==void 0?s:e;let a=n._$litPart$;if(a===void 0){const o=(i=r==null?void 0:r.renderBefore)!==null&&i!==void 0?i:null;n._$litPart$=a=new He(e.insertBefore(Fe(),o),o,void 0,r??{})}return a._$AI(t),a};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Ot,Et;class K extends ye{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,r;const s=super.createRenderRoot();return(e=(r=this.renderOptions).renderBefore)!==null&&e!==void 0||(r.renderBefore=s.firstChild),s}update(e){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=ii(r,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return ue}}K.finalized=!0,K._$litElement$=!0,(Ot=globalThis.litElementHydrateSupport)===null||Ot===void 0||Ot.call(globalThis,{LitElement:K});const Or=globalThis.litElementPolyfillSupport;Or==null||Or({LitElement:K});((Et=globalThis.litElementVersions)!==null&&Et!==void 0?Et:globalThis.litElementVersions=[]).push("3.3.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ni={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},ai=t=>(...e)=>({_$litDirective$:t,values:e});let oi=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,r,s){this._$Ct=e,this._$AM=r,this._$Ci=s}_$AS(e,r){return this.update(e,r)}update(e,r){return this.render(...r)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ci=ai(class extends oi{constructor(t){var e;if(super(t),t.type!==ni.ATTRIBUTE||t.name!=="style"||((e=t.strings)===null||e===void 0?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,r)=>{const s=t[r];return s==null?e:e+`${r=r.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`},"")}update(t,[e]){const{style:r}=t.element;if(this.vt===void 0){this.vt=new Set;for(const s in e)this.vt.add(s);return this.render(e)}this.vt.forEach(s=>{e[s]==null&&(this.vt.delete(s),s.includes("-")?r.removeProperty(s):r[s]="")});for(const s in e){const i=e[s];i!=null&&(this.vt.add(s),s.includes("-")?r.setProperty(s,i):r[s]=i)}return ue}});class li extends K{constructor({primary:e,label:r,backgroundColor:s=null,size:i,onClick:n}={}){super(),this.label=r,this.primary=e,this.backgroundColor=s,this.size=i,this.onClick=n}static get styles(){return Ce`
    :host {
      display: inline-block;
    }

    .storybook-button {
      font-family: 'Nunito Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-weight: 700;
      border: 0;
      border-radius: 5px;
      cursor: pointer;
      display: inline-block;
      line-height: 1;
    }
    .storybook-button--primary {
      color: white;
      background-color: hsl(190, 60%, 36%);
    }
    .storybook-button--secondary {
      color: #333;
      background-color: transparent;
      box-shadow: rgba(0, 0, 0, 0.15) 0px 0px 0px 1px inset;
    }
    .storybook-button--small {
      font-size: 12px;
      padding: 10px 16px;
    }
    .storybook-button--medium {
      font-size: 14px;
      padding: 11px 20px;
    }
    .storybook-button--large {
      font-size: 16px;
      padding: 12px 24px;
    }
`}static get properties(){return{primary:{type:Boolean},backgroundColor:{type:String},size:{type:String},onClick:{type:Function},label:{type:String}}}render(){const e=this.primary?"storybook-button--primary":"storybook-button--secondary";return E`
      <button
        type="button"
        class=${["storybook-button",`storybook-button--${this.size||"medium"}`,e].join(" ")}
        style=${ci({backgroundColor:this.backgroundColor})}
        @click=${this.onClick}
      >
        <slot>${this.label??""}</slot>
      </button>
    `}}customElements.get("hypergamma-button")||customElements.define("hypergamma-button",li);let pe={},Ht={};const Gt=Symbol("infoSubscribeSymbol"),di=(t,e)=>{const r=Math.random().toString(36).substring(2,15);typeof t=="function"?(e=t,t=[Gt]):t=[t];let s=pe;return t.forEach(i=>{s[i]||(s[i]={}),s=s[i]}),s[r]=e,Ht[r]={target:t,callback:e},r},fi=t=>{const{target:e}=Ht[t];let r=pe;e.forEach(i=>{r[i]||(r[i]={}),r=r[i]}),delete r[t],delete Ht[t];let s=pe;e.forEach(i=>{Object.keys(s[i]).length===0&&delete s[i]})};let Qr=(t,e=[])=>{for(let r in t){const s=[...e,r].join(".");typeof t[r]=="object"&&Qr(t[r],[...e,r]),pe[s]&&Object.values(pe[s]).forEach(i=>i(t[r]))}};const jt=t=>{t&&(Qr(t),pe[Gt]&&Object.values(pe[Gt]).forEach(e=>e(t)))};var ke;class G extends K{constructor(r={}){super();j(this,"info",{globalState:{}});j(this,"subscriptions",{});V(this,ke,[]);j(this,"subscribe",(r,s)=>{const i=di(r,s);C(this,ke).push(i)});j(this,"query",r=>this.shadowRoot.querySelector(r));j(this,"onSet",()=>{});j(this,"set",r=>{r&&(Object.assign(this.info,r),this.onSet(),this.requestUpdate())});j(this,"onTransition",()=>{});Object.assign(this.info,r)}static get styles(){return Ce`
      section {
        width: 100%;
        height: 100%;
      }
    `}disconnectedCallback(){super.connectedCallback(),C(this,ke).forEach(r=>fi(r)),z(this,ke,[])}render(){return E`
    <section><slot></slot></section>
    `}}ke=new WeakMap;customElements.get("hypergamma-page")||customElements.define("hypergamma-page",G);class Kr extends G{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)})}render(){return E`
    <h1>Home</h1>
    <p id="readout">No device connected</p>
    `}}customElements.get("hypergamma-home-page")||customElements.define("hypergamma-home-page",Kr);class Xr extends G{constructor(...e){super(...e)}render(){return E`
      <h1>Hyper+</h1>
      <div>
        <hypergamma-button @click=${()=>this.onTransition("plus/focus")}>Focus</hypergamma-button>
        <hypergamma-button @click=${()=>this.onTransition("plus/training")}>Training</hypergamma-button>
        <hypergamma-button @click=${()=>this.onTransition("plus/performance")}>Peformance</hypergamma-button>
        <hypergamma-button @click=${()=>this.onTransition("plus/meditation")}>Meditation</hypergamma-button>
    `}}customElements.get("hypergamma-hyperplus-page")||customElements.define("hypergamma-hyperplus-page",Xr);var ui=Object.create,sr=Object.defineProperty,pi=Object.getOwnPropertyDescriptor,ir=Object.getOwnPropertyNames,hi=Object.getPrototypeOf,gi=Object.prototype.hasOwnProperty,he=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')}),_t=(t,e)=>function(){return t&&(e=(0,t[ir(t)[0]])(t=0)),e},bi=(t,e)=>function(){return e||(0,t[ir(t)[0]])((e={exports:{}}).exports,e),e.exports},yi=(t,e)=>{for(var r in e)sr(t,r,{get:e[r],enumerable:!0})},_i=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ir(e))!gi.call(t,i)&&i!==r&&sr(t,i,{get:()=>e[i],enumerable:!(s=pi(e,i))||s.enumerable});return t},vi=(t,e,r)=>(r=t!=null?ui(hi(t)):{},_i(e||!t||!t.__esModule?sr(r,"default",{value:t,enumerable:!0}):r,t)),Er,jr,Nt,ge,Ye,Nr,Cr,Tr,ae,Zr,es,nr=_t({"src/ble/node_modules/@capacitor/core/dist/index.js"(){Er=t=>{const e=new Map;e.set("web",{name:"web"});const r=t.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},s=(n,a)=>{r.platforms.set(n,a)},i=n=>{r.platforms.has(n)&&(r.currentPlatform=r.platforms.get(n))};return r.addPlatform=s,r.setPlatform=i,r},jr=t=>t.CapacitorPlatforms=Er(t),Nt=jr(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Nt.addPlatform,Nt.setPlatform,function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"}(ge||(ge={})),Ye=class extends Error{constructor(t,e,r){super(t),this.message=t,this.code=e,this.data=r}},Nr=t=>{var e,r;return t!=null&&t.androidBridge?"android":!((r=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},Cr=t=>{var e,r,s,i,n;const a=t.CapacitorCustomPlatform||null,o=t.Capacitor||{},c=o.Plugins=o.Plugins||{},l=t.CapacitorPlatforms,d=()=>a!==null?a.name:Nr(t),u=((e=l==null?void 0:l.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||d,f=()=>u()!=="web",h=((r=l==null?void 0:l.currentPlatform)===null||r===void 0?void 0:r.isNativePlatform)||f,g=x=>{const O=N.get(x);return!!(O!=null&&O.platforms.has(u())||_(x))},b=((s=l==null?void 0:l.currentPlatform)===null||s===void 0?void 0:s.isPluginAvailable)||g,y=x=>{var O;return(O=o.PluginHeaders)===null||O===void 0?void 0:O.find(R=>R.name===x)},_=((i=l==null?void 0:l.currentPlatform)===null||i===void 0?void 0:i.getPluginHeader)||y,m=x=>t.console.error(x),S=(x,O,R)=>Promise.reject(`${R} does not have an implementation of "${O}".`),N=new Map,I=(x,O={})=>{const R=N.get(x);if(R)return console.warn(`Capacitor plugin "${x}" already registered. Cannot register plugins twice.`),R.proxy;const U=u(),w=_(x);let J;const Rs=async()=>(!J&&U in O?J=typeof O[U]=="function"?J=await O[U]():J=O[U]:a!==null&&!J&&"web"in O&&(J=typeof O.web=="function"?J=await O.web():J=O.web),J),Us=(B,D)=>{var W,X;if(w){const Z=w==null?void 0:w.methods.find(q=>D===q.name);if(Z)return Z.rtype==="promise"?q=>o.nativePromise(x,D.toString(),q):(q,We)=>o.nativeCallback(x,D.toString(),q,We);if(B)return(W=B[D])===null||W===void 0?void 0:W.bind(B)}else{if(B)return(X=B[D])===null||X===void 0?void 0:X.bind(B);throw new Ye(`"${x}" plugin is not implemented on ${U}`,ge.Unimplemented)}},vt=B=>{let D;const W=(...X)=>{const Z=Rs().then(q=>{const We=Us(q,B);if(We){const ze=We(...X);return D=ze==null?void 0:ze.remove,ze}else throw new Ye(`"${x}.${B}()" is not implemented on ${U}`,ge.Unimplemented)});return B==="addListener"&&(Z.remove=async()=>D()),Z};return W.toString=()=>`${B.toString()}() { [capacitor code] }`,Object.defineProperty(W,"name",{value:B,writable:!1,configurable:!1}),W},pr=vt("addListener"),hr=vt("removeListener"),qs=(B,D)=>{const W=pr({eventName:B},D),X=async()=>{const q=await W;hr({eventName:B,callbackId:q},D)},Z=new Promise(q=>W.then(()=>q({remove:X})));return Z.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await X()},Z},mt=new Proxy({},{get(B,D){switch(D){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return w?qs:pr;case"removeListener":return hr;default:return vt(D)}}});return c[x]=mt,N.set(x,{name:x,proxy:mt,platforms:new Set([...Object.keys(O),...w?[U]:[]])}),mt},F=((n=l==null?void 0:l.currentPlatform)===null||n===void 0?void 0:n.registerPlugin)||I;return o.convertFileSrc||(o.convertFileSrc=x=>x),o.getPlatform=u,o.handleError=m,o.isNativePlatform=h,o.isPluginAvailable=b,o.pluginMethodNoop=S,o.registerPlugin=F,o.Exception=Ye,o.DEBUG=!!o.DEBUG,o.isLoggingEnabled=!!o.isLoggingEnabled,o.platform=o.getPlatform(),o.isNative=o.isNativePlatform(),o},Tr=t=>t.Capacitor=Cr(t),ae=Tr(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Zr=ae.registerPlugin,ae.Plugins,es=class{constructor(t){this.listeners={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e);const s=this.windowListeners[t];s&&!s.registered&&this.addWindowListener(s);const i=async()=>this.removeListener(t,e),n=Promise.resolve({remove:i});return Object.defineProperty(n,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await i()}}),n}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,e){const r=this.listeners[t];r&&r.forEach(s=>s(e))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,e){this.windowListeners[e]={registered:!1,windowEventName:t,pluginEventName:e,handler:r=>{this.notifyListeners(e,r)}}}unimplemented(t="not implemented"){return new ae.Exception(t,ge.Unimplemented)}unavailable(t="not available"){return new ae.Exception(t,ge.Unavailable)}async removeListener(t,e){const r=this.listeners[t];if(!r)return;const s=r.indexOf(e);this.listeners[t].splice(s,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}}}});function mi(t){return new DataView(Uint8Array.from(t).buffer)}function wi(t){return Array.from(new Uint8Array(t.buffer))}function ki(t){return`0000${t.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}function st(t){const e=t.trim().split(" ").filter(r=>r!=="").map(r=>parseInt(r,16));return mi(e)}function Ct(t){return wi(t).map(e=>{let r=e.toString(16);return r.length==1&&(r="0"+r),r}).join(" ")}function Si(t){if(typeof t=="string")return t;if(typeof t=="number")return ki(t);throw new Error("Invalid UUID")}function Pr(t){const e={};if(t)return t.forEach((r,s)=>{e[s.toString()]=r}),e}var ar=_t({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js"(){}});async function Ai(t,e,r){let s;return Promise.race([t,new Promise((i,n)=>{s=setTimeout(()=>n(r),e)})]).finally(()=>clearTimeout(s))}var xi=_t({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/timeout.js"(){}}),ts={};yi(ts,{BluetoothLeWeb:()=>rs});var rs,Oi=_t({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/web.js"(){nr(),ar(),xi(),rs=class extends es{constructor(){super(...arguments),this.deviceMap=new Map,this.discoveredDevices=new Map,this.scan=null,this.DEFAULT_CONNECTION_TIMEOUT=1e4,this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this),this.onDisconnectedCallback=this.onDisconnected.bind(this),this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}async initialize(){if(typeof navigator>"u"||!navigator.bluetooth)throw this.unavailable("Web Bluetooth API not available in this browser.");if(!await navigator.bluetooth.getAvailability())throw this.unavailable("No Bluetooth radio available.")}async isEnabled(){return{value:!0}}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(t){const e=this.getFilters(t),r=await navigator.bluetooth.requestDevice({filters:e.length?e:void 0,optionalServices:t==null?void 0:t.optionalServices,acceptAllDevices:e.length===0});return this.deviceMap.set(r.id,r),this.getBleDevice(r)}async requestLEScan(t){this.requestBleDeviceOptions=t;const e=this.getFilters(t);await this.stopLEScan(),this.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),this.scan=await navigator.bluetooth.requestLEScan({filters:e.length?e:void 0,acceptAllAdvertisements:e.length===0,keepRepeatedDevices:t==null?void 0:t.allowDuplicates})}onAdvertisementReceived(t){var e,r;const s=t.device.id;if(this.deviceMap.set(s,t.device),!this.discoveredDevices.has(s)||!((e=this.requestBleDeviceOptions)===null||e===void 0)&&e.allowDuplicates){this.discoveredDevices.set(s,!0);const n=this.getBleDevice(t.device),a={device:n,localName:n.name,rssi:t.rssi,txPower:t.txPower,manufacturerData:Pr(t.manufacturerData),serviceData:Pr(t.serviceData),uuids:(r=t.uuids)===null||r===void 0?void 0:r.map(Si)};this.notifyListeners("onScanResult",a)}}async stopLEScan(){var t;!((t=this.scan)===null||t===void 0)&&t.active&&this.scan.stop(),this.scan=null}async getDevices(t){return{devices:(await navigator.bluetooth.getDevices()).map(s=>(this.deviceMap.set(s.id,s),this.getBleDevice(s)))}}async getConnectedDevices(t){return{devices:(await navigator.bluetooth.getDevices()).filter(s=>{var i;return(i=s.gatt)===null||i===void 0?void 0:i.connected}).map(s=>(this.deviceMap.set(s.id,s),this.getBleDevice(s)))}}async connect(t){var e,r;const s=this.getDeviceFromMap(t.deviceId);s.removeEventListener("gattserverdisconnected",this.onDisconnectedCallback),s.addEventListener("gattserverdisconnected",this.onDisconnectedCallback);const i=Symbol();if(s.gatt===void 0)throw new Error("No gatt server available.");try{const n=(e=t.timeout)!==null&&e!==void 0?e:this.DEFAULT_CONNECTION_TIMEOUT;await Ai(s.gatt.connect(),n,i)}catch(n){throw await((r=s.gatt)===null||r===void 0?void 0:r.disconnect()),n===i?new Error("Connection timeout"):n}}onDisconnected(t){const r=`disconnected|${t.target.id}`;this.notifyListeners(r,null)}async createBond(t){throw this.unavailable("createBond is not available on web.")}async isBonded(t){throw this.unavailable("isBonded is not available on web.")}async disconnect(t){var e;(e=this.getDeviceFromMap(t.deviceId).gatt)===null||e===void 0||e.disconnect()}async getServices(t){var e,r;const s=(r=await((e=this.getDeviceFromMap(t.deviceId).gatt)===null||e===void 0?void 0:e.getPrimaryServices()))!==null&&r!==void 0?r:[],i=[];for(const n of s){const a=await n.getCharacteristics(),o=[];for(const c of a)o.push({uuid:c.uuid,properties:this.getProperties(c),descriptors:await this.getDescriptors(c)});i.push({uuid:n.uuid,characteristics:o})}return{services:i}}async getDescriptors(t){try{return(await t.getDescriptors()).map(r=>({uuid:r.uuid}))}catch{return[]}}getProperties(t){return{broadcast:t.properties.broadcast,read:t.properties.read,writeWithoutResponse:t.properties.writeWithoutResponse,write:t.properties.write,notify:t.properties.notify,indicate:t.properties.indicate,authenticatedSignedWrites:t.properties.authenticatedSignedWrites,reliableWrite:t.properties.reliableWrite,writableAuxiliaries:t.properties.writableAuxiliaries}}async getCharacteristic(t){var e;const r=await((e=this.getDeviceFromMap(t.deviceId).gatt)===null||e===void 0?void 0:e.getPrimaryService(t==null?void 0:t.service));return r==null?void 0:r.getCharacteristic(t==null?void 0:t.characteristic)}async getDescriptor(t){const e=await this.getCharacteristic(t);return e==null?void 0:e.getDescriptor(t==null?void 0:t.descriptor)}async discoverServices(t){throw this.unavailable("discoverServices is not available on web.")}async readRssi(t){throw this.unavailable("readRssi is not available on web.")}async read(t){const e=await this.getCharacteristic(t);return{value:await(e==null?void 0:e.readValue())}}async write(t){const e=await this.getCharacteristic(t);let r;typeof t.value=="string"?r=st(t.value):r=t.value,await(e==null?void 0:e.writeValueWithResponse(r))}async writeWithoutResponse(t){const e=await this.getCharacteristic(t);let r;typeof t.value=="string"?r=st(t.value):r=t.value,await(e==null?void 0:e.writeValueWithoutResponse(r))}async readDescriptor(t){const e=await this.getDescriptor(t);return{value:await(e==null?void 0:e.readValue())}}async writeDescriptor(t){const e=await this.getDescriptor(t);let r;typeof t.value=="string"?r=st(t.value):r=t.value,await(e==null?void 0:e.writeValue(r))}async startNotifications(t){const e=await this.getCharacteristic(t);e==null||e.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),e==null||e.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),await(e==null?void 0:e.startNotifications())}onCharacteristicValueChanged(t){var e,r;const s=t.target,i=`notification|${(e=s.service)===null||e===void 0?void 0:e.device.id}|${(r=s.service)===null||r===void 0?void 0:r.uuid}|${s.uuid}`;this.notifyListeners(i,{value:s.value})}async stopNotifications(t){const e=await this.getCharacteristic(t);await(e==null?void 0:e.stopNotifications())}getFilters(t){var e;const r=[];for(const s of(e=t==null?void 0:t.services)!==null&&e!==void 0?e:[])r.push({services:[s],name:t==null?void 0:t.name,namePrefix:t==null?void 0:t.namePrefix});return(t!=null&&t.name||t!=null&&t.namePrefix)&&r.length===0&&r.push({name:t.name,namePrefix:t.namePrefix}),console.log(r),r}getDeviceFromMap(t){const e=this.deviceMap.get(t);if(e===void 0)throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return e}getBleDevice(t){var e;return{deviceId:t.id,name:(e=t.name)!==null&&e!==void 0?e:void 0}}}}}),Ei=bi({"src/ble/node_modules/throat/index.js"(t,e){function r(c){var l=new o,d=c|0;function u(y,_,m){return d|0?(d=(d|0)-1,new Promise(function(S){S(y.apply(_,m))}).then(h,g)):new Promise(function(S){l.push(new n(S,y,_,m))}).then(f)}function f(y){try{return Promise.resolve(y.fn.apply(y.self,y.args)).then(h,g)}catch(_){g(_)}}function h(y){return b(),y}function g(y){throw b(),y}function b(){var y=l.shift();y?y.resolve(y):d=(d|0)+1}return u}function s(c,l){const d=r(c|0);return function(){for(var u=new Array(arguments.length),f=0;f<arguments.length;f++)u[f]=arguments[f];return d(l,this,u)}}function i(c){const l=r(c|0);return function(d){if(typeof d!="function")throw new TypeError("Expected throat fn to be a function but got "+typeof d);for(var u=new Array(arguments.length-1),f=1;f<arguments.length;f++)u[f-1]=arguments[f];return l(d,this,u)}}e.exports=function(l,d){if(typeof l=="function"){var u=d;d=l,l=u}if(typeof l!="number")throw new TypeError("Expected throat size to be a number but got "+typeof l);if(d!==void 0&&typeof d!="function")throw new TypeError("Expected throat fn to be a function but got "+typeof d);return typeof d=="function"?s(l|0,d):i(l|0)},e.exports.default=e.exports;function n(c,l,d,u){this.resolve=c,this.fn=l,this.self=d||null,this.args=u}var a=64;function o(){this._s1=[],this._s2=[],this._shiftBlock=this._pushBlock=new Array(a),this._pushIndex=0,this._shiftIndex=0}o.prototype.push=function(c){this._pushIndex===a&&(this._pushIndex=0,this._s1[this._s1.length]=this._pushBlock=new Array(a)),this._pushBlock[this._pushIndex++]=c},o.prototype.shift=function(){if(this._shiftIndex===a){this._shiftIndex=0;var c=this._s2;if(c.length===0){var l=this._s1;if(l.length===0)return;this._s1=c,c=this._s2=l.reverse()}this._shiftBlock=c.pop()}if(!(this._pushBlock===this._shiftBlock&&this._pushIndex===this._shiftIndex)){var d=this._shiftBlock[this._shiftIndex];return this._shiftBlock[this._shiftIndex++]=null,d}}}}),ji=Object.create,ss=Object.defineProperty,Ni=Object.getOwnPropertyDescriptor,is=Object.getOwnPropertyNames,Ci=Object.getPrototypeOf,Ti=Object.prototype.hasOwnProperty,Pi=(t=>typeof he<"u"?he:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof he<"u"?he:e)[r]}):t)(function(t){if(typeof he<"u")return he.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')}),Ii=(t,e)=>function(){return e||(0,t[is(t)[0]])((e={exports:{}}).exports,e),e.exports},Bi=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of is(e))!Ti.call(t,i)&&i!==r&&ss(t,i,{get:()=>e[i],enumerable:!(s=Ni(e,i))||s.enumerable});return t},Li=(t,e,r)=>(r=t!=null?ji(Ci(t)):{},Bi(e||!t||!t.__esModule?ss(r,"default",{value:t,enumerable:!0}):r,t)),Mi=Ii({"node_modules/web-worker/cjs/browser.js"(t,e){e.exports=Worker}}),Ji=class{constructor(t){this.pushToState={},this.data={},this.triggers={},this.setState=e=>{Object.assign(this.data,e);let r=Object.getOwnPropertyNames(e);for(const s of r)this.triggerEvent(s,this.data[s]);return this.data},this.setValue=(e,r)=>{this.data[e]=r,this.triggerEvent(e,r)},this.triggerEvent=(e,r)=>{if(this.triggers[e]){let s=i=>i.onchange(r);this.triggers[e].forEach(s)}},this.subscribeEvent=(e,r,s,i)=>{if(e){s&&i&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>s[i],set:a=>{s[i]=a},enumerable:!0,configurable:!0}),this.triggers[e]||(this.triggers[e]=[]);let n=this.triggers[e].length;return this.triggers[e].push({sub:n,onchange:r}),this.triggers[e].length-1}else return},this.unsubscribeEvent=(e,r)=>{let s=this.triggers[e];if(s)if(!r)delete this.triggers[e],delete this.data[e];else{let i,n=s.find((a,o)=>{if(a.sub===i)return i=o,!0});return n&&s.splice(i,1),Object.keys(s).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(n),!0}},this.subscribeEventOnce=(e,r)=>{let s,i=n=>{r(n),this.unsubscribeEvent(e,s)};s=this.subscribeEvent(e,i)},this.getEvent=(e,r)=>{for(const s in this.triggers[e])if(this.triggers[e][s].sub===r)return this.triggers[e][s]},this.getSnapshot=()=>{for(const e in this.data)this.data[e]},typeof t=="object"&&(this.data=t)}},ns=new Ji,A=class{constructor(t,e,r){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:ns},this.__setProperties=(s,i,n)=>{if((()=>{let o=s;typeof s=="function"?zt(s)?s=new s:s={__operator:s,__node:{forward:!0,tag:s.name}}:typeof s=="string"&&n!=null&&n.get(s)&&(s=n.get(s)),s.__node.initial||(s.__node.initial=o)})(),typeof s=="object"){let o=()=>{var b;(b=s.__node)!=null&&b.state&&(this.__node.state=s.__node.state)},c=()=>{s.__props&&(typeof s.__props=="function"&&(s.__props=new s.__props),typeof s.__props=="object"&&this.__proxyObject(s.__props))},l=()=>{var b;s.__node.tag||((b=s.__operator)!=null&&b.name?s.__node.tag=s.__operator.name:s.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},d=()=>{typeof s.__node=="string"?n!=null&&n.get(s.__node.tag)?s=n.get(s.__node.tag):s.__node={}:s.__node||(s.__node={}),n&&(s.__node.graph=n),s instanceof de&&(s.__node.source=s)},u=()=>{if(!s.__parent&&i&&(s.__parent=i),i!=null&&i.__node&&!(i instanceof de||s instanceof de)&&(s.__node.tag=i.__node.tag+"."+s.__node.tag),i instanceof de&&s instanceof de&&(s.__node.loaders&&Object.assign(i.__node.loaders?i.__node.loaders:{},s.__node.loaders),i.__node.mapGraphs)){s.__node.nodes.forEach(y=>{i.set(s.__node.tag+"."+y.__node.tag,y)});let b=()=>{s.__node.nodes.forEach(y=>{i.__node.nodes.delete(s.__node.tag+"."+y.__node.tag)})};this.__addOndisconnected(b)}},f=()=>{if(typeof s.default=="function"&&!s.__operator&&(s.__operator=s.default),s.__operator){if(typeof s.__operator=="string"&&n){let b=n.get(s.__operator);b&&(s.__operator=b.__operator),!s.__node.tag&&s.__operator.name&&(s.__node.tag=s.__operator.name)}typeof s.__operator=="function"&&(s.__operator=this.__setOperator(s.__operator)),s.default&&(s.default=s.__operator)}},h=()=>{s.__node=Object.assign(this.__node,s.__node);let b=Object.getOwnPropertyNames(s);for(const y of b)this[y]=s[y]},g=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(b=>b.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(b=>b.bind(this))))};o(),l(),c(),d(),u(),h(),g(),f()}},this.__subscribe=(s,i,n,a,o)=>{var d,u,f;const c=(h,g=(y,_)=>y,b=s)=>{let y=this.__node.state.subscribeEvent(h,b,this,i),_=this.__node.state.getEvent(h,y);return _.source=this.__node.tag,i&&(_.key=i),_.target=g(s),a&&(_.bound=a),y},l=h=>{if(!this.__node.graph.get(h)&&h.includes(".")){let b=this.__node.graph.get(h.substring(0,h.lastIndexOf("."))),y=h.substring(h.lastIndexOf(".")+1);b&&typeof b[y]=="function"&&(h=(..._)=>b[y](..._))}};if(i){if((!this.__node.localState||!this.__node.localState[i])&&this.__addLocalState(this,i),typeof s=="string"){if(o){if((d=this.__node.graph)!=null&&d.get(o)){let b=(u=this.__node.graph)==null?void 0:u.get(o);if(typeof b[s]=="function"){let y=b[s];s=(..._)=>{y(..._)}}else{let y=s;s=m=>{b[y]=m}}}}else if(typeof this[s]=="function"){let b=this[s];s=(...y)=>{b(...y)}}else(f=this.__node.graph)!=null&&f.get(s)&&l(s);if(typeof s!="function")return}let h,g=n?this.__node.unique+"."+i+"input":this.__node.unique+"."+i;return typeof s=="function"?h=c(g):s!=null&&s.__node&&(h=c(g,(b,y)=>y||b.__node.unique,(...b)=>{s.__operator&&s.__operator(...b)})),h}else{if(typeof s=="string"&&(this.__node.graph.get(s)&&(s=this.__node.graph.get(s)),typeof s!="object"))return;let h,g=n?this.__node.unique+"input":this.__node.unique;return typeof s=="function"?h=c(g):s!=null&&s.__node&&(h=c(g,(b,y)=>y||b.__node.unique,(...b)=>{s.__operator&&s.__operator(...b)})),h}},this.__unsubscribe=(s,i,n)=>i?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+i+"input":this.__node.unique+"."+i,s):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,s),this.__setOperator=s=>{s=s.bind(this),this.__args&&this.__node.graph&&(s=or(s,this.__args,this.__node.graph));let i=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[i]&&this.__node.state.setValue(i,n);let a=s(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof(a==null?void 0:a.then)=="function"?a.then(o=>{o!==void 0&&this.__node.state.setValue(this.__node.unique,o)}).catch(console.error):a!==void 0&&this.__node.state.setValue(this.__node.unique,a)),a},this.__parent instanceof A&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),a=()=>{var o;(o=this.__parent)==null||o.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(a),this.__subscribedToParent=!0}return this.__operator},this.__addLocalState=(s,i)=>{if(!s)return;this.__node.localState||(this.__node.localState={});const n=this.__node.localState,a=(o,c)=>{var u;let l=this.__node.unique+"."+c,d=`${l}input`;if(typeof o[c]=="function"&&c!=="__operator"){let f=o[c].bind(this);o[c]=(...h)=>{this.__node.state.triggers[d]&&this.__node.state.setValue(d,h);let g=f(...h);return this.__node.state.triggers[l]&&(typeof(g==null?void 0:g.then)=="function"?g.then(b=>{this.__node.state.triggerEvent(l,b)}).catch(console.error):this.__node.state.triggerEvent(l,g)),g}}else{let f,h;(u=this.__props)!=null&&u[c]?(f=()=>this.__props[c],h=b=>{this.__props[c]=b,this.__node.state.triggers[l]&&this.__node.state.triggerEvent(l,b)}):(n[c]=o[c],f=()=>n[c],h=b=>{n[c]=b,this.__node.state.triggers[l]&&this.__node.state.triggerEvent(l,b)});const g={get:f,set:h,enumerable:!0,configurable:!0};if(Object.defineProperty(o,c,g),typeof this.__node.initial=="object"){let b=Object.getOwnPropertyDescriptor(this.__node.initial,c);(b===void 0||b!=null&&b.configurable)&&Object.defineProperty(this.__node.initial,c,g)}}};if(i)a(s,i);else for(let o in s)a(s,o)},this.__proxyObject=s=>{const i=Di(s);for(const n of i)if(typeof s[n]=="function")this[n]=(...a)=>s[n](...a);else{const a={get:()=>s[n],set:o=>{s[n]=o},enumerable:!0,configurable:!0};if(Object.defineProperty(this,n,a),typeof this.__node.initial=="object"){let o=Object.getOwnPropertyDescriptor(this.__node.initial,n);(o===void 0||o!=null&&o.configurable)&&Object.defineProperty(this.__node.initial,n,a)}}},this.__setProperties(t,e,r)}__addOnconnected(t){t=t.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(t):typeof this.__onconnected=="function"?this.__onconnected=[t,this.__onconnected]:this.__onconnected=t}__addOndisconnected(t){t=t.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(t):typeof this.__ondisconnected=="function"?this.__ondisconnected=[t,this.__ondisconnected]:this.__ondisconnected=t}__callConnected(t=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let e=r=>{r(this)};this.__onconnected.forEach(e)}}__callDisconnected(t=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let e=r=>{r(this)};this.__ondisconnected.forEach(e)}}},de=class{constructor(t){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:ns,roots:{}},this.init=e=>{if(e){let r=Object.assign({},e);delete r.roots,Wt(this.__node,r),e.roots&&this.load(e.roots)}},this.load=e=>{function r(n,a,o=!0,c=!0){var l,d;if(c&&(n?Object.assign(n,a):n=Object.assign({},a),r(n,a,!0,!1)),a.__children&&!o)((l=a.__children)==null?void 0:l.constructor.name)==="Object"?((d=n.__children)==null?void 0:d.constructor.name)==="Object"?r(n.__children,a.__children,!0,!1):n.__children=r({},a.__children,!0,!1):n.__children=a.__children;else if(o)for(const u in a)n[u]=Object.assign({},a[u]),a[u].__children&&r({},a[u].__children,!1,!1);return n}this.__node.roots=r(this.__node.roots?this.__node.roots:{},e);let s=Object.assign({},e);s.__node&&delete s.__node;let i=this.recursiveSet(s,this,void 0,e);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let n=new A(e,this,this);this.set(n.__node.tag,n),this.runLoaders(n,this,e,e.__node.tag),n.__listeners&&(i[n.__node.tag]=n.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(i),s},this.setLoaders=(e,r)=>(r?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders),this.runLoaders=(e,r,s,i)=>{for(const n in this.__node.loaders)typeof this.__node.loaders[n]=="object"?(this.__node.loaders[n].init&&this.__node.loaders[n](e,r,this,this.__node.roots,s,i),this.__node.loaders[n].connected&&e.__addOnconnected(this.__node.loaders[n].connect),this.__node.loaders[n].disconnected&&e.__addOndisconnected(this.__node.loaders[n].disconnect)):typeof this.__node.loaders[n]=="function"&&this.__node.loaders[n](e,r,this,this.__node.roots,s,i)},this.add=(e,r)=>{var n,a;let s={};typeof r=="string"&&(r=this.get(r));let i;if(typeof e=="function"?zt(e)?e.prototype instanceof A?(e=e.prototype.constructor(e,r,this),i=!0):e=new e:e={__operator:e}:typeof e=="string"&&(e=this.__node.roots[e]),!!e){if(!i){let o=Object.getOwnPropertyNames(e),c={};for(const l of o)c[l]=e[l];e=c}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&(!((n=e==null?void 0:e.__node)!=null&&n.tag)||!this.get(e.__node.tag))){let o;if(i?o=e:o=new A(e,r,this),this.set(o.__node.tag,o),this.runLoaders(o,r,e,o.__node.tag),this.__node.roots[o.__node.tag]=e,o.__children&&(o.__children=Object.assign({},o.__children),this.recursiveSet(o.__children,o,s,o.__children)),o.__listeners){s[o.__node.tag]=Object.assign({},o.__listeners);for(const c in o.__listeners){let l=o.__listeners[c];o[c]&&(delete s[o.__node.tag][c],s[o.__node.tag][o.__node.tag+"."+c]=l),typeof l=="string"&&((a=o.__children)!=null&&a[l]?s[o.__node.tag][c]=o.__node.tag+"."+l:r instanceof A&&(r.__node.tag===l||r.__node.tag.includes(".")&&r.__node.tag.split(".").pop()===l)&&(s[o.__node.tag][c]=r.__node.tag))}}return this.setListeners(s),o.__callConnected(),o}}},this.recursiveSet=(e,r,s={},i)=>{var a;let n=Object.getOwnPropertyNames(i);for(const o of n){if(o.includes("__"))continue;let c=i[o];if(Array.isArray(c))continue;let l;if(typeof c=="function"?zt(c)?(c=new c,c instanceof A&&(c=c.prototype.constructor(c,r,this),l=!0)):c={__operator:c}:typeof c=="string"?this.__node.nodes.get(c)?c=this.__node.nodes.get(c):c=this.__node.roots[c]:typeof c=="boolean"&&(this.__node.nodes.get(o)?c=this.__node.nodes.get(o):c=this.__node.roots[o]),typeof c=="object"){if(!l&&!(c instanceof A)){let f=Object.getOwnPropertyNames(c),h={};for(const g of f)h[g]=c[g];c=h}if(c.__node||(c.__node={}),c.__node.tag||(c.__node.tag=o),c.__node.initial||(c.__node.initial=e[o]),this.get(c.__node.tag)&&!(!(r instanceof de)&&(r!=null&&r.__node))||r!=null&&r.__node&&this.get(r.__node.tag+"."+c.__node.tag))continue;let d,u=!1;if(l||c instanceof A?d=c:(d=new A(c,r,this),u=!0),!u&&c instanceof A&&!l&&r instanceof A){let f=this.subscribe(r.__node.tag,d.__node.tag),h=g=>{this.unsubscribe(r.__node.tag,f)};d.__addOndisconnected(h)}else{if(this.set(d.__node.tag,d),this.runLoaders(d,r,e[o],o),e[o]=d,this.__node.roots[d.__node.tag]=c,d.__children&&(d.__children=Object.assign({},d.__children),this.recursiveSet(d.__children,d,s,d.__children)),d.__listeners){s[d.__node.tag]=Object.assign({},d.__listeners);for(const f in d.__listeners){let h=d.__listeners[f],g=f;d[f]&&(delete s[d.__node.tag][f],g=d.__node.tag+"."+f,s[d.__node.tag][g]=h),typeof h=="string"&&((a=d.__children)!=null&&a[h]?s[d.__node.tag][g]=d.__node.tag+"."+h:r instanceof A&&(r.__node.tag===h||r.__node.tag.includes(".")&&r.__node.tag.split(".").pop()===h)&&(s[d.__node.tag][g]=r.__node.tag))}}d.__callConnected()}}}return s},this.remove=(e,r=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof A){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],r&&this.clearListeners(e),e.__callDisconnected();const s=i=>{for(const n in i)this.unsubscribe(i[n]),this.delete(i[n].__node.tag),delete this.__node.roots[i[n].__node.tag],this.delete(n),delete this.__node.roots[n],i[n].__node.tag=i[n].__node.tag.substring(i[n].__node.tag.lastIndexOf(".")+1),r&&this.clearListeners(i[n]),console.log(n,i[n].__listeners),i[n].__callDisconnected(),i[n].__children&&s(i[n].__children)};e.__children&&s(e.__children)}return e!=null&&e.__node.tag&&(e!=null&&e.__parent)&&(e==null||delete e.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e},this.run=(e,...r)=>{if(typeof e=="string"){let s=this.get(e);if(!s&&e.includes(".")){if(s=this.get(e.substring(0,e.lastIndexOf("."))),typeof(s==null?void 0:s[e.substring(e.lastIndexOf(".")+1)])=="function")return s[e.substring(e.lastIndexOf(".")+1)](...r)}else if(s!=null&&s.__operator)return s.__operator(...r)}if(e!=null&&e.__operator)return e==null?void 0:e.__operator(...r)},this.setListeners=e=>{var r,s,i,n;for(const a in e){let o=this.get(a);if(typeof e[a]=="object")for(const c in e[a]){let l=this.get(c),d;if(typeof e[a][c]!="object")e[a][c]={__callback:e[a][c]};else if(!e[a][c].__callback)for(const u in e[a][c]){typeof e[a][c][u]!="object"&&(e[a][c][u]={__callback:e[a][c][u]},(e[a][c][u].__callback===!0||typeof e[a][c][u].__callback>"u")&&(e[a][c][u].__callback=o.__operator));let f=this.get(u);if(f)if(f)d=this.subscribe(f,e[a][c][u].__callback,e[a][c].__args,void 0,e[a][c].inputState,a,c),typeof o.__listeners[c][u]!="object"&&(o.__listeners[c][u]={__callback:e[a][c][u].__callback,inputState:(s=e[a][c][u])==null?void 0:s.inputState}),o.__listeners[c][u].sub=d;else{let h=c.substring(0,c.lastIndexOf("."));f=this.get(h),l&&(d=this.subscribe(f,e[a][c][u].__callback,e[a][c][u].__args,c.substring(c.lastIndexOf(".")+1),e[a][c][u].inputState,a,c),typeof o.__listeners[c][u]!="object"&&(o.__listeners[c][u]={__callback:e[a][c][u].__callback,inputState:(r=e[a][c][u])==null?void 0:r.inputState}),o.__listeners[c][u].sub=d)}}if("__callback"in e[a][c])if((e[a][c].__callback===!0||typeof e[a][c].__callback>"u")&&(e[a][c].__callback=o.__operator),typeof e[a][c].__callback=="function"&&(e[a][c].__callback=e[a][c].__callback.bind(o)),typeof o.__listeners!="object"&&(o.__listeners={}),l)d=this.subscribe(l,e[a][c].__callback,e[a][c].__args,void 0,e[a][c].inputState,a,c),typeof o.__listeners[c]!="object"&&(o.__listeners[c]={__callback:e[a][c].__callback,inputState:(n=e[a][c])==null?void 0:n.inputState}),o.__listeners[c].sub=d;else{let u=c.substring(0,c.lastIndexOf("."));l=this.get(u),l&&(d=this.subscribe(l,e[a][c].__callback,e[a][c].__args,c.substring(c.lastIndexOf(".")+1),e[a][c].inputState,a,c),typeof o.__listeners[c]!="object"&&(o.__listeners[c]={__callback:e[a][c].__callback,inputState:(i=e[a][c])==null?void 0:i.inputState}),o.__listeners[c].sub=d)}}}},this.clearListeners=(e,r)=>{var s,i,n,a,o,c,l;if(typeof e=="string"&&(e=this.get(e)),e!=null&&e.__listeners)for(const d in e.__listeners){if(r&&d!==r||typeof((s=e.__listeners[d])==null?void 0:s.sub)!="number")continue;let u=this.get(d);if(u)if(typeof!((o=e.__listeners[d])!=null&&o.__callback)=="number")for(const f in e.__listeners[d])(c=e.__listeners[d][f])!=null&&c.sub&&(this.unsubscribe(u,e.__listeners[d][f].sub,void 0,e.__listeners[d][f].inputState),e.__listeners[d][f].sub=void 0);else typeof((l=e.__listeners[d])==null?void 0:l.sub)=="number"&&(this.unsubscribe(u,e.__listeners[d].sub,void 0,e.__listeners[d].inputState),e.__listeners[d].sub=void 0);else if(u=this.get(d.substring(0,d.lastIndexOf("."))),u)if(typeof e.__listeners[d]=="object"&&!((i=e.__listeners[d])!=null&&i.__callback))for(const f in e.__listeners[d])typeof((n=e.__listeners[d][f])==null?void 0:n.sub)=="number"&&(this.unsubscribe(u,e.__listeners[d][f].sub,d.substring(d.lastIndexOf(".")+1),e.__listeners[d][f].inputState),e.__listeners[d][f].sub=void 0);else typeof((a=e.__listeners[d])==null?void 0:a.sub)=="number"&&(this.unsubscribe(u,e.__listeners[d].sub,d.substring(d.lastIndexOf(".")+1),e.__listeners[d].inputState),e.__listeners[d].sub=void 0)}},this.get=e=>this.__node.nodes.get(e),this.set=(e,r)=>this.__node.nodes.set(e,r),this.delete=e=>this.__node.nodes.delete(e),this.getProps=(e,r)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof A){let s;if(r)s=Object.assign({},this.__node.roots[e.__node.tag]);else{s=Object.assign({},e);for(const i in s)i.includes("__")&&delete s[i]}}},this.subscribe=(e,r,s,i,n,a,o)=>{let c=e;typeof e=="string"&&(c=this.get(e),!c&&e.includes(".")&&(c=this.get(e.substring(0,e.lastIndexOf("."))),i=e.substring(e.lastIndexOf(".")+1)));let l;if(a instanceof A&&(a=a.__node.tag),typeof r=="string"){let d=r,u=f=>{var h;if((h=this.get(f))!=null&&h.__operator){let g=this.get(f);f=function(...b){return g.__operator(...b)}}else if(f.includes(".")){let g=this.get(f.substring(0,f.lastIndexOf("."))),b=f.substring(f.lastIndexOf(".")+1);typeof g[b]=="function"?g[b]instanceof A?f=g[b]:f=function(...y){return g[b](...y)}:f=function(y){return g[b]=y,g[b]}}return f};if(a){let f=this.get(a);typeof(f==null?void 0:f[r])=="function"?r=function(...h){return f[d](...h)}:f[d]?f[d]instanceof A?r=f[d]:r=function(h){return f[d]=h,f[d]}:r=u(r)}else r=u(r)}if((typeof r=="function"||r instanceof A)&&s&&(r instanceof A&&r.__operator&&(r=function(d){return r.__operator(d)}),r=or(r,s,this)),c instanceof A){l=c.__subscribe(r,i,n,a,o);let d=()=>{c.__unsubscribe(l,i,n)};c.__addOndisconnected(d)}else if(typeof e=="string")if(this.get(e))if(r instanceof A&&r.__operator){l=this.get(e).__subscribe(r.__operator,i,n,a,o);let d=()=>{this.get(e).__unsubscribe(l)};r.__addOndisconnected(d)}else(typeof r=="function"||typeof r=="string")&&(l=this.get(e).__subscribe(r,i,n,a,o),this.__node.state.getEvent(this.get(e).__node.unique,l).source=e);else typeof r=="string"&&(r=this.__node.nodes.get(r).__operator),typeof r=="function"&&(l=this.__node.state.subscribeEvent(e,r));return l},this.unsubscribe=(e,r,s,i)=>{var n;return e instanceof A?e.__unsubscribe(r,s,i):(n=this.get(e))==null?void 0:n.__unsubscribe(r,s,i)},this.setState=e=>{this.__node.state.setState(e)},this.init(t)}};function Wt(t,e){var r,s;for(const i in e)((r=e[i])==null?void 0:r.constructor.name)==="Object"&&!Array.isArray(e[i])?((s=t[i])==null?void 0:s.constructor.name)==="Object"&&!Array.isArray(t[i])?Wt(t[i],e[i]):t[i]=Wt({},e[i]):t[i]=e[i];return t}function Di(t){var e=[],r=t;do{var s=Object.getOwnPropertyNames(r);let i=function(n){e.indexOf(n)===-1&&e.push(n)};s.forEach(i)}while(r=Object.getPrototypeOf(r));return e}function zt(t){return Fi(t)==="class"}function Fi(t){var r;return typeof t=="function"?t.prototype?(r=Object.getOwnPropertyDescriptor(t,"prototype"))!=null&&r.writable?"function":"class":t.constructor.name==="AsyncFunction"?"async":"arrow":""}var or=(t,e,r)=>{let s=[],i=o=>{var c,l;if((c=r.get(o))!=null&&c.__operator){let d=r.get(o);return(...u)=>{d.__operator(...u)}}else if(o.includes(".")){let d=o.split("."),u=d.pop(),f=d.join("."),h=r.get(f);return typeof((l=r.get(f))==null?void 0:l[u])=="function"?(...g)=>h[u](...g):()=>h[u]}else if(r.get(o)){let d=r.get(o);return()=>d}else{let d=o;return()=>d}},n=(o,c)=>{if(o==="__output")s[c]=l=>l;else if(typeof o=="string")s[c]=i(o);else if(typeof o=="function"){let l=o;s[c]=(...d)=>l(...d)}else if(typeof o=="object"&&o.__input){let l=function(d){let u=d.__input;if(typeof d.__input=="string"&&(u=i(d.__input)),d.__args&&(u=or(u,d.__args,r)),d.__output){let f=d.__output;if(typeof d.__output=="string"?f=i(f):typeof o.__output=="object"&&(f=l(f)),typeof f=="function"){let h=u;u=(...g)=>f(h(...g))}}return u};s[c]=l(o)}else{let l=o;s[c]=()=>l}};e.forEach(n),typeof t=="string"&&(t=i(t));let a=t;return t=function(...o){let c=l=>l(...o);return a(...s.map(c))},t},Ri=(t,e,r)=>{t.__node.backward&&e instanceof A&&r.setListeners({[e.__node.tag]:{[t.__node.tag]:e}})},Ui=(t,e,r)=>{if(t.__operator&&!t.__node.looperSet){if(typeof t.__node.delay=="number"){let s=t.__operator;t.__setOperator((...i)=>new Promise((n,a)=>{setTimeout(async()=>{n(await s(...i))},t.__node.delay)}))}else if(t.__node.frame===!0){let s=t.__operator;t.__setOperator((...i)=>new Promise((n,a)=>{requestAnimationFrame(async()=>{n(await s(...i))})}))}if(typeof t.__node.repeat=="number"||typeof t.__node.recursive=="number"){let s=t.__operator;t.__setOperator(async(...i)=>{let n=t.__node.repeat?t.__node.repeat:t.__node.recursive,a,o=async(c,...l)=>{for(;c>0;){if(t.__node.delay||t.__node.frame){s(...l).then(async d=>{t.__node.recursive?await o(c,d):await o(c,...l)});break}else a=await s(...i);c--}};return await o(n,...i),a})}if(t.__node.loop&&typeof t.__node.loop=="number"){t.__node.looperSet=!0;let s=t.__operator;t.__setOperator((...n)=>{"looping"in t.__node||(t.__node.looping=!0),t.__node.looping&&(s(...n),setTimeout(()=>{t.__operator(...n)},t.__node.loop))}),t.__node.looping&&t.__operator();let i=n=>{n.__node.looping&&(n.__node.looping=!1)};t.__addOndisconnected(i)}}},qi=(t,e,r)=>{if(t.__node.animate===!0||t.__animation){let s=t.__operator;t.__setOperator((...n)=>{"animating"in t.__node||(t.__node.animating=!0),t.__node.animating&&(typeof t.__animation=="function"?t.__animation(...n):s(...n),requestAnimationFrame(()=>{t.__operator(...n)}))}),(t.__node.animating||(!("animating"in t.__node)||t.__node.animating)&&t.__animation)&&setTimeout(()=>{requestAnimationFrame(t.__operator)},10);let i=n=>{n.__node.animating&&(n.__node.animating=!1)};t.__addOndisconnected(i)}},Vi=(t,e,r)=>{if(typeof t.__branch=="object"&&t.__operator&&!t.__branchApplied){let s=t.__operator;t.__branchApplied=!0,t.__operator=(...i)=>{let n=s(...i);for(const a in t.__branch){let o=()=>{typeof t.__branch[a].then=="function"?t.__branch[a].then(n):t.__branch[a].then instanceof A&&t.__branch[a].then.__operator?t.__branch[a].then.__operator(n):n=t.__branch[a].then};typeof t.__branch[a].if=="function"?t.__branch[a].if(n)==!0&&o():t.__branch[a].if===n&&o()}return n}}if(t.__listeners){for(const s in t.__listeners)if(typeof t.__listeners[s]=="object"&&t.__listeners[s].branch&&!t.__listeners[s].branchApplied){let i=t.__listeners[s].callback;t.__listeners[s].branchApplied=!0,t.__listeners.callback=n=>{let a=()=>{typeof t.__listeners[s].branch.then=="function"?n=t.__listeners[s].branch.then(n):t.__listeners[s].branch.then instanceof A&&t.__listeners[s].branch.then.__operator?n=t.__listeners[s].branch.then.__operator(n):n=t.__listeners[s].branch.then};return typeof t.__listeners[s].branch.if=="function"?t.__listeners[s].branch.if(n)&&a():t.__listeners[s].branch.if===n&&a(),i(n)}}}},Hi=(t,e,r)=>{if(t.__listeners)for(const s in t.__listeners)typeof t.__listeners[s]=="object"&&t.__listeners[s].oncreate&&t.__listeners[s].callback(t.__listeners[s].oncreate)},Gi=(t,e,r)=>{if(t.__listeners)for(const s in t.__listeners)typeof t.__listeners[s]=="object"&&typeof t.__listeners[s].binding=="object"&&(t.__listeners.callback=t.__listeners.callback.bind(t.__listeners[s].binding))},Wi=(t,e,r)=>{if(t.__listeners){for(const s in t.__listeners)if(typeof t.__listeners[s]=="object"&&typeof t.__listeners[s].transform=="function"&&!t.__listeners[s].transformApplied){let i=t.__listeners[s].callback;t.__listeners[s].transformApplied=!0,t.__listeners.callback=n=>(n=t.__listeners[s].transform(n),i(n))}}},zi=(t,e,r)=>{var s;t.post&&!t.__operator?t.__setOperator(t.post):!t.__operator&&typeof t.get=="function"&&t.__setOperator(t.get),!t.get&&t.__operator&&(t.get=t.__operator),t.aliases&&t.aliases.forEach(i=>{r.set(i,t);let n=a=>{r.__node.nodes.delete(i)};t.__addOndisconnected(n)}),typeof((s=r.__node.roots)==null?void 0:s[t.__node.tag])=="object"&&t.get&&(r.__node.roots[t.__node.tag].get=t.get)},Ir={backprop:Ri,loop:Ui,animate:qi,branching:Vi,triggerListenerOncreate:Hi,bindListener:Gi,transformListenerResult:Wi,substitute__operator:zi},$t=t=>{let e={};for(const r in t)typeof t[r]=="object"?e[r]=$t(t[r]):typeof t[r]=="function"?e[r]=t[r].toString():e[r]=t[r];return e};function _e(t=""){let e=a=>a.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),s=(a=>{let o=a.indexOf("=>")+1;return o<=0&&(o=a.indexOf("){")),o<=0&&(o=a.indexOf(") {")),a.slice(0,a.indexOf("{",o)+1)})(t),i=e(t),n;if(s.includes("function")){let a=s.split("(")[1].split(")")[0];n=new Function(a,i)}else if(s.substring(0,6)===i.substring(0,6)){let a=s.split("(")[1].split(")")[0];n=new Function(a,i.substring(i.indexOf("{")+1,i.length-1))}else try{n=(0,eval)(t)}catch{}return n}var $i=function(){const t=new Map,e=[],r=["this"];function s(){t.clear(),e.length=0,r.length=1}function i(a,o){var c=e.length-1,l=e[c];if(typeof l=="object")if(l[a]===o||c===0)r.push(a),e.push(o.pushed);else for(;c-->=0;){if(l=e[c],typeof l=="object"&&l[a]===o){c+=2,e.length=c,r.length=c,--c,e[c]=o,r[c]=a;break}c--}}function n(a,o){if(o!=null&&typeof o=="object"){a&&i(a,o);let c=t.get(o);if(c)return"[Circular Reference]"+c;t.set(o,r.join("."))}return o}return function(o,c){try{return e.push(o),JSON.stringify(o,n,c)}finally{s()}}}();JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=$i);var Yi=function(){const t=new Map,e=[],r=["this"];function s(){t.clear(),e.length=0,r.length=1}function i(a,o){var c=e.length-1;if(e[c]){var l=e[c];if(typeof l=="object")if(l[a]===o||c===0)r.push(a),e.push(o.pushed);else for(;c-->=0;){if(l=e[c],typeof l=="object"&&l[a]===o){c+=2,e.length=c,r.length=c,--c,e[c]=o,r[c]=a;break}c++}}}function n(a,o){let c;if(o!=null)if(typeof o=="object"){let l=o.constructor.name;a&&l==="Object"&&i(a,o);let d=t.get(o);if(d)return"[Circular Reference]"+d;if(t.set(o,r.join(".")),l==="Array")o.length>20?c=o.slice(o.length-20):c=o;else if(l.includes("Set"))c=Array.from(o);else if(l!=="Object"&&l!=="Number"&&l!=="String"&&l!=="Boolean")c="instanceof_"+l;else if(l==="Object"){let u={};for(const f in o)if(o[f]==null)u[f]=o[f];else if(Array.isArray(o[f]))o[f].length>20?u[f]=o[f].slice(o[f].length-20):u[f]=o[f];else if(o[f].constructor.name==="Object"){u[f]={};for(const h in o[f])if(Array.isArray(o[f][h]))o[f][h].length>20?u[f][h]=o[f][h].slice(o[f][h].length-20):u[f][h]=o[f][h];else if(o[f][h]!=null){let g=o[f][h].constructor.name;g.includes("Set")?u[f][h]=Array.from(o[f][h]):g!=="Number"&&g!=="String"&&g!=="Boolean"?u[f][h]="instanceof_"+g:u[f][h]=o[f][h]}else u[f][h]=o[f][h]}else{let h=o[f].constructor.name;h.includes("Set")?u[f]=Array.from(o[f]):h!=="Number"&&h!=="String"&&h!=="Boolean"?u[f]="instanceof_"+h:u[f]=o[f]}c=u}else c=o}else c=o;return c}return function(o,c){e.push(o);let l=JSON.stringify(o,n,c);return s(),l}}();JSON.stringifyFast===void 0&&(JSON.stringifyFast=Yi);function Br(t){if(typeof t.__methods=="object")for(const e in t.__methods){let r=t.__methods[e],s=typeof r=="function"?r:_e(r);e==="__operator"?t.__setOperator(s):t[e]=s.bind(t)}}var as=class extends de{constructor(t){super({...t,loaders:t!=null&&t.loaders?Object.assign({...Ir},t.loaders):{...Ir}}),this.name=`service${Math.floor(Math.random()*1e15)}`,this.addServices=e=>{var r,s,i,n;for(const a in e)if(typeof e[a]=="function"&&(e[a]=new e[a]),(s=(r=e[a])==null?void 0:r.__node)!=null&&s.loaders&&Object.assign(this.__node.loaders,e[a].__node.loaders),(n=(i=e[a])==null?void 0:i.__node)!=null&&n.nodes){e[a].__node.nodes.forEach((l,d)=>{this.get(d)?this.set(a+"."+d,l):this.set(d,l)}),this.__node.nodes.forEach((l,d)=>{e[a].__node.nodes.get(d)||e[a].__node.nodes.set(d,l)});let o=this.set;this.set=(l,d)=>(e[a].set(l,d),o(l,d));let c=this.delete;this.delete=l=>(e[a].delete(l),c(l))}else typeof e[a]=="object"&&this.load(e[a])},this.handleMethod=(e,r,s)=>{let i=r.toLowerCase(),n=this.__node.nodes.get(e);if(n||(n=this.__node.roots[e]),n!=null&&n[i])if(typeof n[i]!="function"){if(s){Array.isArray(s)&&s.length===1?n[i]=s[0]:n[i]=s;return}return n[i]}else return Array.isArray(s)?n[i](...s):n[i](s);else return this.handleServiceMessage({route:e,args:s,method:r})},this.transmit=(...e)=>typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.__node.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e,this.receive=(...e)=>{if(e[0]&&typeof e[0]=="string"){let r=e[0].substring(0,8);(r.includes("{")||r.includes("["))&&(r.includes("\\")&&(e[0]=e[0].replace(/\\/g,"")),e[0][0]==='"'&&(e[0]=e[0].substring(1,e[0].length-1)),e[0]=JSON.parse(e[0]))}return typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.__node.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e},this.pipe=(e,r,s,i,n)=>{if(e instanceof A)return n?this.subscribe(e,a=>{let o=n(a);o!==void 0?this.transmit({route:r,args:o,method:i}):this.transmit({route:r,args:a,method:i},s)}):this.subscribe(e,a=>{this.transmit({route:r,args:a,method:i},s)});if(typeof e=="string")return this.subscribe(e,a=>{this.transmit({route:r,args:a,method:i},s)})},this.pipeOnce=(e,r,s,i,n)=>{if(e instanceof A)return n?e.__node.state.subscribeEventOnce(e.__node.unique,a=>{let o=n(a);o!==void 0?this.transmit({route:r,args:o,method:i}):this.transmit({route:r,args:a,method:i},s)}):this.__node.state.subscribeEventOnce(e.__node.unique,a=>{this.transmit({route:r,args:a,method:i},s)});if(typeof e=="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(e).__node.unique,a=>{this.transmit({route:r,args:a,method:i},s)})},this.terminate=(...e)=>{},this.isTypedArray=Qi,this.recursivelyAssign=ut,this.spliceTypedArray=Ki,this.ping=()=>(console.log("pinged!"),"pong"),this.echo=(...e)=>(this.transmit(...e),e),t!=null&&t.services&&this.addServices(t.services),this.load(this)}handleServiceMessage(t){let e;return typeof t=="object"&&(t.route?e=t.route:t.node&&(e=t.node)),e?Array.isArray(t.args)?this.run(e,...t.args):this.run(e,t.args):t}handleGraphNodeCall(t,e){if(!t)return e;if(e!=null&&e.args)this.handleServiceMessage(e);else return Array.isArray(e)?this.run(t,...e):this.run(t,e)}};function Qi(t){return ArrayBuffer.isView(t)&&Object.prototype.toString.call(t)!=="[object DataView]"}var ut=(t,e)=>{for(const r in e)e[r].constructor.name==="Object"&&!Array.isArray(e[r])?e[r].constructor.name==="Object"&&!Array.isArray(t[r])?ut(t[r],e[r]):t[r]=ut({},e[r]):t[r]=e[r];return t};function Ki(t,e,r){let s=t.subarray(0,e),i;r&&(i=t.subarray(r+1));let n;return(s.length>0||(i==null?void 0:i.length)>0)&&(n=new t.constructor(s.length+i.length)),n&&(s.length>0&&n.set(s),i&&i.length>0&&n.set(i,s.length)),n}var Qe={},Xi={transferNode:(t,e,r)=>{let s;if(typeof t=="object"){t.__node||(t.__node={}),r&&(t.__node.tag=r);for(const i in t)typeof t[i]=="function"&&(t.__methods||(t.__methods={}),t.__methods[i]=t[i].toString());s=$t(t)}else typeof t=="function"?s=t.toString():typeof t=="string"&&(s=t);if(s){if(e.run)return e.run("setNode",[s]);if(e.postMessage)return e.postMessage({route:"setNode",args:s},void 0),new Promise(i=>i(r));if(e.send)return e.send(JSON.stringify({route:"setNode",args:s})),new Promise(i=>i(r))}},setNode:function(t){if(typeof t=="object"&&t.__methods&&(this.__node.graph.__node.loaders.methodstrings||(this.__node.graph.__node.loaders.methodstrings=Br)),typeof t=="string"){let e=_e(t);typeof e=="function"?t={__operator:e,__node:{tag:e.name}}:(e=JSON.parse(t),typeof e=="object"&&(t=e))}if(typeof t=="object"||typeof t=="function"){let e=Object.assign({},t),r=this.__node.graph.add(t);return Qe[r.__node.tag]=e,r.__node.tag}else return!1},proxyRemoteNode:function(t,e){return new Promise((r,s)=>{e.run("getNodeProperties",t).then(i=>{let n={};if(typeof i=="object")for(const a in i)i[a]==="function"?n[a]=(...o)=>new Promise(c=>{e.run(t,o,a).then(c)}):Object.defineProperty(n,a,{get:()=>new Promise(o=>{e.run(t,void 0,a).then(o)}),set:o=>{e.post(t,o,a)},configurable:!0,enumerable:!0});r(n)})})},makeNodeTransferrable:function(t,e){t.__node||(t.__node={}),e&&(t.__node.tag=e);for(const s in t)typeof t[s]=="function"&&(t.__methods||(t.__methods={}),t.__methods[s]=t[s].toString());return $t(t)},setTemplate:function(t,e){var r;if(typeof t=="object"&&t.__methods&&(this.__node.graph.__node.loaders.methodstrings||(this.__node.graph.__node.loaders.methodstrings=Br)),typeof t=="string"){let s=_e(t);typeof s=="function"?(e||(e=s.name),t={__operator:s,__node:{tag:e}}):(s=JSON.parse(t),typeof s=="object"&&(t=s,!e&&((r=s.__node)!=null&&r.tag)&&(e=s.__node.tag)))}return e||(e=`node${Math.floor(Math.random()*1e15)}`),typeof t=="object"||typeof t=="function"?(Qe[e]=t,e):!1},loadFromTemplate:function(t,e,r){if(Qe[t]){let s=ut({},Qe[t]);return e&&(s.__node||(s.__node={}),s.__node.tag=e),r&&Object.assign(s,r),this.__node.graph.add(s).__node.tag}},setMethod:function(t,e,r){if(typeof e=="string"){let s=_e(e);typeof s=="function"&&(e=s)}return!r&&typeof e=="function"&&(r=e.name),this.__node.graph.get(t)?this.__node.graph.get(t)[r]=e:this.__node.graph.add({__node:{tag:r,[r]:e}}),!0},assignNode:function(t,e){this.__node.graph.get(t)&&typeof e=="object"&&Object.assign(this.__node.graph.get(t),e)},getNodeProperties:function(t){let e=this.__node.graph.get(t);if(e){let r=Object.getOwnPropertyNames(e),s={};for(const i in r)s[i]=typeof e[i];return s}},transferClass:(t,e,r)=>{if(typeof t=="object"){let s=t.toString(),i={route:"receiveClass",args:[s,r]};return e.run?e.run("receiveClass",[s,r]):e.postMessage?(e.postMessage({route:"receiveClass",args:[s,r]},void 0),new Promise(n=>n(name))):e.send?(e.send(JSON.stringify({route:"receiveClass",args:[s,r]})),new Promise(n=>n(name))):i}return!1},receiveClass:function(t,e){if(typeof t=="string"&&t.indexOf("class")===0){let r=(0,eval)("("+t+")"),s=e;return s||(s=r.name),this.__node.graph[s]=r,!0}return!1},transferFunction:(t,e,r)=>{r||(r=t.name);let s=t.toString(),i={route:"receiveClass",args:[s,r]};return e.run?e.run("setFunction",[s,r]):e.postMessage?(e.postMessage({route:"setFunction",args:[s,r]},void 0),new Promise(n=>n(name))):e.send?(e.send(JSON.stringify({route:"setFunction",args:[s,r]})),new Promise(n=>n(name))):i},setGlobal:(t,e)=>(globalThis[t]=e,!0),assignGlobalObject:(t,e)=>globalThis[t]?(typeof e=="object"&&Object.assign(globalThis[t],e),!0):!1,setValue:function(t,e){return this.__node.graph[t]=e,!0},assignObject:function(t,e){return this.__node.graph[t]?(typeof e=="object"&&Object.assign(this.__node.graph[t],e),!0):!1},setGlobalFunction:(t,e)=>(typeof t=="string"&&(t=_e(t)),typeof t=="function"?(e||(e=t.name),globalThis[e]=t,!0):!1),setGraphFunction:function(t,e){return typeof t=="string"&&(t=_e(t)),typeof t=="function"?(e||(e=t.name),this.__node.graph[e]=t,!0):!1}},p={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};p.cipher.aes=function(t){this.s[0][0][0]||this.O();var e,r,s,i,n=this.s[0][4],a=this.s[1];e=t.length;var o=1;if(e!==4&&e!==6&&e!==8)throw new p.exception.invalid("invalid aes key size");for(this.b=[s=t.slice(0),i=[]],t=e;t<4*e+28;t++)r=s[t-1],(t%e===0||e===8&&t%e===4)&&(r=n[r>>>24]<<24^n[r>>16&255]<<16^n[r>>8&255]<<8^n[r&255],t%e===0&&(r=r<<8^r>>>24^o<<24,o=o<<1^283*(o>>7))),s[t]=s[t-e]^r;for(e=0;t;e++,t--)r=s[e&3?t:t-4],i[e]=4>=t||4>e?r:a[0][n[r>>>24]]^a[1][n[r>>16&255]]^a[2][n[r>>8&255]]^a[3][n[r&255]]};p.cipher.aes.prototype={encrypt:function(t){return Lr(this,t,0)},decrypt:function(t){return Lr(this,t,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var t=this.s[0],e=this.s[1],r=t[4],s=e[4],i,n,a,o=[],c=[],l,d,u,f;for(i=0;256>i;i++)c[(o[i]=i<<1^283*(i>>7))^i]=i;for(n=a=0;!r[n];n^=l||1,a=c[a]||1)for(u=a^a<<1^a<<2^a<<3^a<<4,u=u>>8^u&255^99,r[n]=u,s[u]=n,d=o[i=o[l=o[n]]],f=16843009*d^65537*i^257*l^16843008*n,d=257*o[u]^16843008*u,i=0;4>i;i++)t[i][n]=d=d<<24^d>>>8,e[i][u]=f=f<<24^f>>>8;for(i=0;5>i;i++)t[i]=t[i].slice(0),e[i]=e[i].slice(0)}};function Lr(t,e,r){if(e.length!==4)throw new p.exception.invalid("invalid aes block size");var s=t.b[r],i=e[0]^s[0],n=e[r?3:1]^s[1],a=e[2]^s[2];e=e[r?1:3]^s[3];var o,c,l,d=s.length/4-2,u,f=4,h=[0,0,0,0];o=t.s[r],t=o[0];var g=o[1],b=o[2],y=o[3],_=o[4];for(u=0;u<d;u++)o=t[i>>>24]^g[n>>16&255]^b[a>>8&255]^y[e&255]^s[f],c=t[n>>>24]^g[a>>16&255]^b[e>>8&255]^y[i&255]^s[f+1],l=t[a>>>24]^g[e>>16&255]^b[i>>8&255]^y[n&255]^s[f+2],e=t[e>>>24]^g[i>>16&255]^b[n>>8&255]^y[a&255]^s[f+3],f+=4,i=o,n=c,a=l;for(u=0;4>u;u++)h[r?3&-u:u]=_[i>>>24]<<24^_[n>>16&255]<<16^_[a>>8&255]<<8^_[e&255]^s[f++],o=i,i=n,n=a,a=e,e=o;return h}p.bitArray={bitSlice:function(t,e,r){return t=p.bitArray.$(t.slice(e/32),32-(e&31)).slice(1),r===void 0?t:p.bitArray.clamp(t,r-e)},extract:function(t,e,r){var s=Math.floor(-e-r&31);return((e+r-1^e)&-32?t[e/32|0]<<32-s^t[e/32+1|0]>>>s:t[e/32|0]>>>s)&(1<<r)-1},concat:function(t,e){if(t.length===0||e.length===0)return t.concat(e);var r=t[t.length-1],s=p.bitArray.getPartial(r);return s===32?t.concat(e):p.bitArray.$(e,s,r|0,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return e===0?0:32*(e-1)+p.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var r=t.length;return e=e&31,0<r&&e&&(t[r-1]=p.bitArray.partial(e,t[r-1]&2147483648>>e-1,1)),t},partial:function(t,e,r){return t===32?e:(r?e|0:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(p.bitArray.bitLength(t)!==p.bitArray.bitLength(e))return!1;var r=0,s;for(s=0;s<t.length;s++)r|=t[s]^e[s];return r===0},$:function(t,e,r,s){var i;for(i=0,s===void 0&&(s=[]);32<=e;e-=32)s.push(r),r=0;if(e===0)return s.concat(t);for(i=0;i<t.length;i++)s.push(r|t[i]>>>e),r=t[i]<<32-e;return i=t.length?t[t.length-1]:0,t=p.bitArray.getPartial(i),s.push(p.bitArray.partial(e+t&31,32<e+t?r:s.pop(),1)),s},i:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,r;for(e=0;e<t.length;++e)r=t[e],t[e]=r>>>24|r>>>8&65280|(r&65280)<<8|r<<24;return t}};p.codec.utf8String={fromBits:function(t){var e="",r=p.bitArray.bitLength(t),s,i;for(s=0;s<r/8;s++)!(s&3)&&(i=t[s/4]),e+=String.fromCharCode(i>>>8>>>8>>>8),i<<=8;return decodeURIComponent(escape(e))},toBits:function(t){t=unescape(encodeURIComponent(t));var e=[],r,s=0;for(r=0;r<t.length;r++)s=s<<8|t.charCodeAt(r),(r&3)===3&&(e.push(s),s=0);return r&3&&e.push(p.bitArray.partial(8*(r&3),s)),e}};p.codec.hex={fromBits:function(t){var e="",r;for(r=0;r<t.length;r++)e+=((t[r]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,p.bitArray.bitLength(t)/4)},toBits:function(t){var e,r=[],s;for(t=t.replace(/\s|0x/g,""),s=t.length,t=t+"00000000",e=0;e<t.length;e+=8)r.push(parseInt(t.substr(e,8),16)^0);return p.bitArray.clamp(r,4*s)}};p.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(t,e,r){var s=p.codec.base32.BASE,i=p.codec.base32.REMAINING,n="",a=0,o=p.codec.base32.B,c=0,l=p.bitArray.bitLength(t);for(r&&(o=p.codec.base32.X),r=0;n.length*s<l;)n+=o.charAt((c^t[r]>>>a)>>>i),a<s?(c=t[r]<<s-a,a+=i,r++):(c<<=s,a-=s);for(;n.length&7&&!e;)n+="=";return n},toBits:function(t,e){t=t.replace(/\s|=/g,"").toUpperCase();var r=p.codec.base32.BITS,s=p.codec.base32.BASE,i=p.codec.base32.REMAINING,n=[],a,o=0,c=p.codec.base32.B,l=0,d,u="base32";for(e&&(c=p.codec.base32.X,u="base32hex"),a=0;a<t.length;a++){if(d=c.indexOf(t.charAt(a)),0>d){if(!e)try{return p.codec.base32hex.toBits(t)}catch{}throw new p.exception.invalid("this isn't "+u+"!")}o>i?(o-=i,n.push(l^d>>>o),l=d<<r-o):(o+=s,l^=d<<r-o)}return o&56&&n.push(p.bitArray.partial(o&56,l,1)),n}};p.codec.base32hex={fromBits:function(t,e){return p.codec.base32.fromBits(t,e,1)},toBits:function(t){return p.codec.base32.toBits(t,1)}};p.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,r){var s="",i=0,n=p.codec.base64.B,a=0,o=p.bitArray.bitLength(t);for(r&&(n=n.substr(0,62)+"-_"),r=0;6*s.length<o;)s+=n.charAt((a^t[r]>>>i)>>>26),6>i?(a=t[r]<<6-i,i+=26,r++):(a<<=6,i-=6);for(;s.length&3&&!e;)s+="=";return s},toBits:function(t,e){t=t.replace(/\s|=/g,"");var r=[],s,i=0,n=p.codec.base64.B,a=0,o;for(e&&(n=n.substr(0,62)+"-_"),s=0;s<t.length;s++){if(o=n.indexOf(t.charAt(s)),0>o)throw new p.exception.invalid("this isn't base64!");26<i?(i-=26,r.push(a^o>>>i),a=o<<32-i):(i+=6,a^=o<<32-i)}return i&56&&r.push(p.bitArray.partial(i&56,a,1)),r}};p.codec.base64url={fromBits:function(t){return p.codec.base64.fromBits(t,1,1)},toBits:function(t){return p.codec.base64.toBits(t,1)}};p.hash.sha256=function(t){this.b[0]||this.O(),t?(this.F=t.F.slice(0),this.A=t.A.slice(0),this.l=t.l):this.reset()};p.hash.sha256.hash=function(t){return new p.hash.sha256().update(t).finalize()};p.hash.sha256.prototype={blockSize:512,reset:function(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update:function(t){typeof t=="string"&&(t=p.codec.utf8String.toBits(t));var e,r=this.A=p.bitArray.concat(this.A,t);if(e=this.l,t=this.l=e+p.bitArray.bitLength(t),9007199254740991<t)throw new p.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var s=new Uint32Array(r),i=0;for(e=512+e-(512+e&511);e<=t;e+=512)Tt(this,s.subarray(16*i,16*(i+1))),i+=1;r.splice(0,16*i)}else for(e=512+e-(512+e&511);e<=t;e+=512)Tt(this,r.splice(0,16));return this},finalize:function(){var t,r=this.A,e=this.F,r=p.bitArray.concat(r,[p.bitArray.partial(1,1)]);for(t=r.length+2;t&15;t++)r.push(0);for(r.push(Math.floor(this.l/4294967296)),r.push(this.l|0);r.length;)Tt(this,r.splice(0,16));return this.reset(),e},Y:[],b:[],O:function(){function t(n){return 4294967296*(n-Math.floor(n))|0}for(var e=0,r=2,s,i;64>e;r++){for(i=!0,s=2;s*s<=r;s++)if(r%s===0){i=!1;break}i&&(8>e&&(this.Y[e]=t(Math.pow(r,.5))),this.b[e]=t(Math.pow(r,1/3)),e++)}}};function Tt(t,e){var r,s,i,n=t.F,a=t.b,o=n[0],c=n[1],l=n[2],d=n[3],u=n[4],f=n[5],h=n[6],g=n[7];for(r=0;64>r;r++)16>r?s=e[r]:(s=e[r+1&15],i=e[r+14&15],s=e[r&15]=(s>>>7^s>>>18^s>>>3^s<<25^s<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+e[r&15]+e[r+9&15]|0),s=s+g+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(h^u&(f^h))+a[r],g=h,h=f,f=u,u=d+s|0,d=l,l=c,c=o,o=s+(c&l^d&(c^l))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;n[0]=n[0]+o|0,n[1]=n[1]+c|0,n[2]=n[2]+l|0,n[3]=n[3]+d|0,n[4]=n[4]+u|0,n[5]=n[5]+f|0,n[6]=n[6]+h|0,n[7]=n[7]+g|0}p.mode.ccm={name:"ccm",G:[],listenProgress:function(t){p.mode.ccm.G.push(t)},unListenProgress:function(t){t=p.mode.ccm.G.indexOf(t),-1<t&&p.mode.ccm.G.splice(t,1)},fa:function(t){var e=p.mode.ccm.G.slice(),r;for(r=0;r<e.length;r+=1)e[r](t)},encrypt:function(t,e,r,s,i){var n,a=e.slice(0),o=p.bitArray,c=o.bitLength(r)/8,l=o.bitLength(a)/8;if(i=i||64,s=s||[],7>c)throw new p.exception.invalid("ccm: iv must be at least 7 bytes");for(n=2;4>n&&l>>>8*n;n++);return n<15-c&&(n=15-c),r=o.clamp(r,8*(15-n)),e=p.mode.ccm.V(t,e,r,s,i,n),a=p.mode.ccm.C(t,a,r,e,i,n),o.concat(a.data,a.tag)},decrypt:function(t,e,r,s,i){i=i||64,s=s||[];var n=p.bitArray,a=n.bitLength(r)/8,l=n.bitLength(e),o=n.clamp(e,l-i),c=n.bitSlice(e,l-i),l=(l-i)/8;if(7>a)throw new p.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;4>e&&l>>>8*e;e++);if(e<15-a&&(e=15-a),r=n.clamp(r,8*(15-e)),o=p.mode.ccm.C(t,o,r,c,i,e),t=p.mode.ccm.V(t,o.data,r,s,i,e),!n.equal(o.tag,t))throw new p.exception.corrupt("ccm: tag doesn't match");return o.data},na:function(t,e,r,s,i,n){var a=[],o=p.bitArray,c=o.i;if(s=[o.partial(8,(e.length?64:0)|s-2<<2|n-1)],s=o.concat(s,r),s[3]|=i,s=t.encrypt(s),e.length)for(r=o.bitLength(e)/8,65279>=r?a=[o.partial(16,r)]:4294967295>=r&&(a=o.concat([o.partial(16,65534)],[r])),a=o.concat(a,e),e=0;e<a.length;e+=4)s=t.encrypt(c(s,a.slice(e,e+4).concat([0,0,0])));return s},V:function(t,e,r,s,i,n){var a=p.bitArray,o=a.i;if(i/=8,i%2||4>i||16<i)throw new p.exception.invalid("ccm: invalid tag length");if(4294967295<s.length||4294967295<e.length)throw new p.exception.bug("ccm: can't deal with 4GiB or more data");for(r=p.mode.ccm.na(t,s,r,i,a.bitLength(e)/8,n),s=0;s<e.length;s+=4)r=t.encrypt(o(r,e.slice(s,s+4).concat([0,0,0])));return a.clamp(r,8*i)},C:function(t,e,r,s,i,n){var a,o=p.bitArray;a=o.i;var c=e.length,l=o.bitLength(e),d=c/50,u=d;if(r=o.concat([o.partial(8,n-1)],r).concat([0,0,0]).slice(0,4),s=o.bitSlice(a(s,t.encrypt(r)),0,i),!c)return{tag:s,data:[]};for(a=0;a<c;a+=4)a>d&&(p.mode.ccm.fa(a/c),d+=u),r[3]++,i=t.encrypt(r),e[a]^=i[0],e[a+1]^=i[1],e[a+2]^=i[2],e[a+3]^=i[3];return{tag:s,data:o.clamp(e,l)}}};p.mode.ocb2={name:"ocb2",encrypt:function(t,e,r,s,i,n){if(p.bitArray.bitLength(r)!==128)throw new p.exception.invalid("ocb iv must be 128 bits");var a,o=p.mode.ocb2.S,c=p.bitArray,l=c.i,d=[0,0,0,0];r=o(t.encrypt(r));var u,f=[];for(s=s||[],i=i||64,a=0;a+4<e.length;a+=4)u=e.slice(a,a+4),d=l(d,u),f=f.concat(l(r,t.encrypt(l(r,u)))),r=o(r);return u=e.slice(a),e=c.bitLength(u),a=t.encrypt(l(r,[0,0,0,e])),u=c.clamp(l(u.concat([0,0,0]),a),e),d=l(d,l(u.concat([0,0,0]),a)),d=t.encrypt(l(d,l(r,o(r)))),s.length&&(d=l(d,n?s:p.mode.ocb2.pmac(t,s))),f.concat(c.concat(u,c.clamp(d,i)))},decrypt:function(t,e,r,s,i,n){if(p.bitArray.bitLength(r)!==128)throw new p.exception.invalid("ocb iv must be 128 bits");i=i||64;var a=p.mode.ocb2.S,o=p.bitArray,c=o.i,l=[0,0,0,0],d=a(t.encrypt(r)),u,f,h=p.bitArray.bitLength(e)-i,g=[];for(s=s||[],r=0;r+4<h/32;r+=4)u=c(d,t.decrypt(c(d,e.slice(r,r+4)))),l=c(l,u),g=g.concat(u),d=a(d);if(f=h-32*r,u=t.encrypt(c(d,[0,0,0,f])),u=c(u,o.clamp(e.slice(r),f).concat([0,0,0])),l=c(l,u),l=t.encrypt(c(l,c(d,a(d)))),s.length&&(l=c(l,n?s:p.mode.ocb2.pmac(t,s))),!o.equal(o.clamp(l,i),o.bitSlice(e,h)))throw new p.exception.corrupt("ocb: tag doesn't match");return g.concat(o.clamp(u,f))},pmac:function(t,e){var r,s=p.mode.ocb2.S,i=p.bitArray,n=i.i,a=[0,0,0,0],o=t.encrypt([0,0,0,0]),o=n(o,s(s(o)));for(r=0;r+4<e.length;r+=4)o=s(o),a=n(a,t.encrypt(n(o,e.slice(r,r+4))));return r=e.slice(r),128>i.bitLength(r)&&(o=n(o,s(o)),r=i.concat(r,[-2147483648,0,0,0])),a=n(a,r),t.encrypt(n(s(n(o,s(o))),a))},S:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}};p.mode.gcm={name:"gcm",encrypt:function(t,e,r,s,i){var n=e.slice(0);return e=p.bitArray,s=s||[],t=p.mode.gcm.C(!0,t,n,s,r,i||128),e.concat(t.data,t.tag)},decrypt:function(t,e,r,s,i){var n=e.slice(0),a=p.bitArray,o=a.bitLength(n);if(i=i||128,s=s||[],i<=o?(e=a.bitSlice(n,o-i),n=a.bitSlice(n,0,o-i)):(e=n,n=[]),t=p.mode.gcm.C(!1,t,n,s,r,i),!a.equal(t.tag,e))throw new p.exception.corrupt("gcm: tag doesn't match");return t.data},ka:function(t,e){var r,s,i,n,a,o=p.bitArray.i;for(i=[0,0,0,0],n=e.slice(0),r=0;128>r;r++){for((s=(t[Math.floor(r/32)]&1<<31-r%32)!==0)&&(i=o(i,n)),a=(n[3]&1)!==0,s=3;0<s;s--)n[s]=n[s]>>>1|(n[s-1]&1)<<31;n[0]>>>=1,a&&(n[0]^=-520093696)}return i},j:function(t,e,r){var s,i=r.length;for(e=e.slice(0),s=0;s<i;s+=4)e[0]^=4294967295&r[s],e[1]^=4294967295&r[s+1],e[2]^=4294967295&r[s+2],e[3]^=4294967295&r[s+3],e=p.mode.gcm.ka(e,t);return e},C:function(t,e,r,s,i,n){var a,o,c,l,d,u,f,h,g=p.bitArray;for(u=r.length,f=g.bitLength(r),h=g.bitLength(s),o=g.bitLength(i),a=e.encrypt([0,0,0,0]),o===96?(i=i.slice(0),i=g.concat(i,[1])):(i=p.mode.gcm.j(a,[0,0,0,0],i),i=p.mode.gcm.j(a,i,[0,0,Math.floor(o/4294967296),o&4294967295])),o=p.mode.gcm.j(a,[0,0,0,0],s),d=i.slice(0),s=o.slice(0),t||(s=p.mode.gcm.j(a,o,r)),l=0;l<u;l+=4)d[3]++,c=e.encrypt(d),r[l]^=c[0],r[l+1]^=c[1],r[l+2]^=c[2],r[l+3]^=c[3];return r=g.clamp(r,f),t&&(s=p.mode.gcm.j(a,o,r)),t=[Math.floor(h/4294967296),h&4294967295,Math.floor(f/4294967296),f&4294967295],s=p.mode.gcm.j(a,s,t),c=e.encrypt(i),s[0]^=c[0],s[1]^=c[1],s[2]^=c[2],s[3]^=c[3],{tag:g.bitSlice(s,0,n),data:r}}};p.misc.hmac=function(t,e){this.W=e=e||p.hash.sha256;var r=[[],[]],s,i=e.prototype.blockSize/32;for(this.w=[new e,new e],t.length>i&&(t=e.hash(t)),s=0;s<i;s++)r[0][s]=t[s]^909522486,r[1][s]=t[s]^1549556828;this.w[0].update(r[0]),this.w[1].update(r[1]),this.R=new e(this.w[0])};p.misc.hmac.prototype.encrypt=p.misc.hmac.prototype.mac=function(t){if(this.aa)throw new p.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)};p.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1};p.misc.hmac.prototype.update=function(t){this.aa=!0,this.R.update(t)};p.misc.hmac.prototype.digest=function(){var t=this.R.finalize(),t=new this.W(this.w[1]).update(t).finalize();return this.reset(),t};p.misc.pbkdf2=function(t,e,r,s,i){if(r=r||1e4,0>s||0>r)throw new p.exception.invalid("invalid params to pbkdf2");typeof t=="string"&&(t=p.codec.utf8String.toBits(t)),typeof e=="string"&&(e=p.codec.utf8String.toBits(e)),i=i||p.misc.hmac,t=new i(t);var n,a,o,c,l=[],d=p.bitArray;for(c=1;32*l.length<(s||1);c++){for(i=n=t.encrypt(d.concat(e,[c])),a=1;a<r;a++)for(n=t.encrypt(n),o=0;o<n.length;o++)i[o]^=n[o];l=l.concat(i)}return s&&(l=d.clamp(l,s)),l};p.prng=function(t){this.c=[new p.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=t,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80};p.prng.prototype={randomWords:function(t,e){var r=[],s;s=this.isReady(e);var i;if(s===this.u)throw new p.exception.notReady("generator isn't seeded");if(s&this.J){s=!(s&this.I),i=[];var n=0,a;for(this.Z=i[0]=new Date().valueOf()+this.da,a=0;16>a;a++)i.push(4294967296*Math.random()|0);for(a=0;a<this.c.length&&(i=i.concat(this.c[a].finalize()),n+=this.m[a],this.m[a]=0,s||!(this.P&1<<a));a++);for(this.P>=1<<this.c.length&&(this.c.push(new p.hash.sha256),this.m.push(0)),this.f-=n,n>this.o&&(this.o=n),this.P++,this.b=p.hash.sha256.hash(this.b.concat(i)),this.L=new p.cipher.aes(this.b),s=0;4>s&&(this.h[s]=this.h[s]+1|0,!this.h[s]);s++);}for(s=0;s<t;s+=4)(s+1)%this.ca===0&&Jr(this),i=Yt(this),r.push(i[0],i[1],i[2],i[3]);return Jr(this),r.slice(0,t)},setDefaultParanoia:function(t,e){if(t===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new p.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=t},addEntropy:function(t,e,r){r=r||"user";var s,i,n=new Date().valueOf(),a=this.H[r],o=this.isReady(),c=0;switch(s=this.U[r],s===void 0&&(s=this.U[r]=this.ha++),a===void 0&&(a=this.H[r]=0),this.H[r]=(this.H[r]+1)%this.c.length,typeof t){case"number":e===void 0&&(e=1),this.c[a].update([s,this.N++,1,e,n,1,t|0]);break;case"object":if(r=Object.prototype.toString.call(t),r==="[object Uint32Array]"){for(i=[],r=0;r<t.length;r++)i.push(t[r]);t=i}else for(r!=="[object Array]"&&(c=1),r=0;r<t.length&&!c;r++)typeof t[r]!="number"&&(c=1);if(!c){if(e===void 0)for(r=e=0;r<t.length;r++)for(i=t[r];0<i;)e++,i=i>>>1;this.c[a].update([s,this.N++,2,e,n,t.length].concat(t))}break;case"string":e===void 0&&(e=t.length),this.c[a].update([s,this.N++,3,e,n,t.length]),this.c[a].update(t);break;default:c=1}if(c)throw new p.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[a]+=e,this.f+=e,o===this.u&&(this.isReady()!==this.u&&Mr("seeded",Math.max(this.o,this.f)),Mr("progress",this.getProgress()))},isReady:function(t){return t=this.T[t!==void 0?t:this.M],this.o&&this.o>=t?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=t?this.J|this.u:this.u},getProgress:function(t){return t=this.T[t||this.M],this.o>=t||this.f>t?1:this.f/t},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:Ie(this,this.ma),mouseCollector:Ie(this,this.oa),keyboardCollector:Ie(this,this.la),accelerometerCollector:Ie(this,this.ea),touchCollector:Ie(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new p.exception.bug("can't attach event");this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(t,e){this.K[t][this.ga++]=e},removeEventListener:function(t,e){var r,s,i=this.K[t],n=[];for(s in i)i.hasOwnProperty(s)&&i[s]===e&&n.push(s);for(r=0;r<n.length;r++)s=n[r],delete i[s]},la:function(){Pe(this,1)},oa:function(t){var e,r;try{e=t.x||t.clientX||t.offsetX||0,r=t.y||t.clientY||t.offsetY||0}catch{r=e=0}e!=0&&r!=0&&this.addEntropy([e,r],2,"mouse"),Pe(this,0)},qa:function(t){t=t.touches[0]||t.changedTouches[0],this.addEntropy([t.pageX||t.clientX,t.pageY||t.clientY],1,"touch"),Pe(this,0)},ma:function(){Pe(this,2)},ea:function(t){if(t=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z,window.orientation){var e=window.orientation;typeof e=="number"&&this.addEntropy(e,1,"accelerometer")}t&&this.addEntropy(t,2,"accelerometer"),Pe(this,0)}};function Mr(t,e){var r,s=p.random.K[t],i=[];for(r in s)s.hasOwnProperty(r)&&i.push(s[r]);for(r=0;r<i.length;r++)i[r](e)}function Pe(t,e){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?t.addEntropy(window.performance.now(),e,"loadtime"):t.addEntropy(new Date().valueOf(),e,"loadtime")}function Jr(t){t.b=Yt(t).concat(Yt(t)),t.L=new p.cipher.aes(t.b)}function Yt(t){for(var e=0;4>e&&(t.h[e]=t.h[e]+1|0,!t.h[e]);e++);return t.L.encrypt(t.h)}function Ie(t,e){return function(){e.apply(t,arguments)}}p.random=new p.prng(6);e:try{if(It=typeof module<"u"&&module.exports){try{Bt=Pi("crypto")}catch{Bt=null}It=Pt=Bt}if(It&&Pt.randomBytes)Ke=Pt.randomBytes(128),Ke=new Uint32Array(new Uint8Array(Ke).buffer),p.random.addEntropy(Ke,1024,"crypto['randomBytes']");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(Xe=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(Xe);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(Xe);else break e;p.random.addEntropy(Xe,1024,"crypto['getRandomValues']")}}catch(t){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(t))}var Ke,Pt,Xe,It,Bt;p.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(t,e,r,s){r=r||{},s=s||{};var i=p.json,n=i.g({iv:p.random.randomWords(4,0)},i.defaults),a;if(i.g(n,r),r=n.adata,typeof n.salt=="string"&&(n.salt=p.codec.base64.toBits(n.salt)),typeof n.iv=="string"&&(n.iv=p.codec.base64.toBits(n.iv)),!p.mode[n.mode]||!p.cipher[n.cipher]||typeof t=="string"&&100>=n.iter||n.ts!==64&&n.ts!==96&&n.ts!==128||n.ks!==128&&n.ks!==192&&n.ks!==256||2>n.iv.length||4<n.iv.length)throw new p.exception.invalid("json encrypt: invalid parameters");return typeof t=="string"?(a=p.misc.cachedPbkdf2(t,n),t=a.key.slice(0,n.ks/32),n.salt=a.salt):p.ecc&&t instanceof p.ecc.elGamal.publicKey&&(a=t.kem(),n.kemtag=a.tag,t=a.key.slice(0,n.ks/32)),typeof e=="string"&&(e=p.codec.utf8String.toBits(e)),typeof r=="string"&&(n.adata=r=p.codec.utf8String.toBits(r)),a=new p.cipher[n.cipher](t),i.g(s,n),s.key=t,n.ct=n.mode==="ccm"&&p.arrayBuffer&&p.arrayBuffer.ccm&&e instanceof ArrayBuffer?p.arrayBuffer.ccm.encrypt(a,e,n.iv,r,n.ts):p.mode[n.mode].encrypt(a,e,n.iv,r,n.ts),n},encrypt:function(t,e,r,s){var i=p.json,n=i.ja.apply(i,arguments);return i.encode(n)},ia:function(t,e,r,s){r=r||{},s=s||{};var i=p.json;e=i.g(i.g(i.g({},i.defaults),e),r,!0);var n,a;if(n=e.adata,typeof e.salt=="string"&&(e.salt=p.codec.base64.toBits(e.salt)),typeof e.iv=="string"&&(e.iv=p.codec.base64.toBits(e.iv)),!p.mode[e.mode]||!p.cipher[e.cipher]||typeof t=="string"&&100>=e.iter||e.ts!==64&&e.ts!==96&&e.ts!==128||e.ks!==128&&e.ks!==192&&e.ks!==256||!e.iv||2>e.iv.length||4<e.iv.length)throw new p.exception.invalid("json decrypt: invalid parameters");return typeof t=="string"?(a=p.misc.cachedPbkdf2(t,e),t=a.key.slice(0,e.ks/32),e.salt=a.salt):p.ecc&&t instanceof p.ecc.elGamal.secretKey&&(t=t.unkem(p.codec.base64.toBits(e.kemtag)).slice(0,e.ks/32)),typeof n=="string"&&(n=p.codec.utf8String.toBits(n)),a=new p.cipher[e.cipher](t),n=e.mode==="ccm"&&p.arrayBuffer&&p.arrayBuffer.ccm&&e.ct instanceof ArrayBuffer?p.arrayBuffer.ccm.decrypt(a,e.ct,e.iv,e.tag,n,e.ts):p.mode[e.mode].decrypt(a,e.ct,e.iv,n,e.ts),i.g(s,e),s.key=t,r.raw===1?n:p.codec.utf8String.fromBits(n)},decrypt:function(t,e,r,s){var i=p.json;return i.ia(t,i.decode(e),r,s)},encode:function(t){var e,r="{",s="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new p.exception.invalid("json encode: invalid property name");switch(r+=s+'"'+e+'":',s=",",typeof t[e]){case"number":case"boolean":r+=t[e];break;case"string":r+='"'+escape(t[e])+'"';break;case"object":r+='"'+p.codec.base64.fromBits(t[e],0)+'"';break;default:throw new p.exception.bug("json encode: unsupported type")}}return r+"}"},decode:function(t){if(t=t.replace(/\s/g,""),!t.match(/^\{.*\}$/))throw new p.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var e={},r,s;for(r=0;r<t.length;r++){if(!(s=t[r].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new p.exception.invalid("json decode: this isn't json!");s[3]!=null?e[s[2]]=parseInt(s[3],10):s[4]!=null?e[s[2]]=s[2].match(/^(ct|adata|salt|iv)$/)?p.codec.base64.toBits(s[4]):unescape(s[4]):s[5]!=null&&(e[s[2]]=s[5]==="true")}return e},g:function(t,e,r){if(t===void 0&&(t={}),e===void 0)return t;for(var s in e)if(e.hasOwnProperty(s)){if(r&&t[s]!==void 0&&t[s]!==e[s])throw new p.exception.invalid("required parameter overridden");t[s]=e[s]}return t},sa:function(t,e){var r={},s;for(s in t)t.hasOwnProperty(s)&&t[s]!==e[s]&&(r[s]=t[s]);return r},ra:function(t,e){var r={},s;for(s=0;s<e.length;s++)t[e[s]]!==void 0&&(r[e[s]]=t[e[s]]);return r}};p.encrypt=p.json.encrypt;p.decrypt=p.json.decrypt;p.misc.pa={};p.misc.cachedPbkdf2=function(t,e){var r=p.misc.pa,s;return e=e||{},s=e.iter||1e3,r=r[t]=r[t]||{},s=r[s]=r[s]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):p.random.randomWords(2,0)},r=e.salt===void 0?s.firstSalt:e.salt,s[r]=s[r]||p.misc.pbkdf2(t,r,e.iter),{key:s[r].slice(0),salt:r.slice(0)}};var it=class extends as{constructor(t,e,r){super(t),this.name="http",this.fetchProxied=!1,this.listening={},this.GET=(s="http://localhost:8080/ping",i="",n)=>(i==="json"&&(n="application/json"),new Promise((a,o)=>{let c=it.request({method:"GET",url:s,responseType:i,mimeType:n,onload:l=>{let d;c.responseType===""||c.responseType==="text"?d=c.responseText:d=c.response,s instanceof URL&&(s=s.toString()),this.setState({[s]:d}),a(d)},onabort:l=>{o(l)}})}).catch(console.error)),this.POST=(s,i="http://localhost:8080/echo",n="",a)=>(typeof s=="object"&&(n==="json"||n==="text"||!n)&&(s=JSON.stringify(s)),n==="json"&&(a="application/json"),new Promise((o,c)=>{let l=it.request({method:"POST",url:i,data:s,responseType:n,mimeType:a,onload:d=>{let u;l.responseType===""||l.responseType==="text"?u=l.responseText:u=l.response,i instanceof URL&&(i=i.toString()),this.setState({[i]:u}),o(u)},onabort:d=>{c(d)}})}).catch(console.error)),this.transmit=(s,i)=>{var a;let n=s;return typeof n=="object"&&(s=JSON.stringify(n)),((a=n==null?void 0:n.method)==null?void 0:a.toLowerCase())=="get"||(s==null?void 0:s.toLowerCase())==="get"?this.GET(i):this.POST(s,i)},this.transponder=(s,i,n="",a)=>{typeof i=="object"&&(i=JSON.stringify(i));let o="GET";if(i&&(o="POST"),n!=="json")return new Promise((c,l)=>{let d=it.request({method:o,url:s,data:i,responseType:n,onload:u=>{let f=d.response;if(typeof f=="string"){let h=f.substring(0,8);(h.includes("{")||h.includes("["))&&(h.includes("\\")&&(f=f.replace(/\\/g,"")),f[0]==='"'&&(f=f.substring(1,f.length-1)),f=JSON.parse(f))}return typeof(f==null?void 0:f.method)=="string"?c(this.handleMethod(f.route,f.method,f.args)):typeof(f==null?void 0:f.route)=="string"?c(this.handleServiceMessage(f)):typeof(f==null?void 0:f.node)=="string"||f.node instanceof A?c(this.handleGraphNodeCall(f.node,f.args)):c(f)},onabort:u=>{l(u)}})}).catch(console.error)},this.listen=(s="0",i=async(n,a,o)=>{const c=await n.text(),l=this.receive(c);this.setState({[o.url]:l})})=>{this.listening[s]={};let n=`${s}${Math.floor(Math.random()*1e15)}`;return this.listening[s][n]=i,this.fetchProxied||(globalThis.fetch=new Proxy(globalThis.fetch,{apply(a,o,c){const l=a.apply(o,c);return l.then(d=>{if(d.ok){if(this.listening[0])for(const u in this.listeners){const f=d.clone();this.listening[0][u](f,c,d)}else for(const u in this.listening)if(d.url.includes(u)){for(const f in this.listening[s]){const h=d.clone();this.listening[s][f](h,c,d)}break}}}).catch(d=>{console.error(d)}),l}}),this.fetchProxied=!0),n},this.stopListening=(s,i)=>{if(!s&&s!==0)for(const n in this.listening)delete this.listening[n];else i?delete this.listening[i]:delete this.listening[s]},this.load(this),this.listen(e,r)}},Zi=it;Zi.request=t=>{const e=new XMLHttpRequest;return t.responseType?e.responseType=t.responseType:t.responseType="json",t.mimeType&&e.overrideMimeType(t.mimeType),t.onload&&e.addEventListener("load",t.onload,!1),t.onprogress&&e.addEventListener("progress",t.onprogress,!1),t.onabort&&e.addEventListener("abort",t.onabort,!1),t.onloadend&&e.addEventListener("loadend",t.onloadend,!1),t.onerror&&e.addEventListener("error",t.onerror,!1),e.open(t.method,t.url,!0,t.user,t.pass),t.onerror||(e.onerror=function(){e.abort()}),e.send(t.data),e};var le=Li(Mi()),en=class extends as{constructor(t){super(),this.name="worker",this.workers={},this.threadRot=0,this.loadWorkerRoute=(e,r)=>{e.workerUrl&&(e.url=e.workerUrl),e.workerId&&(e.__node.tag=e.workerId),e.__node.tag||(e.__node.tag=r),e._id=e.__node.tag;let s;if(this.workers[e._id]?s=this.workers[e._id]:e.worker&&(s=e.worker),s||(s=this.addWorker(e)),e.worker=s,!e.worker.__ondisconnected){let i=n=>{var a;(a=n.worker)==null||a.terminate()};e.__addOndisconnected(i)}if(e.transferFunctions)for(const i in e.transferFunctions)this.transferFunction(s,e.transferFunctions[i],i);if(e.transferClasses)for(const i in e.transferClasses)this.transferClass(s,e.transferClasses[i],i);if(s)return e.__operator||(e.__operator=(...i)=>{var n,a;if(e.callback)if(!((n=this.__node.nodes.get(e.__node.tag))!=null&&n.__children))s.post(e.callback,i);else return s.run(e.callback,i);else if(!((a=this.__node.nodes.get(e.__node.tag))!=null&&a.__children))s.send(i);else return s.request(i)}),e.init&&s.run(e.init,e.initArgs,void 0,e.initTransfer),s},this.workerloader={workers:(e,r,s,i)=>{var a,o,c,l,d,u,f,h,g,b,y,_,m,S,N,I,F,x,O,R,U;let n=e;if(!e.parentRoute&&(r!=null&&r.callback)&&(r!=null&&r.worker)&&(e.parentRoute=r==null?void 0:r.callback),n!=null&&n.worker||n!=null&&n.workerId||n!=null&&n.workerUrl){let w=this.loadWorkerRoute(n,n.__node.tag);w&&(!n.parentRoute&&((a=n.__parent)!=null&&a.callback)&&(n.parentRoute=n.__parent.callback),n.__parent&&!n.portId&&(typeof n.__parent=="string"?n.__node.tag!==n.__parent&&w._id!==n.__parent&&(n.portId=this.establishMessageChannel(w,n.__parent)):n.__node.tag!==((c=(o=n.__parent)==null?void 0:o.__node)==null?void 0:c.tag)&&w._id!==((l=n.__parent)==null?void 0:l.tag)&&(n.portId=this.establishMessageChannel(w,n.__parent.worker))),n.parentRoute?(n.stopped||(typeof n.__parent=="string"&&n.__parent===w._id?w.run("subscribe",[n.parentRoute,void 0,void 0,n.callback]):n.__node.tag===((u=(d=n.__parent)==null?void 0:d.__node)==null?void 0:u.tag)||w._id===((h=(f=n.__parent)==null?void 0:f.__node)==null?void 0:h.tag)?w.run("subscribe",[n.parentRoute,void 0,void 0,n.callback]):w.run("subscribeToWorker",[n.parentRoute,n.portId,void 0,n.callback,void 0,void 0,n.blocking]).then(J=>{w.workerSubs[n.parentRoute+n.portId].sub=J})),!(typeof n.__parent=="string"&&n.__parent===w._id)&&!(n.__node.tag===((b=(g=n.__parent)==null?void 0:g.__node)==null?void 0:b.tag)||w._id===((_=(y=n.__parent)==null?void 0:y.__node)==null?void 0:_.tag))&&(w.workerSubs[n.parentRoute+n.portId]={sub:null,route:n.parentRoute,portId:n.portId,callback:n.callback,blocking:n.blocking})):n.__parent&&(typeof n.__parent=="string"?(n.stopped||(n.__parent===w._id?w.run("subscribe",[n.__parent,void 0,n.callback]):w.run("subscribeToWorker",[n.__parent,n.portId,void 0,n.callback,void 0,void 0,n.blocking]).then(J=>{w.workerSubs[n.__parent+n.portId].sub=J})),typeof n.__parent=="string"&&n.__parent===w._id||(w.workerSubs[n.__parent+n.portId]={sub:null,route:w._id,portId:n.portId,callback:n.callback,blocking:n.blocking})):(S=(m=n.__parent)==null?void 0:m.__node)!=null&&S.tag&&((N=n.__parent)!=null&&N.worker)&&(n.stopped||(n.__node.tag===n.__parent.__node.tag||w._id===n.__parent.__node.tag?w.run("subscribe",[n.__parent.__node.tag,void 0,void 0,n.callback]):w.run("subscribeToWorker",[n.__parent.__node.tag,n.portId,void 0,n.callback,void 0,void 0,n.blocking]).then(J=>{w.workerSubs[n.__parent.__node.tag+n.portId].sub=J})),n.__node.tag===((F=(I=n.__parent)==null?void 0:I.__node)==null?void 0:F.tag)||w._id===((O=(x=n.__parent)==null?void 0:x.__node)==null?void 0:O.tag)||(w.workerSubs[n.__parent.__node.tag+n.portId]={sub:null,route:n.__parent.__node.tag,portId:n.portId,callback:n.callback,blocking:n.blocking}))))}else n.__parent&&n.parentRoute&&(typeof n.__parent=="string"&&((R=i[n.__parent])!=null&&R.worker)?i[n.__parent].worker.subscribe(n.parentRoute,n.__operator,void 0,void 0,void 0,n.blocking):(U=n.__parent)!=null&&U.worker&&n.__parent.worker.subscribe(n.parentRoute,n.__operator,void 0,void 0,void 0,n.blocking));return n}},this.addDefaultMessageListener=()=>{globalThis.onmessage=e=>{let r=this.receive(e.data);this.__node.keepState&&this.setState({[this.name]:r})}},this.postMessage=(e,r,s)=>{this.workers[r]?this.workers[r].send(e,s):globalThis.postMessage(e,r,s)},this.addWorker=e=>{let r;if(e._id||(e._id=`worker${Math.floor(Math.random()*1e15)}`),e.url?r=new le.default(e.url):e.port?r=e.port:this.workers[e._id]&&(this.workers[e._id].port?r=this.workers[e._id].port:r=this.workers[e._id].worker),!r)return;let s=(h,g)=>this.transmit(h,r,g),i=(h,g,b,y)=>{let _={route:h,args:g};return b&&(_.method=b),this.transmit(_,r,y)},n=(h,g,b,y)=>new Promise((_,m)=>{let S=Math.random(),N={route:"runRequest",args:[{route:h,args:g},e._id,S]};b&&(N.args[0].method=b);let I=F=>{typeof F.data=="object"&&F.data.callbackId===S&&(r.removeEventListener("message",I),_(F.data.args))};r.addEventListener("message",I),this.transmit(N,r,y)}),a=(h,g,b)=>new Promise((y,_)=>{let m=Math.random(),S={route:"runRequest",args:[h,e._id,m]};g&&(S.method=g);let N=I=>{typeof I.data=="object"&&I.data.callbackId===m&&(r.removeEventListener("message",N),y(I.data.args))};r.addEventListener("message",N),this.transmit(S,r,b)}),o={},c=(h,g,b,y,_,m)=>this.subscribeToWorker(h,e._id,g,b,y,_,m),l=(h,g)=>n("unsubscribe",[h,g]),d=async(h,g,b,y)=>{if(h)await n("subscribeToWorker",[h,g,void 0,b,y]).then(_=>{_&&(o[h+g]={sub:_,route:h,portId:g,callback:b,blocking:y})});else for(const _ in o)typeof o[_].sub!="number"&&await n("subscribeToWorker",[o[_].route,o[_].portId,void 0,o[_].callback,void 0,o[_].blocking]).then(m=>{o[_].sub=m}),console.log(JSON.stringify(o));return!0},u=async(h,g)=>{if(h&&g&&o[h+g])await n("unsubscribe",[h,o[h+g].sub]),o[h+g].sub=!1;else for(const b in o)typeof o[b].sub=="number"&&await n("unpipeWorkers",[o[b].route,o[b].portId,o[b].sub]).then(console.log),o[b].sub=!1;return!0},f=()=>{for(const h in o)typeof o[h].sub=="number"&&n("unpipeWorkers",[o[h].route,o[h].portId,o[h].sub]),o[h].sub=!1;return this.terminate(e._id)};return e.onmessage||(e.onmessage=h=>{this.receive(h.data),this.setState({[e._id]:h.data})}),e.onerror||(e.onerror=h=>{console.error(h.data)}),r.onmessage=e.onmessage,r.onerror=e.onerror,this.workers[e._id]={worker:r,send:s,post:i,run:n,request:a,subscribe:c,unsubscribe:l,terminate:f,start:d,stop:u,postMessage:r.postMessage,workerSubs:o,graph:this,...e},this.workers[e._id]},this.open=this.addWorker,this.toObjectURL=e=>{let r=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(r)},this.transmit=(e,r,s)=>{if(s||(s=this.getTransferable(e)),r instanceof le.default||r instanceof MessagePort)r.postMessage(e,s);else if(typeof r=="string")this.workers[r]&&(this.workers[r].port?this.workers[r].port.postMessage(e,s):this.workers[r].worker&&this.workers[r].worker.postMessage(e,s));else{let i=Object.keys(this.workers);this.workers[i[this.threadRot]].worker.postMessage(e,s),this.threadRot++,this.threadRot===i.length&&(this.threadRot=0)}return e},this.terminate=e=>{let r;if(typeof e=="string"){let s=this.workers[e];s&&(delete this.workers[e],e=s.worker,s.onclose&&(r=s.onclose))}else typeof e=="object"&&e!=null&&e._id&&(e=e.worker,delete this.workers[e==null?void 0:e._id]);return e instanceof le.default?(e.terminate(),r&&r(e),!0):e instanceof MessagePort?(e.close(),r&&r(e),!0):!1},this.establishMessageChannel=(e,r)=>{let s;if(typeof e=="string"?(s=e,this.workers[e]&&(this.workers[e].port?e=this.workers[e].port:r=this.workers[e].worker)):e!=null&&e.worker&&(e=e.worker),typeof r=="string"?this.workers[r]&&(this.workers[r].port?r=this.workers[r].port:r=this.workers[r].worker):r!=null&&r.worker&&(r=r.worker),e instanceof le.default||e instanceof MessagePort){let i=new MessageChannel,n=`port${Math.floor(Math.random()*1e15)}`;return e.postMessage({route:"addWorker",args:{port:i.port1,_id:n}},[i.port1]),r instanceof le.default||r instanceof MessagePort?r.postMessage({route:"addWorker",args:{port:i.port2,_id:n}},[i.port2]):s&&this.workers[s]&&(i.port2.onmessage=this.workers[s].onmessage,this.workers[s].port=i.port2),n}return!1},this.request=(e,r,s,i)=>{let n=this.workers[r].worker;return new Promise((a,o)=>{let c=Math.random(),l={route:"runRequest",args:[e,c]};i&&(l.method=i);let d=u=>{typeof u.data=="object"&&u.data.callbackId===c&&(n.removeEventListener("message",d),a(u.data.args))};n.addEventListener("message",d),this.transmit(l,n,s)})},this.runRequest=(e,r,s)=>{let i=this.receive(e);return typeof r=="string"&&this.workers[r]&&(this.workers[r].port?r=this.workers[r].port:r=this.workers[r].worker),i instanceof Promise?i.then(n=>{r instanceof le.default||r instanceof MessagePort?r.postMessage({args:n,callbackId:s}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:n,callbackId:s})}):r instanceof le.default||r instanceof MessagePort?r.postMessage({args:i,callbackId:s}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:i,callbackId:s}),i},this.subscribeWorker=(e,r,s,i,n,a)=>{let o;if(a){let c=!1;o=l=>{c||(c=!0,l instanceof Promise?l.then(d=>{r!=null&&r.run&&r.run("triggerSubscription",[e,r._id,d]).then(u=>{c=!1})}):r!=null&&r.run&&r.run("triggerSubscription",[e,r._id,l]).then(d=>{c=!1}))}}else o=c=>{c instanceof Promise?c.then(l=>{r!=null&&r.postMessage?r.postMessage({args:l,callbackId:e}):globalThis.postMessage&&globalThis.postMessage({args:l,callbackId:e})}):r!=null&&r.postMessage?r.postMessage({args:c,callbackId:e}):globalThis.postMessage&&globalThis.postMessage({args:c,callbackId:e})};return!a&&(r!=null&&r.port)?r=r.port:!a&&(r!=null&&r.worker)?r=r.worker:typeof r=="string"&&this.workers[r]&&(a?r=this.workers[r]:this.workers[r].port?r=this.workers[r].port:r=this.workers[r].worker),this.subscribe(e,o,s,i,n)},this.subscribeToWorker=(e,r,s,i,n,a,o)=>{if(typeof r=="string"&&this.workers[r])return this.__node.state.subscribeEvent(r,c=>{(c==null?void 0:c.callbackId)===e&&(s?typeof s=="string"?this.run(s,c.args):s(c.args):this.setState({[r]:c.args}))}),this.workers[r].run("subscribeWorker",[e,r,i,n,a,o])},this.triggerSubscription=async(e,r,s)=>{if(this.__node.state.triggers[r])for(let i=0;i<this.__node.state.triggers[r].length;i++)await this.__node.state.triggers[r][i].onchange({args:s,callbackId:e});return!0},this.pipeWorkers=(e,r,s,i,n,a,o,c,l)=>(typeof e=="string"&&(e=this.workers[e]),typeof r=="string"&&(r=this.workers[r]),n||(n=this.establishMessageChannel(e.worker,r.worker)),r.run("subscribeToWorker",[s,n,i,a,o,c,l])),this.unpipeWorkers=(e,r,s)=>{if(typeof r=="string"&&(r=this.workers[r]),typeof r=="object")return r.run("unsubscribe",[e,s])},this.connections={workers:this.workers},t!=null&&t.services&&this.addServices(t.services),this.load(this),this.setLoaders(this.workerloader),t&&this.init(t),typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope&&this.addDefaultMessageListener()}getTransferable(t){var r,s,i,n,a,o,c,l,d,u;let e;if(typeof t=="object")if(t.args)if(((s=(r=t.args)==null?void 0:r.constructor)==null?void 0:s.name)==="Object")for(const f in t.args)ArrayBuffer.isView(t.args[f])?e?e.push(t.args[f].buffer):e=[t.args[f].buffer]:((n=(i=t.args[f])==null?void 0:i.constructor)==null?void 0:n.name)==="ArrayBuffer"&&(e?e.push(t.args[f]):e=[t.args[f]]);else Array.isArray(t.args)&&t.args.length<11?t.args.forEach(f=>{var h;ArrayBuffer.isView(f)?e=[f.buffer]:((h=f==null?void 0:f.constructor)==null?void 0:h.name)==="ArrayBuffer"&&(e=[f])}):ArrayBuffer.isView(t.args)?e=[t.args.buffer]:((o=(a=t.args)==null?void 0:a.constructor)==null?void 0:o.name)==="ArrayBuffer"&&(e=[t]);else if(((c=t==null?void 0:t.constructor)==null?void 0:c.name)==="Object")for(const f in t)ArrayBuffer.isView(t[f])?e?e.push(t[f].buffer):e=[t[f].buffer]:((d=(l=t[f])==null?void 0:l.constructor)==null?void 0:d.name)==="ArrayBuffer"&&(e?e.push(t[f]):e=[t[f]]);else Array.isArray(t)&&t.length<11?t.forEach(f=>{var h;ArrayBuffer.isView(f)?e=[f.buffer]:((h=f.constructor)==null?void 0:h.name)==="ArrayBuffer"&&(e=[f])}):ArrayBuffer.isView(t)?e=[t.buffer]:((u=t.constructor)==null?void 0:u.name)==="ArrayBuffer"&&(e=[t]);return e}},$=cr(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","timeStamp"]),tn=cr(["deltaX","deltaY"]),rn=cr(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function Dr(t,e){const r={type:t.type};r.isTrusted=t.isTrusted,r.bubbles=t.bubbles,r.cancelBubble=t.cancelBubble,r.cancelable=t.cancelable,r.composed=t.composed,r.defaultPrevent=t.defaultPrevented,r.eventPhase=t.eventPhase,r.returnValue=t.returnValue,r.currentTarget=t.currentTarget.id?t.currentTarget.id:t.currentTarget.constructor.name,r.target=r.currentTarget,r.srcElement=r.currentTarget,e(r)}function sn(t,e){t.preventDefault(),tn(t,e)}function nn(t){t.preventDefault()}function an(t,e,r){for(const s of e)r[s]=t[s]}function cr(t){return function(r,s){const i={type:r.type};an(r,t,i),s(i)}}function Lt(t,e){const r=[],s={type:t.type,touches:r};for(let i=0;i<t.touches.length;++i){const n=t.touches[i];r.push({pageX:n.pageX,pageY:n.pageY})}e(s)}var Mt=1,os={};for(;Mt<222;)os[Mt]=!0,Mt++;function Fr(t,e){let{keyCode:r}=t;os[r]&&(t.preventDefault&&(r<110||r>123)&&t.preventDefault(),rn(t,e))}var Be={contextmenu:nn,mousedown:$,mousemove:$,mouseup:$,pointerdown:$,pointermove:$,pointerup:$,pointerlockchange:$,webkitpointerlockchange:$,focus:Dr,blur:Dr,pointerout:$,touchstart:Lt,touchmove:Lt,touchend:Lt,wheel:sn,keydown:Fr,keyup:Fr};function lr(t,e,r){r||(r="proxy"+Math.floor(Math.random()*1e15));const s=a=>{e?e.postMessage({route:"handleProxyEvent",args:[a,r]}):cs(a,r)};let i=Object.entries(Be);for(const[a,o]of i)t.addEventListener(a,function(c){o(c,s)});Be.keydown&&globalThis.addEventListener("keydown",function(a){Be.keydown(a,s)}),Be.keyup&&globalThis.addEventListener("keyup",function(a){Be.keyup(a,s)});const n=()=>{const a=t.getBoundingClientRect();s({type:"resize",left:a.left,top:a.top,width:t.clientWidth,height:t.clientHeight})};return n(),globalThis.addEventListener("resize",n),r}var on=class{addEventListener(t,e){this.__listeners===void 0&&(this.__listeners={});const r=this.__listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(e)===-1&&r[t].push(e)}hasEventListener(t,e){if(this.__listeners===void 0)return!1;const r=this.__listeners;return r[t]!==void 0&&r[t].indexOf(e)!==-1}removeEventListener(t,e){if(this.__listeners===void 0)return;const s=this.__listeners[t];if(s!==void 0){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}dispatchEvent(t,e){if(this.__listeners===void 0)return;const s=this.__listeners[t.type];if(s!==void 0){e?t.target=e:t.target=this;const i=s.slice(0);for(let n=0,a=i.length;n<a;n++)i[n].call(this,t)}}};function Rr(){}var cn=class extends on{constructor(){super(),this.__listeners={},this.style={},this.setPointerCapture=()=>{},this.releasePointerCapture=()=>{},this.getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}),this.handleEvent=t=>{t.type==="resize"&&(this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),t.preventDefault=Rr,t.stopPropagation=Rr,this.dispatchEvent(t,this.proxied)},this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}},pt=class{constructor(){this.targets={},this.makeProxy=(t,e=void 0)=>{t||(t=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let r;this.targets[t]?r=this.targets[t]:(r=new cn,this.targets[t]=r),typeof e=="object"&&(e.proxy=r,r.proxied=e,typeof WorkerGlobalScope<"u"&&(e.style=r.style),r.width&&(e.style.width=r.width+"px",e.clientWidth=r.width),r.height&&(e.style.height=r.height+"px",e.clientHeight=r.height),e.setPointerCapture=r.setPointerCapture.bind(r),e.releasePointerCapture=r.releasePointerCapture.bind(r),e.getBoundingClientRect=r.getBoundingClientRect.bind(r),e.addEventListener=r.addEventListener.bind(r),e.removeEventListener=r.removeEventListener.bind(r),e.handleEvent=r.handleEvent.bind(r),e.dispatchEvent=r.dispatchEvent.bind(r),e.focus=r.focus.bind(r),e.blur=r.blur.bind(r))},this.getProxy=t=>this.targets[t],this.handleEvent=(t,e)=>{if(this.targets[e]||this.makeProxy(e),this.targets[e])return this.targets[e].handleEvent(t),!0},globalThis.document||(globalThis.document={elementFromPoint:(...t)=>this.targets[Object.keys(this.targets)[0]].proxied})}};function ln(t,e){var r;return(r=this==null?void 0:this.__node)!=null&&r.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new pt),this.__node.graph.ProxyManager.makeProxy(t,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new pt),globalThis.ProxyManager.makeProxy(t,e)),t}function cs(t,e){var r;if((r=this==null?void 0:this.__node)!=null&&r.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new pt),this.__node.graph.ProxyManager.handleEvent(t,e))return t}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new pt),globalThis.ProxyManager.handleEvent(t,e))return t}var dr={initProxyElement:lr,makeProxy:ln,handleProxyEvent:cs};function dn(t){if(t.worker){let e=t.worker,r=t.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete t.worker,delete t.route,ls(e,t,r)}else return lr(t.canvas,void 0,t._id),ds(t)}function ls(t,e,r){var o;if(console.log(e),!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let s=e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let i={route:r||"setupCanvas",args:{...e,canvas:s}};(o=this==null?void 0:this.__node)!=null&&o.graph?this.__node.graph.run("initProxyElement",e.canvas,t,e._id):lr(e.canvas,t,e._id),e.draw&&(typeof e.draw=="function"?i.args.draw=e.draw.toString():i.args.draw=e.draw),e.update&&(typeof e.update=="function"?i.args.update=e.update.toString():i.args.update=e.update),e.init&&(typeof e.init=="function"?i.args.init=e.init.toString():i.args.init=e.init),e.clear&&(typeof e.clear=="function"?i.args.clear=e.clear.toString():i.args.clear=e.clear);let n=[s];return e.transfer&&(n.push(...e.transfer),delete e.transfer),t.postMessage(i,n),{_id:e._id,width:e.width,height:e.height,worker:t,draw:(c,l)=>{t.postMessage({route:"drawFrame",args:[c,e._id]},l)},update:(c,l)=>{t.postMessage({route:"updateCanvas",args:[c,e._id]},l)},clear:()=>{t.postMessage({route:"clearCanvas",args:e._id})},init:()=>{t.postMessage({route:"initCanvas",args:e._id})},stop:()=>{t.postMessage({route:"stopAnim",args:e._id})},start:()=>{t.postMessage({route:"startAnim",args:e._id})},set:(c,l)=>{t.postMessage({route:"setDraw",args:[c,e._id]},l)},terminate:()=>{t.terminate()}}}function nt(t,e){var s,i,n,a,o,c,l,d;let r;if((s=this==null?void 0:this.__node)!=null&&s.graph?e?r=(i=this.__node.graph.CANVASES)==null?void 0:i[t._id]:t._id?r=(n=this.__node.graph.CANVASES)==null?void 0:n[t._id]:r=(a=this.__node.graph.CANVASES)==null?void 0:a[Object.keys(this.__node.graph.CANVASES)[0]]:e?r=(o=globalThis.CANVASES)==null?void 0:o[t._id]:t._id?r=(c=globalThis.CANVASES)==null?void 0:c[t._id]:r=(l=globalThis.CANVASES)==null?void 0:l[Object.keys(globalThis.CANVASES)[0]],r)return t.canvas&&(r.canvas=t.canvas,(d=this==null?void 0:this.__node)!=null&&d.graph?this.__node.graph.run("makeProxy",r._id,r.canvas):dr.makeProxy(r._id,r.canvas)),typeof t.context=="string"?r.context=r.canvas.getContext(t.context):t.context&&(r.context=t.context),t.width&&(r.canvas.width=t.width),t.height&&(r.canvas.height=t.height),typeof t.draw=="string"&&(t.draw=Q(t.draw)),typeof t.draw=="function"&&(r.draw=t.draw.bind(t)),typeof t.update=="string"&&(t.update=Q(t.update)),typeof t.update=="function"&&(r.update=t.update.bind(t)),typeof t.init=="string"&&(t.init=Q(t.init)),typeof t.init=="function"&&(r.init=t.init.bind(t)),typeof t.clear=="string"&&(t.clear=Q(t.clear)),typeof t.clear=="function"&&(r.clear=t.clear.bind(t)),t._id}function ds(t){var r,s,i,n,a,o,c;(r=this==null?void 0:this.__node)!=null&&r.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=t;if(t._id?e._id=t._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof t.context=="string"?e.context=t.canvas.getContext(t.context):e.context=t.context,"animating"in t?e.animating=t.animating:e.animating=!0,(i=(s=this==null?void 0:this.__node)==null?void 0:s.graph)!=null&&i.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if((n=globalThis.CANVASES)!=null&&n[e._id])nt(e);else if((a=this==null?void 0:this.__node)!=null&&a.graph&&(e.graph=this.__node.graph,e.__node||(e.__node={}),e.__node.tag||(e.__node.tag=e._id),e=this.__node.graph.add(e),e.__addOndisconnected=()=>{e.stop(),delete this.__node.graph.CANVASES[e._id]}),(o=this==null?void 0:this.__node)!=null&&o.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,(c=this==null?void 0:this.__node)!=null&&c.graph?this.__node.graph.run("makeProxy",e._id,e.canvas):dr.makeProxy(e._id,e.canvas),t.width&&(e.canvas.width=t.width),t.height&&(e.canvas.height=t.height),typeof e.draw=="string"?e.draw=Q(e.draw):typeof e.draw=="function"&&(e.draw=e.draw.bind(e)),typeof e.update=="string"?e.update=Q(e.update):typeof e.update=="function"&&(e.update=e.update.bind(e)),typeof e.init=="string"?e.init=Q(e.init):typeof e.init=="function"&&(e.init=e.init.bind(e)),typeof e.clear=="string"?e.clear=Q(e.clear):typeof e.clear=="function"&&(e.clear=e.clear.bind(e)),typeof e.init=="function"&&e.init(e,e.canvas,e.context),e.stop=()=>{at(e._id)},e.start=l=>{Qt(e._id,l)},e.set=l=>{nt(l,e._id)},typeof e.draw=="function"&&e.animating){let l=(d,u,f)=>{d.animating&&(d.draw(d,u,f),requestAnimationFrame(()=>{l(d,u,f)}))};l(e,e.canvas,e.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?e._id:{_id:t._id,width:t.width,height:t.height,draw:d=>{fs(d,t._id)},update:d=>{hs(d,t._id)},clear:()=>{us(t._id)},init:()=>{ps(t._id)},stop:()=>{at(t._id)},start:()=>{Qt(t._id)},set:d=>{nt(d,t._id)},terminate:()=>{var d,u;(d=this.__node)!=null&&d.graph?this.__node.graph.remove(t._id):(at(t._id),(u=this==null?void 0:this.__node)!=null&&u.graph?delete this.__node.graph.CANVASES[e._id]:delete globalThis.CANVASES[e._id])}}}function fs(t,e){let r=oe.call(this,e);if(r&&(t&&Object.assign(r,t),r.draw))return r.draw(r,r.canvas,r.context),e}function us(t){let e=oe.call(this,t);if(e!=null&&e.clear)return e.clear(e,e.canvas,e.context),t}function ps(t){let e=oe.call(this,t);if(e!=null&&e.init)return e.init(e,e.canvas,e.context),t}function hs(t,e){let r=oe.call(this,e);if(r!=null&&r.update)return r.update(r,r.canvas,r.context,t),e}function fn(t,e){let r=oe.call(this,e);if(r)return Object.assign(r,t),t.width&&(r.canvas.width=t.width),t.height&&(r.canvas.height=t.height),e}function Qt(t,e){let r=oe.call(this,t);if(r.animating=!0,r&&e)return typeof e=="string"&&(e=Q(e)),typeof e=="function"&&(r.draw=e),t;if(typeof(r==null?void 0:r.draw)=="function"){let s=(i,n,a)=>{i.animating&&(i.draw(i,n,a),requestAnimationFrame(()=>{s(i,n,a)}))};return typeof r.clear=="function"&&r.clear(r,r.canvas,r.context),typeof r.init=="function"&&r.init(r,r.canvas,r.context),s(r,r.canvas,r.context),t}}function at(t){let e=oe.call(this,t);if(e)return e.animating=!1,typeof e.clear=="function"&&requestAnimationFrame(e.clear(e,e.canvas,e.context)),t}function oe(t){var r,s,i,n,a;let e;return(r=this==null?void 0:this.__node)!=null&&r.graph?t?e=(i=this.__node.graph.CANVASES)==null?void 0:i[t]:e=(s=this.__node.graph.CANVASES)==null?void 0:s[Object.keys(this.__node.graph.CANVASES)[0]]:t?e=(a=globalThis.CANVASES)==null?void 0:a[t]:e=(n=globalThis.CANVASES)==null?void 0:n[Object.keys(globalThis.CANVASES)[0]],e}var un={...dr,Renderer:dn,transferCanvas:ls,setupCanvas:ds,setDraw:nt,drawFrame:fs,clearCanvas:us,initCanvas:ps,updateCanvas:hs,setProps:fn,startAnim:Qt,stopAnim:at,getCanvas:oe};function Q(t=""){let e=a=>a.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),s=(a=>{let o=a.indexOf("=>")+1;return o<=0&&(o=a.indexOf("){")),o<=0&&(o=a.indexOf(") {")),a.slice(0,a.indexOf("{",o)+1)})(t),i=e(t),n;if(s.includes("function")){let a=s.split("(")[1].split(")")[0];n=new Function(a,i)}else if(s.substring(0,6)===i.substring(0,6)){let a=s.split("(")[1].split(")")[0];n=new Function(a,i.substring(i.indexOf("{")+1,i.length-1))}else try{n=(0,eval)(s+i+"}")}catch{}return n}var pn=URL.createObjectURL(new Blob(['(()=>{var __require=(x=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof require!=="undefined"?require:a)[b]}):x)(function(x){if(typeof require!=="undefined")return require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x+\'" is not supported\')});var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __require2=(x=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x)(function(x){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x+\'" is not supported\')});var __commonJS=(cb,mod)=>function __require22(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var require_browser=__commonJS({"node_modules/web-worker/cjs/browser.js"(exports,module2){module2.exports=Worker}});var EventHandler=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.setState=updateObj=>{Object.assign(this.data,updateObj);let props=Object.getOwnPropertyNames(updateObj);for(const prop of props){this.triggerEvent(prop,this.data[prop])}return this.data};this.setValue=(key,value)=>{this.data[key]=value;this.triggerEvent(key,value)};this.triggerEvent=(key,value)=>{if(this.triggers[key]){let fn=obj=>obj.onchange(value);this.triggers[key].forEach(fn)}};this.subscribeEvent=(key,onchange,refObject,refKey)=>{if(key){if(refObject&&refKey&&!this.triggers[key]){Object.defineProperty(this.data,key,{get:()=>{return refObject[refKey]},set:value=>{refObject[refKey]=value},enumerable:true,configurable:true})}if(!this.triggers[key]){this.triggers[key]=[]}let l=this.triggers[key].length;this.triggers[key].push({sub:l,onchange});return this.triggers[key].length-1}else return void 0};this.unsubscribeEvent=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(!sub){delete this.triggers[key];delete this.data[key]}else{let sub2=void 0;let obj=triggers.find((o,i2)=>{if(o.sub===sub2){sub2=i2;return true}});if(obj)triggers.splice(sub2,1);if(Object.keys(triggers).length===0){delete this.triggers[key];delete this.data[key]}if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeEventOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeEvent(key,sub)};sub=this.subscribeEvent(key,changed)};this.getEvent=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};this.getSnapshot=()=>{const snapshot={};for(const key in this.data){snapshot[key]=this.data[key]}};if(typeof data==="object")this.data=data}};var state=new EventHandler;var GraphNode=class{constructor(properties,parent,graph){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state};this.__setProperties=(properties2,parent2,graph2)=>{let enforceProperties=()=>{let orig=properties2;if(typeof properties2==="function"){if(isNativeClass(properties2)){properties2=new properties2}else properties2={__operator:properties2,__node:{forward:true,tag:properties2.name}}}else if(typeof properties2==="string"){if(graph2?.get(properties2)){properties2=graph2.get(properties2)}}if(!properties2.__node.initial)properties2.__node.initial=orig};enforceProperties();if(typeof properties2==="object"){let assignState=()=>{if(properties2.__node?.state)this.__node.state=properties2.__node.state};let setProps2=()=>{if(properties2.__props){if(typeof properties2.__props==="function")properties2.__props=new properties2.__props;if(typeof properties2.__props==="object"){this.__proxyObject(properties2.__props)}}};let setTag=()=>{if(!properties2.__node.tag){if(properties2.__operator?.name)properties2.__node.tag=properties2.__operator.name;else properties2.__node.tag=`node${Math.floor(Math.random()*1e15)}`}};let setNode=()=>{if(typeof properties2.__node==="string"){if(graph2?.get(properties2.__node.tag)){properties2=graph2.get(properties2.__node.tag)}else properties2.__node={}}else if(!properties2.__node)properties2.__node={};if(graph2){properties2.__node.graph=graph2}if(properties2 instanceof Graph)properties2.__node.source=properties2};let setParent=()=>{if(!properties2.__parent&&parent2)properties2.__parent=parent2;if(parent2?.__node&&!(parent2 instanceof Graph||properties2 instanceof Graph))properties2.__node.tag=parent2.__node.tag+"."+properties2.__node.tag;if(parent2 instanceof Graph&&properties2 instanceof Graph){if(properties2.__node.loaders)Object.assign(parent2.__node.loaders?parent2.__node.loaders:{},properties2.__node.loaders);if(parent2.__node.mapGraphs){properties2.__node.nodes.forEach(n=>{parent2.set(properties2.__node.tag+"."+n.__node.tag,n)});let ondelete=()=>{properties2.__node.nodes.forEach(n=>{parent2.__node.nodes.delete(properties2.__node.tag+"."+n.__node.tag)})};this.__addOndisconnected(ondelete)}}};let setOp=()=>{if(typeof properties2.default==="function"&&!properties2.__operator){properties2.__operator=properties2.default}if(properties2.__operator){if(typeof properties2.__operator==="string"){if(graph2){let n=graph2.get(properties2.__operator);if(n)properties2.__operator=n.__operator;if(!properties2.__node.tag&&properties2.__operator.name)properties2.__node.tag=properties2.__operator.name}}if(typeof properties2.__operator==="function")properties2.__operator=this.__setOperator(properties2.__operator);if(properties2.default)properties2.default=properties2.__operator}};let assignProps=()=>{properties2.__node=Object.assign(this.__node,properties2.__node);let keys2=Object.getOwnPropertyNames(properties2);for(const key of keys2){this[key]=properties2[key]}};let bindCallbacks=()=>{if(this.__onconnected){if(typeof this.__onconnected==="function"){this.__onconnected=this.__onconnected.bind(this)}else if(Array.isArray(this.__onconnected)){this.__onconnected=this.__onconnected.map(f=>{return f.bind(this)})}if(typeof this.__ondisconnected==="function"){this.__ondisconnected=this.__ondisconnected.bind(this)}else if(Array.isArray(this.__ondisconnected)){this.__ondisconnected=this.__ondisconnected.map(f=>{return f.bind(this)})}}};assignState();setTag();setProps2();setNode();setParent();assignProps();bindCallbacks();setOp()}};this.__subscribe=(callback,key,subInput,bound,target)=>{const subscribeToFunction=(k,setTarget=(callback2,target2)=>callback2,triggerCallback=callback)=>{let sub=this.__node.state.subscribeEvent(k,triggerCallback,this,key);let trigger=this.__node.state.getEvent(k,sub);trigger.source=this.__node.tag;if(key)trigger.key=key;trigger.target=setTarget(callback);if(bound)trigger.bound=bound;return sub};const subscribeToGraph=callback2=>{let fn=this.__node.graph.get(callback2);if(!fn&&callback2.includes(".")){let n=this.__node.graph.get(callback2.substring(0,callback2.lastIndexOf(".")));let key2=callback2.substring(callback2.lastIndexOf(".")+1);if(n&&typeof n[key2]==="function")callback2=(...args)=>{return n[key2](...args)}}};if(key){if(!this.__node.localState||!this.__node.localState[key]){this.__addLocalState(this,key)}if(typeof callback==="string"){if(target){if(this.__node.graph?.get(target)){let n=this.__node.graph?.get(target);if(typeof n[callback]==="function"){let fn=n[callback];callback=(...inp)=>{fn(...inp)}}else{let k2=callback;let setter=inp=>{n[k2]=inp};callback=setter}}}else if(typeof this[callback]==="function"){let fn=this[callback];callback=(...inp)=>{fn(...inp)}}else if(this.__node.graph?.get(callback))subscribeToGraph(callback);if(typeof callback!=="function")return void 0}let sub;let k=subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key;if(typeof callback==="function")sub=subscribeToFunction(k);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}else{if(typeof callback==="string"){if(this.__node.graph.get(callback))callback=this.__node.graph.get(callback);if(typeof callback!=="object")return void 0}let sub;let k=subInput?this.__node.unique+"input":this.__node.unique;if(typeof callback==="function")sub=subscribeToFunction(k);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}};this.__unsubscribe=(sub,key,unsubInput)=>{if(key)return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key,sub);else return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"input":this.__node.unique,sub)};this.__setOperator=fn=>{fn=fn.bind(this);if(this.__args&&this.__node.graph){fn=wrapArgs(fn,this.__args,this.__node.graph)}let inpstr=`${this.__node.unique}input`;this.__operator=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[this.__node.unique]){if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result)}return result};if(this.__parent instanceof GraphNode&&!this.__subscribedToParent){if(this.__parent.__operator){let sub=this.__parent.__subscribe(this);let ondelete=()=>{this.__parent?.__unsubscribe(sub);delete this.__subscribedToParent};this.__addOndisconnected(ondelete);this.__subscribedToParent=true}}return this.__operator};this.__addLocalState=(props,key)=>{if(!props)return;if(!this.__node.localState){this.__node.localState={}}const localState=this.__node.localState;const initState=(props2,k)=>{let str2=this.__node.unique+"."+k;let inpstr=`${str2}input`;if(typeof props2[k]==="function"&&k!=="__operator"){let fn=props2[k].bind(this);props2[k]=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[str2]){if(typeof result?.then==="function"){result.then(res=>{this.__node.state.triggerEvent(str2,res)}).catch(console.error)}else this.__node.state.triggerEvent(str2,result)}return result}}else{let get,set;if(this.__props?.[k]){get=()=>{return this.__props[k]};set=v=>{this.__props[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}else{localState[k]=props2[k];get=()=>{return localState[k]};set=v=>{localState[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}const descriptor={get,set,enumerable:true,configurable:true};Object.defineProperty(props2,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}};if(key)initState(props,key);else{for(let k in props){initState(props,k)}}};this.__proxyObject=obj=>{const allProps=getAllProperties(obj);for(const k of allProps){if(typeof obj[k]==="function"){this[k]=(...args)=>{return obj[k](...args)}}else{const descriptor={get:()=>{return obj[k]},set:value=>{obj[k]=value},enumerable:true,configurable:true};Object.defineProperty(this,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}}};this.__setProperties(properties,parent,graph)}__addOnconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__onconnected)){this.__onconnected.push(callback)}else if(typeof this.__onconnected==="function"){this.__onconnected=[callback,this.__onconnected]}else this.__onconnected=callback}__addOndisconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.push(callback)}else if(typeof this.__ondisconnected==="function"){this.__ondisconnected=[callback,this.__ondisconnected]}else this.__ondisconnected=callback}__callConnected(node=this){if(typeof this.__onconnected==="function"){this.__onconnected(this)}else if(Array.isArray(this.__onconnected)){let fn=o=>{o(this)};this.__onconnected.forEach(fn)}}__callDisconnected(node=this){if(typeof this.__ondisconnected==="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let fn=o=>{o(this)};this.__ondisconnected.forEach(fn)}}};var Graph=class{constructor(options){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state,roots:{}};this.init=options2=>{if(options2){let cpy=Object.assign({},options2);delete cpy.roots;recursivelyAssign(this.__node,cpy);if(options2.roots)this.load(options2.roots)}};this.load=roots=>{function recursivelyAssignChildren(target,obj,inChildren=true,top=true){if(top){if(target)Object.assign(target,obj);else target=Object.assign({},obj);recursivelyAssignChildren(target,obj,true,false)}if(obj.__children&&!inChildren){if(obj.__children?.constructor.name==="Object"){if(target.__children?.constructor.name==="Object")recursivelyAssignChildren(target.__children,obj.__children,true,false);else target.__children=recursivelyAssignChildren({},obj.__children,true,false)}else{target.__children=obj.__children}}else if(inChildren){for(const key in obj){target[key]=Object.assign({},obj[key]);if(obj[key].__children){recursivelyAssignChildren({},obj[key].__children,false,false)}}}return target}this.__node.roots=recursivelyAssignChildren(this.__node.roots?this.__node.roots:{},roots);let cpy=Object.assign({},roots);if(cpy.__node)delete cpy.__node;let listeners=this.recursiveSet(cpy,this,void 0,roots);if(roots.__node){if(!roots.__node.tag)roots.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(roots.__node.tag)){let node=new GraphNode(roots,this,this);this.set(node.__node.tag,node);this.runLoaders(node,this,roots,roots.__node.tag);if(node.__listeners){listeners[node.__node.tag]=node.__listeners}}}else if(roots.__listeners){this.setListeners(roots.__listeners)}this.setListeners(listeners);return cpy};this.setLoaders=(loaders2,replace)=>{if(replace)this.__node.loaders=loaders2;else Object.assign(this.__node.loaders,loaders2);return this.__node.loaders};this.runLoaders=(node,parent,properties,key)=>{for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders[l]==="function")this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key)}};this.add=(properties,parent)=>{let listeners={};if(typeof parent==="string")parent=this.get(parent);let instanced;if(typeof properties==="function"){if(isNativeClass(properties)){if(properties.prototype instanceof GraphNode){properties=properties.prototype.constructor(properties,parent,this);instanced=true}else properties=new properties}else properties={__operator:properties}}else if(typeof properties==="string"){properties=this.__node.roots[properties]}if(!properties)return;if(!instanced){let keys2=Object.getOwnPropertyNames(properties);let cpy={};for(const key of keys2){cpy[key]=properties[key]}properties=cpy}if(!properties.__node)properties.__node={};properties.__node.initial=properties;if(typeof properties==="object"&&(!properties?.__node?.tag||!this.get(properties.__node.tag))){let node;if(instanced)node=properties;else node=new GraphNode(properties,parent,this);this.set(node.__node.tag,node);this.runLoaders(node,parent,properties,node.__node.tag);this.__node.roots[node.__node.tag]=properties;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key in node.__listeners){let listener=node.__listeners[key];if(node[key]){delete listeners[node.__node.tag][key];listeners[node.__node.tag][node.__node.tag+"."+key]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][key]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][key]=parent.__node.tag}}}}this.setListeners(listeners);node.__callConnected();return node}return};this.recursiveSet=(t2,parent,listeners={},origin)=>{let keys2=Object.getOwnPropertyNames(origin);for(const key of keys2){if(key.includes("__"))continue;let p=origin[key];if(Array.isArray(p))continue;let instanced;if(typeof p==="function"){if(isNativeClass(p)){p=new p;if(p instanceof GraphNode){p=p.prototype.constructor(p,parent,this);instanced=true}}else p={__operator:p}}else if(typeof p==="string"){if(this.__node.nodes.get(p))p=this.__node.nodes.get(p);else p=this.__node.roots[p]}else if(typeof p==="boolean"){if(this.__node.nodes.get(key))p=this.__node.nodes.get(key);else p=this.__node.roots[key]}if(typeof p==="object"){if(!instanced&&!(p instanceof GraphNode)){let keys3=Object.getOwnPropertyNames(p);let cpy={};for(const key2 of keys3){cpy[key2]=p[key2]}p=cpy}if(!p.__node)p.__node={};if(!p.__node.tag)p.__node.tag=key;if(!p.__node.initial)p.__node.initial=t2[key];if(this.get(p.__node.tag)&&!(!(parent instanceof Graph)&&parent?.__node)||parent?.__node&&this.get(parent.__node.tag+"."+p.__node.tag))continue;let node;let newnode=false;if(instanced||p instanceof GraphNode){node=p}else{node=new GraphNode(p,parent,this);newnode=true}if(!newnode&&p instanceof GraphNode&&!instanced&&parent instanceof GraphNode){let sub=this.subscribe(parent.__node.tag,node.__node.tag);let ondelete=node2=>{this.unsubscribe(parent.__node.tag,sub)};node.__addOndisconnected(ondelete)}else{this.set(node.__node.tag,node);this.runLoaders(node,parent,t2[key],key);t2[key]=node;this.__node.roots[node.__node.tag]=p;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key2 in node.__listeners){let listener=node.__listeners[key2];let k=key2;if(node[key2]){delete listeners[node.__node.tag][key2];k=node.__node.tag+"."+key2;listeners[node.__node.tag][k]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][k]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][k]=parent.__node.tag}}}}node.__callConnected()}}}return listeners};this.remove=(node,clearListeners=true)=>{this.unsubscribe(node);if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){this.delete(node.__node.tag);delete this.__node.roots[node.__node.tag];if(clearListeners){this.clearListeners(node)}node.__callDisconnected();const recursiveRemove=t2=>{for(const key in t2){this.unsubscribe(t2[key]);this.delete(t2[key].__node.tag);delete this.__node.roots[t2[key].__node.tag];this.delete(key);delete this.__node.roots[key];t2[key].__node.tag=t2[key].__node.tag.substring(t2[key].__node.tag.lastIndexOf(".")+1);if(clearListeners){this.clearListeners(t2[key])}console.log(key,t2[key].__listeners);t2[key].__callDisconnected();if(t2[key].__children){recursiveRemove(t2[key].__children)}}};if(node.__children){recursiveRemove(node.__children)}}if(node?.__node.tag&&node?.__parent){delete node?.__parent;node.__node.tag=node.__node.tag.substring(node.__node.tag.indexOf(".")+1)}return node};this.run=(node,...args)=>{if(typeof node==="string"){let nd=this.get(node);if(!nd&&node.includes(".")){nd=this.get(node.substring(0,node.lastIndexOf(".")));if(typeof nd?.[node.substring(node.lastIndexOf(".")+1)]==="function")return nd[node.substring(node.lastIndexOf(".")+1)](...args)}else if(nd?.__operator)return nd.__operator(...args)}if(node?.__operator){return node?.__operator(...args)}};this.setListeners=listeners=>{for(const key in listeners){let node=this.get(key);if(typeof listeners[key]==="object"){for(const k in listeners[key]){let n=this.get(k);let sub;if(typeof listeners[key][k]!=="object")listeners[key][k]={__callback:listeners[key][k]};else if(!listeners[key][k].__callback){for(const kk in listeners[key][k]){if(typeof listeners[key][k][kk]!=="object"){listeners[key][k][kk]={__callback:listeners[key][k][kk]};if(listeners[key][k][kk].__callback===true||typeof listeners[key][k][kk].__callback==="undefined")listeners[key][k][kk].__callback=node.__operator}let nn=this.get(kk);if(nn){if(!nn){let tag=k.substring(0,k.lastIndexOf("."));nn=this.get(tag);if(n){sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k][kk].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k][kk].inputState,key,k);if(typeof node.__listeners[k][kk]!=="object")node.__listeners[k][kk]={__callback:listeners[key][k][kk].__callback,inputState:listeners[key][k][kk]?.inputState};node.__listeners[k][kk].sub=sub}}else{sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k);if(typeof node.__listeners[k][kk]!=="object")node.__listeners[k][kk]={__callback:listeners[key][k][kk].__callback,inputState:listeners[key][k][kk]?.inputState};node.__listeners[k][kk].sub=sub}}}}if("__callback"in listeners[key][k]){if(listeners[key][k].__callback===true||typeof listeners[key][k].__callback==="undefined")listeners[key][k].__callback=node.__operator;if(typeof listeners[key][k].__callback==="function")listeners[key][k].__callback=listeners[key][k].__callback.bind(node);if(typeof node.__listeners!=="object")node.__listeners={};if(!n){let tag=k.substring(0,k.lastIndexOf("."));n=this.get(tag);if(n){sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k].inputState,key,k);if(typeof node.__listeners[k]!=="object")node.__listeners[k]={__callback:listeners[key][k].__callback,inputState:listeners[key][k]?.inputState};node.__listeners[k].sub=sub}}else{sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k);if(typeof node.__listeners[k]!=="object")node.__listeners[k]={__callback:listeners[key][k].__callback,inputState:listeners[key][k]?.inputState};node.__listeners[k].sub=sub}}}}}};this.clearListeners=(node,listener)=>{if(typeof node==="string")node=this.get(node);if(node?.__listeners){for(const key in node.__listeners){if(listener&&key!==listener)continue;if(typeof node.__listeners[key]?.sub!=="number")continue;let n=this.get(key);if(!n){n=this.get(key.substring(0,key.lastIndexOf(".")));if(n){if(typeof node.__listeners[key]==="object"&&!node.__listeners[key]?.__callback){for(const k in node.__listeners[key]){if(typeof node.__listeners[key][k]?.sub==="number"){this.unsubscribe(n,node.__listeners[key][k].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}else{if(typeof!node.__listeners[key]?.__callback==="number"){for(const k in node.__listeners[key]){if(node.__listeners[key][k]?.sub){this.unsubscribe(n,node.__listeners[key][k].sub,void 0,node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,void 0,node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}}};this.get=tag=>{return this.__node.nodes.get(tag)};this.set=(tag,node)=>{return this.__node.nodes.set(tag,node)};this.delete=tag=>{return this.__node.nodes.delete(tag)};this.getProps=(node,getInitial)=>{if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){let cpy;if(getInitial)cpy=Object.assign({},this.__node.roots[node.__node.tag]);else{cpy=Object.assign({},node);for(const key in cpy){if(key.includes("__"))delete cpy[key]}}}};this.subscribe=(nodeEvent,onEvent,args,key,subInput,target,bound)=>{let nd=nodeEvent;if(typeof nodeEvent==="string"){nd=this.get(nodeEvent);if(!nd&&nodeEvent.includes(".")){nd=this.get(nodeEvent.substring(0,nodeEvent.lastIndexOf(".")));key=nodeEvent.substring(nodeEvent.lastIndexOf(".")+1)}}let sub;if(target instanceof GraphNode)target=target.__node.tag;if(typeof onEvent==="string"){let key2=onEvent;let setOnEventFromString=onEvent2=>{if(this.get(onEvent2)?.__operator){let node=this.get(onEvent2);onEvent2=function(...inp){return node.__operator(...inp)}}else if(onEvent2.includes(".")){let n=this.get(onEvent2.substring(0,onEvent2.lastIndexOf(".")));let key3=onEvent2.substring(onEvent2.lastIndexOf(".")+1);if(typeof n[key3]==="function"){if(n[key3]instanceof GraphNode)onEvent2=n[key3];else onEvent2=function(...inp){return n[key3](...inp)}}else{onEvent2=function(inp){n[key3]=inp;return n[key3]}}}return onEvent2};if(target){let node=this.get(target);if(typeof node?.[onEvent]==="function"){onEvent=function(...inp){return node[key2](...inp)}}else if(node[key2]){if(node[key2]instanceof GraphNode)onEvent=node[key2];else onEvent=function(inp){node[key2]=inp;return node[key2]}}else{onEvent=setOnEventFromString(onEvent)}}else{onEvent=setOnEventFromString(onEvent)}}if((typeof onEvent==="function"||onEvent instanceof GraphNode)&&args){if(onEvent instanceof GraphNode&&onEvent.__operator)onEvent=function(inp){return onEvent.__operator(inp)};onEvent=wrapArgs(onEvent,args,this)}if(nd instanceof GraphNode){sub=nd.__subscribe(onEvent,key,subInput,target,bound);let ondelete=()=>{nd.__unsubscribe(sub,key,subInput)};nd.__addOndisconnected(ondelete)}else if(typeof nodeEvent==="string"){if(this.get(nodeEvent)){if(onEvent instanceof GraphNode&&onEvent.__operator){sub=this.get(nodeEvent).__subscribe(onEvent.__operator,key,subInput,target,bound);let ondelete=()=>{this.get(nodeEvent).__unsubscribe(sub)};onEvent.__addOndisconnected(ondelete)}else if(typeof onEvent==="function"||typeof onEvent==="string"){sub=this.get(nodeEvent).__subscribe(onEvent,key,subInput,target,bound);this.__node.state.getEvent(this.get(nodeEvent).__node.unique,sub).source=nodeEvent}}else{if(typeof onEvent==="string")onEvent=this.__node.nodes.get(onEvent).__operator;if(typeof onEvent==="function")sub=this.__node.state.subscribeEvent(nodeEvent,onEvent)}}return sub};this.unsubscribe=(node,sub,key,subInput)=>{if(node instanceof GraphNode){return node.__unsubscribe(sub,key,subInput)}else return this.get(node)?.__unsubscribe(sub,key,subInput)};this.setState=update=>{this.__node.state.setState(update)};this.init(options)}};function recursivelyAssign(target,obj){for(const key in obj){if(obj[key]?.constructor.name==="Object"&&!Array.isArray(obj[key])){if(target[key]?.constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign(target[key],obj[key]);else target[key]=recursivelyAssign({},obj[key])}else{target[key]=obj[key]}}return target}function getAllProperties(obj){var allProps=[],curr=obj;do{var props=Object.getOwnPropertyNames(curr);let fn=function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)};props.forEach(fn)}while(curr=Object.getPrototypeOf(curr));return allProps}function isNativeClass(thing){return isFunction(thing)==="class"}function isFunction(x){const res=typeof x==="function"?x.prototype?Object.getOwnPropertyDescriptor(x,"prototype")?.writable?"function":"class":x.constructor.name==="AsyncFunction"?"async":"arrow":"";return res}var wrapArgs=(callback,argOrder,graph)=>{let args=[];let getCallbackFromString=a=>{if(graph.get(a)?.__operator){let node=graph.get(a);return(...inp)=>{node.__operator(...inp)}}else if(a.includes(".")){let split=a.split(".");let popped=split.pop();let joined=split.join(".");let node=graph.get(joined);if(typeof graph.get(joined)?.[popped]==="function"){return(...inp)=>{return node[popped](...inp)}}else return()=>{return node[popped]}}else if(graph.get(a)){let node=graph.get(a);return()=>{return node}}else{let arg=a;return()=>{return arg}}};let forArg=(a,i2)=>{if(a==="__output"){args[i2]=inp=>{return inp}}else if(typeof a==="string"){args[i2]=getCallbackFromString(a)}else if(typeof a==="function"){let fn2=a;args[i2]=(...inp)=>{return fn2(...inp)}}else if(typeof a==="object"&&a.__input){let recursivelyCreateCallback=function(c){let input=c.__input;if(typeof c.__input==="string"){input=getCallbackFromString(c.__input)}if(c.__args){input=wrapArgs(input,c.__args,graph)}if(c.__output){let output=c.__output;if(typeof c.__output==="string"){output=getCallbackFromString(output)}else if(typeof a.__output==="object"){output=recursivelyCreateCallback(output)}if(typeof output==="function"){let fn2=input;input=(...inp)=>{return output(fn2(...inp))}}}return input};args[i2]=recursivelyCreateCallback(a)}else{let arg=a;args[i2]=()=>{return arg}}};argOrder.forEach(forArg);if(typeof callback==="string")callback=getCallbackFromString(callback);let fn=callback;callback=function(...inp){let mapArg=arg=>{return arg(...inp)};return fn(...args.map(mapArg))};return callback};var backprop=(node,parent,graph)=>{if(node.__node.backward&&parent instanceof GraphNode){graph.setListeners({[parent.__node.tag]:{[node.__node.tag]:parent}})}};var loop=(node,parent,graph)=>{if(node.__operator&&!node.__node.looperSet){if(typeof node.__node.delay==="number"){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{setTimeout(async()=>{res(await fn(...args))},node.__node.delay)})})}else if(node.__node.frame===true){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{requestAnimationFrame(async()=>{res(await fn(...args))})})})}if(typeof node.__node.repeat==="number"||typeof node.__node.recursive==="number"){let fn=node.__operator;node.__setOperator(async(...args)=>{let i2=node.__node.repeat?node.__node.repeat:node.__node.recursive;let result;let repeater=async(tick,...inp)=>{while(tick>0){if(node.__node.delay||node.__node.frame){fn(...inp).then(async res=>{if(node.__node.recursive){await repeater(tick,res)}else await repeater(tick,...inp)});break}else result=await fn(...args);tick--}};await repeater(i2,...args);return result})}if(node.__node.loop&&typeof node.__node.loop==="number"){node.__node.looperSet=true;let fn=node.__operator;node.__setOperator((...args)=>{if(!("looping"in node.__node))node.__node.looping=true;if(node.__node.looping){fn(...args);setTimeout(()=>{node.__operator(...args)},node.__node.loop)}});if(node.__node.looping)node.__operator();let ondelete=node2=>{if(node2.__node.looping)node2.__node.looping=false};node.__addOndisconnected(ondelete)}}};var animate=(node,parent,graph)=>{if(node.__node.animate===true||node.__animation){let fn=node.__operator;node.__setOperator((...args)=>{if(!("animating"in node.__node))node.__node.animating=true;if(node.__node.animating){if(typeof node.__animation==="function")node.__animation(...args);else fn(...args);requestAnimationFrame(()=>{node.__operator(...args)})}});if(node.__node.animating||(!("animating"in node.__node)||node.__node.animating)&&node.__animation)setTimeout(()=>{requestAnimationFrame(node.__operator)},10);let ondelete=node2=>{if(node2.__node.animating)node2.__node.animating=false};node.__addOndisconnected(ondelete)}};var branching=(node,parent,graph)=>{if(typeof node.__branch==="object"&&node.__operator&&!node.__branchApplied){let fn=node.__operator;node.__branchApplied=true;node.__operator=(...args)=>{let result=fn(...args);for(const key in node.__branch){let triggered=()=>{if(typeof node.__branch[key].then==="function"){node.__branch[key].then(result)}else if(node.__branch[key].then instanceof GraphNode&&node.__branch[key].then.__operator){node.__branch[key].then.__operator(result)}else result=node.__branch[key].then};if(typeof node.__branch[key].if==="function"){if(node.__branch[key].if(result)==true){triggered()}}else if(node.__branch[key].if===result){triggered()}}return result}}if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].branch&&!node.__listeners[key].branchApplied){let fn=node.__listeners[key].callback;node.__listeners[key].branchApplied=true;node.__listeners.callback=ret=>{let triggered=()=>{if(typeof node.__listeners[key].branch.then==="function"){ret=node.__listeners[key].branch.then(ret)}else if(node.__listeners[key].branch.then instanceof GraphNode&&node.__listeners[key].branch.then.__operator){ret=node.__listeners[key].branch.then.__operator(ret)}else ret=node.__listeners[key].branch.then};if(typeof node.__listeners[key].branch.if==="function"){if(node.__listeners[key].branch.if(ret)){triggered()}}else if(node.__listeners[key].branch.if===ret){triggered()}return fn(ret)}}}}}};var triggerListenerOncreate=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].oncreate){node.__listeners[key].callback(node.__listeners[key].oncreate)}}}}};var bindListener=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].binding==="object"){node.__listeners.callback=node.__listeners.callback.bind(node.__listeners[key].binding)}}}}};var transformListenerResult=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].transform==="function"&&!node.__listeners[key].transformApplied){let fn=node.__listeners[key].callback;node.__listeners[key].transformApplied=true;node.__listeners.callback=ret=>{ret=node.__listeners[key].transform(ret);return fn(ret)}}}}}};var substitute__operator=(node,parent,graph)=>{if(node.post&&!node.__operator){node.__setOperator(node.post)}else if(!node.__operator&&typeof node.get=="function"){node.__setOperator(node.get)}if(!node.get&&node.__operator){node.get=node.__operator}if(node.aliases){node.aliases.forEach(a=>{graph.set(a,node);let ondelete=node2=>{graph.__node.nodes.delete(a)};node.__addOndisconnected(ondelete)})}if(typeof graph.__node.roots?.[node.__node.tag]==="object"&&node.get)graph.__node.roots[node.__node.tag].get=node.get};var loaders={backprop,loop,animate,branching,triggerListenerOncreate,bindListener,transformListenerResult,substitute__operator};var recursivelyStringifyFunctions=obj=>{let cpy={};for(const key in obj){if(typeof obj[key]==="object"){cpy[key]=recursivelyStringifyFunctions(obj[key])}else if(typeof obj[key]==="function"){cpy[key]=obj[key].toString()}else cpy[key]=obj[key]}return cpy};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs22(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast22(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}function methodstrings(node){if(typeof node.__methods==="object"){for(const key in node.__methods){let fstr=node.__methods[key];let fn=typeof fstr==="function"?fstr:parseFunctionFromText(fstr);if(key==="__operator"){node.__setOperator(fn)}else{node[key]=fn.bind(node)}}}}var Service=class extends Graph{constructor(options){super({...options,loaders:options?.loaders?Object.assign({...loaders},options.loaders):{...loaders}});this.name=`service${Math.floor(Math.random()*1e15)}`;this.addServices=services=>{for(const s in services){if(typeof services[s]==="function")services[s]=new services[s];if(services[s]?.__node?.loaders)Object.assign(this.__node.loaders,services[s].__node.loaders);if(services[s]?.__node?.nodes){services[s].__node.nodes.forEach((n,tag)=>{if(!this.get(tag)){this.set(tag,n)}else this.set(s+"."+tag,n)});this.__node.nodes.forEach((n,k)=>{if(!services[s].__node.nodes.get(k))services[s].__node.nodes.set(k,n)});let set=this.set;this.set=(tag,node)=>{services[s].set(tag,node);return set(tag,node)};let del=this.delete;this.delete=tag=>{services[s].delete(tag);return del(tag)}}else if(typeof services[s]==="object"){this.load(services[s])}}};this.handleMethod=(route,method,args)=>{let m=method.toLowerCase();let src=this.__node.nodes.get(route);if(!src){src=this.__node.roots[route]}if(src?.[m]){if(typeof src[m]!=="function"){if(args){if(Array.isArray(args)&&args.length===1)src[m]=args[0];else src[m]=args;return}return src[m]}else{if(Array.isArray(args))return src[m](...args);else return src[m](args)}}else return this.handleServiceMessage({route,args,method})};this.transmit=(...args)=>{if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.receive=(...args)=>{if(args[0]){if(typeof args[0]==="string"){let substr=args[0].substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))args[0]=args[0].replace(/\\\\/g,"");if(args[0][0]===\'"\'){args[0]=args[0].substring(1,args[0].length-1)};args[0]=JSON.parse(args[0])}}}if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.pipe=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return this.subscribe(source,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.pipeOnce=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return source.__node.state.subscribeEventOnce(source.__node.unique,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.__node.state.subscribeEventOnce(source.__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(source).__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.terminate=(...args)=>{};this.isTypedArray=isTypedArray;this.recursivelyAssign=recursivelyAssign2;this.spliceTypedArray=spliceTypedArray;this.ping=()=>{console.log("pinged!");return"pong"};this.echo=(...args)=>{this.transmit(...args);return args};if(options?.services)this.addServices(options.services);this.load(this)}handleServiceMessage(message){let call;if(typeof message==="object"){if(message.route)call=message.route;else if(message.node)call=message.node}if(call){if(Array.isArray(message.args))return this.run(call,...message.args);else return this.run(call,message.args)}else return message}handleGraphNodeCall(route,args){if(!route)return args;if(args?.args){this.handleServiceMessage(args)}else if(Array.isArray(args))return this.run(route,...args);else return this.run(route,args)}};function isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}var recursivelyAssign2=(target,obj)=>{for(const key in obj){if(obj[key].constructor.name==="Object"&&!Array.isArray(obj[key])){if(obj[key].constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign2(target[key],obj[key]);else target[key]=recursivelyAssign2({},obj[key])}else target[key]=obj[key]}return target};function spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let ta;if(s.length>0||e?.length>0)ta=new arr.constructor(s.length+e.length);if(ta){if(s.length>0)ta.set(s);if(e&&e.length>0)ta.set(e,s.length)}return ta}var nodeTemplates={};var remoteGraphRoutes={transferNode:(properties,connection,name2)=>{let str2;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str2=recursivelyStringifyFunctions(properties)}else if(typeof properties==="function")str2=properties.toString();else if(typeof properties==="string")str2=properties;if(str2){if(connection.run)return connection.run("setNode",[str2]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str2},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str2}));return new Promise(r=>r(name2))}}},setNode:function(properties){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function")properties={__operator:f,__node:{tag:f.name}};else{f=JSON.parse(properties);if(typeof f==="object")properties=f}}if(typeof properties==="object"||typeof properties==="function"){let template=Object.assign({},properties);let node=this.__node.graph.add(properties);nodeTemplates[node.__node.tag]=template;return node.__node.tag}else return false},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]==="function"){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str2=recursivelyStringifyFunctions(properties);return str2},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function"){if(!name2)name2=f.name;properties={__operator:f,__node:{tag:name2}}}else{f=JSON.parse(properties);if(typeof f==="object"){properties=f;if(!name2&&f.__node?.tag)name2=f.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates[templateName]){let cpy=recursivelyAssign2({},nodeTemplates[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(route,fn,methodKey){if(typeof fn==="string"){let f=parseFunctionFromText(fn);if(typeof f==="function")fn=f}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(route)){this.__node.graph.get(route)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key in properties){result[key]=typeof node[key]}return result}return void 0},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str2=classObj.toString();let message={route:"receiveClass",args:[str2,className]};if(connection.run)return connection.run("receiveClass",[str2,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str2,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str2,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str2=fn.toString();let message={route:"receiveClass",args:[str2,fnName]};if(connection.run)return connection.run("setFunction",[str2,fnName]);else if(connection.postMessage){connection.postMessage({route:"setFunction",args:[str2,fnName]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"setFunction",args:[str2,fnName]}));return new Promise(r=>r(name))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl.exception.invalid("invalid aes key size");this.b=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};sjcl.cipher.aes.prototype={encrypt:function(a){return t(this,a,0)},decrypt:function(a){return t(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d=b[4],e,f,g,h=[],k=[],l,n,m,p;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d[m]=f,n=h[e=h[l=h[f]]],p=16843009*n^65537*e^257*l^16843008*f,n=257*h[m]^16843008*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p=p<<24^p>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function t(a,b,c){if(4!==b.length)throw new sjcl.exception.invalid("invalid aes block size");var d=a.b[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,k,l,n=d.length/4-2,m,p=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v=h[2],w=h[3],x=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v[g>>8&255]^w[b&255]^d[p],k=a[f>>>24]^q[g>>16&255]^v[b>>8&255]^w[e&255]^d[p+1],l=a[g>>>24]^q[b>>16&255]^v[e>>8&255]^w[f&255]^d[p+2],b=a[b>>>24]^q[e>>16&255]^v[f>>8&255]^w[g&255]^d[p+3],p+=4,e=h,f=k,g=l;for(m=0;4>m;m++)r[c?3&-m:m]=x[e>>>24]<<24^x[f>>16&255]<<16^x[g>>8&255]<<8^x[b&255]^d[p++],h=e,e=f,f=g,g=b,b=h;return r}sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray.$(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},$:function(a,b,c,d){var e;e=0;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(c&65280)<<8|c<<24;return a}};sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\\s|0x/g,"");d=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};sjcl.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f="",g=0,h=sjcl.codec.base32.B,k=0,l=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32.X);for(c=0;f.length*d<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d?(k=a[c]<<d-g,g+=e,c++):(k<<=d,g-=d);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\\s|=/g,"").toUpperCase();var c=sjcl.codec.base32.BITS,d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f=[],g,h=0,k=sjcl.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p){}throw new sjcl.exception.invalid("this isn\'t "+m+"!")}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d,l^=n<<c-h)}h&56&&f.push(sjcl.bitArray.partial(h&56,l,1));return f}};sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};sjcl.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.B,g=0,h=sjcl.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\\s|=/g,"");var c=[],d,e=0,f=sjcl.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d=0;d<a.length;d++){h=f.indexOf(a.charAt(d));if(0>h)throw new sjcl.exception.invalid("this isn\'t base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl.bitArray.partial(e&56,g,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl.hash.sha256.hash=function(a){return new sjcl.hash.sha256().update(a).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.A=sjcl.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl.bitArray.bitLength(a);if(9007199254740991<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=512+b-(512+b&511);b<=a;b+=512)u(this,d.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&511);b<=a;b+=512)u(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/4294967296));for(b.push(this.l|0);b.length;)u(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a2){return 4294967296*(a2-Math.floor(a2))|0}for(var b=0,c=2,d,e;64>b;c++){e=true;for(d=2;d*d<=c;d++)if(0===c%d){e=false;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};function u(a,b){var c,d,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d=b[c]:(d=b[c+1&15],e=b[c+14&15],d=b[c&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d=d+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p^r))+g[c],q=r,r=p,p=m,m=n+d|0,n=l,l=k,k=h,h=d+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p|0;f[6]=f[6]+r|0;f[7]=f[7]+q|0}sjcl.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm.G.indexOf(a);-1<a&&sjcl.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.V(a,b,c,d,e,f);g=sjcl.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl.mode.ccm.C(a,k,c,l,e,b);a=sjcl.mode.ccm.V(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn\'t match");return k.data},na:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,k=h.i;d=[h.partial(8,(b.length?64:0)|d-2<<2|f-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d=a.encrypt(k(d,g.slice(b,b+4).concat([0,0,0])));return d},V:function(a,b,c,d,e,f){var g=sjcl.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");if(4294967295<d.length||4294967295<b.length)throw new sjcl.exception.bug("ccm: can\'t deal with 4GiB or more data");c=sjcl.mode.ccm.na(a,d,c,e,g.bitLength(b)/8,f);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl.mode.ccm.fa(g/k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,l)}}};sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.S,k=sjcl.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p=p.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));d.length&&(n=l(n,f?d:sjcl.mode.ocb2.pmac(a,d)));return p.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.S,h=sjcl.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p,r=sjcl.bitArray.bitLength(b)-e,q=[];d=d||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p=r-32*c;m=a.encrypt(k(n,[0,0,0,p]));m=k(m,h.clamp(b.slice(c),p).concat([0,0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d.length&&(l=k(l,f?d:sjcl.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl.exception.corrupt("ocb: tag doesn\'t match");return q.concat(h.clamp(m,p))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.S,e=sjcl.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d(f(h,d(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;d=d||[];a=sjcl.mode.gcm.C(true,a,f,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl.mode.gcm.C(false,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn\'t match");return a.data},ka:function(a,b){var c,d,e,f,g,h=sjcl.bitArray.i;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d=3;0<d;d--)f[d]=f[d]>>>1|(f[d-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=sjcl.mode.gcm.ka(b,a);return b},C:function(a,b,c,d,e,f){var g,h,k,l,n,m,p,r,q=sjcl.bitArray;m=c.length;p=q.bitLength(c);r=q.bitLength(d);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl.mode.gcm.j(g,[0,0,0,0],e),e=sjcl.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=sjcl.mode.gcm.j(g,[0,0,0,0],d);n=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p);a&&(d=sjcl.mode.gcm.j(g,h,c));a=[Math.floor(r/4294967296),r&4294967295,Math.floor(p/4294967296),p&4294967295];d=sjcl.mode.gcm.j(g,d,a);k=b.encrypt(e);d[0]^=k[0];d[1]^=k[1];d[2]^=k[2];d[3]^=k[3];return{tag:q.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.W=b=b||sjcl.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=false};sjcl.misc.hmac.prototype.update=function(a){this.aa=true;this.R.update(a)};sjcl.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=new this.W(this.w[1]).update(a).finalize();this.reset();return a};sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1e4;if(0>d||0>c)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl.bitArray;for(k=1;32*l.length<(d||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d&&(l=n.clamp(l,d));return l};sjcl.prng=function(a){this.c=[new sjcl.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=false;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=65536;this.T=[0,48,64,96,128,192,256,384,512,768,1024];this.da=3e4;this.ba=80};sjcl.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;if(d===this.u)throw new sjcl.exception.notReady("generator isn\'t seeded");if(d&this.J){d=!(d&this.I);e=[];var f=0,g;this.Z=e[0]=new Date().valueOf()+this.da;for(g=0;16>g;g++)e.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=f);this.P++;this.b=sjcl.hash.sha256.hash(this.b.concat(e));this.L=new sjcl.cipher.aes(this.b);for(d=0;4>d&&(this.h[d]=this.h[d]+1|0,!this.h[d]);d++);}for(d=0;d<a;d+=4)0===(d+1)%this.ca&&y(this),e=z(this),c.push(e[0],e[1],e[2],e[3]);y(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=new Date().valueOf(),g=this.H[c],h=this.isReady(),k=0;d=this.U[c];void 0===d&&(d=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case"number":void 0===b&&(b=1);this.c[g].update([d,this.N++,1,b,f,1,a|0]);break;case"object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d,this.N++,2,b,f,a.length].concat(a))}break;case"string":void 0===b&&(b=a.length);this.c[g].update([d,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)};if(window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,false),window.addEventListener("mousemove",this.a.mouseCollector,false),window.addEventListener("keypress",this.a.keyboardCollector,false),window.addEventListener("devicemotion",this.a.accelerometerCollector,false),window.addEventListener("touchmove",this.a.touchCollector,false);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl.exception.bug("can\'t attach event");this.D=true}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,false),window.removeEventListener("mousemove",this.a.mouseCollector,false),window.removeEventListener("keypress",this.a.keyboardCollector,false),window.removeEventListener("devicemotion",this.a.accelerometerCollector,false),window.removeEventListener("touchmove",this.a.touchCollector,false)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=false)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d,e=this.K[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},la:function(){C(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C(this,0)},qa:function(a){a=a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C(this,0)},ma:function(){C(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C(this,0)}};function A(a,b){var c,d=sjcl.random.K[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function C(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy(new Date().valueOf(),b,"loadtime")}function y(a){a.b=z(a).concat(z(a));a.L=new sjcl.cipher.aes(a.b)}function z(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}function B(a,b){return function(){b.apply(a,arguments)}}sjcl.random=new sjcl.prng(6);a:try{if(G="undefined"!==typeof module&&module.exports){try{H=__require2("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array(new Uint8Array(D).buffer),sjcl.random.addEntropy(D,1024,"crypto[\'randomBytes\']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F);else break a;sjcl.random.addEntropy(F,1024,"crypto[\'getRandomValues\']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}var D;var E;var F;var G;var H;sjcl.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.g({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[f.cipher](a);e.g(d,f);d.key=a;f.ct="ccm"===f.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d){var e=sjcl.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.g(e.g(e.g({},e.defaults),b),c,true);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl.codec.utf8String.toBits(f));g=new sjcl.cipher[b.cipher](a);f="ccm"===b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d,b);d.key=a;return 1===c.raw?f:sjcl.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=sjcl.json;return e.ia(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+\'"\'+b+\'":\';d=",";switch(typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+=\'"\'+escape(a[b])+\'"\';break;case"object":c+=\'"\'+sjcl.codec.base64.fromBits(a[b],0)+\'"\';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){a=a.replace(/\\s/g,"");if(!a.match(/^\\{.*\\}$/))throw new sjcl.exception.invalid("json decode: this isn\'t json!");a=a.replace(/^\\{|\\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^\\s*(?:(["\']?)([a-z][a-z0-9]*)\\1)\\s*:\\s*(?:(-?\\d+)|"([a-z0-9+\\/%*_.@=\\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn\'t json!");null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},sa:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},ra:function(a,b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.pa={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.pa,d;b=b||{};d=b.iter||1e3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};var _HTTPfrontend=class extends Service{constructor(options,path,fetched){super(options);this.name="http";this.fetchProxied=false;this.listening={};this.GET=(url="http://localhost:8080/ping",type="",mimeType)=>{if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"GET",url,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.POST=(message,url="http://localhost:8080/echo",type="",mimeType)=>{if(typeof message==="object"&&(type==="json"||type==="text"||!type)){message=JSON.stringify(message)}if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"POST",url,data:message,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.transmit=(message,url)=>{let obj=message;if(typeof obj==="object"){message=JSON.stringify(obj)}if(obj?.method?.toLowerCase()=="get"||message?.toLowerCase()==="get")return this.GET(url);return this.POST(message,url)};this.transponder=(url,message,type="",mimeType)=>{if(typeof message==="object")message=JSON.stringify(message);let method="GET";if(message){method="POST"}if(type==="json")mimeType="application/json";else return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method,url,data:message,responseType:type,onload:ev=>{let body=xhr.response;if(typeof body==="string"){let substr=body.substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))body=body.replace(/\\\\/g,"");if(body[0]===\'"\'){body=body.substring(1,body.length-1)};body=JSON.parse(body)}}if(typeof body?.method==="string"){return resolve(this.handleMethod(body.route,body.method,body.args))}else if(typeof body?.route==="string"){return resolve(this.handleServiceMessage(body))}else if(typeof body?.node==="string"||body.node instanceof GraphNode){return resolve(this.handleGraphNodeCall(body.node,body.args))}else return resolve(body)},onabort:er=>{reject(er)}})}).catch(console.error)};this.listen=(path2="0",fetched2=async(clone,args,response)=>{const result=await clone.text();const returned=this.receive(result);this.setState({[response.url]:returned})})=>{this.listening[path2]={};let listenerId=`${path2}${Math.floor(Math.random()*1e15)}`;this.listening[path2][listenerId]=fetched2;if(!this.fetchProxied){globalThis.fetch=new Proxy(globalThis.fetch,{apply(fetch,that,args){const result=fetch.apply(that,args);result.then(response=>{if(!response.ok)return;if(this.listening["0"]){for(const key in this.listeners){const clone=response.clone();this.listening["0"][key](clone,args,response)}}else{for(const key in this.listening){if(response.url.includes(key)){for(const key2 in this.listening[path2]){const clone=response.clone();this.listening[path2][key2](clone,args,response)}break}}}}).catch(er=>{console.error(er)});return result}});this.fetchProxied=true}return listenerId};this.stopListening=(path2,listener)=>{if(!path2&&path2!==0){for(const key in this.listening)delete this.listening[key]}else{if(!listener)delete this.listening[path2];else delete this.listening[listener]}};this.load(this);this.listen(path,fetched)}};var HTTPfrontend=_HTTPfrontend;HTTPfrontend.request=options=>{const xhr=new XMLHttpRequest;if(options.responseType)xhr.responseType=options.responseType;else options.responseType="json";if(options.mimeType){xhr.overrideMimeType(options.mimeType)}if(options.onload)xhr.addEventListener("load",options.onload,false);if(options.onprogress)xhr.addEventListener("progress",options.onprogress,false);if(options.onabort)xhr.addEventListener("abort",options.onabort,false);if(options.onloadend)xhr.addEventListener("loadend",options.onloadend,false);if(options.onerror)xhr.addEventListener("error",options.onerror,false);xhr.open(options.method,options.url,true,options.user,options.pass);if(!options.onerror)xhr.onerror=function(){xhr.abort()};xhr.send(options.data);return xhr};var import_web_worker=__toESM(require_browser());var WorkerService=class extends Service{constructor(options){super();this.name="worker";this.workers={};this.threadRot=0;this.loadWorkerRoute=(rt,routeKey)=>{if(rt.workerUrl)rt.url=rt.workerUrl;if(rt.workerId)rt.__node.tag=rt.workerId;if(!rt.__node.tag)rt.__node.tag=routeKey;rt._id=rt.__node.tag;let worker;if(this.workers[rt._id])worker=this.workers[rt._id];else if(rt.worker)worker=rt.worker;if(!worker){worker=this.addWorker(rt)}rt.worker=worker;if(!rt.worker.__ondisconnected){let ondelete=rt2=>{rt2.worker?.terminate()};rt.__addOndisconnected(ondelete)}if(rt.transferFunctions){for(const prop in rt.transferFunctions){this.transferFunction(worker,rt.transferFunctions[prop],prop)}}if(rt.transferClasses){for(const prop in rt.transferClasses){this.transferClass(worker,rt.transferClasses[prop],prop)}}if(worker){if(!rt.__operator){rt.__operator=(...args)=>{if(rt.callback){if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.post(rt.callback,args);else return worker.run(rt.callback,args)}else{if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(rt.init){worker.run(rt.init,rt.initArgs,void 0,rt.initTransfer)}return worker}};this.workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?.workerId||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};this.addDefaultMessageListener=()=>{globalThis.onmessage=ev=>{let result=this.receive(ev.data);if(this.__node.keepState)this.setState({[this.name]:result})}};this.postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};this.addWorker=options2=>{let worker;if(!options2._id)options2._id=`worker${Math.floor(Math.random()*1e15)}`;if(options2.url)worker=new import_web_worker.default(options2.url);else if(options2.port){worker=options2.port}else if(this.workers[options2._id]){if(this.workers[options2._id].port)worker=this.workers[options2._id].port;else worker=this.workers[options2._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options2._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options2._id,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options2._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options2._id)};if(!options2.onmessage)options2.onmessage=ev=>{this.receive(ev.data);this.setState({[options2._id]:ev.data})};if(!options2.onerror){options2.onerror=ev=>{console.error(ev.data)}}worker.onmessage=options2.onmessage;worker.onerror=options2.onerror;this.workers[options2._id]={worker,send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options2};return this.workers[options2._id]};this.open=this.addWorker;this.toObjectURL=scriptTemplate=>{let blob=new Blob([scriptTemplate],{type:"text/javascript"});return URL.createObjectURL(blob)};this.transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys2=Object.keys(this.workers);this.workers[keys2[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys2.length)this.threadRot=0}return message};this.terminate=worker=>{let onclose;if(typeof worker==="string"){let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof import_web_worker.default){worker.terminate();if(onclose)onclose(worker);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);return true}return false};this.establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof import_web_worker.default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};this.request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};this.runRequest=(message,worker,callbackId)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId})})}else{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId})}return res};this.subscribeWorker=(route,worker,args,key,subInput,blocking)=>{let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{if(worker?.postMessage)worker.postMessage({args:r,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route})})}else{if(worker?.postMessage)worker.postMessage({args:res,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route})}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};this.subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking])}};this.triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i2=0;i2<this.__node.state.triggers[workerId].length;i2++){await this.__node.state.triggers[workerId][i2].onchange({args:result,callbackId:route})}return true};this.pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking])};this.unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}};this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}};var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","timeStamp"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function focusEventHandler(event,sendFn){const data={type:event.type};data.isTrusted=event.isTrusted;data.bubbles=event.bubbles;data.cancelBubble=event.cancelBubble;data.cancelable=event.cancelable;data.composed=event.composed;data.defaultPrevent=event.defaultPrevented;data.eventPhase=event.eventPhase;data.returnValue=event.returnValue;data.currentTarget=event.currentTarget.id?event.currentTarget.id:event.currentTarget.constructor.name;data.target=data.currentTarget;data.srcElement=data.currentTarget;sendFn(data)}function wheelEventHandler(event,sendFn){event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event){event.preventDefault()}function copyProperties(src,properties,dst){for(const name2 of properties){dst[name2]=src[name2]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn){const touches=[];const data={type:event.type,touches};for(let i2=0;i2<event.touches.length;++i2){const touch=event.touches[i2];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var i=1;var keys={};while(i<222){keys[i]=true;i++}function filteredKeydownEventHandler(event,sendFn){let{keyCode}=event;if(keys[keyCode]){if(event.preventDefault&&(keyCode<110||keyCode>123))event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,pointerlockchange:mouseEventHandler,webkitpointerlockchange:mouseEventHandler,focus:focusEventHandler,blur:focusEventHandler,pointerout:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler,keyup:filteredKeydownEventHandler};function initProxyElement(element,worker,id){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent)})}if(eventHandlers.keydown){globalThis.addEventListener("keydown",function(ev){eventHandlers.keydown(ev,sendEvent)})}if(eventHandlers.keyup){globalThis.addEventListener("keyup",function(ev){eventHandlers.keyup(ev,sendEvent)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i2=0,l=array.length;i2<l;i2++){array[i2].call(this,event)}}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy);addTo.blur=proxy.blur.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={elementFromPoint:(...args)=>{return this.targets[Object.keys(this.targets)[0]].proxied}}}};function makeProxy(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else{initProxyElement(options.canvas,void 0,options._id);return setupCanvas(options)}}function transferCanvas(worker,options,route){console.log(options);if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id);else initProxyElement(options.canvas,worker,options._id);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let tr=[offscreen];if(options.transfer){tr.push(...options.transfer);delete options.transfer}worker.postMessage(message,tr);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:(props,transfer)=>{worker.postMessage({route:"drawFrame",args:[props,options._id]},transfer)},update:(props,transfer)=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]},transfer)},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:(newDrawProps,transfer)=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]},transfer)},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText3(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw.bind(settings)}if(typeof settings.update==="string")settings.update=parseFunctionFromText3(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update.bind(settings)}if(typeof settings.init==="string")settings.init=parseFunctionFromText3(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init.bind(settings)}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText3(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear.bind(settings)}return settings._id}return void 0}function setupCanvas(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{if(this?.__node?.graph){canvasOptions.graph=this.__node.graph;if(!canvasOptions.__node){canvasOptions.__node={}}if(!canvasOptions.__node.tag)canvasOptions.__node.tag=canvasOptions._id;canvasOptions=this.__node.graph.add(canvasOptions);canvasOptions.__addOndisconnected=()=>{canvasOptions.stop();delete this.__node.graph.CANVASES[canvasOptions._id]}}if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText3(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw.bind(canvasOptions)}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText3(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update.bind(canvasOptions)}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText3(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init.bind(canvasOptions)}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText3(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear.bind(canvasOptions)}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{if(this.__node?.graph)this.__node.graph.remove(options._id);else{stopAnim(options._id);if(this?.__node?.graph)delete this.__node.graph.CANVASES[canvasOptions._id];else delete globalThis.CANVASES[canvasOptions._id]}}};return canvascontrols}}function drawFrame(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts=getCanvas.call(this,_id);canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText3(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")requestAnimationFrame(canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context));return _id}return void 0}function getCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}return canvasopts}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim,getCanvas};function parseFunctionFromText3(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var _ArrayManip=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return y2*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return 2*((y2-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps9){let now=Date.now();let toInterp=[now-ct*1e3/sps9,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i2=incr;i2<array.length;i2+=incr){let rounded=Math.round(i2);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i2=1;i2<fitCount-1;i2++){var tmp=i2*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i2]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x;b=0}else if(60<=h&&h<120){r=x;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x}else if(180<=h&&h<240){r=0;g=x;b=c}else if(240<=h&&h<300){r=x;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d={};data.forEach((arr,i2)=>{d[i2]=arr});data=d;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i2)=>lastValue+slopeIncr*(i2+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip=_ArrayManip;ArrayManip.bufferValues=(objects,property,keys2,buffer)=>{if(!Array.isArray(keys2)&&typeof keys2==="object")keys2=Object.keys(keys2);if(!buffer){let object_keys=Object.keys(objects);if(keys2)buffer=new Float32Array(object_keys.length*keys2.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys2=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys2.length)}else buffer=new Float32Array(object_keys.length)}}let i2=0;for(const key in objects){if(objects[key][property]){if(keys2){for(let j=0;j<keys2.length;j++){buffer[i2]=objects[key][property][keys2[j]];i2++}}else{buffer[i2]=objects[key][property];i2++}}}return buffer};var rechk=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str=(v,o,c)=>String.fromCharCode(...new Uint8Array(v.buffer,v.byteOffset+o,c));var rts=(v,o,c,s)=>new Uint8Array(v.buffer,v.byteOffset+o,c).set(s.split("").map(str2=>str2.charCodeAt(0)));var pst=(v,o,c)=>str(v,o+1,Math.min(v.getUint8(o),c-1));var tsp=(v,o,c,s)=>{v.setUint8(o,s.length);rts(v,o+1,c-1,s)};var lut=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v=>str(v,o,1),p:(v,c2)=>rts(v,o,1,c2)})],"?":c=>[c,1,o=>({u:v=>Boolean(v.getUint8(o)),p:(v,B2)=>v.setUint8(o,B2)})],b:c=>[c,1,o=>({u:v=>v.getInt8(o),p:(v,b)=>v.setInt8(o,b)})],B:c=>[c,1,o=>({u:v=>v.getUint8(o),p:(v,B2)=>v.setUint8(o,B2)})],h:c=>[c,2,o=>({u:v=>v.getInt16(o,le),p:(v,h)=>v.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v=>v.getUint16(o,le),p:(v,H2)=>v.setUint16(o,H2,le)})],i:c=>[c,4,o=>({u:v=>v.getInt32(o,le),p:(v,i2)=>v.setInt32(o,i2,le)})],I:c=>[c,4,o=>({u:v=>v.getUint32(o,le),p:(v,I)=>v.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v=>v.getFloat32(o,le),p:(v,f)=>v.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v=>v.getFloat64(o,le),p:(v,d)=>v.setFloat64(o,d,le)})],s:c=>[1,c,o=>({u:v=>str(v,o,c),p:(v,s)=>rts(v,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v=>pst(v,o,c),p:(v,s)=>tsp(v,o,c,s.slice(0,c-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var _ByteParser=class extends ArrayManip{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){indices.push(i2);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y2){return[y2&255,y2>>8&255]}static bytesToInt24(x0,x1,x2){let int24=(255&x0)<<16|(255&x1)<<8|255&x2;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x2){return x0*65536+x1*256+x2}static Uint24ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255]}static bytesToInt32(x0,x1,x2,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x2)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x2,x3){return x0*16777216+x1*65536+x2*256+x3}static Uint32ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255,y2>>24&255]}static get2sCompliment(val,nbits3){if(val>4294967296)return null;return val<<32-nbits3>>32-nbits3}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i2=0;i2<input.length;i2++){var c=input.charCodeAt(i2);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i2]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser.asUint8Array(patternBuffer);var M=pattern.length;if(M===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R=256;var rightmost_positions=new Int32Array(R);for(var c=0;c<R;c++){rightmost_positions[c]=-1}for(var j=0;j<M;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i2=start;i2<=lastIndex;i2+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i2+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i2}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk.exec(format);if(!m){throw new RangeError("Invalid format string")}const t2=lut("<"===m[1]),lu=(n,c)=>t2[c](n?parseInt(n,10):1);while(m=refmt.exec(format)){((r,s,f)=>{for(let i2=0;i2<r;++i2,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v=new DataView(arrb,offs|0);return fns.map(f=>f.u(v))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i2)=>f.p(v,values[i2]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser=_ByteParser;ByteParser.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92};var WebSerial=class extends ByteParser{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:`stream${Math.floor(Math.random()*1e15)}`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message){const writer=port.writable.getWriter();await writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=stream.buffering.lockIdx??0;for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))used=stream.buffering.lockIdx=i2;else{nextIndex=i2;if(nextIndex>=0){const len=nextIndex-used;if(!stream.buffering.locked){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(data);stream.buffering.locked=true}else if(len>0){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(new Uint8Array(data))}used=nextIndex}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}writeStream(stream,message){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i2=0;i2<ports.length;i2++){if(ports[i2].getInfo().usbVendorId===info.usbVendorId&&ports[i2].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i2],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i2]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t2=>{let opt=transforms[t2];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str2=stream;transform.forEach(transform2=>{str2=str2.pipeThrough(transform2)});return str2}};function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i2=0;i2<9;i2++){let j=i2*25;output[0][i2]=ByteParser.bytesToInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var sps=250;var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var gain=32;var nbits=24;var vref=1.2;var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};var accScale=.002/Math.pow(2,4);var getAcc=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b)=>a+b;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale*ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale*ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale*ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;if(arr[0]%2===0)output[i2+7]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);return output}var sps2=250;var cytonSerialSettings={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<128;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i2=0;i2<128;i2++){freeeeg128ChartSettings.lines[i2]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i2]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<32;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i2=0;i2<32;i2++){freeeeg32ChartSettings.lines[i2]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i2]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps5=40;var hegduinoSerialSettings={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\\n",codec:hegduinocodec,sps:sps5};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={deviceType:"BLE",deviceName:"hegduino",sps:sps5,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps5}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i2=0;while(i2<pktCt){let idx=i2*6;if(i2%2===0){output["ir"][i2]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i2+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i2-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i2]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i2++}return output}function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i2=0;i2<20;i2++){let idx=i2*12;output.ax[i2]=ByteParser.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i2]=ByteParser.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i2]=ByteParser.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i2]=ByteParser.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i2]=ByteParser.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i2]=ByteParser.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i2=0;i2<7;i2++){let j=i2*26+1;if(!arr[j+23])break;output[0][i2]=ByteParser.bytesToUInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToUInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToUInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToUInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToUInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToUInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToUInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToUInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var sps6=250;var cognixionONEBLESettings={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps6}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps6};var cognixionONESerialSettings=Object.assign({},cytonSerialSettings);cognixionONESerialSettings.sps=sps6;cognixionONESerialSettings.deviceName="cognixionONE";var defaultChartSetting4={nSec:10,sps:sps6,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting4)),"1":JSON.parse(JSON.stringify(defaultChartSetting4)),"2":JSON.parse(JSON.stringify(defaultChartSetting4)),"3":JSON.parse(JSON.stringify(defaultChartSetting4)),"4":JSON.parse(JSON.stringify(defaultChartSetting4)),"5":JSON.parse(JSON.stringify(defaultChartSetting4)),"6":JSON.parse(JSON.stringify(defaultChartSetting4)),"7":JSON.parse(JSON.stringify(defaultChartSetting4))}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i2=0;while(i2<data.length){if(PeanutCodes[data[i2]]&&i2+1+PeanutCodes[data[i2]].byteLength<=data.length){let slice=data.slice(i2+1,i2+1+PeanutCodes[data[i2]].byteLength).buffer;let unpacked=ByteParser.struct(PeanutCodes[data[i2]].format).unpack(slice);let code=PeanutCodes[data[i2]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i2]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type]=unpacked;else result[PeanutCodes[data[i2]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type].push(...unpacked);else result[PeanutCodes[data[i2]].type].push(unpacked)}i2+=PeanutCodes[data[i2]].byteLength+1}else i2++}result.timestamp=Date.now();return result}var peanutSerialSettings={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j=0;j<3;j++){let i2=j*16+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}else{output.humidity=[];for(let j=0;j<3;j++){let i2=j*24+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser.bytesToInt32(arr[19+i2],arr[18+i2],arr[17+i2],arr[16+i2]);let hfrac=ByteParser.bytesToInt32(arr[23+i2],arr[22+i2],arr[21+i2],arr[20+i2]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}return output};function altitude(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa,.1903))}function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=ads131m08codec(arr.subarray(2));Object.keys(result).forEach((key,i2)=>{output[i2+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,ads131m08codec(arr))}return output}var nrf5xSerialSettings={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xBLESettings={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting5={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))},generateNewLines:true,cleanGeneration:false};var gain2=32;var nbits2=24;var vref2=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec,sps:20};var statechangerBLESettings={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps7=40;var blueberryBLESettings={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps7}}},sps:sps7};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps8=40;var blueberry2BLESettings={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps8},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps8}}},sps:sps8};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop2=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v,i2)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i2+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop2()},loopTime)}};loop2();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings}};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.buffer)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps9=this.sps;this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps9=this.sps){this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps9=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f,i2)=>{out=f.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad=class{constructor(type,freq,sps9,Q=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: \'lowpass\',\'highpass\',\'bandpass\',\'notch\',\'peak\',\'lowshelf\',\'highshelf\'");return}this.type=type;this.freq=freq;this.sps=sps9;this.Q=Q;this.dbGain=dbGain;let A2=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps9;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q);let beta=Math.sqrt(A2+A2);this[type](A2,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A2,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A2,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A2,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A2,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A2,sn,cs,alpha,beta){this.b0=1+alpha*A2;this.b1=-2*cs;this.b2=1-alpha*A2;this.a0=1+alpha/A2;this.a1=-2*cs;this.a2=1-alpha/A2}lowshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1-(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1-(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1+(A2+1)*cs+beta*sn;this.a1=2*(A2-1+(A2+1)*cs);this.a2=A2+1+(A2-1)*cs-beta*sn}highshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1+(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1+(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1-(A2+1)*cs-beta*sn;this.a1=2*(A2-1-(A2+1)*cs);this.a2=A2+1-(A2-1)*cs-beta*sn}applyFilter(signal_step){let y2=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y2;return y2}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y2=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y2;return y2}};var makeNotchFilter=(frequency,sps9,bandwidth)=>{return new Biquad("notch",frequency,sps9,Biquad.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps9,resonance=Math.pow(10,Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad("bandpass",Biquad.calcCenterFrequency(freqStart,freqEnd),sps9,Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart,freqEnd),Biquad.calcBandwidth(freqStart,freqEnd),resonance),0)};function parseFunctionFromText2(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs3(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs2}var stringifyFast2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast3(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast2}function loadStreamWorkerGlobals(){globalThis.Devices=Devices;globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser;globalThis.filtering=true;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"transferDevice":function transferDevice(device,worker){let cpy=Object.assign({},device);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}worker.send({route:"receiveDevice",args:cpy})},"receiveDevice":function receiveDevice(device){for(const key in device){if(typeof device[key]==="string"){let fn=parseFunctionFromText2(device[key]);if(typeof fn==="function"){device[key]=fn}}}if(!globalThis.Devices[device.deviceType])globalThis.Devices[device.deviceType]={};globalThis.Devices[device.deviceType][device.deviceName]=device},"receiveDecoder":function receiveDecoder(decoder2,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder2+")")},"receiveCodec":function receiveDeviceCodec(decoder2,deviceType,device,service,characteristic){let codec=parseFunctionFromText2(decoder2);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters)globalThis.filters={};for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService2=this.__node.graph;if(!globalThis.Serial)WorkerService2.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(typeof stream.settings.pipeTo==="string")WorkerService2.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService2.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService2.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(`${stream._id} disconnected`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(`disconnected`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){globalThis.Devices=Devices;const worker=new WorkerService({roots:{...workerCanvasRoutes,...remoteGraphRoutes,...streamWorkerRoutes}})}var stream_worker_default=self;})();\n'],{type:"text/javascript"})),hn=pn,Me=class{constructor(){this.recursivelyAssign=(t,e)=>{for(const r in e)typeof e[r]=="object"?typeof t[r]=="object"?this.recursivelyAssign(t[r],e[r]):t[r]=this.recursivelyAssign({},e[r]):t[r]=e[r];return t}}static autoscale(t,e=0,r=1,s=!1,i,n,a){if((t==null?void 0:t.length)===0)return t;let o=n||Math.max(...t),c=i||Math.min(...t),l=1/r,d=1;if(s){let u=Math.max(Math.abs(c),Math.abs(o));return u!==0&&(d=l/u),t.map(f=>(a&&(f<c&&(f=c),f>o&&(f=o)),f*d+(l*(e+1)*2-1-l)))}else return o===c?o!==0?d=l/o:c!==0&&(d=l/Math.abs(c)):d=l/(o-c),t.map(u=>(a&&(u<c&&(u=c),u>o&&(u=o)),2*((u-c)*d-1/(2*r))+(l*(e+1)*2-1-l)))}static genTimestamps(t,e){let r=Date.now(),s=[r-t*1e3/e,r];return Me.upsample(s,t)}static absmax(t){return Math.max(Math.abs(Math.min(...t)),Math.max(...t))}static downsample(t,e,r=1){if(t.length>e){let s=new Array(e),i=t.length/e,n=t.length-1,a=0,o=0;for(let c=i;c<t.length;c+=i){let l=Math.round(c);l>n&&(l=n);for(let d=a;d<l;d++)s[o]+=t[d];s[o]/=(l-a)*r,o++,a=l}return s}else return t}static upsample(t,e,r=1){var s=function(u,f,h){return(u+(f-u)*h)*r},i=new Array(e),n=(t.length-1)/(e-1);i[0]=t[0];for(var a=1;a<e-1;a++){var o=a*n,c=Math.floor(o),l=Math.ceil(o),d=o-c;i[a]=s(t[c],t[l],d)}return i[e-1]=t[t.length-1],i}static interpolate(t,e,r=1){return t.length>e?Me.downsample(t,e,r):t.length<e?Me.upsample(t,e,r):t}static HSLToRGB(t,e,r,s=255){e/=100,r/=100;let i=(1-Math.abs(2*r-1))*e,n=i*(1-Math.abs(t/60%2-1)),a=r-i/2,o=0,c=0,l=0;return 0<=t&&t<60?(o=i,c=n,l=0):60<=t&&t<120?(o=n,c=i,l=0):120<=t&&t<180?(o=0,c=i,l=n):180<=t&&t<240?(o=0,c=n,l=i):240<=t&&t<300?(o=n,c=0,l=i):300<=t&&t<360&&(o=i,c=0,l=n),o=(o+a)*s,c=(c+a)*s,l=(l+a)*s,[o,c,l]}static circularBuffer(t,e){if(e.length<t.length){let r=t.slice(e.length),s=t.length;t.splice(0,s,...r,...e)}else if(e.length>t.length){let r=t.length;t.splice(0,r,e.slice(r-e.length))}else t.splice(0,t.length,...e);return t}static reformatData(t,e){var r;if(Array.isArray(t)){if(Array.isArray(t[0])){let s={};if(t.forEach((i,n)=>{s[n]=i}),t=s,isNaN(t[0][0]))return}else if(e){if(t={[e]:t},isNaN(t[e][0]))return}else if(t={0:t},isNaN(t[0][0]))return}else if(typeof t=="object"){for(const s in t)if(typeof t[s]=="number"?t[s]=[t[s]]:(r=t[s])!=null&&r.values&&typeof t[s].values=="number"&&(t[s].values=[t[s].values]),isNaN(t[s][0]))return}else if(typeof t=="string"){let s;if(t.includes(`\r
`)){let i=t.split(`\r
`);t={},i.forEach((n,a)=>{n.includes("	")?s=n.split("	"):n.includes(",")?s=n.split(","):n.includes("|")&&(s=n.split("|")),Array.isArray(s)&&s.forEach((o,c)=>{if(o.includes(":")){let[l,d]=o.split(":"),u=parseFloat(d);if(u)t[l]=[u];else return}else{let l=parseFloat(o);if(l)t[c]=[l];else return}})})}else t.includes("	")?s=t.split("	"):t.includes(",")?s=t.split(","):t.includes("|")&&(s=t.split("|"));t={},Array.isArray(s)&&s.forEach((i,n)=>{if(i.includes(":")){let[a,o]=i.split(":"),c=parseFloat(o);if(c)t[a]=[c];else return}else{let a=parseFloat(i);if(a)t[n]=[a];else return}})}else typeof t=="number"&&(e?t={[e]:[t]}:t={0:[t]});return t}static padTime(t,e,r,s){let i=(t[0]-e)/r/s;return[...new Array(s-t.length).map((a,o)=>e+i*(o+1)),...t]}static interpolateForTime(t,e,r){return Me.interpolate(t,Math.ceil(r*e))}isTypedArray(t){return ArrayBuffer.isView(t)&&Object.prototype.toString.call(t)!=="[object DataView]"}spliceTypedArray(t,e,r){let s=t.subarray(0,e),i;r&&(i=t.subarray(r+1));let n;return(s.length>0||(i==null?void 0:i.length)>0)&&(n=new t.constructor(s.length+i.length)),s.length>0&&n.set(s),i&&i.length>0&&n.set(i,s.length),n}},gs=Me;gs.bufferValues=(t,e,r,s)=>{if(!Array.isArray(r)&&typeof r=="object"&&(r=Object.keys(r)),!s){let n=Object.keys(t);r?s=new Float32Array(n.length*r.length):typeof t[n[0]][e]=="object"?(r=Object.keys(t[n[0]][e]),s=new Float32Array(n.length*r.length)):s=new Float32Array(n.length)}let i=0;for(const n in t)if(t[n][e])if(r)for(let a=0;a<r.length;a++)s[i]=t[n][e][r[a]],i++;else s[i]=t[n][e],i++;return s};var gn=/^([<>])?(([1-9]\d*)?([xcbB?hHiIfdsp]))*$/,bn=/([1-9]\d*)?([xcbB?hHiIfdsp])/g,Kt=(t,e,r)=>String.fromCharCode(...new Uint8Array(t.buffer,t.byteOffset+e,r)),Xt=(t,e,r,s)=>new Uint8Array(t.buffer,t.byteOffset+e,r).set(s.split("").map(i=>i.charCodeAt(0))),yn=(t,e,r)=>Kt(t,e+1,Math.min(t.getUint8(e),r-1)),_n=(t,e,r,s)=>{t.setUint8(e,s.length),Xt(t,e+1,r-1,s)},vn=t=>({x:e=>[1,e,0],c:e=>[e,1,r=>({u:s=>Kt(s,r,1),p:(s,i)=>Xt(s,r,1,i)})],"?":e=>[e,1,r=>({u:s=>!!s.getUint8(r),p:(s,i)=>s.setUint8(r,i)})],b:e=>[e,1,r=>({u:s=>s.getInt8(r),p:(s,i)=>s.setInt8(r,i)})],B:e=>[e,1,r=>({u:s=>s.getUint8(r),p:(s,i)=>s.setUint8(r,i)})],h:e=>[e,2,r=>({u:s=>s.getInt16(r,t),p:(s,i)=>s.setInt16(r,i,t)})],H:e=>[e,2,r=>({u:s=>s.getUint16(r,t),p:(s,i)=>s.setUint16(r,i,t)})],i:e=>[e,4,r=>({u:s=>s.getInt32(r,t),p:(s,i)=>s.setInt32(r,i,t)})],I:e=>[e,4,r=>({u:s=>s.getUint32(r,t),p:(s,i)=>s.setUint32(r,i,t)})],f:e=>[e,4,r=>({u:s=>s.getFloat32(r,t),p:(s,i)=>s.setFloat32(r,i,t)})],d:e=>[e,8,r=>({u:s=>s.getFloat64(r,t),p:(s,i)=>s.setFloat64(r,i,t)})],s:e=>[1,e,r=>({u:s=>Kt(s,r,e),p:(s,i)=>Xt(s,r,e,i.slice(0,e))})],p:e=>[1,e,r=>({u:s=>yn(s,r,e),p:(s,i)=>_n(s,r,e,i.slice(0,e-1))})]}),Ur=new RangeError("Structure larger than remaining buffer"),mn=new RangeError("Not enough values for structure"),ve=class extends gs{static toDataView(t){if(!(t instanceof DataView))if(typeof t=="string"&&parseInt(t)&&(t=parseInt(t)),typeof t=="string"){let e=new TextEncoder,r={};for(const i in ve.codes)for(;t.indexOf(i)>-1;){let n=t.indexOf(i);t=t.replace(i,""),r[n]=i}let s=Array.from(e.encode(t));for(const i in r)s.splice(parseInt(i),0,ve.codes[r[i]]);t=new DataView(new Uint8Array(s).buffer)}else if(typeof t=="number"){let e=t;t<256?(t=new DataView(new ArrayBuffer(1)),t.setUint8(0,e)):t<65536?(t=new DataView(new ArrayBuffer(2)),t.setInt16(0,e)):(t=new DataView(new ArrayBuffer(4)),t.setUint32(0,e))}else t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer?t=new DataView(t):Array.isArray(t)?t=new DataView(Uint8Array.from(t).buffer):typeof t=="object"&&(t=new TextEncoder().encode(JSON.stringify(t)));return t}static searchBuffer(t,e,r){for(var s=e,i=t,n=ve.boyerMoore(s),a=n.byteLength,o=[],c=n(i);c!==-1&&(o.push(c),!(r&&o.length>=r));c=n(i,c+a));return o}static bytesToInt16(t,e){let r=(255&t)<<8|255&e;return(r&32768)>0?r|=4294901760:r&=65535,r}static bytesToUInt16(t,e){return t*256+e}static Uint16ToBytes(t){return[t&255,t>>8&255]}static bytesToInt24(t,e,r){let s=(255&t)<<16|(255&e)<<8|255&r;return(s&8388608)>0?s|=4278190080:s&=16777215,s}static bytesToUInt24(t,e,r){return t*65536+e*256+r}static Uint24ToBytes(t){return[t&255,t>>8&255,t>>16&255]}static bytesToInt32(t,e,r,s){let i=(255&t)<<24|(255&e)<<16|(255&r)<<8|255&s;return(i&2147483648)>0?i|=0:i&=4294967295,i}static bytesToUInt32(t,e,r,s){return t*16777216+e*65536+r*256+s}static Uint32ToBytes(t){return[t&255,t>>8&255,t>>16&255,t>>24&255]}static get2sCompliment(t,e){return t>4294967296?null:t<<32-e>>32-e}static getSignedInt(...t){let e=0;function r(s){for(var i=0,n=!0;s--;)if(n){let a=t[e++];i+=a&127,a&128&&(i-=128),n=!1}else i*=256,i+=t[e++];return i}return r(t.length)}static asUint8Array(t){if(t instanceof Uint8Array)return t;if(typeof t=="string"){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++){var s=t.charCodeAt(r);if(s>127)throw new TypeError("Only ASCII patterns are supported");e[r]=s}return e}else return new Uint8Array(t)}static boyerMoore(t){var e=ve.asUint8Array(t),r=e.length;if(r===0)throw new TypeError("patternBuffer must be at least 1 byte long");for(var s=256,i=new Int32Array(s),n=0;n<s;n++)i[n]=-1;for(var a=0;a<r;a++)i[e[a]]=a;var o=(c,l,d)=>{var u=ve.asUint8Array(c);l===void 0&&(l=0),d===void 0&&(d=u.length);for(var f=e,h=i,g=d-f.length,b=f.length-1,y,_=l;_<=g;_+=y){y=0;for(var m=b;m>=0;m--){var S=u[_+m];if(f[m]!==S){y=Math.max(1,m-h[S]);break}}if(y===0)return _}return-1};return o.byteLength=e.byteLength,o}static struct(t){let e=[],r=0,s=gn.exec(t);if(!s)throw new RangeError("Invalid format string");const i=vn(s[1]==="<"),n=(u,f)=>i[f](u?parseInt(u,10):1);for(;s=bn.exec(t);)((u,f,h)=>{for(let g=0;g<u;++g,r+=f)h&&e.push(h(r))})(...n(...s.slice(1)));const a=(u,f)=>{if(u.byteLength<(f|0)+r)throw Ur;let h=new DataView(u,f|0);return e.map(g=>g.u(h))},o=(u,f,...h)=>{if(h.length<e.length)throw mn;if(u.byteLength<f+r)throw Ur;const g=new DataView(u,f);new Uint8Array(u,f,r).fill(0),e.forEach((b,y)=>b.p(g,h[y]))},c=(...u)=>{let f=new ArrayBuffer(r);return o(f,0,...u),f},l=u=>a(u,0);function*d(u){for(let f=0;f+r<=u.byteLength;f+=r)yield a(u,f)}return Object.freeze({unpack:l,pack:c,unpack_from:a,pack_into:o,iter_unpack:d,format:t,size:r})}},v=ve;v.codes={"\\n":10,"\\r":13,"\\t":9,"\\s":32,"\\b":8,"\\f":12,"\\":92};var qr;(function(t){t[t.SCAN_MODE_LOW_POWER=0]="SCAN_MODE_LOW_POWER",t[t.SCAN_MODE_BALANCED=1]="SCAN_MODE_BALANCED",t[t.SCAN_MODE_LOW_LATENCY=2]="SCAN_MODE_LOW_LATENCY"})(qr||(qr={}));nr();ar();nr();var k=Zr("BluetoothLe",{web:()=>Promise.resolve().then(()=>(Oi(),ts)).then(t=>new t.BluetoothLeWeb)}),wn=vi(Ei());function Jt(t){return t?(0,wn.default)(1):e=>e()}function T(t){if(typeof t!="string")throw new Error(`Invalid UUID type ${typeof t}. Expected string.`);if(t=t.toLowerCase(),!(t.search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${t}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return t}var kn=class{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=Jt(!0)}enableQueue(){this.queue=Jt(!0)}disableQueue(){this.queue=Jt(!1)}async initialize(t){await this.queue(async()=>{await k.initialize(t)})}async getEnabled(){return this.isEnabled()}async isEnabled(){return await this.queue(async()=>(await k.isEnabled()).value)}async enable(){await this.queue(async()=>{await k.enable()})}async disable(){await this.queue(async()=>{await k.disable()})}async startEnabledNotifications(t){await this.queue(async()=>{var e;const r="onEnabledChanged";await((e=this.eventListeners.get(r))===null||e===void 0?void 0:e.remove());const s=await k.addListener(r,i=>{t(i.value)});this.eventListeners.set(r,s),await k.startEnabledNotifications()})}async stopEnabledNotifications(){await this.queue(async()=>{var t;const e="onEnabledChanged";await((t=this.eventListeners.get(e))===null||t===void 0?void 0:t.remove()),this.eventListeners.delete(e),await k.stopEnabledNotifications()})}async isLocationEnabled(){return await this.queue(async()=>(await k.isLocationEnabled()).value)}async openLocationSettings(){await this.queue(async()=>{await k.openLocationSettings()})}async openBluetoothSettings(){await this.queue(async()=>{await k.openBluetoothSettings()})}async openAppSettings(){await this.queue(async()=>{await k.openAppSettings()})}async setDisplayStrings(t){await this.queue(async()=>{await k.setDisplayStrings(t)})}async requestDevice(t){return t=t?this.validateRequestBleDeviceOptions(t):void 0,await this.queue(async()=>await k.requestDevice(t))}async requestLEScan(t,e){t=this.validateRequestBleDeviceOptions(t),await this.queue(async()=>{var r;await((r=this.scanListener)===null||r===void 0?void 0:r.remove()),this.scanListener=await k.addListener("onScanResult",s=>{const i=Object.assign(Object.assign({},s),{manufacturerData:this.convertObject(s.manufacturerData),serviceData:this.convertObject(s.serviceData),rawAdvertisement:s.rawAdvertisement?this.convertValue(s.rawAdvertisement):void 0});e(i)}),await k.requestLEScan(t)})}async stopLEScan(){await this.queue(async()=>{var t;await((t=this.scanListener)===null||t===void 0?void 0:t.remove()),this.scanListener=null,await k.stopLEScan()})}async getDevices(t){return this.queue(async()=>(await k.getDevices({deviceIds:t})).devices)}async getConnectedDevices(t){return this.queue(async()=>(await k.getConnectedDevices({services:t})).devices)}async connect(t,e,r){await this.queue(async()=>{var s;if(e){const i=`disconnected|${t}`;await((s=this.eventListeners.get(i))===null||s===void 0?void 0:s.remove());const n=await k.addListener(i,()=>{e(t)});this.eventListeners.set(i,n)}await k.connect(Object.assign({deviceId:t},r))})}async createBond(t){await this.queue(async()=>{await k.createBond({deviceId:t})})}async isBonded(t){return await this.queue(async()=>(await k.isBonded({deviceId:t})).value)}async disconnect(t){await this.queue(async()=>{await k.disconnect({deviceId:t})})}async getServices(t){return await this.queue(async()=>(await k.getServices({deviceId:t})).services)}async discoverServices(t){await this.queue(async()=>{await k.discoverServices({deviceId:t})})}async readRssi(t){return await this.queue(async()=>{const r=await k.readRssi({deviceId:t});return parseFloat(r.value)})}async read(t,e,r,s){return e=T(e),r=T(r),await this.queue(async()=>{const n=await k.read(Object.assign({deviceId:t,service:e,characteristic:r},s));return this.convertValue(n.value)})}async write(t,e,r,s,i){return e=T(e),r=T(r),this.queue(async()=>{if(!(s!=null&&s.buffer))throw new Error("Invalid data.");let n=s;ae.getPlatform()!=="web"&&(n=Ct(s)),await k.write(Object.assign({deviceId:t,service:e,characteristic:r,value:n},i))})}async writeWithoutResponse(t,e,r,s,i){e=T(e),r=T(r),await this.queue(async()=>{if(!(s!=null&&s.buffer))throw new Error("Invalid data.");let n=s;ae.getPlatform()!=="web"&&(n=Ct(s)),await k.writeWithoutResponse(Object.assign({deviceId:t,service:e,characteristic:r,value:n},i))})}async readDescriptor(t,e,r,s,i){return e=T(e),r=T(r),s=T(s),await this.queue(async()=>{const a=await k.readDescriptor(Object.assign({deviceId:t,service:e,characteristic:r,descriptor:s},i));return this.convertValue(a.value)})}async writeDescriptor(t,e,r,s,i,n){return e=T(e),r=T(r),s=T(s),this.queue(async()=>{if(!(i!=null&&i.buffer))throw new Error("Invalid data.");let a=i;ae.getPlatform()!=="web"&&(a=Ct(i)),await k.writeDescriptor(Object.assign({deviceId:t,service:e,characteristic:r,descriptor:s,value:a},n))})}async startNotifications(t,e,r,s){e=T(e),r=T(r),await this.queue(async()=>{var i;const n=`notification|${t}|${e}|${r}`;await((i=this.eventListeners.get(n))===null||i===void 0?void 0:i.remove());const a=await k.addListener(n,o=>{s(this.convertValue(o==null?void 0:o.value))});this.eventListeners.set(n,a),await k.startNotifications({deviceId:t,service:e,characteristic:r})})}async stopNotifications(t,e,r){e=T(e),r=T(r),await this.queue(async()=>{var s;const i=`notification|${t}|${e}|${r}`;await((s=this.eventListeners.get(i))===null||s===void 0?void 0:s.remove()),this.eventListeners.delete(i),await k.stopNotifications({deviceId:t,service:e,characteristic:r})})}validateRequestBleDeviceOptions(t){return t.services&&(t.services=t.services.map(T)),t.optionalServices&&(t.optionalServices=t.optionalServices.map(T)),t}convertValue(t){return typeof t=="string"?st(t):t===void 0?new DataView(new ArrayBuffer(0)):t}convertObject(t){if(t===void 0)return;const e={};for(const r of Object.keys(t))e[r]=this.convertValue(t[r]);return e}},Sn=new kn;ar();var ot=class extends v{constructor(t,e){super(),this.client=Sn,this.devices={},this.location=!1,this.initialized=!1,this.setupDevice=(r,s)=>new Promise(async(i,n)=>{this.devices[r.deviceId]={device:r,deviceId:r.deviceId,...s},this.client.connect(r.deviceId,a=>{var o;(o=this.devices[r.deviceId])!=null&&o.ondisconnect&&this.devices[r.deviceId].ondisconnect(a)},s==null?void 0:s.connectOptions).then(async()=>{let a=await this.getServices(r.deviceId);for(const o in s==null?void 0:s.services){let c=a.find(l=>{if(l.uuid===o)return!0});if(c)for(const l in s.services[o]){if(!c.characteristics.find(u=>{if(u.uuid===l)return!0}))continue;let d=s.services[o][l];d.write&&await this.write(r,o,l,d.write,d.writeCallback,d.writeOptions),d.read&&await this.read(r,o,l,d.readCallback,d.readOptions),d.notify&&d.notifyCallback&&(await this.subscribe(r,o,l,d.notifyCallback),d.notifying=!0)}}}).catch(n),i(this.devices[r.deviceId])}),this.triangulate=(r,s=1500,i=60)=>new Promise((n,a)=>{if("Accelerometer"in globalThis){if(typeof globalThis.Accelerometer=="function"){let o=new globalThis.Accelerometer({frequency:i}),c=performance.now(),l=c,d=()=>{l-c<s?this.readRssi(r).then(u=>{o.x,o.y,o.z,l=performance.now()}):o.removeEventListener("reading",d)};o.addEventListener("reading",d)}}else a(new Error("No Accelerometer API detected"))}),e&&(this.location=e),t&&this.setup(t)}setup(t,e=this.location){if(t)for(const s in t.services);let r={};return e||(r.androidNeverForLocation=!1),new Promise(async(s,i)=>{if(this.initialized||(await this.client.initialize(r),this.initialized=!0),t!=null&&t.deviceId)s(await this.reconnect(t.deviceId));else if(t){let n=Array.from(Object.keys(t.services)),a={};this.isMobile()||(a.optionalServices=n),t.name&&(a.name=t.name),t.namePrefix&&(a.namePrefix=t.namePrefix),this.client.requestDevice(a).then(o=>{s(this.setupDevice(o,t))}).catch(i)}else this.client.requestDevice().then(n=>{s(this.setupDevice(n,t))}).catch(i)})}initialize(t){return new Promise((e,r)=>{this.client.initialize(t).then(()=>{e(!0)}).catch(r)})}requestDevice(t,e){return new Promise((r,s)=>{this.client.requestDevice(t).then(i=>{this.devices[i.deviceId]={device:i,deviceId:i.deviceId,...e},r(i)}).catch(s)})}getServices(t){return this.client.getServices(t)}connect(t,e){return new Promise((r,s)=>{this.client.connect(t.deviceId,i=>{e!=null&&e.ondisconnect&&e.ondisconnect(i)},e==null?void 0:e.connectOptions).then(i=>{r(t)}).catch(s)})}reconnect(t,e){return new Promise((r,s)=>{var o;let i=this.isAndroid(),n=this.isMobile();console.log(t);let a=e;this.devices[t]&&(a=Object.assign(Object.assign({},this.devices[t]),a)),a!=null&&a.deviceId&&delete a.deviceId,!n&&!((o=navigator.bluetooth)!=null&&o.getDevices)&&this.setup(a).then(c=>{r(c)}),i&&this.client.getDevices([t]).then(c=>{this.setupDevice(c[0],a).then(l=>{r(l)})}).catch(s)})}disconnect(t){if(typeof t=="object"&&t!=null&&t.deviceId&&(t=t.deviceId),typeof t=="string"){let e=this.devices[t];return e.beforedisconnect&&e.beforedisconnect(this,e),delete this.devices[t],this.client.disconnect(t)}}write(t,e,r,s,i,n){return typeof t=="object"&&(t=t.deviceId),i?this.client.write(t,e,r,ot.toDataView(s)).then(i):this.client.writeWithoutResponse(t,e,r,ot.toDataView(s),n)}read(t,e,r,s,i){return typeof t=="object"&&(t=t.deviceId),s?this.client.read(t,e,r,i).then(s):this.client.read(t,e,r,i)}subscribe(t,e,r,s){return typeof t=="object"&&(t=t.deviceId),this.client.startNotifications(t,e,r,s)}unsubscribe(t,e,r){return typeof t=="object"&&(t=t.deviceId),this.client.stopNotifications(t,e,r)}scan(t,e){return this.client.requestLEScan(t,e)}stopScanning(){return this.client.stopLEScan()}readDescriptor(t,e,r,s,i){return this.client.readDescriptor(t.deviceId,e,r,s,i)}writeDescriptor(t,e,r,s,i,n){return this.client.writeDescriptor(t.deviceId,e,r,s,ot.toDataView(i),n)}readRssi(t){return this.client.readRssi(t.deviceId)}isMobile(){let t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t}isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}async distance(t,e,r,s,i){let n=await this.readRssi(t);if(n==0)return;let a=n/e;return a<1?Math.pow(a,10):r*Math.pow(a,s)+i}async distanceFromPhone(t,e,r){let s,i,n;return r&&(r==="nexus5"?(s=.42093,i=6.9476,n=.54992):r==="motoX"?(s=.9401940951,i=6.170094565,n=0):r==="iphone5"&&(s=.89976,i=7.7095,n=.111)),await this.distance(t,e,s,i,n)}},Je=class extends v{constructor(){super(...arguments),this.streams={},this.createStream=t=>{var r;let e={_id:t._id?t._id:`stream${Math.floor(Math.random()*1e15)}`,info:t.port.getInfo(),running:!1,...t};return(r=t.port)!=null&&r.readable&&(t.transforms?e.reader=Je.setStreamTransforms(t.port.readable,t.transforms).getReader():e.reader=t.port.readable.getReader()),this.streams[e._id]=e,e}}getPorts(){return navigator.serial.getPorts()}requestPort(t,e){let r={};return t&&(r.usbVendorId=t),e&&(r.usbProductId=e),r.usbVendorId?navigator.serial.requestPort({filters:[r]}):navigator.serial.requestPort()}openPort(t,e){return e&&(e=Object.assign({},e)),e!=null&&e.ondisconnect&&(t.ondisconnect=e.ondisconnect,delete e.ondisconnect),t.open(e).then(()=>{e!=null&&e.onconnect&&e.onconnect(t)})}async readWithTimeout(t,e){const r=t.readable.getReader(),s=setTimeout(()=>{r.releaseLock()},e),i=await r.read();return clearTimeout(s),r.releaseLock(),i}async writePort(t,e){const r=t.writable.getWriter();return await r.write(Je.toDataView(e)),r.releaseLock(),!0}getSignals(t){return t.getSignals()}setSignals(t,e){return t.setSignals(e)}readStream(t){if(t.reader&&!t.running){let e=t.reader;t.buffering&&(typeof t.buffering!="object"&&(t.buffering={}),t.buffering.buffer||(t.buffering.buffer=[]),t.buffering.searchBytes||(t.buffering.searchBytes=new Uint8Array([13,10])));let r=()=>{if(t.port.readable&&t.running)e.read().then(s=>{if(s.done)e.releaseLock();else{if(t.buffering){t.buffering.buffer.push(...s.value);const n=t.buffering.searchBytes,a=t.buffering.buffer,o=Je.boyerMoore(n),c=o.byteLength;let l=-1,d=t.buffering.lockIdx??0;for(var i=o(a);i!==-1;i=o(a,i+c))if(!t.buffering.locked&&!("lockIdx"in t.buffering))d=t.buffering.lockIdx=i;else if(l=i,l>=0){const u=l-d;if(t.buffering.locked){if(u>0){const f=t.buffering.buffer.splice(t.buffering.lockIdx,u),h=new Uint8Array(f.slice(t.buffering.searchBytes.length));t.ondata(new Uint8Array(h))}}else{const f=t.buffering.buffer.splice(t.buffering.lockIdx,u),h=new Uint8Array(f.slice(t.buffering.searchBytes.length));t.ondata(h),t.buffering.locked=!0}d=l}}else t.ondata(s.value);setTimeout(()=>{r()},t.frequency)}}).catch(s=>{console.error(t._id," Read error:",s),(s.message.includes("overrun")||s.message.includes("framing"))&&(delete t.reader,this.reconnect(t))});else if(!t.running&&t.port.readable)try{e.releaseLock()}catch(s){console.error(s)}};return t.running=!0,r(),t}}writeStream(t,e){if(typeof t=="string"&&(t=this.streams[t]),t.port.writable){let r=t.port.writable.getWriter();return r.write(Je.toDataView(e)),r.releaseLock(),!0}}closeStream(t,e){return typeof t=="string"&&(t=this.streams[t]),t.running=!1,new Promise((r,s)=>{t.settings.beforedisconnect&&t.settings.beforedisconnect(this,t.port),setTimeout(async()=>{if(t.port.readable&&t.reader){try{t.reader.releaseLock()}catch(i){console.error(i)}if(t.transforms)try{await t.reader.cancel()}catch(i){console.error(i)}}try{await t.port.close().then(()=>{e&&e(this.streams[t._id])}),delete this.streams[t._id],r(!0)}catch(i){s(i)}},300)})}reconnect(t,e){return typeof t=="string"&&(t=this.streams[t]),new Promise((r,s)=>{if(typeof t!="object"){s(void 0);return}let i=t.port.getInfo();this.closeStream(t._id).then(n=>{setTimeout(()=>{this.getPorts().then(a=>{for(let o=0;o<a.length;o++)a[o].getInfo().usbVendorId===i.usbVendorId&&a[o].getInfo().usbProductId===i.usbProductId&&(e?e._id=t._id:e=t,delete e.port,this.openPort(a[o],e.settings).then(()=>{const c=this.createStream({...e,port:a[o]});this.readStream(c),r(c)}).catch(s))}).catch(s)},100)})})}static setStreamTransforms(t,e){let r=[];Object.keys(e).forEach(i=>{let n=e[i];if(n instanceof TransformStream)r.push(n);else{n.start||(n.start=function(){}),n.flush||(n.flush=function(){});let a=new TransformStream({start:n.start,transform:n.transform,flush:n.flush},n.writableStrategy,n.readableStrategy);r.push(a)}});let s=t;return r.forEach(i=>{s=s.pipeThrough(i)}),s}};function De(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let s=0;s<9;s++){let i=s*25;r[0][s]=v.bytesToInt24(e[i],e[i+1],e[i+2]),r[1][s]=v.bytesToInt24(e[i+3],e[i+4],e[i+5]),r[2][s]=v.bytesToInt24(e[i+6],e[i+7],e[i+8]),r[3][s]=v.bytesToInt24(e[i+9],e[i+10],e[i+11]),r[4][s]=v.bytesToInt24(e[i+12],e[i+13],e[i+14]),r[5][s]=v.bytesToInt24(e[i+15],e[i+16],e[i+17]),r[6][s]=v.bytesToInt24(e[i+18],e[i+19],e[i+20]),r[7][s]=v.bytesToInt24(e[i+21],e[i+22],e[i+23])}return r}new TextDecoder;var bs=250,ee={nSec:10,sps:bs,units:"mV"};JSON.parse(JSON.stringify(ee)),JSON.parse(JSON.stringify(ee)),JSON.parse(JSON.stringify(ee)),JSON.parse(JSON.stringify(ee)),JSON.parse(JSON.stringify(ee)),JSON.parse(JSON.stringify(ee)),JSON.parse(JSON.stringify(ee)),JSON.parse(JSON.stringify(ee));var An=32,xn=24,On=1.2,te={sps:bs,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*On/(An*(Math.pow(2,xn)-1))};JSON.parse(JSON.stringify(te)),JSON.parse(JSON.stringify(te)),JSON.parse(JSON.stringify(te)),JSON.parse(JSON.stringify(te)),JSON.parse(JSON.stringify(te)),JSON.parse(JSON.stringify(te)),JSON.parse(JSON.stringify(te)),JSON.parse(JSON.stringify(te));var Dt=.002/Math.pow(2,4),ys=(t,e,r=8)=>{const s=r*3+1,i=(a,o)=>a+o;t.slice(s).reduce(i,0)!==0&&(e.ax=Dt*v.bytesToInt16(t[s],t[s+1]),e.ay=Dt*v.bytesToInt16(t[s+2],t[s+3]),e.az=Dt*v.bytesToInt16(t[s+4],t[s+5]))};function En(t){let e;t.buffer?e=t:e=new Uint8Array(t);let r={};for(let s=0;s<8;s++){let i=1+3*s;r[s]=v.bytesToInt24(e[i],e[i+1],e[i+2])}return ys(e,r),r.timestamp=Date.now(),r}function jn(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r={};for(let s=0;s<8;s++){let i=1+3*s;e[0]%2===0?r[s+7]=v.bytesToInt24(e[i],e[i+1],e[i+2]):r[s]=v.bytesToInt24(e[i],e[i+1],e[i+2])}return ys(e,r),r}var Ge=250,Zt={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:En,write:"b",beforedisconnect:(t,e)=>{t.writePort(e,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Ge},Nn={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:jn,write:"b",beforedisconnect:(t,e)=>{t.writePort(e,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Ge},re={nSec:10,sps:Ge,units:"mV"},Ft={nSec:10,sps:Ge};JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(re)),JSON.parse(JSON.stringify(Ft)),JSON.parse(JSON.stringify(Ft)),JSON.parse(JSON.stringify(Ft));var L={sps:Ge,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L)),JSON.parse(JSON.stringify(L));function Cn(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r={};for(let i=0;i<128;i++){let n=i*3+1;r[i]=v.bytesToInt24(e[n],e[n+1],e[n+2])}let s=385;return r.ax=v.bytesToInt16(e[s],e[s+1]),r.ay=v.bytesToInt16(e[s+2],e[s+3]),r.az=v.bytesToInt16(e[s+4],e[s+5]),r.gx=v.bytesToInt16(e[s+6],e[s+7]),r.gy=v.bytesToInt16(e[s+8],e[s+9]),r.gz=v.bytesToInt16(e[s+10],e[s+11]),r.timestamp=Date.now(),r}var Tn=250,Pn={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:Cn,sps:Tn,buffering:{searchBytes:new Uint8Array([192,160])}};function _s(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r={};for(let i=0;i<32;i++){let n=i*3+1;r[i]=v.bytesToInt24(e[n],e[n+1],e[n+2])}let s=97;return r.ax=v.bytesToInt16(e[s],e[s+1]),r.ay=v.bytesToInt16(e[s+2],e[s+3]),r.az=v.bytesToInt16(e[s+4],e[s+5]),r.gx=v.bytesToInt16(e[s+6],e[s+7]),r.gy=v.bytesToInt16(e[s+8],e[s+9]),r.gz=v.bytesToInt16(e[s+10],e[s+11]),r.timestamp=Date.now(),r}var fr=512,In={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:_s,sps:fr,buffering:{searchBytes:new Uint8Array([192,160])}},Bn={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:_s,sps:fr,buffering:{searchBytes:new Uint8Array([192,160])}},be={nSec:10,sps:fr};JSON.parse(JSON.stringify(be)),JSON.parse(JSON.stringify(be)),JSON.parse(JSON.stringify(be)),JSON.parse(JSON.stringify(be)),JSON.parse(JSON.stringify(be)),JSON.parse(JSON.stringify(be));var Ln=new TextDecoder;function vs(t){let e={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0},r=Ln.decode(t),s=r.split("|");if(s.length===3)e.timestamp=Date.now(),e.red=parseInt(s[0]),e.infrared=parseInt(s[1]),e.heg=parseFloat(s[2]);else return s.length>=2?(e.timestamp=Date.now(),e.red=parseInt(s[1]),e.infrared=parseInt(s[2]),e.heg=parseFloat(s[3]),s[4]&&(e.ambient=parseFloat(s[4])),s[5]&&(e.temperature=parseFloat(s[5])),e):r}var er=40,ur={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:`t
`,codec:vs,sps:er},ms=Object.assign({},ur);ms.sps=19;var Mn={deviceType:"BLE",deviceName:"hegduino",sps:er,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:vs,sps:er}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"},ws=Object.assign({},ur);ws.sps=19;function ks(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r=32;const s={red:new Array(r),ir:new Array(r),max_dietemp:v.get2sCompliment(e[193],8)+.0625*e[194],timestamp:Date.now()};let i=0;for(;i<r;){let n=i*6;i%2===0?(s.ir[i]=(e[n+1]<<16|e[n+2]<<8|e[n+3])&524287,s.ir[i+1]=(e[n+4]<<16|e[n+5]<<8|e[n+6])&524287):(s.red[i-1]=(e[n+1]<<16|e[n+2]<<8|e[n+3])&524287,s.red[i]=(e[n+4]<<16|e[n+5]<<8|e[n+6])&524287),i++}return s}function Ss(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r={ax:new Array(20),ay:new Array(20),az:new Array(20),gx:new Array(20),gy:new Array(20),gz:new Array(20),mpu_dietemp:(v.bytesToInt16(e[241],e[242])+521)/340+35,timestamp:Date.now()};for(let s=0;s<20;s++){let i=s*12;r.ax[s]=v.bytesToInt16(e[i+1],e[i+2]),r.ay[s]=v.bytesToInt16(e[i+3],e[i+4]),r.az[s]=v.bytesToInt16(e[i+5],e[i+6]),r.gx[s]=v.bytesToInt16(e[i+7],e[i+8]),r.gy[s]=v.bytesToInt16(e[i+9],e[i+10]),r.gz[s]=v.bytesToInt16(e[i+11],e[i+12])}return r}function Jn(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let s=0;s<7;s++){let i=s*26+1;if(!e[i+23])break;r[0][s]=v.bytesToUInt24(e[i],e[i+1],e[i+2]),r[1][s]=v.bytesToUInt24(e[i+3],e[i+4],e[i+5]),r[2][s]=v.bytesToUInt24(e[i+6],e[i+7],e[i+8]),r[3][s]=v.bytesToUInt24(e[i+9],e[i+10],e[i+11]),r[4][s]=v.bytesToUInt24(e[i+12],e[i+13],e[i+14]),r[5][s]=v.bytesToUInt24(e[i+15],e[i+16],e[i+17]),r[6][s]=v.bytesToUInt24(e[i+18],e[i+19],e[i+20]),r[7][s]=v.bytesToUInt24(e[i+21],e[i+22],e[i+23])}return r}var ht=250,Dn={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:!0,notifyCallback:void 0,codec:Jn,sps:ht}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:!0}}},sps:ht},As=Object.assign({},Zt);As.sps=ht;As.deviceName="cognixionONE";var se={nSec:10,sps:ht,units:"mV"};JSON.parse(JSON.stringify(se)),JSON.parse(JSON.stringify(se)),JSON.parse(JSON.stringify(se)),JSON.parse(JSON.stringify(se)),JSON.parse(JSON.stringify(se)),JSON.parse(JSON.stringify(se)),JSON.parse(JSON.stringify(se)),JSON.parse(JSON.stringify(se));var H={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function Fn(t){let e={},r=0;for(;r<t.length;)if(H[t[r]]&&r+1+H[t[r]].byteLength<=t.length){let s=t.slice(r+1,r+1+H[t[r]].byteLength).buffer,i=v.struct(H[t[r]].format).unpack(s),n=H[t[r]].type;n==="unfilteredHEG"||n==="heg"?i=i[0]/256:(n==="POOR_SIGNAL"||n==="sampleNumber"||n==="debug0"||n==="debug1"||n==="debug2"||n==="debug3")&&(i=i[0]),e[H[t[r]].type]?Array.isArray(i)?e[H[t[r]].type].push(...i):e[H[t[r]].type].push(i):Array.isArray(i)?e[H[t[r]].type]=i:e[H[t[r]].type]=[i],r+=H[t[r]].byteLength+1}else r++;return e.timestamp=Date.now(),e}var Rn={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:`protocol 3
`,buffering:{searchBytes:new Uint8Array([170,170])},codec:Fn,sps:10.101},Un=1013.25,xs=t=>{let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);let r={timestamp:Date.now(),temp:[],pressure:[],altitude:[]},s=0;if(e[0].length===74&&(s=1),s){r.humidity=[];for(let i=0;i<3;i++){let n=i*24+2,a=v.bytesToInt32(e[3+n],e[2+n],e[1+n],e[0+n]),o=v.bytesToInt32(e[7+n],e[6+n],e[5+n],e[4+n]);r.temp.push(a+o/Math.pow(10,Math.ceil(Math.log10(o))));let c=10*v.bytesToInt32(e[11+n],e[10+n],e[9+n],e[8+n]),l=v.bytesToInt32(e[15+n],e[14+n],e[13+n],e[12+n]);r.pressure.push(c+l/Math.pow(10,Math.ceil(Math.log10(l))));let d=v.bytesToInt32(e[19+n],e[18+n],e[17+n],e[16+n]),u=v.bytesToInt32(e[23+n],e[22+n],e[21+n],e[20+n]);r.humidity.push(d+u/Math.pow(10,Math.ceil(Math.log10(u)))),r.altitude.push(Vr(r.pressure[i],r.temp[i]))}}else for(let i=0;i<3;i++){let n=i*16+2,a=v.bytesToInt32(e[3+n],e[2+n],e[1+n],e[0+n]),o=v.bytesToInt32(e[7+n],e[6+n],e[5+n],e[4+n]);r.temp.push(a+o/Math.pow(10,Math.ceil(Math.log10(o))));let c=10*v.bytesToInt32(e[11+n],e[10+n],e[9+n],e[8+n]),l=v.bytesToInt32(e[15+n],e[14+n],e[13+n],e[12+n]);r.pressure.push(c+l/Math.pow(10,Math.ceil(Math.log10(l)))),r.altitude.push(Vr(r.pressure[i],r.temp[i]))}return r};function Vr(t,e){return 44330*(1-Math.pow(t/Un,.1903))}function qn(t){let e;t.getInt8?e=new Uint8Array(t.buffer):t.buffer?e=t:e=new Uint8Array(t);const r={};if(e[0]===2)Object.assign(r,De(e.subarray(2)));else if(e[0]===3){let s=De(e.subarray(2));Object.keys(s).forEach((i,n)=>{r[n+8]=s[i]})}else e[0]===4?Object.assign(r,Ss(e.subarray(2))):e[0]===5?Object.assign(r,ks(e.subarray(2))):e[0]===6?Object.assign(r,xs(e.subarray(2))):Object.assign(r,De(e));return r}var Vn={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:qn,sps:250},Hn={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:De,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:ks,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Ss,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:De,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:xs,sps:3.33}}}},ie={nSec:10,sps:250,units:"mV"};JSON.parse(JSON.stringify(ie)),JSON.parse(JSON.stringify(ie)),JSON.parse(JSON.stringify(ie)),JSON.parse(JSON.stringify(ie)),JSON.parse(JSON.stringify(ie)),JSON.parse(JSON.stringify(ie)),JSON.parse(JSON.stringify(ie)),JSON.parse(JSON.stringify(ie));var Gn=32,Wn=24,zn=1.2,M={sps:250,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*zn/(Gn*(Math.pow(2,Wn)-1))};JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M)),JSON.parse(JSON.stringify(M));var $n=new TextDecoder;function Os(t){let e={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0},r=$n.decode(t),s=r.split("|");return s.length>=5?(e.timestamp=Date.now(),e.left_red=parseInt(s[1]),e.left_infrared=parseInt(s[2]),e.left_heg=parseFloat(s[3]),e.center_red=parseInt(s[4]),e.center_infrared=parseInt(s[5]),e.center_heg=parseFloat(s[6]),e.right_red=parseInt(s[7]),e.right_infrared=parseInt(s[8]),e.right_heg=parseFloat(s[9]),e):r}var Yn={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:Os,sps:20},Qn={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:Os}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"};function Kn(t){let e={red:t.getInt32(2),ir:t.getInt32(6),ir2:t.getInt32(10),timestamp:Date.now()};return e.heg=e.red/(.5*(e.ir+e.ir2)),e}var Hr=40,Xn={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:!0,notifyCallback:void 0,codec:Kn,sps:Hr}}},sps:Hr};function Zn(t){let e={sred:t.getInt32(2),sir:t.getInt32(6),sir2:t.getInt32(10),timestamp:Date.now()};return e.sheg=e.sred/(.5*(e.sir+e.sir2)),e}function ea(t){let e={red:t.getInt32(2),ir:t.getInt32(6),ir2:t.getInt32(10),timestamp:Date.now()};return e.heg=e.sred/(.5*(e.ir+e.ir2)),e}var Rt=40,ta={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:!0,notifyCallback:void 0,codec:ea,sps:Rt},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:!0,notifyCallback:void 0,codec:Zn,sps:Rt}}},sps:Rt},Ze={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45};JSON.parse(JSON.stringify(Ze)),JSON.parse(JSON.stringify(Ze)),JSON.parse(JSON.stringify(Ze)),JSON.parse(JSON.stringify(Ze));var et={nSec:10,sps:250,units:"mV"};JSON.parse(JSON.stringify(et)),JSON.parse(JSON.stringify(et)),JSON.parse(JSON.stringify(et)),JSON.parse(JSON.stringify(et));var Le={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45};JSON.parse(JSON.stringify(Le)),JSON.parse(JSON.stringify(Le)),JSON.parse(JSON.stringify(Le)),JSON.parse(JSON.stringify(Le)),JSON.parse(JSON.stringify(Le));function ra(t){return{hr:t.getInt8(1),timestamp:Date.now()}}var sa={deviceType:"BLE",deviceName:"heartrate",services:{heart_rate:{heart_rate_measurement:{notify:!0,notifyCallback:void 0,codec:ra}}}},Es={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{0:{sps:250,freq:1,amplitude:1,offset:0},1:{sps:250,freq:10,amplitude:1,offset:0},2:{sps:250,freq:100,amplitude:.5,offset:.5},3:{sps:250,freq:25,amplitude:1,offset:0}},connect:(t={})=>new Promise(async(e,r)=>{let i={_id:`simulated${Math.floor(Math.random()*1e15)}`,settings:Object.assign(Object.assign({},Es),t)};i.settings.looping=!0;let n=50,a=Date.now(),o=()=>{if(i.settings.looping){let c={},l=Date.now(),d=l-a;for(const u in i.settings.simulate){let f=Math.floor(i.settings.simulate[u].sps*d/1e3);c[u]=new Array(f).fill(0),c[u]=c[u].map((h,g)=>Math.sin(2*Math.PI*i.settings.simulate[u].freq*.001*(a+d*(g+1)/f))*i.settings.simulate[u].amplitude+i.settings.simulate[u].offset)}a=l,c.timestamp=a,i.settings.ondata(c),setTimeout(()=>{o()},n)}};o(),i.settings.onconnect&&i.settings.onconnect(i),e(i)}),codec:t=>t,disconnect:t=>{console.log(t),t.settings.looping=!1,t.settings.ondisconnect(t)},onconnect:t=>{console.log("simulator connected!",t)},ondisconnect:t=>{console.log("simulator disconnected!",t)},ondata:t=>{}},js={BLE:{nrf5x:Hn,hegduino:Mn,hegduinoV1:ws,cognixionONE:Dn,statechanger:Qn,blueberry:Xn,blueberry2:ta,heart_rate:sa},USB:{nrf5x:Vn,freeEEG32:In,freeEEG32_optical:Bn,freeEEG128:Pn,hegduino:ur,hegduinoV1:ms,cyton:Zt,cyton_daisy:Nn,peanut:Rn,statechanger:Yn,cognixionONE:Zt},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{simulator:Es}};new TextDecoder;var tt=new ot,ia=new en({roots:{...un,...Xi}});function na(t,e){var n,a,o,c,l,d,u,f,h;if(!t)return;let r=t.deviceType,s=t.deviceName;e.workerUrl||(e.workerUrl=hn),e.service||(e.service=ia);let i=e.service.addWorker({url:e.workerUrl});if(e.devices||(e.devices=js),!e.devices[r][s]){let g=Object.assign({},t);for(const b in g)typeof g[b]=="function"&&(g[b]=g[b].toString());i.send({route:"receiveDevice",args:g})}if(e.roots){for(const g in e.roots){let b={callback:"decodeAndParseDevice",worker:i};e.roots[g].__parent=e.roots[g].__parent?Object.assign(e.roots[g].__parent,b):b}e.service.load(e.roots)}if(r.includes("CUSTOM"))return new Promise(async(g,b)=>{t.ondata=m=>{i.run("decodeAndParseDevice",[m,r,s]).then(S=>{typeof e.ondecoded=="function"&&e.ondecoded(S)})},t.ondisconnect=()=>{if(e.service.terminate(i._id),e.roots)for(const m in e.roots)e.service.remove(m)};let y=await t.connect(t),_={workers:{streamworker:i},disconnect:()=>{if(e.beforedisconnect&&e.beforedisconnect(_),t.disconnect(y),e.ondisconnect&&e.ondisconnect(_),e.roots)for(const m in e.roots)e.service.remove(m)},device:y,options:e,read:m=>{if(t.read)return new Promise((S,N)=>{S(t.read(t,m))})},write:m=>{if(t.write)return new Promise((S,N)=>{S(t.write(t,m))})},roots:e.roots};e.onconnect&&e.onconnect(_),g(_)}).catch(g=>{if(console.error(g),e.service.terminate(i._id),e.roots)for(const b in e.roots)e.service.remove(b)});if(r==="BLE"){for(const g in t.services)for(const b in t.services[g])if(typeof e.ondecoded=="function"){if((o=(a=(n=t.services)==null?void 0:n[g])==null?void 0:a[b])!=null&&o.notify){t.services[g][b].notifyCallback||(t.services[g][b].notifyCallback=y=>{i.run("decodeAndParseDevice",[y,r,s,g,b],void 0,[y.buffer]).then(e.ondecoded)});break}}else typeof e.ondecoded=="object"&&e.ondecoded[b]&&((d=(l=(c=t.services)==null?void 0:c[g])==null?void 0:l[b])!=null&&d.notify&&(t.services[g][b].notifyCallback||(t.services[g][b].notifyCallback=y=>{i.run("decodeAndParseDevice",[y,r,s,g,b],void 0,[y.buffer]).then(e.ondecoded[b])})),(h=(f=(u=t.services)==null?void 0:u[g])==null?void 0:f[b])!=null&&h.read&&(t.services[g][b].readCallback||(t.services[b].readCallback=y=>{i.run("decodeAndParseDevice",[y,r,s,g,b],void 0,[y.buffer]).then(e.ondecoded[b])})));return new Promise((g,b)=>{tt.setup(t).then(y=>{let _={workers:{streamworker:i},options:e,device:y,disconnect:async()=>{if(await tt.disconnect(y.deviceId),e.ondisconnect&&e.ondisconnect(_),i.terminate(),e.roots)for(const m in e.roots)e.service.remove(m)},read:m=>tt.read(y.device,m.service,m.characteristic,m.ondata,m.timeout),write:m=>tt.write(y.device,m.service,m.characteristic,m.data,m.callback,m.timeout),roots:e.roots};e.onconnect&&e.onconnect(_),g(_)}).catch(y=>{if(console.error(y),i.terminate(),e.roots)for(const _ in e.roots)e.service.remove(_);b(y)})})}else if(r==="USB"){let g=e.service.addWorker({url:e.workerUrl});g.worker.addEventListener("message",_=>{if(typeof _.data=="string"&&_.data.includes("disconnected")&&(e.service.terminate(g._id),e.service.terminate(i._id),e.roots))for(const m in e.roots)e.service.remove(m)}),g.post("setupSerial");let b=e.service.establishMessageChannel(i.worker,g.worker);const y=new Je;return new Promise((_,m)=>{y.requestPort(t.usbVendorId,t.usbProductId).then(S=>{let N=S.getInfo();g.run("openPort",{baudRate:t.baudRate,usbVendorId:N.usbVendorId,usbProductId:N.usbProductId,bufferSize:t.bufferSize,buffering:t.buffering?t.buffering:void 0,frequency:t.frequency?t.frequency:void 0,pipeTo:{route:"decodeAndParseDevice",_id:b,extraArgs:[r,s]}}).then(I=>{t.write&&g.post("writeStream",[I._id,t.write]),typeof e.ondecoded=="function"&&i.subscribe("decodeAndParseDevice",e.ondecoded);let F={workers:{streamworker:i,serialworker:g},device:I,options:e,disconnect:()=>{g.post("closeStream",I._id),e.ondisconnect&&e.ondisconnect(F)},read:()=>new Promise((x,O)=>{let R;R=i.subscribe("decodeAndParseDevice",U=>{g.unsubscribe("decodeAndParseDevice",R),x(U)})}),write:x=>g.run("writeStream",[I._id,x]),roots:e.roots};e.onconnect&&e.onconnect(F),_(F)})}).catch(S=>{if(console.error(S),e.service.terminate(g._id),e.service.terminate(i._id),e.roots)for(const N in e.roots)e.service.remove(N);m(S)})})}else return}/*! Capacitor: https://capacitorjs.com/ - MIT License */let ct=null;const aa=async(t,e)=>{if(ct)throw new Error("Already connected to a device");return await na(js[t][e],{ondecoded:s=>{jt({decoded:s})},ondisconnect:()=>{ct=null,jt({status:"disconnected"})},onconnect:s=>{console.log(s),ct=s,jt({status:"connected"})}})},Ut={BLE:{hegduino:"HEGduino",hegduinoV1:"HEGduino V1",nrf5x:"NRF5x",statechanger:"State Changer",blueberry2:"Blueberry",blueberry:"Blueberry V1"},USB:{peanut:"Biocomp Peanut HEG",hegduino:"HEGduino",hegduinoV1:"HEGduino V1",statechanger:"State Changer",nrf5x:"NRF5x"}};class Ns extends G{static get styles(){return Ce`
      .row {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .row > div {
        padding: 10px;
        flex-grow: 1;
    `}constructor(...e){super(...e)}render(){let e=document.createElement("p");return this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)}),this.subscribe("decoded.infrared",r=>{console.log("Decoded Infrared Reading",r)}),this.status=document.createElement("p"),this.subscribe("status",r=>{this.status.innerHTML=r[0].toUpperCase()+r.slice(1)}),ct?this.status.innerHTML="Connected":this.status.innerHTML="Disconnected",E`
    <h1>Devices Manager</h1>
    <select>
    ${Object.keys(Ut).map(r=>E`
      <optgroup label=${r}>
        ${Object.keys(Ut[r]).map(s=>E`
          <option value=${r}_${s}>${Ut[r][s]} (${r})</option>
          `)}
      </optgroup>
      `)}
    </select>

    <hypergamma-button @click=${async()=>{const[r,s]=this.shadowRoot.querySelector("select").value.split("_");aa(r,s)}}>Connect</hypergamma-button>


   ${e}

    <div class="row">
      <div>
        <h3>Battery Life</h3>
        <p>100%</p>
      </div>
      <div>
        <h3>Device Status</h3>
        ${this.status}
      </div>
      <div>
        <h3>Last Session</h3>
        <p>${new Date().toUTCString()}</p>
      </div>
      <div>
        <h3>Average Session Duration</h3>
        <p>${(120*Math.random()).toFixed(2)} minutes</p>
      </div>
    </div>



    `}}customElements.get("hypergamma-devices-page")||customElements.define("hypergamma-devices-page",Ns);class Cs extends G{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)})}render(){return E`
    <h1>Analytics</h1>
    <p id="readout">No device connected</p>
    `}}customElements.get("hypergamma-analytics-page")||customElements.define("hypergamma-analytics-page",Cs);class Ts extends G{constructor(...e){super(...e)}render(){return E`
    <h1>Reports</h1>
    <p>Coming soon...</p>
    `}}customElements.get("hypergamma-reports-page")||customElements.define("hypergamma-reports-page",Ts);const oa=Ce`
    :host {
        position: relative;
        display: grid;
        grid-template-rows: fit-content(100%) 1fr fit-content(100%);
        overflow: hidden;
        height: 100%;
    }

    section { 
      padding: 25px;
    }
`;var fe;class Ps extends K{constructor({toRender:r}={}){super();j(this,"history",[]);j(this,"onTransition",()=>{});V(this,fe,[]);this.toRender=r}static get styles(){return oa}static get properties(){return{toRender:{type:Object,reflect:!1}}}attributeChangedCallback(...r){const s=["toRender"];super.attributeChangedCallback(...r),s.includes(r[0])&&this.requestUpdate()}set(r){let s=r.page??r;typeof s=="function"&&(s=new s),s.onTransition=this.onTransition,this.content?this.toRender=r.page?r:{page:s}:C(this,fe).push(s)}updated(){this.content=(this.shadowRoot??this).querySelector("#content"),C(this,fe).length&&(C(this,fe).forEach(r=>this.set(r)),z(this,fe,[]))}render(){let{page:r=""}=this.toRender??{};return E`
      <main id="content">
        <section>
          ${r}
        </section>
      </main>
    `}}fe=new WeakMap;customElements.get("hypergamma-main")||customElements.define("hypergamma-main",Ps);const ca=Ce`
 
a {
  text-decoration: none;
  display: flex;
  align-items: center;
  user-select: none;
}

img {
  width: 50px;
  padding-right: 15px;
  box-sizing: border-box;
}

li {
  margin-bottom: 10px;
}

#sidebarCollapse {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  background: transparent;
  position: absolute;
  top: 8px;
  left: 200px;
  cursor: pointer;
  border: none;
  z-index: 2;
  transition: all 0.25s linear;
}

#sidebarCollapse span {
  width: 80%;
  height: 2px;
  margin: 0 auto;
  display: block;
  background: var(--color-light-green);
  transition: all 0.25s linear;
  /* transition: all 0.1s cubic-bezier(0.81, -0.33, 0.345, 1.375); */
}
/* animate toggle button */
#sidebarCollapse span:first-of-type {
  transition: all 0.25s linear;
  transform: rotate(45deg) translate(2px, 2px);
}
#sidebarCollapse span:nth-of-type(2) {
  transition: all 0.25s linear;
  opacity: 0;
}
#sidebarCollapse span:last-of-type {
  transition: all 0.25s linear;
  transform: rotate(-45deg) translate(1px, -1px);
}

#sidebarCollapse.active span {
  transition: all 0.25s linear;
  transform: none;
  opacity: 1;
  margin: 5px auto;
}

#main-nav {
  background: var(--color-sidebar);
  color: white;
  font-family: "Source Sans Pro", sans-serif;
  transition: all 0.25s linear;
  transform-origin: 0 50%; /* Set the transformed position of sidebar to center left side. */
}

#main-nav.active {
  width: 0px;
  overflow: hidden;
  /* transform: rotateY(150deg);  */
}

.navbar-btn {
  transition: margin-left 600ms ease;
}

.navbar-btn.active {
  margin-left: -190px;
  transition: all 0.25s linear;
}

.navbar-btn:focus {
  outline: none;
}

.navbar-btn.active:focus {
  outline: none;
}

.dash-content.active {
  margin-left: -230px;
}

a[data-toggle="collapse"] {
  position: relative;
}

.dropdown-toggle::after {
  display: block;
  position: absolute;
  top: 50%;
  right: 20px;
  transform: translateY(-50%);
}

#main-nav .sidebar-header {
  padding: 20px;
  padding-bottom: 0px;
}

#main-nav ul.components {
  list-style: none;
  padding-right: 10px;
  padding-left: 3px;
  margin-right: 0;
  margin-top: 10px;
}

#main-nav ul p {
  color: white;
  padding: 10px;
}

#main-nav ul li a {
  font-size: 14px;
  line-height: 45px;
  padding-left: 20px;
  margin-bottom: 5px;
  text-align: left;
  padding-right: 10px;
  color: white;
  border: none;
  border-radius: 4px;
  border-left: 4px solid transparent;
}

#main-nav ul li a svg {
  fill: #000;
}

#main-nav ul li a a {
  padding-left: 10px;
  text-align: left;
  padding-right: 10px;
}

#main-nav ul li a i {
  margin-right: 25px;
  font-size: 20px;
}

#main-nav ul li a:hover {
  text-decoration: none;
  background: none;
  font-weight: 600;
}

#main-nav ul li a.is-selected {
  color: var(--color-accent);
  background: none;
  font-weight: 600;
  border-left: 4px solid var(--color-accent);
  /* margin-left: -3px; */
  border-radius: 0;
}

#main-nav ul li a.is-selected svg {
  fill: var(--color-accent);
}

.help-section {
  bottom: 2px;
  position: absolute;
  width: 230px;
}

.help-section ul {
  padding-left: 15px !important;
}

.help-section a {
  text-decoration: none;
  line-height: 5px;
  border: none;
  color: #f0f0f0;
  width: 35px !important;
  padding-right: 3px !important;
  padding-left: 3px !important;
  z-index: 200;
}

.help-section a i {
  font-size: 17px;
  opacity: 0.7;
}

.help-section a:hover {
  background: none !important;
  border: none !important;
}

.help-section a:hover i {
  opacity: 1;
}

.help-section a.is-selected {
  color: #000 !important;
  background: none !important;
  border: none !important;
}

.list-unstyled {
  list-style: none;
  border-bottom: none;
}

.list-unstyled.components li a {
  -webkit-user-drag: none;
}

.collapse:not(.show) {
  display: none;
}

.collapse.show {
  display: block;
}

.collapsing {
  position: relative;
  height: 0;
  overflow: hidden;
  -webkit-transition: height 0.35s ease;
  -o-transition: height 0.35s ease;
  transition: height 0.35s ease;
}
@media (prefers-reduced-motion: reduce) {
  .collapsing {
    -webkit-transition: none;
    -o-transition: none;
    transition: none;
  }
}

.nav {
  padding: 0px 0px;
  /* position: fixed; */
  width: 240px;
  min-height: 100vh;
  color: var(--color-subtle);
  visibility: visible;
  left: 0;
  z-index: 1;
  align-items: stretch;
  /* display: flex; */
  transition: 0.5s;
}

@media screen and (max-height: 500px) {
  #main-nav {
    padding-top: 15px;
  }
  #main-nav a {
    font-size: 13px;
  }
}

.nav.is-shown {
  visibility: visible;
  opacity: 1;
}

.nav-header {
  position: relative;
  padding: 10px 10px;
  margin-top: 10px;
  margin-bottom: 30px;
}

.nav-title strong {
  color: var(--color-light-green);
  opacity: 0.8;
  transition: color 0.1s ease-in;
}

.nav-title strong:hover {
  color: linear-gradient(90deg, rgba(37, 129, 147, 1) 0%, rgba(52, 207, 196, 1) 51%);
}

.nav-header-icon {
  position: absolute;
  width: 165px;
  height: 70px;
  top: 1.3rem;
  right: 1.8rem;
}

.nav-item {
  padding: 0.5em 0;
  vertical-align: middle;
  width: 240px !important;
}

.nav-icon {
  width: 30px;
  height: 30px;
  margin-right: 27px;
  padding-bottom: 1px;
  padding-top: 1px;
  margin-left: -22px;
  margin-top: 10px;
  margin-bottom: 10px;
  vertical-align: middle;
}

.nav-icon.logo {
  width: 45px;
  height: 45px;
  margin-right: 24px;
  margin-left: 15px;
  margin-bottom: 75px;
  vertical-align: middle;
}

.nav-video {
  width: 18px;
  height: 21px;
  vertical-align: sub;
  text-decoration: none;
}

.nav-category {
  margin: 0.2em 0;
  padding-left: 2rem;
  font-size: 11px;
  font-weight: normal;
  text-transform: uppercase;
}

.nav-button {
  display: block;
  width: 100%;
  padding: 0.5rem;
  padding-left: calc(5rem + 5px + 0.5rem); /* padding + icon + magic */
  padding-top: 0.8rem;
  padding-bottom: 0.8rem;
  line-height: 2;
  text-align: left;
  font-size: 16px;
  color: white;
  border: none;
  background-color: transparent;
  outline: none;
  opacity: 0.8;
  cursor: pointer;
  font-family: "Open Sans", sans-serif;
  background-size: 30px 30px;
  background-repeat: no-repeat;
  background-position: 22px center;
}

.nav-button:hover,
.nav-button:focus:not(.is-selected) {
  background-color: hsla(0, 0%, 0%, 0.1);
  color: white;
  opacity: 1;
}

.nav-button.is-selected {
  background-color: var(--color-accent);
}

.nav-button.is-selected,
.nav-button.is-selected em {
  color: white;
  font-weight: 500;
  opacity: 1;
}

.nav-button.is-selected:focus {
  opacity: 1;
}

.nav-button em {
  font-style: normal;
  font-weight: 600;
  color: var(--color-strong);
  pointer-events: none; /* makes it invisible to clicks */
}

.nav-footer {
  margin-top: 1rem;
  padding: 2rem;
  border-top: 1px solid var(--color-border);
  text-align: center;
}

.nav-footer-icon {
  width: calc(770px / 6.5);
  height: calc(88px / 6.5);
}

.nav-footer a {
  outline: none;
}

.nav-footer-button {
  display: block;
  width: 100%;
  padding: 0;
  margin-bottom: 0.75rem;
  line-height: 2;
  text-align: left;
  font: inherit;
  font-size: 15px;
  color: inherit;
  border: none;
  background-color: transparent;
  cursor: default;
  outline: none;
  text-align: center;
}

.nav-footer-button:focus {
  color: var(--color-strong);
}

.nav-footer-logo {
  color: hsl(0, 0%, 66%);
}

.nav-footer-logo:focus {
  color: hsl(0, 0%, 33%);
}

/* Remove border on the logo */
.nav-footer-logo.nav-footer-logo {
  border-bottom: none;
}

.logo-container {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  min-height: 50px;
}
.nav-center-logo-image {
  display: block;
  width: 100%;
  padding: 0px 25px;
}
`;var Se,qe,Y;class Is extends K{constructor(r={}){super();j(this,"initialize",!0);j(this,"show",()=>{z(this,Se,!1),this.nav&&(this.nav.classList.remove("active"),this.toggle.classList.remove("active"),this.style.display="block")});V(this,Se,!1);j(this,"hide",r=>{z(this,Se,!0),this.nav&&(this.nav.classList.add("active"),this.toggle.classList.add("active"),r&&(this.style.display="none"))});j(this,"onClick",()=>{});j(this,"selectItem",r=>{z(this,Y,r.split("/")[0]||"/"),(this.shadowRoot??this).querySelectorAll("a").forEach(n=>n.classList.remove("is-selected"));const i=(this.shadowRoot??this).querySelector(`a[data-id="${C(this,Y)}"]`);i&&i.classList.add("is-selected")});V(this,qe,r=>{if(!this.pages[r])throw new Error(`No page found for key ${r}`);this.selectItem(r),this.onClick(r,this.pages[r])});V(this,Y,"");j(this,"select",r=>{var i;const s=(i=this.pages)==null?void 0:i[r];s&&C(this,qe).call(this,r,s)});this.pages=r.pages,this.name=r.name??"",this.logo=r.logo,this.subtitle=r.subtitle,this.renderName=r.renderName??!0}static get styles(){return ca}static get properties(){return{pages:{type:Object,reflect:!1},name:{type:String,reflect:!0},logo:{type:String,reflect:!0},subtitle:{type:String,reflect:!0},renderName:{type:Boolean,reflect:!0}}}attributeChangedCallback(...r){const s=["pages","name","subtitle","renderName"];super.attributeChangedCallback(...r),s.includes(r[0])&&this.requestUpdate()}updated(){this.nav=(this.shadowRoot??this).querySelector("#main-nav"),this.subtitleElement=(this.shadowRoot??this).querySelector("#subtitle");const r=this.toggle=(this.shadowRoot??this).querySelector("#sidebarCollapse");r.onclick=()=>{this.nav.classList.toggle("active"),r.classList.toggle("active")};let s=C(this,Y)?(this.shadowRoot??this).querySelector(`ul[data-id='${C(this,Y)}']`):(this.shadowRoot??this).querySelector("ul").children[0];this.initialize&&s?s.click():C(this,Y)&&this.selectItem(C(this,Y)),C(this,Se)&&this.hide(!0)}render(){const r=this.name&&this.renderName,s=this.logo&&!r;return E`
    <button type="button" id="sidebarCollapse" class="navbar-btn">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <nav id="main-nav" class="nav js-nav">
        <div id="nav-items" class="nav-item u-category-windows">
          <!-- Sidebar Header -->
          <div class="sidebar-header">

              ${s?E`
                <div class="logo-container">
                  <img
                    class="nav-center-logo-image"
                    src="${this.logo}"
                  />
                </div>
              `:""}
                ${r?E`<h1 style="margin: 0;">${this.name}</h1>`:""}
                ${this.subtitle?E`<span id="subtitle" style="font-size: 14px; ${s?"padding-top: 15px; text-align: center; width: 100%; display: block;":""}">${this.subtitle}</span>`:""}
            </div>
            <!-- Sidebar Links -->
            <ul class="list-unstyled components">
              ${Object.entries(this.pages).map(([i,n])=>{const a=n.info??{};let o=a.label??i;const c=a.icon??"";return E`<li @click="${()=>C(this,qe).call(this,i)}">
                  <a data-id="${i}" href="#">
                    ${c}
                    ${o}
                  </a>
                </li>`})}
            </ul>
            <div>
            ${!s&&this.logo?E`
            <img
              class="nav-center-logo-image"
              style="padding:0px 40px;"
              src="${this.logo}"
            />
          `:""}
            </div>
          </div>
        </div>
      </nav>
    `}}Se=new WeakMap,qe=new WeakMap,Y=new WeakMap;customElements.get("hypergamma-sidebar")||customElements.define("hypergamma-sidebar",Is);const la=Ce`
    :host {
        display: flex;
        height: 100%;
        width: 100%;
        position: relative;
    }

    hypergamma-main {
        background: #fff;
    }
`;var Ae,gt,xe,lt,bt,Ve;class Bs extends K{constructor(r={}){super();V(this,xe);j(this,"main");j(this,"sidebar");j(this,"pagesById",{});V(this,Ae,void 0);V(this,gt,void 0);V(this,bt,r=>{const s=this.getPage(this.pagesById[r]);if(z(this,gt,r),s){const{id:i,label:n}=s.info;history.pushState({page:i,label:n},n,`?page=${i}`)}});j(this,"addPage",(r,s)=>{let[i,n]=s;const a={...n.info};a.id?i=a.id:n.info.id=i;const o=a.pages;if(delete a.pages,n instanceof HTMLElement&&(r[i]=n),o){const c=Object.values(o);Object.entries(o).forEach(([l,d],u)=>{d.info.base=i,d.info.previous=c[u-1],d.info.next=c[u+1],d.info.id=`${i}/${l}`,d.info.parent=n}),Object.entries(o).forEach(l=>this.addPage(r,l))}return r});V(this,Ve,!0);this.main=new Ps,this.main.classList.add("dash-app"),this.sidebar=new Is,this.sidebar.onClick=(i,n)=>this.setAttribute("activePage",n.info.id),this.pages=r.pages??{},this.name=r.name,this.logo=r.logo,this.renderNameInSidebar=r.renderNameInSidebar??!0,r.activePage&&this.setAttribute("activePage",r.activePage);const s=window.history.pushState;window.history.pushState=function(i){return typeof window.onpushstate=="function"&&window.onpushstate({state:i}),s.apply(window.history,arguments)},window.onpushstate=window.onpopstate=i=>{i.state&&(document.title=`${i.state.label} - ${this.name}`,this.setMain(this.pagesById[i.state.page],void 0,!1))},$e(this,xe,lt).call(this)}static get styles(){return la}static get properties(){return{renderNameInSidebar:{type:Boolean,reflect:!0},name:{type:String,reflect:!0},logo:{type:String,reflect:!0},subtitle:{type:String,reflect:!0},activePage:{type:String,reflect:!0}}}attributeChangedCallback(r,s,i){if(super.attributeChangedCallback(...arguments),this.sidebar&&(r==="name"||r==="logo"||r==="subtitle"))this.sidebar[r]=i;else if(r==="renderNameInSidebar")this.sidebar.renderName=i==="true"||i===!0;else if(r==="pages")$e(this,xe,lt).call(this,i);else if(r.toLowerCase()==="activepage"){this.sidebar.selectItem(i),this.sidebar.initialize=!1,C(this,bt).call(this,i);return}}getPage(r){if(!r)throw new Error("Page not found...");const s=r.page??r;if(s instanceof HTMLElement)return s;if(typeof s=="object")return this.getPage(Object.values(s)[0])}setMain(r,s={}){r.info;const i=C(this,Ae);if(i===r)return;i&&(i.info.parent&&i.info.section&&i.save(),i.active=!1),z(this,Ae,r);const n={...s};i&&(n.globalState=i.info.globalState),r.set(n),this.main.set({page:r})}updated(){const r=(this.shadowRoot??this).querySelector("div");r.style.height="100vh",C(this,Ve)&&(z(this,Ve,!1),$e(this,xe,lt).call(this))}render(){return this.style.width="100%",this.style.height="100%",this.style.display="grid",this.style.gridTemplateColumns="fit-content(0px) 1fr",this.style.position="relative",this.name&&(this.sidebar.name=this.name),this.logo&&(this.sidebar.logo=this.logo),"renderNameInSidebar"in this&&(this.sidebar.renderName=this.renderNameInSidebar),E`
        <div>
          ${this.sidebar}
        </div>
        ${this.main}
    `}}Ae=new WeakMap,gt=new WeakMap,xe=new WeakSet,lt=function(r=this.pages){const s=new URL(window.location.href);let i=s.pathname.slice(1);i=new URLSearchParams(s.search).get("page"),i||(i=this.activePage),this.main.onTransition=n=>{if(typeof n=="number"){const a=C(this,Ae).info,o=Math.sign(n);if(o===1)return this.setAttribute("activePage",a.next.info.id);if(o===-1)return this.setAttribute("activePage",(a.previous??a.parent).info.id)}n in this.pages?this.sidebar.select(n):this.setAttribute("activePage",n)},this.pagesById={},Object.entries(r).forEach(n=>this.addPage(this.pagesById,n)),this.sidebar.pages=r,i&&this.setAttribute("activePage",i)},bt=new WeakMap,Ve=new WeakMap;customElements.get("hypergamma-dashboard")||customElements.define("hypergamma-dashboard",Bs);class Ls extends G{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)})}render(){return E`
      <h1>Training</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-training-page")||customElements.define("hypergamma-training-page",Ls);class Ms extends G{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)})}render(){return E`
      <h1>Focus</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-focus-page")||customElements.define("hypergamma-focus-page",Ms);class Js extends G{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)})}render(){return E`
      <h1>Peformance</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-performance-page")||customElements.define("hypergamma-performance-page",Js);class Ds extends G{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)})}render(){return E`
      <h1>Meditation</h1>
      <p id="readout">No device connected</p>
      <br>
      <hypergamma-button @click=${()=>this.onTransition("plus")}>Back</hypergamma-button>
    `}}customElements.get("hypergamma-meditation-page")||customElements.define("hypergamma-meditation-page",Ds);const da="data:image/png;base64,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",fa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABBCAYAAABhNaJ7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMFSURBVHgB7Zu/axRBFMe/M3e5xiDoH6BBrBRMoShYyB2KlXYWohYe6l8QsDRa6B+goKCiBAuLWAgKWggndqIR0UqDhqDYWmihl9w8Z2Iid9lhZ2/f7sTLvQ8ce8w+vvOYfT92bvcAQRAEYXhRKIDxM7SXFJpWbbsiVLvP2fFFbTALjbtvb6lXa6GXBnsBnLMV4KYBtlmxUY+m9Rk/7HHOaJwLOV20XogqmFQNJpTCuHXzDhncpwoWu8+rDqpa4YT92rRXbsIej8fUC/oPJhXCQXekDq68mcJn6yL1WpDadxrzSyFtcCi2XggNJpqwyV4JzHiddSh6OYZPzsbZxtYLzgcm9orpCv11bGXs+kNquc8/o4vKOBtnG1svRBEpkIRQz2QXQS8EewG0L0gz2sXQC1FKBPic40QARy+ELACY+JzTGe1i6IXgR4BJjvmal88uhl4ISQEwkRSQLpAcUwUvgJIUyGaXB0kBMNGeduS9ihnbVtF6IcqpARntYuiFiJ4CZ492bWs90BDsBerok4G7EfKFrE3ZBnKyLrbDtx+r58jJukgBDgO7F3hyL73gFT1vHsreDtdREv/3dnj52OnkL3w9c1TQyjJvHspJgeWxw838ha+bZ1OUad48SBEEk6y3rpON/gripZZqpOkNRAp0oxgFUZcYZdEWYGUsdEdoC2gr7xx5KKUN6hS7Cy/SC+PlA56Cl6LHRX4QAZN+UyC2XohSb4RCdjH0QsivwmCiMzrMejwuKZDNLg/ltMGCH45y9EJIFwATSQG5EUqODX0XGKonQ1IEfe3IJLe8nDbI0QvBfl3+wS5q2xwd2VpDbc+MWvDZvN5NI/NttElh4dg7VYupF4L/rrDBrAvHL22cdI6tPu/GvrZxytlY2w+x9ULwU0Dhqg3RGyBMfvuN5qOd1BOcdkxbZ7fAPfglXIutF4K9AL86mN6gsdE63bRO709o0tIfHj6Sxnkbb9Ox9UIU8p+hpztos3VsrAOMmlWvsGsFY8d/6irmjrxX39dCTxAEQRD8/AGgBO2QRI1L4wAAAABJRU5ErkJggg==",ua="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAACO98lFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAzzSURBVHgB7Vp9cFTVFf/d995uNpEsBA2phRKKpvL9IbE2fqDFMRoVFNtYWwUxUmntSImMVafjNHWGcdqphYkDdZgBdMSPIUBqO0UGFSlFGAuRhgKCRIGQKljlI4Hsbnbfu/3dzW7Ix+7b93YX+k/OzNv79r17zz33d88959xzH9BP/dRP/dRP/dSbBLJEQx+XE8ntFmnhCpZ5yepJgaBl4ajQ8d6oAuzeUiMixQvk6KCJWylMiQYMSNqJRFhINId1bP5WEDsbloswskBZAWHYfDkTFqokMJF/h5CpNylvgbAlcUrTcECaWCkEzvJ60AIm8W0RB+lL1pYARlic5vUJ26yCjtdaFosAMqSMQRg6T07UdbwoNVzNmdrEazs0fG0J3iXqMIJ8DqCU10z+/ZwChAjASN6/47LtCSnxiyERvJ+pRhjIkHJ03K80wDKxkQN4waNjX1Mt2iBEwoGMmCN9ET82GibrSFQRhFyW69JqK/HQf3Xs5KtTyIA0ZEiaxFRDIo9orhaF2N30omhNNghFR14WwZZacUg3sYJXq25FZyKttpqFm3wyuf1xPAZkSBxEEQXSjRA+PvIbhBw39GA/wQsaCoQ023poQ2gkM9bmjEHwWgRAQmi5CNrNYm/irIc8ElJni7TbWjB8yJwyRlGpsyIP3NP/q21vcgTCd6ukcn23mGAMAORp3XwK3d0gVYogpk+YJVfteVWcg0OiPYm6JysIx1RZKfUjftzBfnNj/S655hF5ups8YRrNZs3AZnoZR7FEShDKZsuZZqcVn6gzBuAjLxW3C4au9WRhfp4HkbJq+coOh77bE1sAugtHfTQXM2gQn2CTQdFmEvd0f88JipDtaS2MCvJdVVYpX9tRZy+PLQg3PCgnWhqqNRNX0zdv4oi3Uwu/Jgi9128xwVhIIOaZbajnf0cgcDCdaLqwTB6BOYxKSxkoLWWwtZ8BlNmjgkQ+NayU5UzK/BTDtuYpU+T7DQ3JNcIWBKJ6v7CoARIb2dML5gDs+zCBH7/hJ7KA6jeXD8egHY5tlRFbDhE4Jw5wFAeYw+lePSyAPXV1ogcIKpYoCmOjx4M2yl4lNDykXcVYoiF5LKGlEHIqXVgeQVjt1bD7wyR+fNvr4hTrRDwWvG6stQJBuUifi8CXbbxcRiI3gpO9AVCkYokPXxeHtBBWsF4rZ/kmr2EfS9iCoKkYwIou2Y+3rErsx5WhKv+xnM4oLldZbDKcXj5LXgInAzLPW3mn5LTN52ewnxMTZAxTRFWz13i7l0RSj6JuJffjbV7MoMH8FTscpGbWKzHfCGMWDVIuUlBUE3i50R5a/2oWD1vtOGNXr+ltEaKWSfJPGUvYI6TWrBqYnrwOkZ5DTSmlO1rKuud4LeDjeYVGagPZm7/SqoDAdBqKGxVr8v7oKz/qP1iJs501gffeEH+GQ3IivyJbEKIuTF02fpzq+U0K7aER2soN0AnO1Fw+HsodnhcpKM4/EkQxAWihpt/JmXuSj8Yr1jTMLUPOIL+yEivr6uB6y+xE/ugY7F5GXZgE7OJZor2L11i6o2o6q7PUigFsto0BUAdSUJy/oeM5JlqaaclHcVlN4P1S8lNB1wI+qwqFsBZwD4IT+RXZa0LM9tqFXARgOWevgMthmmrCTnfyWa2Rg1akoDh/tp2sdqO09dGwgcHZVlrjExR+LuOAYflGetGxE/kV2YKgO4joxo9H477dWCQMvElN8HI5tLQG0LhpE1IGw3H+XDpPsYt29jOD93dxCVcTzLNSpdoktcpEWkkTJ/IrsgXBiLmiiI1hqakRqta/Y5crivNn9Pf26+vF0TmVcrfZwTyiQDnB0KkXOxkd1oYcaJUd/0gmhjGOZDZ2ak74v1yHvbNmYhG1aa2KT5iHbKHRbKz7C1xssZLzT0b2mhBjktLMp0Fz7pEjVD6AetQqOuK2S8hX67GXN3uRBXIqfyrvoCy8DLVjoJRSCBeJj970szvkErq8gfH/VhiDWQykym+LaC6ySg7pgQrpp/xq1x/KyEVyTR3m+hzp0XDdE9fhENJwU3HisrybEI6I/+d9q1rz3AjV5ufar/lHp0iPrxB3cUBlKsCkx9hlBrB+2RZxNlmbQuB68s6huz1MO2O7R0sVMdZT2O9R2EetfJx6vEJurt2Ar9LRCLZQFn/Q+QcIaBEcyz2Oxj/ssZ+rAZdhhqm26p3xiJdg3K774Ksuk68u3tEzV0AZ/Yw0S2lQ5+sa/NwXrKRG2CZ6bJ3HYzfLb3i9qGGlB8jsMMsmPm6j5e6zhTHDqF6yRZzGBaCF5VKF4LdTA5axPEc5FhCQ47z/iGUPEAgSE9AYzpFNlCpos/D0oDD21mwRSbXBVhOobsfn3ypfYPjZQks9nUasgsxzkAA8Xx5q0Hk6lHViv0M5OA9B2MoEzwn2rkLzktjVk2Q0s/QJtW4FrzpuuQ/YAaAoZXqt9h1xqOZm+VLYhy1EdRU7GUkhFpsC+7lcuvbz51Ls6jIh2qYGgjAuuqTAIMpiaC7wLuVYh9jOgG61mN5gobrl8992dGDnAA3HUgGgyNUx3LPT5AGi/J1IBFM+Leqb1blQ9PRUOdnwMFUmMY1g5FCGXZy95zkF2zjIKAjP3yAL2r3YQ20p5HK9atFmcdQpf1fnDgw+clR+YYCROKtzoci3FY3hMBYZNNCctUc5489y4W2PA6DomW1d2a2clImMXuTq3EGP7c+hwxWtYZ7g4HFMZ7Mbpc7WFj46Y6L+9x+czxPYUY2yCltTh+bpyucKBI/yCWr/73I7c+xz3MlYI5onoLsyyKNlsI78P5Zh5RM7kPHReqbyudYE1UmqRiq4KcllcCNRRqtzGdfpOE7OBBqvpXx9jgZ1AddtFQFJK0+QqXy9yVV9I2YFUm1IxuRwS2xFLfVYdQ6AmAGmfFsJyAlN5QksDOMZZEJWi8vkEhELsVmvjfe78k+i/pGD9svHqXx92rmprMfOCVL5FM70gxR8MrVzGWd8P+8r2ERpRjW65wkCifMEPUJsgSDr3x4YnHr5OJWvN7nThFicmCpxyd3haMqRY2hYfekw7DnRgn/yWZi+vVyoHIfKEwjURkTiPQPrVMtYiM2uivl/IcdXRXBtl49T+fq0c1O5C+lUTOlKWU9wC3fyPrpSntrtfakUi+gZonkCytrSHkLjk0n2DI/vOJ9RXkb/r3dgLoEbYxjRaDVj+frI66pyPB3msp5Q63hXenmCx+j/V1wjI2Tmk9J+jE7l69POVWXJvTmnlVbez0KIJEZKjx20Zvzxgwt+G66V/i8j0aOGoOnS37iKGLn1PUqVM3PCuO7lEclVU/nr6FFZlpyfE36tHbieNiGHdY/wcnPG6w4Eup632NE5gjHvkoG4e81kWag0onudNybJEZwOg2C1MmOUdiaqh5DkRX6SmlCsos/u75QGrJkgp7Gj+Xzv58u3/AKOPxRR5EpjwzrquTVV2Z17ObxfM/z90foJaFsnZVd+gTvNwURloNrLcyXbps3WjuuMB1p1VD/8r+S5CAK/neuhhP09px1E87rxsmvfEgjARx7DqSnqa5odXKprvvRcQBBmNYgv1k+Qv6P6NLOzOynUbRRA7VfOf7nCWSMAO/mkVp5OnjbbcKX0hzo/yhyeH8FiTvSZZDaGm+HluoECGkZ1wDNVdOuPoHcoefhkNWV6s+gs9t9/xN3HnWl90bputLycMcAo3haZKh4AfkrpryWzjSzXcoEcatXQOHsP2pNFePXjZQXD5lVsU8TB/TzUilfua0n8WU0NpDZpFMZqHlzB7fO9lLqSmvgp444/cRLO8NkpAvHJ5Xk4Utrg/uvWtAz4Dz4WX7D4Iv7/r6OlZEwwhoIVM78X4mnUgbv3on12AgCUBug6Sk0Tv+Tg/bEIb54nD6f4bnNFE3OYvdqpXeT7mjwcMFHImb+c9ZUhejMYxOr7PhMZJ3Oy8oH3BhpILYjnCMJsMvyMs3KQo1CZYJmgR+Xvh/PFJPNK5KmQUP8UFo3tPr5t4vM2AST6DEMlU4pVO6nhPdZ5JmcIDn7fQeYoFWUFBEWbRssS2oNKiv9DlX0iEHkJ+dPFSG6N5LeZnB2D6MkIjR00JvTFSf6PnnT05W8hamSP0p/9jVzXMMmy+44mkZXziqyBoOjdUfJSzug4S6PKcua6f+rHCV/MYpBezt8CjvNSlv6YBMpyfMWSNt3ciGjWkDgs4MC7VJ3aE2Gy96QMY59WjP9kQwPilFUQ7OgfJbKR0zk+9wHuKYYm7lnSlwRfY9lGD8O6N34mmnERKFuRbeqOlK+XKJF/R66lNCBBmCbpG/RANHP8gSazfzSXVDZcJGLgtJzqXBA+hmkc/2VIoAtcAirG2EWNqbUi6R3Hp0MXbTkoX18+EmN1QV9vwc/Z7qMLdJ0BLvRjbZeg8TabGKOf+qmf+qmf+unC0/8AohxNfqIfbKgAAAAASUVORK5CYII=",pa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAACO98lFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAjFSURBVHgB7VprbBTXGT13dmbXaxuydpwH4eUgFIOTCrmQPuI0MZUStT9CqNIHf9oG2ihVqQppKUiVqqxQo4iISEDUpiiV5YYqUuNIJa0IJDSOU9pCJGiiUBrIAzteQATjB37tc+bm3F0nwWZ25+56IEbaI429nrnz7Zlvvvc1UEYZZZRRRhlllFFGXgjvJVLUP4gbjDDWC4l7pIFaTHcI2MJBjA/3QvA8nvl/u0gVWm56yWv8EWoyFjbw40MSqIJEANMdMnvU8+fCVF32zO8KLfdUguGgiscD1OqoEPjeGHDc6x7TRpUFrOIb2SQFDo4ZWG1IOF7X/EIohZBh4uv8+BQ5P4CpKsEMISBszOXHWDyG17r3iiQ0cNuP5XMG8H0psTAC3Pz2TvGqzjW/0LBGwgqQOzDPa63htQAJIOAgwAPvaypAwblAn3TQyvuuMzL4WTQqDZ1rfiHsIGmSc8D2dl/PL6/gYdLHLImiwGA0Ek6hnUTO8P4v74lhuc41v1AMb603kNVoCV47lECM/t/K++vMSW+80DW/oMtbzxIoyCpBCeqNyzG0B8bf+OtdE60h3zU/UAxvzzqhZZWsh4Wu8cXdKBYSLC9wE2+2GAfOU+0jWtd8AGXX81d35y5xc6F1ntlBaTTzmTbrUSpyvlnHZFhX1LUpQqMa9FZCdlGOZHfC8T+AXS7wwepNA69pri2MrCXYOY3u+4voxlWClavkp7y9oGUJgSLT43SBLm9vJbBYMq2Jp1aulBHTxHpWfD/0up1la6yyEt969lnRhysJF975oOUO0r70vGUj4giNQMmGKz2oZ3F+Ih9vNxQTGD/F7t1ikNYQrZDYpnE7MiGmP5+giqrjb2I2C5y1hsAy+nzcluhABm3P7REDKMA7H/QswaXgUIrgr0FcQSgFfPgmFoUk2vjwDYx6YXWeCmnmj7vWrJA/aP2bGEYB3m4oyRIeZExge62GLJfEBBUDUgHGgL/6HwPOHEYt28J1lomm2jkwZy+mlbGl6zmKmqFetBg2fsplW/LxzgdvS2CAkS59WNBBRMpLYwKVEKjCZYsBlSyz7wubMJc0cMJTTW78smv4+Y2PMJN8VmBcCfl4u6EkS2ijK6xvkdFExD0mnLEmxoAopHHuXswWAazln8t4xDlQ6eDR9vQkPy4E9gGCgTbCF4Ab6Q/hNNtyJ6t4lQ4FLTNSiHfe5/NakPUtF2HbOvVigvLjvgNYZBlo4wM0KO7IyWxmdrlrI/34iXE/9iRrMvGl8T87idtPHgOWLmQm5PTw5LvZljnBbPC2F29XuVqLNFONG4Y7URs0sS5goGnGXJg3fIF+TFM9+xZqRs+hxclM9ONCqAlhYDiB7cwEf3yvCxU9p3LnE2lIWslZGsVTpfDWaqVV5VVq1ci3V8lgdl9FEObi24DZMznvug645daszJlMcyu0hfXCoJsnaeamzMBJJKjPOK0jg3+wbf5J7BQOl8Jbr2KcwnxZ2X7axjUsrnA9skPQrJmq4Z/q97MTbA1khy4HsIADmN8wBgxRxta0gRdMBuK4wAX7A/S3v3/RaL0I3loxwZlK75BBikSPywS+eJoeeysjeZJUT7+TDVxxBrMjWnJeQZ0TxK8tgQVsufeJCJ5+bDcuKC0KFRKnwFt7vGaWMFmKtsgIzXE1713EgIauk8D+DuCf/wLOnckqIcx6Y9nm5XJJITlbmuUMw8Iqvtj7Ka+L0+9Ho8xQgjMZNwUUy9tTCSEUrwSVEh+/Uy5gZfd7kt5Acxvg/b8Vafw9MYLe1Cj6qJRXeO55RvVGmnjrY3dL11nFzqXSSgfQxHWbGPxGKGvzsRtxwotDMbxL6iILIdoog9V1+Arz9xa+sUZm9hNMhZtg47CdRtCsRFimYdAKEsk0QlYYH/BdbmR6+8MTd8jHN/5HtH0mTYrhEG4K2lSggUo+zzNWEnva24V33Pe9i3TR5vPfkYGzPWhwuEXHIKUKoEE2Mq/Tts6T4jp+/7U8tzdl4dHIEE4+fIR24IKtS+U2UcF7BB9UYPO2ZtlAedePy0xTiX10gyZyOET/3/qLgyIODfjfO0wSphRwLoYlJL2L9Xo9T4UZ7B1G/CYqIDnupE9yA2Tn6XvQuykq8tLZcESc3/FN2eoMop/p8kk+qKoqA/ytngO8UylvgPK3rz2I3l9BH7ourD1yv1jgyFnUUnuPMKjN5w7PS5zl3UGSK2m2x1jbV9F3O+0Qdjz0hvgoWkABn+Dne8UQ+4H9vP/f/B4zKzOAZirlfsp6izKreXxJQGjnKTfe+VDSeC09xjdv4BtMfQOkFWWvcKL2FAIGN+3594tq/++RXFmtDSsBxkfcTuvqu0QmO3cuuRtFIuBXilTdmGpEJjcjtIIKdY5+1x/tFJn+ObDpu33jW18hFIk0myPuTs9wlclrqmstRl4+3m7QqxPsiXU4u7cEn/Iwz10bZmTftVTOmj+MxcEMfknzjdO89AogTJQZZOHkp8zJvPOu81rwSeV18eg6bmFgho3tPP0nXniYQezbwdylGqbDnsmNjA78lunGOx9K2pBV6S45iH00te+yJziohq7UeAV98EWmxjXzqnEUReJyyNTdkNWzBBdBq7tFgmXxq40X8F8ksymS7R0ScyPoX05/RgnwU2Y+3m7QqxjVKhe7iuaI9cJH+CazAO/J0LYEHd+aTiiGt15MyA0nQi/fIhfhKsBLC2WI1Wuj6ddQ5SLfmsVCpqOjQWr/39LnCgch3fJSr2JUSpBQGTdI+5qF6Y4c10FdH9bad1BlG+XFaGJfi6ev/L5iKWA/M4eWe8CXrXnuJtksWvrY2oYcG9XLu4XnP3N+3lAxodZBo1QWwV7Ea72nEjjEGKUT7Ddy/4XacWjBVRATcu4bYhc6wo8vey33VMJXT2Hg0HxsFib7GoF72eFN+5jAgKgsoIfHn0cd7PBarxU6JMdcR+chMhZEFef9V0VM4EvLpFMYvbMHg8XMIcooo4wyyiijjDLKmISPAcfCsmd6OJoeAAAAAElFTkSuQmCC",ha="data:image/png;base64,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",ga=""+new URL("hypergamma-logo-colorized-921f89f0.png",import.meta.url).href;class Fs extends G{constructor(...e){super(...e)}updated(){const e=this.query("#readout");this.subscribe("decoded",r=>{e.innerHTML=JSON.stringify(r)})}render(){return E`
    <h1>Experiments</h1>
    <p id="readout">No device connected</p>
    `}}customElements.get("hypergamma-experiments-page")||customElements.define("hypergamma-experiments-page",Fs);const ba={home:da,plus:fa,devices:ua,analytics:pa,reports:ha},me={};for(const[t,e]of Object.entries(ba)){const r=document.createElement("img");r.src=e,me[t]=r}let Ne=document.querySelector("hypergamma-dashboard");Ne||(Ne=new Bs);Ne.logo=ga;Ne.name="HyperGamma";Ne.renderNameInSidebar=!1;const ya={"/":new Kr({label:"Home",icon:me.home}),analytics:new Cs({label:"Analytics",icon:me.analytics}),plus:new Xr({label:"Hyper+",icon:me.plus,pages:{focus:new Ms({label:"Focus"}),training:new Ls({label:"Training"}),performance:new Js({label:"Performance"}),meditation:new Ds({label:"Meditation"})}}),experiments:new Fs({label:"Experiments"}),devices:new Ns({label:"Devices",icon:me.devices}),reports:new Ts({label:"Reports",icon:me.reports})};Ne.pages=ya;
